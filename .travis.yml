language: python
dist: bionic

env:
  - TEST="flake8"
  - OS=debian10 PY=3 TEST="all"
  - OS=debian10 PY=3 TEST="all"
  - OS=debian9 PY=3 TEST="all"
  - OS=debian9 PY=2 TEST="all"
  - OS=ubuntu18.04 PY=3 TEST="all"
  - OS=ubuntu18.04 PY=2 TEST="all"
  - OS=ubuntu20.04 PY=3 TEST="all_splitted"
  - OS=debian11 PY=3 TEST="all_splitted"
  # - OS=ubuntu20.04 PY=3 TEST="basic"
  # - OS=ubuntu20.04 PY=3 TEST="controller"
  # - OS=ubuntu20.04 PY=3 TEST="controller2"
  # - OS=ubuntu20.04 PY=3 TEST="tangosource"
  # - OS=debian11 PY=3 TEST="basic"
  # - OS=debian11 PY=3 TEST="controller"
  # - OS=debian11 PY=3 TEST="controller2"
  # - OS=debian11 PY=3 TEST="tangosource"
  # - OS=ubuntu20.04 PY=3 TEST="all"
  # - OS=debian11 PY=3 TEST="all"
  # - OS=debian10 PY=3 TEST="basic"
  # - OS=debian10 PY=3 TEST="controller"
  # - OS=debian10 PY=3 TEST="tangosource"
  # - OS=debian10 PY=2 TEST="basic"
  # - OS=debian10 PY=2 TEST="controller"
  # - OS=debian10 PY=2 TEST="tangosource"
  # - OS=debian9 PY=3 TEST="basic"
  # - OS=debian9 PY=3 TEST="controller"
  # - OS=debian9 PY=3 TEST="tangosource"
  # - OS=debian9 PY=2 TEST="basic"
  # - OS=debian9 PY=2 TEST="controller"
  # - OS=debian9 PY=2 TEST="tangosource"
  # - OS=ubuntu18.04 PY=3 TEST="basic"
  # - OS=ubuntu18.04 PY=3 TEST="controller"
  # - OS=ubuntu18.04 PY=3 TEST="tangosource"
  # - OS=ubuntu18.04 PY=2 TEST="basic"
  # - OS=ubuntu18.04 PY=2 TEST="controller"
  # - OS=ubuntu18.04 PY=2 TEST="tangosource"

services:
  - docker
  - xvfb

before_install:
  - if [ $TEST == "flake8" ]; then sudo apt-get update -qq ; fi
  - if [ $TEST == "flake8" ]; then sudo pip install flake8; fi
  - if [ $TEST != "flake8" ]; then chmod +x .travis/run.sh; fi
  - if [ $TEST != "flake8" ]; then chmod +x .travis/install.sh; fi

before_script:
  - if [ $TEST != "flake8" ]; then docker build -t ndts .travis/${OS}_py${PY}; fi
  - if [ $TEST != "flake8" ]; then docker run  --name  ndts -d -it -v `pwd`:/home/tango -v /tmp/.X11-unix:/tmp/.X11-unix:ro  -e DISPLAY=$DISPLAY   ndts; fi
  - if [ $TEST != "flake8" ]; then .travis/install.sh ${OS} ${PY}; fi

script:
  - if [ $TEST != "flake8" ]; then .travis/run.sh ${TEST} ${PY} ${OS}; fi
  - if [ $TEST == "flake8" ]; then flake8; fi


after-script:
  - if [ $TEST != "flake8" ]; then docker stop ndts; fi
  - if [ $TEST != "flake8" ]; then docker rm ndts; fi
