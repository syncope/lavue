

<!doctype html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>lavuelib.toolWidget &#8212; LaVue 2.83.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/bizstyle.css" />
    
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">LaVue 2.83.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">lavuelib.toolWidget</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for lavuelib.toolWidget</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (C) 2017  DESY, Christoph Rosemann, Notkestr. 85, D-22607 Hamburg</span>
<span class="c1">#</span>
<span class="c1"># lavue is an image viewing program for photon science imaging detectors.</span>
<span class="c1"># Its usual application is as a live viewer using hidra as data source.</span>
<span class="c1">#</span>
<span class="c1"># This program is free software; you can redistribute it and/or</span>
<span class="c1"># modify it under the terms of the GNU General Public License</span>
<span class="c1"># as published by the Free Software Foundation in  version 2</span>
<span class="c1"># of the License.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with this program; if not, write to the Free Software</span>
<span class="c1"># Foundation, Inc., 51 Franklin Street, Fifth Floor,</span>
<span class="c1"># Boston, MA  02110-1301, USA.</span>
<span class="c1">#</span>
<span class="c1"># Authors:</span>
<span class="c1">#     Jan Kotanski &lt;jan.kotanski@desy.de&gt;</span>
<span class="c1">#     Christoph Rosemann &lt;christoph.rosemann@desy.de&gt;</span>
<span class="c1">#</span>

<span class="sd">&quot;&quot;&quot; image widget &quot;&quot;&quot;</span>


<span class="kn">from</span> <span class="nn">.qtuic</span> <span class="kn">import</span> <span class="n">uic</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.optimize</span>
<span class="kn">import</span> <span class="nn">scipy.interpolate</span>
<span class="kn">import</span> <span class="nn">pyqtgraph</span> <span class="k">as</span> <span class="nn">_pg</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">pyqtgraph</span> <span class="kn">import</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">functions</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">pyqtgraph</span> <span class="kn">import</span> <span class="n">QtWidgets</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">pyqtgraph</span> <span class="kn">import</span> <span class="n">QtGui</span> <span class="k">as</span> <span class="n">QtWidgets</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">geometryDialog</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">rangeDialog</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">diffRangeDialog</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">takeMotorsDialog</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">intervalsDialog</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">motorWatchThread</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">edDictDialog</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">edListDialog</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">commandThread</span>
<span class="kn">from</span> <span class="nn">.sardanaUtils</span> <span class="kn">import</span> <span class="n">debugmethod</span><span class="p">,</span> <span class="n">numpyEncoder</span>

<span class="k">try</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">tango</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">PyTango</span> <span class="k">as</span> <span class="nn">tango</span>
    <span class="c1">#: (:obj:`bool`) tango imported</span>
    <span class="n">TANGO</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="c1">#: (:obj:`bool`) tango imported</span>
    <span class="n">TANGO</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pyFAI</span>
    <span class="c1">#: (:obj:`bool`) pyFAI imported</span>
    <span class="n">PYFAI</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="c1">#: (:obj:`bool`) pyFAI imported</span>
    <span class="n">PYFAI</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
    <span class="n">long</span> <span class="o">=</span> <span class="nb">int</span>


<span class="n">_intensityformclass</span><span class="p">,</span> <span class="n">_intensitybaseclass</span> <span class="o">=</span> <span class="n">uic</span><span class="o">.</span><span class="n">loadUiType</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span>
                 <span class="s2">&quot;ui&quot;</span><span class="p">,</span> <span class="s2">&quot;IntensityToolWidget.ui&quot;</span><span class="p">))</span>

<span class="n">_roiformclass</span><span class="p">,</span> <span class="n">_roibaseclass</span> <span class="o">=</span> <span class="n">uic</span><span class="o">.</span><span class="n">loadUiType</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span>
                 <span class="s2">&quot;ui&quot;</span><span class="p">,</span> <span class="s2">&quot;ROIToolWidget.ui&quot;</span><span class="p">))</span>

<span class="n">_cutformclass</span><span class="p">,</span> <span class="n">_cutbaseclass</span> <span class="o">=</span> <span class="n">uic</span><span class="o">.</span><span class="n">loadUiType</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span>
                 <span class="s2">&quot;ui&quot;</span><span class="p">,</span> <span class="s2">&quot;LineCutToolWidget.ui&quot;</span><span class="p">))</span>

<span class="n">_angleqformclass</span><span class="p">,</span> <span class="n">_angleqbaseclass</span> <span class="o">=</span> <span class="n">uic</span><span class="o">.</span><span class="n">loadUiType</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span>
                 <span class="s2">&quot;ui&quot;</span><span class="p">,</span> <span class="s2">&quot;AngleQToolWidget.ui&quot;</span><span class="p">))</span>

<span class="n">_diffractogramformclass</span><span class="p">,</span> <span class="n">_diffractogrambaseclass</span> <span class="o">=</span> <span class="n">uic</span><span class="o">.</span><span class="n">loadUiType</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span>
                 <span class="s2">&quot;ui&quot;</span><span class="p">,</span> <span class="s2">&quot;DiffractogramToolWidget.ui&quot;</span><span class="p">))</span>

<span class="n">_maximaformclass</span><span class="p">,</span> <span class="n">_maximabaseclass</span> <span class="o">=</span> <span class="n">uic</span><span class="o">.</span><span class="n">loadUiType</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span>
                 <span class="s2">&quot;ui&quot;</span><span class="p">,</span> <span class="s2">&quot;MaximaToolWidget.ui&quot;</span><span class="p">))</span>

<span class="n">_motorsformclass</span><span class="p">,</span> <span class="n">_motorsbaseclass</span> <span class="o">=</span> <span class="n">uic</span><span class="o">.</span><span class="n">loadUiType</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span>
                 <span class="s2">&quot;ui&quot;</span><span class="p">,</span> <span class="s2">&quot;MotorsToolWidget.ui&quot;</span><span class="p">))</span>

<span class="n">_meshformclass</span><span class="p">,</span> <span class="n">_meshbaseclass</span> <span class="o">=</span> <span class="n">uic</span><span class="o">.</span><span class="n">loadUiType</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span>
                 <span class="s2">&quot;ui&quot;</span><span class="p">,</span> <span class="s2">&quot;MeshToolWidget.ui&quot;</span><span class="p">))</span>

<span class="n">_onedformclass</span><span class="p">,</span> <span class="n">_onedbaseclass</span> <span class="o">=</span> <span class="n">uic</span><span class="o">.</span><span class="n">loadUiType</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span>
                 <span class="s2">&quot;ui&quot;</span><span class="p">,</span> <span class="s2">&quot;OneDToolWidget.ui&quot;</span><span class="p">))</span>

<span class="n">_projectionformclass</span><span class="p">,</span> <span class="n">_projectionbaseclass</span> <span class="o">=</span> <span class="n">uic</span><span class="o">.</span><span class="n">loadUiType</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span>
                 <span class="s2">&quot;ui&quot;</span><span class="p">,</span> <span class="s2">&quot;ProjectionToolWidget.ui&quot;</span><span class="p">))</span>

<span class="n">_parametersformclass</span><span class="p">,</span> <span class="n">_parametersbaseclass</span> <span class="o">=</span> <span class="n">uic</span><span class="o">.</span><span class="n">loadUiType</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span>
                 <span class="s2">&quot;ui&quot;</span><span class="p">,</span> <span class="s2">&quot;ParametersToolWidget.ui&quot;</span><span class="p">))</span>

<span class="n">_qroiprojformclass</span><span class="p">,</span> <span class="n">_qroiprojbaseclass</span> <span class="o">=</span> <span class="n">uic</span><span class="o">.</span><span class="n">loadUiType</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span>
                 <span class="s2">&quot;ui&quot;</span><span class="p">,</span> <span class="s2">&quot;QROIProjToolWidget.ui&quot;</span><span class="p">))</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;IntensityToolWidget&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ROIToolWidget&#39;</span><span class="p">,</span>
    <span class="s1">&#39;LineCutToolWidget&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AngleQToolWidget&#39;</span><span class="p">,</span>
    <span class="s1">&#39;MotorsToolWidget&#39;</span><span class="p">,</span>
    <span class="s1">&#39;MeshToolWidget&#39;</span><span class="p">,</span>
    <span class="s1">&#39;OneDToolWidget&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ProjectionToolWidget&#39;</span><span class="p">,</span>
    <span class="s1">&#39;MaximaToolWidget&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ParametersToolWidget&#39;</span><span class="p">,</span>
    <span class="s1">&#39;DiffractogramToolWidget&#39;</span><span class="p">,</span>
    <span class="s1">&#39;QROIProjToolWidget&#39;</span><span class="p">,</span>
    <span class="s1">&#39;twproperties&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;lavue&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Converters</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; set of converters</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">toBool</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; converts to bool</span>

<span class="sd">        :param value: variable to convert</span>
<span class="sd">        :type value: any</span>
<span class="sd">        :returns: result in bool type</span>
<span class="sd">        :rtype: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;str&#39;</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;unicode&#39;</span><span class="p">:</span>
            <span class="n">lvalue</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">lvalue</span> <span class="o">==</span> <span class="s1">&#39;false&#39;</span> <span class="ow">or</span> <span class="n">lvalue</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="k">class</span> <span class="nc">ToolParameters</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; tool parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#: (:obj:`bool`) lines enabled</span>
        <span class="c1"># self.lines = False</span>
        <span class="c1">#: (:obj:`bool`) rois enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rois</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#: (:obj:`bool`) cuts enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cuts</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#: (:obj:`bool`) mesh enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#: (:obj:`bool`) axes scale enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#: (:obj:`bool`) tool axes scale enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toolscale</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#: (:obj:`bool`) bottom 1d plot enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bottomplot</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#: (:obj:`bool`) right 1d plot enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rightplot</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#: (:obj:`bool`) cross hair locker enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crosshairlocker</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#: (:obj:`bool`) center lines enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">centerlines</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#: (:obj:`bool`) mark position lines enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">marklines</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#: (:obj:`bool`) tracking position lines enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trackinglines</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#: (:obj:`str`) infolineedit text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infolineedit</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`str`) infolabel text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infolabel</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`str`) infolabel text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infotips</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`str`) show maxima</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxima</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#: (:obj:`bool`) vertical and horizontal bounds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vhbounds</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#: (:obj:`bool`) angle range enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">regions</span> <span class="o">=</span> <span class="kc">False</span>


<span class="k">class</span> <span class="nc">ToolBaseWidget</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; tool widget</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#: (:obj:`str`) tool name</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span>
    <span class="c1">#: (:obj:`str`) tool name alias</span>
    <span class="n">alias</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
    <span class="c1">#: (:obj:`tuple` &lt;:obj:`str`&gt;) capitalized required packages</span>
    <span class="n">requires</span> <span class="o">=</span> <span class="p">()</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param parent: parent object</span>
<span class="sd">        :type parent: :class:`pyqtgraph.QtCore.QObject`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QWidget</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="c1">#: (:class:`pyqtgraph.QtCore.QObject`) mainwidget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="c1">#: (:class:`Ui_ToolBaseWidget&#39;)</span>
        <span class="c1">#:     ui_toolwidget object from qtdesigner</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ui</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:class:`ToolParameters`) tool parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">ToolParameters</span><span class="p">()</span>

        <span class="c1">#: (:obj:`list` &lt; [:class:`pyqtgraph.QtCore.pyqtSignal`, :obj:`str`] &gt;)</span>
        <span class="c1">#: list of [signal, slot] object to connect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signal2slot</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">activate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; activates tool widget</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">deactivate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; deactivates tool widget</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">afterplot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; command after plot</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">beforeplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">rawarray</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; command  before plot</span>

<span class="sd">        :param array: 2d image array</span>
<span class="sd">        :type array: :class:`numpy.ndarray`</span>
<span class="sd">        :param rawarray: 2d raw image array</span>
<span class="sd">        :type rawarray: :class:`numpy.ndarray`</span>
<span class="sd">        :return: 2d image array and raw image</span>
<span class="sd">        :rtype: (:class:`numpy.ndarray`, :class:`numpy.ndarray`)</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set configuration for the current tool</span>

<span class="sd">        :param configuration: configuration string</span>
<span class="sd">        :type configuration: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides configuration for the current tool</span>

<span class="sd">        :returns configuration: configuration string</span>
<span class="sd">        :rtype configuration: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>


<div class="viewcode-block" id="IntensityToolWidget"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.IntensityToolWidget">[docs]</a><span class="k">class</span> <span class="nc">IntensityToolWidget</span><span class="p">(</span><span class="n">ToolBaseWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; intensity tool widget</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#: (:obj:`str`) tool name</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Intensity&quot;</span>
    <span class="c1">#: (:obj:`str`) tool name alias</span>
    <span class="n">alias</span> <span class="o">=</span> <span class="s2">&quot;intensity&quot;</span>
    <span class="c1">#: (:obj:`tuple` &lt;:obj:`str`&gt;) capitalized required packages</span>
    <span class="n">requires</span> <span class="o">=</span> <span class="p">()</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param parent: parent object</span>
<span class="sd">        :type parent: :class:`pyqtgraph.QtCore.QObject`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ToolBaseWidget</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

        <span class="c1">#: (:class:`Ui_IntensityToolWidget&#39;)</span>
        <span class="c1">#:        ui_toolwidget object from qtdesigner</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span> <span class="o">=</span> <span class="n">_intensityformclass</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1">#: (:class:`lavuelib.settings.Settings`) configuration settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">settings</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">crosshairlocker</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">infolineedit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">infotips</span> <span class="o">=</span> \
            <span class="s2">&quot;coordinate info display for the mouse pointer&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">crosshairCheckBox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">crosshairlocker</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_updateCrossHairLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">crosshairlocker</span><span class="p">)</span>

        <span class="c1">#: (:obj:`list` &lt; [:class:`pyqtgraph.QtCore.pyqtSignal`, :obj:`str`] &gt;)</span>
        <span class="c1">#: list of [signal, slot] object to connect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signal2slot</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">axesPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">setTicks</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">crosshairCheckBox</span><span class="o">.</span><span class="n">stateChanged</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">crosshairCheckBox</span><span class="o">.</span><span class="n">stateChanged</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_updateCrossHairLocker</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">mouseImagePositionChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_message</span><span class="p">]</span>
        <span class="p">]</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_updateCrossHairLocker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">crosshairlocker</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateinfowidgets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides intensity message</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">intensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">currentIntensity</span><span class="p">()[:</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">intensity</span><span class="p">):</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ilabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scalingLabel</span><span class="p">()</span>
        <span class="n">txdata</span><span class="p">,</span> <span class="n">tydata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scaledxy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">xunits</span><span class="p">,</span> <span class="n">yunits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">axesunits</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> \
           <span class="n">intensity</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">itn</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">it</span><span class="p">))</span>
                   <span class="k">else</span> <span class="n">it</span> <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">intensity</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">itn</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">txdata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;x = </span><span class="si">%f%s</span><span class="s2">, y = </span><span class="si">%f%s</span><span class="s2">, &quot;</span> \
                              <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> = (</span><span class="si">%.2f</span><span class="s2">, </span><span class="si">%.2f</span><span class="s2">, </span><span class="si">%.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
                                  <span class="n">txdata</span><span class="p">,</span>
                                  <span class="p">(</span><span class="s2">&quot; </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">xunits</span><span class="p">)</span> <span class="k">if</span> <span class="n">xunits</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                  <span class="n">tydata</span><span class="p">,</span>
                                  <span class="p">(</span><span class="s2">&quot; </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">yunits</span><span class="p">)</span> <span class="k">if</span> <span class="n">yunits</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                  <span class="n">ilabel</span><span class="p">,</span>
                                  <span class="n">itn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">itn</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">itn</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;x = </span><span class="si">%i%s</span><span class="s2">, y = </span><span class="si">%i%s</span><span class="s2">, &quot;</span> \
                              <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> = (</span><span class="si">%.2f</span><span class="s2">, </span><span class="si">%.2f</span><span class="s2">, </span><span class="si">%.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
                                  <span class="n">x</span><span class="p">,</span>
                                  <span class="p">(</span><span class="s2">&quot; </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">xunits</span><span class="p">)</span> <span class="k">if</span> <span class="n">xunits</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                  <span class="n">y</span><span class="p">,</span>
                                  <span class="p">(</span><span class="s2">&quot; </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">yunits</span><span class="p">)</span> <span class="k">if</span> <span class="n">yunits</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                  <span class="n">ilabel</span><span class="p">,</span>
                                  <span class="n">itn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">itn</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">itn</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">setDisplayedText</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">txdata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;x = </span><span class="si">%f%s</span><span class="s2">, y = </span><span class="si">%f%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">txdata</span><span class="p">,</span>
                    <span class="p">(</span><span class="s2">&quot; </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">xunits</span><span class="p">)</span> <span class="k">if</span> <span class="n">xunits</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="n">tydata</span><span class="p">,</span>
                    <span class="p">(</span><span class="s2">&quot; </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">yunits</span><span class="p">)</span> <span class="k">if</span> <span class="n">yunits</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="n">ilabel</span><span class="p">,</span>
                    <span class="n">intensity</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;x = </span><span class="si">%i%s</span><span class="s2">, y = </span><span class="si">%i%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">x</span><span class="p">,</span>
                    <span class="p">(</span><span class="s2">&quot; </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">xunits</span><span class="p">)</span> <span class="k">if</span> <span class="n">xunits</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="n">y</span><span class="p">,</span>
                    <span class="p">(</span><span class="s2">&quot; </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">yunits</span><span class="p">)</span> <span class="k">if</span> <span class="n">yunits</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="n">ilabel</span><span class="p">,</span>
                    <span class="n">intensity</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">setDisplayedText</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

<div class="viewcode-block" id="IntensityToolWidget.afterplot"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.IntensityToolWidget.afterplot">[docs]</a>    <span class="k">def</span> <span class="nf">afterplot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; command after plot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sendresults</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__sendresults</span><span class="p">()</span></div>

<div class="viewcode-block" id="IntensityToolWidget.configure"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.IntensityToolWidget.configure">[docs]</a>    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set configuration for the current tool</span>

<span class="sd">        :param configuration: configuration string</span>
<span class="sd">        :type configuration: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configuration</span><span class="p">:</span>
            <span class="n">cnf</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;crosshair_locker&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">crosshairlocker</span> <span class="o">=</span> <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;crosshair_locker&quot;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">crosshairCheckBox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="n">crosshairlocker</span><span class="p">)</span>
            <span class="n">pars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">,</span> <span class="s2">&quot;scale&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;xtext&quot;</span><span class="p">,</span> <span class="s2">&quot;ytext&quot;</span><span class="p">,</span> <span class="s2">&quot;xunits&quot;</span><span class="p">,</span> <span class="s2">&quot;yunits&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">par</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateTicks</span><span class="p">(</span><span class="n">cnf</span><span class="p">)</span></div>

<div class="viewcode-block" id="IntensityToolWidget.configuration"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.IntensityToolWidget.configuration">[docs]</a>    <span class="k">def</span> <span class="nf">configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides configuration for the current tool</span>

<span class="sd">        :returns configuration: configuration string</span>
<span class="sd">        :rtype configuration: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cnf</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;crosshair_locker&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">crosshairCheckBox</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">,</span> <span class="n">xsc</span><span class="p">,</span> <span class="n">ysc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scale</span><span class="p">()</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;xunits&quot;</span><span class="p">],</span> <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;yunits&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">axesunits</span><span class="p">()</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;xtext&quot;</span><span class="p">],</span> <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;ytext&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">axestext</span><span class="p">()</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">]</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;scale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">xsc</span><span class="p">,</span> <span class="n">ysc</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">cnf</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">numpyEncoder</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__sendresults</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; send results to LavueController</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">intensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">currentIntensity</span><span class="p">()[:</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">intensity</span><span class="p">):</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">scaling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scalingLabel</span><span class="p">()</span>
        <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scaledxy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">xunits</span><span class="p">,</span> <span class="n">yunits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">axesunits</span><span class="p">()</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tool&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">}</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">it</span><span class="p">))</span>
                         <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">intensity</span><span class="p">]</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;intensity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">intensity</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;intensity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">intensity</span><span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;imagename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">imageName</span><span class="p">()</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;pixel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">y</span><span class="p">)]</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;scaled_coordiantes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">sx</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">sy</span><span class="p">)]</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;coordiantes_units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">xunits</span><span class="p">,</span> <span class="n">yunits</span><span class="p">]</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;intensity_scaling&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaling</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span>
            <span class="s2">&quot;ToolResults&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">numpyEncoder</span><span class="p">))</span></div>


<div class="viewcode-block" id="MotorsToolWidget"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.MotorsToolWidget">[docs]</a><span class="k">class</span> <span class="nc">MotorsToolWidget</span><span class="p">(</span><span class="n">ToolBaseWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; motors tool widget</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#: (:obj:`str`) tool name</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;MoveMotors&quot;</span>
    <span class="c1">#: (:obj:`str`) tool name alias</span>
    <span class="n">alias</span> <span class="o">=</span> <span class="s2">&quot;movemotors&quot;</span>
    <span class="c1">#: (:obj:`tuple` &lt;:obj:`str`&gt;) capitalized required packages</span>
    <span class="n">requires</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;TANGO&quot;</span><span class="p">,)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param parent: parent object</span>
<span class="sd">        :type parent: :class:`pyqtgraph.QtCore.QObject`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ToolBaseWidget</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

        <span class="c1">#: (:obj:`str`) x-motor name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__xmotorname</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="c1">#: (:obj:`str`) y-motor name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ymotorname</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="c1">#: (:obj:`str`) x final position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__xfinal</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`str`) y final position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__yfinal</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`str`) state of x-motor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__statex</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`str`) state of y-motor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__statey</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:class:`tango.DeviceProxy`) x-motor device</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__xmotordevice</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:class:`tango.DeviceProxy`) y-motor device</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ymotordevice</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:class:`lavuelib.motorWatchThread.motorWatchThread`) motor watcher</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__motorWatcher</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`bool`) is moving</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__moving</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#: (:obj:`bool`) is tracking</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__tracking</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1">#: (:class:`Ui_MotorsToolWidget&#39;)</span>
        <span class="c1">#:        ui_toolwidget object from qtdesigner</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span> <span class="o">=</span> <span class="n">_motorsformclass</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xcurLineEdit</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">ycurLineEdit</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>

        <span class="c1">#: (:obj:`bool`) position lines enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">marklines</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">trackinglines</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">infolineedit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">infotips</span> <span class="o">=</span> \
            <span class="s2">&quot;coordinate info display for the mouse pointer&quot;</span>

        <span class="c1">#: (:obj:`list` &lt; [:class:`pyqtgraph.QtCore.pyqtSignal`, :obj:`str`] &gt;)</span>
        <span class="c1">#: list of [signal, slot] object to connect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signal2slot</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">axesPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">setTicks</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">takePushButton</span><span class="o">.</span><span class="n">clicked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setMotors</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">movePushButton</span><span class="o">.</span><span class="n">clicked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_moveStopMotors</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">trackPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trackStopMotors</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">mouseImageDoubleClicked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updateFinal</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">mouseImagePositionChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_message</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xLineEdit</span><span class="o">.</span><span class="n">textEdited</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getFinal</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xLineEdit</span><span class="o">.</span><span class="n">textChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">yLineEdit</span><span class="o">.</span><span class="n">textEdited</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getFinal</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">yLineEdit</span><span class="o">.</span><span class="n">textChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">],</span>
        <span class="p">]</span>

    <span class="c1"># @debugmethod</span>
<div class="viewcode-block" id="MotorsToolWidget.configure"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.MotorsToolWidget.configure">[docs]</a>    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set configuration for the current tool</span>

<span class="sd">        :param configuration: configuration string</span>
<span class="sd">        :type configuration: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configuration</span><span class="p">:</span>
            <span class="n">cnf</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
            <span class="n">pars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">,</span> <span class="s2">&quot;scale&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;xtext&quot;</span><span class="p">,</span> <span class="s2">&quot;ytext&quot;</span><span class="p">,</span> <span class="s2">&quot;xunits&quot;</span><span class="p">,</span> <span class="s2">&quot;yunits&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">par</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateTicks</span><span class="p">(</span><span class="n">cnf</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;motors&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">motorname</span> <span class="o">=</span> <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;motors&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">motordevice</span> <span class="o">=</span> <span class="n">tango</span><span class="o">.</span><span class="n">DeviceProxy</span><span class="p">(</span><span class="n">motorname</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">,</span> <span class="s2">&quot;position&quot;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">motordevice</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
                            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Missing </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">attr</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__xmotorname</span> <span class="o">=</span> <span class="n">motorname</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__xmotordevice</span> <span class="o">=</span> <span class="n">motordevice</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">motorname</span> <span class="o">=</span> <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;motors&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">motordevice</span> <span class="o">=</span> <span class="n">tango</span><span class="o">.</span><span class="n">DeviceProxy</span><span class="p">(</span><span class="n">motorname</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">,</span> <span class="s2">&quot;position&quot;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">motordevice</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
                            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Missing </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">attr</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__ymotorname</span> <span class="o">=</span> <span class="n">motorname</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__ymotordevice</span> <span class="o">=</span> <span class="n">motordevice</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">if</span> <span class="s2">&quot;x_position&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;x_position&quot;</span><span class="p">]))</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">if</span> <span class="s2">&quot;y_position&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">yLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;y_position&quot;</span><span class="p">]))</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">if</span> <span class="s2">&quot;track&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;track&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">trackePushButton</span><span class="o">.</span><span class="n">text</span><span class="p">())</span> <span class="o">==</span> <span class="s2">&quot;Track&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_trackStopMotors</span><span class="p">()</span>
            <span class="k">if</span> <span class="s2">&quot;untrack&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;untrack&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">trackePushButton</span><span class="o">.</span><span class="n">text</span><span class="p">())</span> <span class="o">==</span> <span class="s2">&quot;Untrack&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_trackStopMotors</span><span class="p">()</span>
            <span class="k">if</span> <span class="s2">&quot;move&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;move&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">movePushButton</span><span class="o">.</span><span class="n">text</span><span class="p">())</span> <span class="o">==</span> <span class="s2">&quot;Move&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_moveStopMotors</span><span class="p">()</span>
            <span class="k">if</span> <span class="s2">&quot;stop&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;stop&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">movePushButton</span><span class="o">.</span><span class="n">text</span><span class="p">())</span> <span class="o">==</span> <span class="s2">&quot;Stop&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_moveStopMotors</span><span class="p">()</span></div>

    <span class="c1"># @debugmethod</span>
<div class="viewcode-block" id="MotorsToolWidget.configuration"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.MotorsToolWidget.configuration">[docs]</a>    <span class="k">def</span> <span class="nf">configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides configuration for the current tool</span>

<span class="sd">        :returns configuration: configuration string</span>
<span class="sd">        :rtype configuration: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cnf</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">,</span> <span class="n">xsc</span><span class="p">,</span> <span class="n">ysc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scale</span><span class="p">()</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;xunits&quot;</span><span class="p">],</span> <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;yunits&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">axesunits</span><span class="p">()</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;xtext&quot;</span><span class="p">],</span> <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;ytext&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">axestext</span><span class="p">()</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">]</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;scale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">xsc</span><span class="p">,</span> <span class="n">ysc</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;x_position&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;x_position&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;y_position&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">yLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;y_position&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">yLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;motors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__xmotorname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ymotorname</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">movePushButton</span><span class="o">.</span><span class="n">text</span><span class="p">())</span> <span class="o">==</span> <span class="s2">&quot;Move&quot;</span><span class="p">:</span>
            <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;motor_state&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ON&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;motor_state&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;MOVING&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tracking</span><span class="p">:</span>
            <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;tracking&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;tracking&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">cnf</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">numpyEncoder</span><span class="p">)</span></div>

<div class="viewcode-block" id="MotorsToolWidget.activate"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.MotorsToolWidget.activate">[docs]</a>    <span class="k">def</span> <span class="nf">activate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; activates tool widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__xfinal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__yfinal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updatePositionMark</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__xfinal</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__yfinal</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span></div>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_updateFinal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; updates the final motors position</span>

<span class="sd">        :param xdata: x pixel position</span>
<span class="sd">        :type xdata: :obj:`float`</span>
<span class="sd">        :param ydata: y-pixel position</span>
<span class="sd">        :type ydata: :obj:`float`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__moving</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scaledxy</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">xdata</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">ydata</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__xfinal</span> <span class="o">=</span> <span class="n">x</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__yfinal</span> <span class="o">=</span> <span class="n">y</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__xfinal</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">xdata</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__yfinal</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__xfinal</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">yLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__yfinal</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">movePushButton</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
                <span class="s2">&quot;Move to x- and y-motors to (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__xfinal</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__yfinal</span><span class="p">))</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_moveStopMotors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; move or stop motors depending on movePushButton</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">movePushButton</span><span class="o">.</span><span class="n">text</span><span class="p">())</span> <span class="o">==</span> <span class="s2">&quot;Move&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__moveMotors</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__stopMotors</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">()</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_trackStopMotors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; move or stop motors depending on movePushButton</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">trackPushButton</span><span class="o">.</span><span class="n">text</span><span class="p">())</span> <span class="o">==</span> <span class="s2">&quot;Track&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__trackMotors</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__hideMotors</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">()</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_finished</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; stop motors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__stopMotors</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__stopMotors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; move motors</span>

<span class="sd">        :returns: motors stopped</span>
<span class="sd">        :rtype: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__xmotordevice</span><span class="p">,</span> <span class="s2">&quot;stop&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__xmotordevice</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__xmotordevice</span><span class="p">,</span> <span class="s2">&quot;StopMove&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__xmotordevice</span><span class="o">.</span><span class="n">StopMove</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ymotordevice</span><span class="p">,</span> <span class="s2">&quot;stop&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ymotordevice</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ymotordevice</span><span class="p">,</span> <span class="s2">&quot;StopMove&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ymotordevice</span><span class="o">.</span><span class="n">StopMove</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="c1"># print(str(e))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__motorWatcher</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__motorWatcher</span><span class="o">.</span><span class="n">motorStatusSignal</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_showMotors</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__motorWatcher</span><span class="o">.</span><span class="n">watchingFinished</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_finished</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__motorWatcher</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__motorWatcher</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__motorWatcher</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tracking</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">trackinglines</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateinfowidgets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateinfowidgets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">setDoubleClickLock</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">movePushButton</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Move&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xcurLineEdit</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">ycurLineEdit</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">takePushButton</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">axesPushButton</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">trackPushButton</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__moving</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xLineEdit</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">yLineEdit</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xcurLineEdit</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span>
            <span class="s2">&quot;color: black; background-color: #90EE90;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">ycurLineEdit</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span>
            <span class="s2">&quot;color: black; background-color: #90EE90;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tracking</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__trackMotors</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">__hideMotors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">changestatus</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; move motors</span>

<span class="sd">        :returns: motors stopped</span>
<span class="sd">        :rtype: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__motorWatcher</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__motorWatcher</span><span class="o">.</span><span class="n">motorStatusSignal</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_showMotors</span><span class="p">)</span>
            <span class="c1"># self.__motorWatcher.watchingFinished.disconnect(self._hide)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__motorWatcher</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__motorWatcher</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__motorWatcher</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">trackinglines</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateinfowidgets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
        <span class="c1"># self._mainwidget.setDoubleClickLock(False)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">trackPushButton</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Track&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xcurLineEdit</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">ycurLineEdit</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">takePushButton</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">axesPushButton</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">trackPushButton</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">changestatus</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__tracking</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># self.__ui.xLineEdit.setReadOnly(False)</span>
        <span class="c1"># self.__ui.yLineEdit.setReadOnly(False)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xcurLineEdit</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span>
            <span class="s2">&quot;color: black; background-color: #90EE90;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">ycurLineEdit</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span>
            <span class="s2">&quot;color: black; background-color: #90EE90;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_getFinal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; update final positions</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__xfinal</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xLineEdit</span><span class="o">.</span><span class="n">setFocus</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__yfinal</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">yLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">yLineEdit</span><span class="o">.</span><span class="n">setFocus</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updatePositionMark</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__xfinal</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__yfinal</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__moveMotors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; move motors</span>

<span class="sd">        :returns: motors started</span>
<span class="sd">        :rtype: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_getFinal</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__xmotordevice</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ymotordevice</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setMotors</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__xmotordevice</span><span class="o">.</span><span class="n">state</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;ON&quot;</span> \
           <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ymotordevice</span><span class="o">.</span><span class="n">state</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;ON&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__xmotordevice</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__xfinal</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ymotordevice</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__yfinal</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="c1"># print(str(e))</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># print(&quot;%s %s&quot; % (self.__xfinal, self.__yfinal))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tracking</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__hideMotors</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">trackinglines</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateinfowidgets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__motorWatcher</span> <span class="o">=</span> <span class="n">motorWatchThread</span><span class="o">.</span><span class="n">MotorWatchThread</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__xmotordevice</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ymotordevice</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__motorWatcher</span><span class="o">.</span><span class="n">motorStatusSignal</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_showMotors</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__motorWatcher</span><span class="o">.</span><span class="n">watchingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_finished</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__motorWatcher</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">setDoubleClickLock</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">movePushButton</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Stop&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xcurLineEdit</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">ycurLineEdit</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">takePushButton</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">axesPushButton</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">trackPushButton</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xLineEdit</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">yLineEdit</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__moving</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__statex</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__statey</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">__trackMotors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; track motors</span>

<span class="sd">        :returns: motors tracked</span>
<span class="sd">        :rtype: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__xmotordevice</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ymotordevice</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setMotors</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">trackinglines</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateinfowidgets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="c1"># print(str(e))</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># print(&quot;%s %s&quot; % (self.__xfinal, self.__yfinal))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__motorWatcher</span> <span class="o">=</span> <span class="n">motorWatchThread</span><span class="o">.</span><span class="n">MotorWatchThread</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__xmotordevice</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ymotordevice</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__motorWatcher</span><span class="o">.</span><span class="n">motorStatusSignal</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_showMotors</span><span class="p">)</span>
        <span class="c1"># self.__motorWatcher.watchingFinished.connect(self._hide)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__motorWatcher</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">trackPushButton</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Untrack&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xcurLineEdit</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">ycurLineEdit</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">takePushButton</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">axesPushButton</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="c1"># self.__ui.trackPushButton.hide()</span>
        <span class="c1"># self.__ui.xLineEdit.setReadOnly(True)</span>
        <span class="c1"># self.__ui.yLineEdit.setReadOnly(True)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__tracking</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_showMotors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">positionx</span><span class="p">,</span> <span class="n">statex</span><span class="p">,</span> <span class="n">positiony</span><span class="p">,</span> <span class="n">statey</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; shows motors positions and states</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># print(&quot;%s %s %s %s&quot; % (positionx, statex, positiony, statey))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updatePositionTrackingMark</span><span class="p">(</span>
            <span class="n">positionx</span><span class="p">,</span> <span class="n">positiony</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xcurLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">positionx</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">ycurLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">positiony</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__statex</span> <span class="o">!=</span> <span class="n">statex</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__statex</span> <span class="o">=</span> <span class="n">statex</span>
            <span class="k">if</span> <span class="n">statex</span> <span class="o">==</span> <span class="s2">&quot;MOVING&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xcurLineEdit</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span>
                    <span class="s2">&quot;color: black; background-color: #ADD8E6;&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xcurLineEdit</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span>
                    <span class="s2">&quot;color: black; background-color: #90EE90;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__statey</span> <span class="o">!=</span> <span class="n">statey</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__statey</span> <span class="o">=</span> <span class="n">statey</span>
            <span class="k">if</span> <span class="n">statey</span> <span class="o">==</span> <span class="s2">&quot;MOVING&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">ycurLineEdit</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span>
                    <span class="s2">&quot;color: black; background-color: #ADD8E6;&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">ycurLineEdit</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span>
                    <span class="s2">&quot;color: black; background-color: #90EE90;&quot;</span><span class="p">)</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_setMotors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; launches motors widget</span>

<span class="sd">        :returns: apply status</span>
<span class="sd">        :rtype: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">motors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">getElementNames</span><span class="p">(</span><span class="s2">&quot;MotorList&quot;</span><span class="p">)</span>
        <span class="n">cnfdlg</span> <span class="o">=</span> <span class="n">takeMotorsDialog</span><span class="o">.</span><span class="n">TakeMotorsDialog</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">motors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cnfdlg</span><span class="o">.</span><span class="n">motortips</span> <span class="o">=</span> <span class="n">motors</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">xmotorname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__xmotorname</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">ymotorname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ymotorname</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">createGUI</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">exec_</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__xmotorname</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">xmotorname</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ymotorname</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">ymotorname</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__xmotordevice</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">xmotordevice</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ymotordevice</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">ymotordevice</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">takePushButton</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
                <span class="s2">&quot;x-motor: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">y-motor: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__xmotorname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ymotorname</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xLabel</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
                <span class="s2">&quot;x-motor position (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__xmotorname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xLineEdit</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
                <span class="s2">&quot;final x-motor position (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__xmotorname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xcurLineEdit</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
                <span class="s2">&quot;current x-motor position (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__xmotorname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">yLabel</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
                <span class="s2">&quot;y-motor position (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ymotorname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">yLineEdit</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
                <span class="s2">&quot;final y-motor position (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ymotorname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">ycurLineEdit</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
                <span class="s2">&quot;current y-motor position (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ymotorname</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides intensity message</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">intensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">currentIntensity</span><span class="p">()[:</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">intensity</span><span class="p">):</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ilabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scalingLabel</span><span class="p">()</span>
        <span class="n">txdata</span><span class="p">,</span> <span class="n">tydata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scaledxy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">xunits</span><span class="p">,</span> <span class="n">yunits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">axesunits</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> \
           <span class="n">intensity</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">itn</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">it</span><span class="p">))</span>
                   <span class="k">else</span> <span class="n">it</span> <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">intensity</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">itn</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">txdata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;x = </span><span class="si">%f%s</span><span class="s2">, y = </span><span class="si">%f%s</span><span class="s2">, &quot;</span> \
                              <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> = (</span><span class="si">%.2f</span><span class="s2">, </span><span class="si">%.2f</span><span class="s2">, </span><span class="si">%.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
                                  <span class="n">txdata</span><span class="p">,</span>
                                  <span class="p">(</span><span class="s2">&quot; </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">xunits</span><span class="p">)</span> <span class="k">if</span> <span class="n">xunits</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                  <span class="n">tydata</span><span class="p">,</span>
                                  <span class="p">(</span><span class="s2">&quot; </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">yunits</span><span class="p">)</span> <span class="k">if</span> <span class="n">yunits</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                  <span class="n">ilabel</span><span class="p">,</span>
                                  <span class="n">itn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">itn</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">itn</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;x = </span><span class="si">%i%s</span><span class="s2">, y = </span><span class="si">%i%s</span><span class="s2">, &quot;</span> \
                              <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> = (</span><span class="si">%.2f</span><span class="s2">, </span><span class="si">%.2f</span><span class="s2">, </span><span class="si">%.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
                                  <span class="n">x</span><span class="p">,</span>
                                  <span class="p">(</span><span class="s2">&quot; </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">xunits</span><span class="p">)</span> <span class="k">if</span> <span class="n">xunits</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                  <span class="n">y</span><span class="p">,</span>
                                  <span class="p">(</span><span class="s2">&quot; </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">yunits</span><span class="p">)</span> <span class="k">if</span> <span class="n">yunits</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                  <span class="n">ilabel</span><span class="p">,</span>
                                  <span class="n">itn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">itn</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">itn</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">setDisplayedText</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">txdata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;x = </span><span class="si">%f%s</span><span class="s2">, y = </span><span class="si">%f%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">txdata</span><span class="p">,</span>
                    <span class="p">(</span><span class="s2">&quot; </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">xunits</span><span class="p">)</span> <span class="k">if</span> <span class="n">xunits</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="n">tydata</span><span class="p">,</span>
                    <span class="p">(</span><span class="s2">&quot; </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">yunits</span><span class="p">)</span> <span class="k">if</span> <span class="n">yunits</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="n">ilabel</span><span class="p">,</span>
                    <span class="n">intensity</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;x = </span><span class="si">%i%s</span><span class="s2">, y = </span><span class="si">%i%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">x</span><span class="p">,</span>
                    <span class="p">(</span><span class="s2">&quot; </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">xunits</span><span class="p">)</span> <span class="k">if</span> <span class="n">xunits</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="n">y</span><span class="p">,</span>
                    <span class="p">(</span><span class="s2">&quot; </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">yunits</span><span class="p">)</span> <span class="k">if</span> <span class="n">yunits</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="n">ilabel</span><span class="p">,</span>
                    <span class="n">intensity</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">setDisplayedText</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>


<span class="k">class</span> <span class="nc">WD</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Enum with Parameter Widget positions</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">label</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">read</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">write</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">button</span> <span class="o">=</span> <span class="mi">3</span>


<div class="viewcode-block" id="ParametersToolWidget"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.ParametersToolWidget">[docs]</a><span class="k">class</span> <span class="nc">ParametersToolWidget</span><span class="p">(</span><span class="n">ToolBaseWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; motors tool widget</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#: (:obj:`str`) tool name</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Parameters&quot;</span>
    <span class="c1">#: (:obj:`str`) tool name alias</span>
    <span class="n">alias</span> <span class="o">=</span> <span class="s2">&quot;parameters&quot;</span>
    <span class="c1">#: (:obj:`tuple` &lt;:obj:`str`&gt;) capitalized required packages</span>
    <span class="n">requires</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;TANGO&quot;</span><span class="p">,)</span>

    <span class="c1">#: (:obj:`dict` &lt;:obj:`str` , :obj:`type` or :obj:`types.MethodType` &gt;) \</span>
    <span class="c1">#:      map of type : converting function</span>
    <span class="n">convert</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;float16&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;float32&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;float64&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
               <span class="s2">&quot;float&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;int64&quot;</span><span class="p">:</span> <span class="n">long</span><span class="p">,</span> <span class="s2">&quot;int32&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
               <span class="s2">&quot;int16&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="s2">&quot;int8&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="s2">&quot;int&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="s2">&quot;uint64&quot;</span><span class="p">:</span> <span class="n">long</span><span class="p">,</span>
               <span class="s2">&quot;uint32&quot;</span><span class="p">:</span> <span class="n">long</span><span class="p">,</span> <span class="s2">&quot;uint16&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
               <span class="s2">&quot;uint8&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="s2">&quot;uint&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;str&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
               <span class="s2">&quot;bool&quot;</span><span class="p">:</span> <span class="n">Converters</span><span class="o">.</span><span class="n">toBool</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param parent: parent object</span>
<span class="sd">        :type parent: :class:`pyqtgraph.QtCore.QObject`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ToolBaseWidget</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

        <span class="c1">#: (:class:`lavuelib.settings.Settings`) configuration settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">settings</span><span class="p">()</span>

        <span class="c1"># #: (:obj:`list` &lt;str, str, str&gt;)</span>
        <span class="c1">#        detector parameters (label, devicename, type)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__detparams</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#: (:obj:`list` &lt;:class:`tango.DeviceProxy`&gt;)  attribute proxies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__aproxies</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#: (:obj:`list` &lt;:list:`any`&gt;)  attribute values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__avalues</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#: (:class:`lavuelib.motorWatchThread.attributeWatchThread`)</span>
        <span class="c1">#               attribute watcher</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__attrWatcher</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`bool`) is watching</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__watching</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#: (:obj:`list` &lt;:obj:`list` &lt;:class:`pyqtgraph.QtCore.QObject`&gt; &gt;)</span>
        <span class="c1"># widgets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__widgets</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1">#: (:class:`Ui_ParametersToolWidget&#39;)</span>
        <span class="c1">#:        ui_toolwidget object from qtdesigner</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span> <span class="o">=</span> <span class="n">_parametersformclass</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">infolineedit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">infotips</span> <span class="o">=</span> \
            <span class="s2">&quot;coordinate info display for the mouse pointer&quot;</span>

        <span class="c1">#: (:obj:`list` &lt; [:class:`pyqtgraph.QtCore.pyqtSignal`, :obj:`str`] &gt;)</span>
        <span class="c1">#: list of [signal, slot] object to connect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signal2slot</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">setupPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setParameters</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">mouseImagePositionChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_message</span><span class="p">],</span>
         <span class="p">]</span>

        <span class="c1">#: (:class:`pyqtgraph.QtCore.QSignalMapper`) apply mapper</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__applymapper</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QSignalMapper</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__applymapper</span><span class="o">.</span><span class="n">mapped</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_applypars</span><span class="p">)</span>

<div class="viewcode-block" id="ParametersToolWidget.configure"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.ParametersToolWidget.configure">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set configuration for the current tool</span>

<span class="sd">        :param configuration: configuration string</span>
<span class="sd">        :type configuration: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configuration</span><span class="p">:</span>
            <span class="n">cnf</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;tango_det_attrs&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;tango_det_attrs&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">tangodetattrs</span> <span class="o">!=</span> \
                   <span class="nb">str</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">numpyEncoder</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">tangodetattrs</span> <span class="o">=</span> \
                        <span class="nb">str</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">numpyEncoder</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__updateParams</span><span class="p">()</span></div>

<div class="viewcode-block" id="ParametersToolWidget.configuration"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.ParametersToolWidget.configuration">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides configuration for the current tool</span>

<span class="sd">        :returns configuration: configuration string</span>
<span class="sd">        :rtype configuration: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cnf</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;tango_det_attrs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">tangodetattrs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">cnf</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">numpyEncoder</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_applypars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; apply the parameter with the given widget id</span>

<span class="sd">        :param wid: widget id</span>
<span class="sd">        :type wid: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__widgets</span><span class="p">[</span><span class="n">wid</span><span class="p">][</span><span class="n">WD</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">tp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__detparams</span><span class="p">[</span><span class="n">wid</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">frm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__detparams</span><span class="p">[</span><span class="n">wid</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">ap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aproxies</span><span class="p">[</span><span class="n">wid</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">frm</span> <span class="o">==</span> <span class="s2">&quot;SPECTRUM&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">vl</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">vl</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">tp</span> <span class="ow">and</span> <span class="n">tp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">vl</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">convert</span><span class="p">[</span><span class="n">tp</span><span class="p">](</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vl</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e2</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e2</span><span class="p">))</span>
                    <span class="n">vl</span> <span class="o">=</span> <span class="n">txt</span>
        <span class="k">elif</span> <span class="n">frm</span> <span class="o">==</span> <span class="s2">&quot;IMAGE&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">vl</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="n">vl</span> <span class="o">=</span> <span class="n">txt</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tp</span> <span class="ow">and</span> <span class="n">tp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">vl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert</span><span class="p">[</span><span class="n">tp</span><span class="p">](</span><span class="n">txt</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">vl</span> <span class="o">=</span> <span class="n">txt</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="n">vl</span> <span class="o">=</span> <span class="n">txt</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ap</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">vl</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

<div class="viewcode-block" id="ParametersToolWidget.activate"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.ParametersToolWidget.activate">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">activate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; activates tool widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">record</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">tangodetattrs</span> <span class="ow">or</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">record</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deactivate</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">lb</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dv</span> <span class="o">=</span> <span class="n">record</span><span class="p">[</span><span class="n">lb</span><span class="p">]</span>
                <span class="n">ap</span> <span class="o">=</span> <span class="n">tango</span><span class="o">.</span><span class="n">AttributeProxy</span><span class="p">(</span><span class="n">dv</span><span class="p">)</span>
                <span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">frm</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">cap</span> <span class="o">=</span> <span class="n">ap</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
                    <span class="n">unit</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">unit</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
                    <span class="n">vl</span> <span class="o">=</span> <span class="n">ap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">value</span>
                    <span class="n">tp</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">vl</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
                    <span class="k">if</span> <span class="n">tp</span> <span class="o">==</span> <span class="s2">&quot;ndarray&quot;</span><span class="p">:</span>
                        <span class="n">tp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">vl</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
                    <span class="n">frm</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">data_format</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                    <span class="n">vl</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">tp</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="n">dv</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">dv</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__aproxies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ap</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__detparams</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">lb</span><span class="p">,</span> <span class="n">dv</span><span class="p">,</span> <span class="n">tp</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">frm</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__avalues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__updateWidgets</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__attrWatcher</span> <span class="o">=</span> <span class="n">motorWatchThread</span><span class="o">.</span><span class="n">AttributeWatchThread</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__aproxies</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">toolpollinginterval</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__attrWatcher</span><span class="o">.</span><span class="n">attrValuesSignal</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_showValues</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__attrWatcher</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__attrWatcher</span><span class="o">.</span><span class="n">isWatching</span><span class="p">():</span>
            <span class="n">QtCore</span><span class="o">.</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__updateWidgets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; add widgets</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">parGridLayout</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__detparams</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__widgets</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__widgets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="p">),</span>
                    <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="p">),</span>
                    <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="p">),</span>
                    <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Apply&quot;</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="n">last</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__widgets</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__widgets</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">WD</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__widgets</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">WD</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span>
                <span class="s2">&quot;color: black; background-color: #90EE90;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__widgets</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">WD</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span>
                <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__widgets</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">WD</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span>
                <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignRight</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__widgets</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">last</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__widgets</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">WD</span><span class="o">.</span><span class="n">button</span><span class="o">.</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__applymapper</span><span class="o">.</span><span class="n">map</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__applymapper</span><span class="o">.</span><span class="n">setMapping</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__widgets</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">WD</span><span class="o">.</span><span class="n">button</span><span class="o">.</span><span class="n">value</span><span class="p">],</span> <span class="n">last</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="c1"># self.__widgets[-1][WD.read.value].setMaximumWidth(200)</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__detparams</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__widgets</span><span class="p">):</span>
            <span class="n">wds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__widgets</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__applymapper</span><span class="o">.</span><span class="n">removeMappings</span><span class="p">(</span><span class="n">wds</span><span class="p">[</span><span class="n">WD</span><span class="o">.</span><span class="n">button</span><span class="o">.</span><span class="n">value</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">wds</span><span class="p">:</span>
                <span class="n">w</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
                <span class="n">layout</span><span class="o">.</span><span class="n">removeWidget</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pars</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__detparams</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__widgets</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">WD</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:&quot;</span> <span class="o">%</span> <span class="n">pars</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__widgets</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">WD</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">pars</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__widgets</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">WD</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__widgets</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">WD</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">pars</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__widgets</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">WD</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">button</span><span class="o">.</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
                <span class="s2">&quot;Write the new value of </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">pars</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__avalues</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">vl</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vl</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__avalues</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">pars</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                <span class="n">vl</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">vl</span><span class="p">,</span> <span class="n">pars</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__widgets</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">WD</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="n">vl</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__widgets</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">WD</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">vl</span><span class="p">)</span>

<div class="viewcode-block" id="ParametersToolWidget.deactivate"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.ParametersToolWidget.deactivate">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">deactivate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; activates tool widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__attrWatcher</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__attrWatcher</span><span class="o">.</span><span class="n">attrValuesSignal</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_showValues</span><span class="p">)</span>
            <span class="c1"># self.__attrWatcher.watchingFinished.disconnect(self._finished)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;STOPING </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__attrWatcher</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__attrWatcher</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;WAITING  for </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__attrWatcher</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__attrWatcher</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;REMOVING  for </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__attrWatcher</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__attrWatcher</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__aproxies</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__detparams</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__avalues</span> <span class="o">=</span> <span class="p">[]</span></div>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_showValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vls</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pars</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__widgets</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">vls</span><span class="p">):</span>
                <span class="n">vl</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">vls</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__detparams</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">]:</span>
                    <span class="n">vl</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">vl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__detparams</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__widgets</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">WD</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">vl</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__widgets</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">WD</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="n">vl</span><span class="p">)</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_setParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; launches parameters widget</span>

<span class="sd">        :returns: apply status</span>
<span class="sd">        :rtype: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">record</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">tangodetattrs</span> <span class="ow">or</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">record</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dform</span> <span class="o">=</span> <span class="n">edDictDialog</span><span class="o">.</span><span class="n">EdDictDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">dform</span><span class="o">.</span><span class="n">record</span> <span class="o">=</span> <span class="n">record</span>
        <span class="n">dform</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Tango Detector Attributes&quot;</span>
        <span class="n">dform</span><span class="o">.</span><span class="n">createGUI</span><span class="p">()</span>
        <span class="n">dform</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">dform</span><span class="o">.</span><span class="n">dirty</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                    <span class="n">record</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">tangodetattrs</span> <span class="o">!=</span> \
               <span class="nb">str</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">numpyEncoder</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">tangodetattrs</span> <span class="o">=</span> \
                    <span class="nb">str</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">numpyEncoder</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__updateParams</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__updateParams</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; update parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deactivate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">()</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides intensity message</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">currentIntensity</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">intensity</span><span class="p">):</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span>
                <span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">it</span><span class="p">))</span>
                 <span class="k">else</span> <span class="n">it</span> <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">intensity</span><span class="p">])</span>
        <span class="n">ilabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scalingLabel</span><span class="p">()</span>
        <span class="n">txdata</span><span class="p">,</span> <span class="n">tydata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scaledxy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">xunits</span><span class="p">,</span> <span class="n">yunits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">axesunits</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">txdata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;x = </span><span class="si">%f%s</span><span class="s2">, y = </span><span class="si">%f%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">txdata</span><span class="p">,</span>
                <span class="p">(</span><span class="s2">&quot; </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">xunits</span><span class="p">)</span> <span class="k">if</span> <span class="n">xunits</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">tydata</span><span class="p">,</span>
                <span class="p">(</span><span class="s2">&quot; </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">yunits</span><span class="p">)</span> <span class="k">if</span> <span class="n">yunits</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">ilabel</span><span class="p">,</span>
                <span class="n">intensity</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;x = </span><span class="si">%f%s</span><span class="s2">, y = </span><span class="si">%f%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="p">(</span><span class="s2">&quot; </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">xunits</span><span class="p">)</span> <span class="k">if</span> <span class="n">xunits</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">y</span><span class="p">,</span>
                <span class="p">(</span><span class="s2">&quot; </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">yunits</span><span class="p">)</span> <span class="k">if</span> <span class="n">yunits</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">ilabel</span><span class="p">,</span>
                <span class="n">intensity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">setDisplayedText</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>


<div class="viewcode-block" id="MeshToolWidget"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.MeshToolWidget">[docs]</a><span class="k">class</span> <span class="nc">MeshToolWidget</span><span class="p">(</span><span class="n">ToolBaseWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; mesh tool widget</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#: (:class:`pyqtgraph.QtCore.pyqtSignal`) roi info Changed signal</span>
    <span class="n">roiInfoChanged</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="c1">#: (:obj:`str`) tool name</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;MeshScan&quot;</span>
    <span class="c1">#: (:obj:`str`) tool name alias</span>
    <span class="n">alias</span> <span class="o">=</span> <span class="s2">&quot;meshscan&quot;</span>
    <span class="c1">#: (:obj:`tuple` &lt;:obj:`str`&gt;) capitalized required packages</span>
    <span class="n">requires</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;TANGO&quot;</span><span class="p">,)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param parent: parent object</span>
<span class="sd">        :type parent: :class:`pyqtgraph.QtCore.QObject`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ToolBaseWidget</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

        <span class="c1">#: (:obj:`str`) x-motor name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__xmotorname</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="c1">#: (:obj:`str`) y-motor name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ymotorname</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="c1">#: (:obj:`str`) state of x-motor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__statex</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`str`) state of y-motor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__statey</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:class:`tango.DeviceProxy`) x-motor device</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__xmotordevice</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:class:`tango.DeviceProxy`) y-motor device</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ymotordevice</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:class:`tango.DeviceProxy`) door server</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__door</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:class:`lavuelib.motorWatchThread.motorWatchThread`) motor watcher</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__motorWatcher</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`bool`) is moving</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__moving</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1">#: (:obj:`int`) number of x intervals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__xintervals</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="c1">#: (:obj:`int`) number of y intervals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__yintervals</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="c1">#: (:obj:`float`) integration time in seconds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__itime</span> <span class="o">=</span> <span class="mf">0.1</span>

        <span class="c1">#: (:class:`Ui_MeshToolWidget&#39;)</span>
        <span class="c1">#:        ui_toolwidget object from qtdesigner</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span> <span class="o">=</span> <span class="n">_meshformclass</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__showLabels</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">rois</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">infolineedit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">infolabel</span> <span class="o">=</span> <span class="s2">&quot;[x1, y1, x2, y2]: &quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">infotips</span> <span class="o">=</span> \
            <span class="s2">&quot;coordinate info display for the mouse pointer&quot;</span>

        <span class="c1">#: (:obj:`list` &lt; [:class:`pyqtgraph.QtCore.pyqtSignal`, :obj:`str`] &gt;)</span>
        <span class="c1">#: list of [signal, slot] object to connect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signal2slot</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">axesPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">setTicks</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">takePushButton</span><span class="o">.</span><span class="n">clicked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setMotors</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">intervalsPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setIntervals</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">scanPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scanStopMotors</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">roiInfoChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateDisplayedText</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">roiValueChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateROIDisplayText</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">mouseImagePositionChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_message</span><span class="p">]</span>
        <span class="p">]</span>

    <span class="c1"># @debugmethod</span>
<div class="viewcode-block" id="MeshToolWidget.configure"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.MeshToolWidget.configure">[docs]</a>    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set configuration for the current tool</span>

<span class="sd">        :param configuration: configuration string</span>
<span class="sd">        :type configuration: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configuration</span><span class="p">:</span>
            <span class="n">cnf</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
            <span class="n">pars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">,</span> <span class="s2">&quot;scale&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;xtext&quot;</span><span class="p">,</span> <span class="s2">&quot;ytext&quot;</span><span class="p">,</span> <span class="s2">&quot;xunits&quot;</span><span class="p">,</span> <span class="s2">&quot;yunits&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">par</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateTicks</span><span class="p">(</span><span class="n">cnf</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;motors&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">motorname</span> <span class="o">=</span> <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;motors&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">motordevice</span> <span class="o">=</span> <span class="n">tango</span><span class="o">.</span><span class="n">DeviceProxy</span><span class="p">(</span><span class="n">motorname</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">,</span> <span class="s2">&quot;position&quot;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">motordevice</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
                            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Missing </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">attr</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__xmotorname</span> <span class="o">=</span> <span class="n">motorname</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__xmotordevice</span> <span class="o">=</span> <span class="n">motordevice</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">motorname</span> <span class="o">=</span> <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;motors&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">motordevice</span> <span class="o">=</span> <span class="n">tango</span><span class="o">.</span><span class="n">DeviceProxy</span><span class="p">(</span><span class="n">motorname</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">,</span> <span class="s2">&quot;position&quot;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">motordevice</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
                            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Missing </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">attr</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__ymotorname</span> <span class="o">=</span> <span class="n">motorname</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__ymotordevice</span> <span class="o">=</span> <span class="n">motordevice</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">pars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;x_intervals&quot;</span><span class="p">,</span> <span class="s2">&quot;y_intervals&quot;</span><span class="p">,</span> <span class="s2">&quot;interval_time&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">par</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">):</span>
                <span class="k">if</span> <span class="s2">&quot;x_intervals&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__xintervals</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;x_intervals&quot;</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="k">if</span> <span class="s2">&quot;y_intervals&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__yintervals</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;y_intervals&quot;</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="k">if</span> <span class="s2">&quot;interval_time&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__itime</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;interval_time&quot;</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_updateIntervals</span><span class="p">()</span>
            <span class="k">if</span> <span class="s2">&quot;scan&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;scan&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">scanPushButton</span><span class="o">.</span><span class="n">text</span><span class="p">())</span> <span class="o">==</span> <span class="s2">&quot;Scan&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_scanStopMotors</span><span class="p">()</span>
            <span class="k">if</span> <span class="s2">&quot;stop&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;stop&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">scanPushButton</span><span class="o">.</span><span class="n">text</span><span class="p">())</span> <span class="o">==</span> <span class="s2">&quot;Stop&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_scanStopMotors</span><span class="p">()</span></div>

    <span class="c1"># @debugmethod</span>
<div class="viewcode-block" id="MeshToolWidget.configuration"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.MeshToolWidget.configuration">[docs]</a>    <span class="k">def</span> <span class="nf">configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides configuration for the current tool</span>

<span class="sd">        :returns configuration: configuration string</span>
<span class="sd">        :rtype configuration: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cnf</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">,</span> <span class="n">xsc</span><span class="p">,</span> <span class="n">ysc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scale</span><span class="p">()</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;xunits&quot;</span><span class="p">],</span> <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;yunits&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">axesunits</span><span class="p">()</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;xtext&quot;</span><span class="p">],</span> <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;ytext&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">axestext</span><span class="p">()</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">]</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;scale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">xsc</span><span class="p">,</span> <span class="n">ysc</span><span class="p">]</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;x_intervals&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__xintervals</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;y_intervals&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__yintervals</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;interval_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__itime</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;motors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__xmotorname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ymotorname</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">scanPushButton</span><span class="o">.</span><span class="n">text</span><span class="p">())</span> <span class="o">==</span> <span class="s2">&quot;Scan&quot;</span><span class="p">:</span>
            <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;motor_state&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ON&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;motor_state&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;MOVING&quot;</span>

        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">cnf</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">numpyEncoder</span><span class="p">)</span></div>

<div class="viewcode-block" id="MeshToolWidget.activate"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.MeshToolWidget.activate">[docs]</a>    <span class="k">def</span> <span class="nf">activate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; activates tool widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">changeMeshRegion</span><span class="p">()</span></div>
        <span class="c1"># self._mainwidget.updateROIs(1)</span>

<div class="viewcode-block" id="MeshToolWidget.deactivate"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.MeshToolWidget.deactivate">[docs]</a>    <span class="k">def</span> <span class="nf">deactivate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; deactivates tool widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">meshCoordsChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span></div>

<div class="viewcode-block" id="MeshToolWidget.updateROIDisplayText"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.MeshToolWidget.updateROIDisplayText">[docs]</a>    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">updateROIDisplayText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">currentroi</span><span class="p">,</span> <span class="n">roiVal</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; updates ROI display text</span>

<span class="sd">        :param text: standard display text</span>
<span class="sd">        :type text: :obj:`str`</span>
<span class="sd">        :param currentroi: current roi label</span>
<span class="sd">        :type currentroi: :obj:`str`</span>
<span class="sd">        :param text: roi sum value</span>
<span class="sd">        :type text: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">roiVal</span><span class="p">:</span>
            <span class="n">sroiv</span> <span class="o">=</span> <span class="s2">&quot; / &quot;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">roiVal</span><span class="p">)</span>
            <span class="n">roiVal</span> <span class="o">=</span> <span class="n">sroiv</span><span class="p">[</span><span class="n">currentroi</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sroiv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">currentroi</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="n">roilabel</span> <span class="o">=</span> <span class="s2">&quot;roi [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">currentroi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">roiInfoChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">roilabel</span><span class="p">,</span> <span class="n">roiVal</span><span class="p">))</span></div>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_scanStopMotors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; starts or stops scan</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">scanPushButton</span><span class="o">.</span><span class="n">text</span><span class="p">())</span> <span class="o">==</span> <span class="s2">&quot;Scan&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__startScan</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__stopScan</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">()</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_finished</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; stops mesh scan without stopping the macro</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__stopScan</span><span class="p">(</span><span class="n">stopmacro</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__stopScan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stopmacro</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; stops mesh scan</span>
<span class="sd">        :param stopmacro: call stopmacro</span>
<span class="sd">        :type stopmacro: :obj:`bool`</span>
<span class="sd">        :returns: motors stopped</span>
<span class="sd">        :rtype: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">stopmacro</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__door</span><span class="o">.</span><span class="n">StopMacro</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="c1"># print(str(e))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__motorWatcher</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__motorWatcher</span><span class="o">.</span><span class="n">motorStatusSignal</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_showMotors</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__motorWatcher</span><span class="o">.</span><span class="n">watchingFinished</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_finished</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__motorWatcher</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__motorWatcher</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__motorWatcher</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__showLabels</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__moving</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xcurLineEdit</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span>
            <span class="s2">&quot;color: black; background-color: #90EE90;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">ycurLineEdit</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span>
            <span class="s2">&quot;color: black; background-color: #90EE90;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">showDoorError</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">__showLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; shows GUI labels</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">scanPushButton</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Scan&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xcurLineEdit</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">ycurLineEdit</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">takePushButton</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">axesPushButton</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">intervalsPushButton</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xLabel</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;X: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__xintervals</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">yLabel</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Y: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__yintervals</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">timeLabel</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;dT: </span><span class="si">%s</span><span class="s2">s&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__itime</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">timeLabel</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__hideLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; hides GUI labels</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">scanPushButton</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Stop&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xcurLineEdit</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">ycurLineEdit</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">takePushButton</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">axesPushButton</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">intervalsPushButton</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xLabel</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;X: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__xintervals</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">yLabel</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Y: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__yintervals</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">timeLabel</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;dT: </span><span class="si">%s</span><span class="s2">s&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__itime</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">timeLabel</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__startScan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; start scan</span>

<span class="sd">        :returns: motors started</span>
<span class="sd">        :rtype: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">meshCoords</span><span class="p">()</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span>
            <span class="n">curcoords</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__xmotordevice</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ymotordevice</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setMotors</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="n">macrocommand</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">macrocommand</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;mesh&quot;</span><span class="p">)</span>
        <span class="n">macrocommand</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__xmotorname</span><span class="p">))</span>
        <span class="n">macrocommand</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">curcoords</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
        <span class="n">macrocommand</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">curcoords</span><span class="p">[</span><span class="mi">2</span><span class="p">])))</span>
        <span class="n">macrocommand</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__xintervals</span><span class="p">))</span>
        <span class="n">macrocommand</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ymotorname</span><span class="p">))</span>
        <span class="n">macrocommand</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">curcoords</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
        <span class="n">macrocommand</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">curcoords</span><span class="p">[</span><span class="mi">3</span><span class="p">])))</span>
        <span class="n">macrocommand</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__yintervals</span><span class="p">))</span>
        <span class="n">macrocommand</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__itime</span><span class="p">))</span>
        <span class="n">macrocommand</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;True&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__door</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">getDoor</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__door</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;MeshToolWidget.__startScan: Cannot access Door device&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">runMacro</span><span class="p">(</span><span class="n">macrocommand</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;MeshToolWidget.__startScan: Cannot in running </span><span class="si">%s</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="n">macrocommand</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__motorWatcher</span> <span class="o">=</span> <span class="n">motorWatchThread</span><span class="o">.</span><span class="n">MotorWatchThread</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__xmotordevice</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ymotordevice</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__door</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__motorWatcher</span><span class="o">.</span><span class="n">motorStatusSignal</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_showMotors</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__motorWatcher</span><span class="o">.</span><span class="n">watchingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_finished</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__motorWatcher</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__hideLabels</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__moving</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__statex</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__statey</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_showMotors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">positionx</span><span class="p">,</span> <span class="n">statex</span><span class="p">,</span> <span class="n">positiony</span><span class="p">,</span> <span class="n">statey</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; shows motors positions and states</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># print(&quot;%s %s %s %s&quot; % (positionx, statex, positiony, statey))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xcurLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">positionx</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">ycurLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">positiony</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__statex</span> <span class="o">!=</span> <span class="n">statex</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__statex</span> <span class="o">=</span> <span class="n">statex</span>
            <span class="k">if</span> <span class="n">statex</span> <span class="o">==</span> <span class="s2">&quot;MOVING&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xcurLineEdit</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span>
                    <span class="s2">&quot;color: black; background-color: #ADD8E6;&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xcurLineEdit</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span>
                    <span class="s2">&quot;color: black; background-color: #90EE90;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__statey</span> <span class="o">!=</span> <span class="n">statey</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__statey</span> <span class="o">=</span> <span class="n">statey</span>
            <span class="k">if</span> <span class="n">statey</span> <span class="o">==</span> <span class="s2">&quot;MOVING&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">ycurLineEdit</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span>
                    <span class="s2">&quot;color: black; background-color: #ADD8E6;&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">ycurLineEdit</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span>
                    <span class="s2">&quot;color: black; background-color: #90EE90;&quot;</span><span class="p">)</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_setMotors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; launches motors widget</span>

<span class="sd">        :returns: apply status</span>
<span class="sd">        :rtype: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">motors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">getElementNames</span><span class="p">(</span><span class="s2">&quot;MotorList&quot;</span><span class="p">)</span>
        <span class="n">cnfdlg</span> <span class="o">=</span> <span class="n">takeMotorsDialog</span><span class="o">.</span><span class="n">TakeMotorsDialog</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">motors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cnfdlg</span><span class="o">.</span><span class="n">motortips</span> <span class="o">=</span> <span class="n">motors</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Motor aliases&quot;</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">xmotorname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__xmotorname</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">ymotorname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ymotorname</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">createGUI</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">exec_</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__xmotorname</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">xmotorname</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ymotorname</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">ymotorname</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__xmotordevice</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">xmotordevice</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ymotordevice</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">ymotordevice</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">takePushButton</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
                <span class="s2">&quot;x-motor: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">y-motor: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__xmotorname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ymotorname</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xLabel</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
                <span class="s2">&quot;x-motor interval number (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__xmotorname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xcurLineEdit</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
                <span class="s2">&quot;current x-motor position (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__xmotorname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">yLabel</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
                <span class="s2">&quot;y-motor interval number (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ymotorname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">ycurLineEdit</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
                <span class="s2">&quot;current y-motor position (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ymotorname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__showLabels</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_setIntervals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; launches motors widget</span>

<span class="sd">        :returns: apply status</span>
<span class="sd">        :rtype: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cnfdlg</span> <span class="o">=</span> <span class="n">intervalsDialog</span><span class="o">.</span><span class="n">IntervalsDialog</span><span class="p">()</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">xintervals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__xintervals</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">yintervals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__yintervals</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">itime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__itime</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">createGUI</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">exec_</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__xintervals</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">xintervals</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__yintervals</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">yintervals</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__itime</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">itime</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_updateIntervals</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_updateIntervals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; update interval informations</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">intervalsPushButton</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
            <span class="s2">&quot;x-intervals:</span><span class="si">%s</span><span class="se">\n</span><span class="s2">y-intervals:</span><span class="si">%s</span><span class="se">\n</span><span class="s2">integration time:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__xintervals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__yintervals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__itime</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__showLabels</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">()</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides mesh message</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">meshCoords</span><span class="p">()</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">setDisplayedText</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>


<div class="viewcode-block" id="ROIToolWidget"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.ROIToolWidget">[docs]</a><span class="k">class</span> <span class="nc">ROIToolWidget</span><span class="p">(</span><span class="n">ToolBaseWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; roi tool widget</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#: (:class:`pyqtgraph.QtCore.pyqtSignal`) apply ROI pressed signal</span>
    <span class="n">applyROIPressed</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
    <span class="c1">#: (:class:`pyqtgraph.QtCore.pyqtSignal`) fetch ROI pressed signal</span>
    <span class="n">fetchROIPressed</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="c1">#: (:class:`pyqtgraph.QtCore.pyqtSignal`) roi info Changed signal</span>
    <span class="n">roiInfoChanged</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="c1">#: (:obj:`str`) tool name</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;ROI&quot;</span>
    <span class="c1">#: (:obj:`str`) tool name alias</span>
    <span class="n">alias</span> <span class="o">=</span> <span class="s2">&quot;roi&quot;</span>
    <span class="c1">#: (:obj:`tuple` &lt;:obj:`str`&gt;) capitalized required packages</span>
    <span class="n">requires</span> <span class="o">=</span> <span class="p">()</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param parent: parent object</span>
<span class="sd">        :type parent: :class:`pyqtgraph.QtCore.QObject`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ToolBaseWidget</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

        <span class="c1">#: (:class:`Ui_ROIToolWidget&#39;) ui_toolwidget object from qtdesigner</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span> <span class="o">=</span> <span class="n">_roiformclass</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1">#: (:obj:`list`&lt; :obj:`str`&gt;) sardana aliases</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__aliases</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#: (:obj:`int`) ROI label length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__textlength</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">rois</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">infolineedit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">infolabel</span> <span class="o">=</span> <span class="s2">&quot;[x1, y1, x2, y2], sum: &quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">infotips</span> <span class="o">=</span> \
            <span class="s2">&quot;coordinate info display for the mouse pointer&quot;</span>

        <span class="c1">#: (:class:`lavuelib.settings.Settings`) configuration settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">settings</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_updateApplyButton</span><span class="p">()</span>
        <span class="c1">#: (:obj:`list` &lt; [:class:`pyqtgraph.QtCore.pyqtSignal`, :obj:`str`] &gt;)</span>
        <span class="c1">#: list of [signal, slot] object to connect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signal2slot</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">applyROIPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emitApplyROIPressed</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">fetchROIPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emitFetchROIPressed</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">applyROIPressed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">applyROIs</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fetchROIPressed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">fetchROIs</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">roiInfoChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateDisplayedText</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">labelROILineEdit</span><span class="o">.</span><span class="n">textChanged</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_updateApplyButton</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">roiSpinBox</span><span class="o">.</span><span class="n">valueChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateROIs</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">roiSpinBox</span><span class="o">.</span><span class="n">valueChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">roiSpinBox</span><span class="o">.</span><span class="n">valueChanged</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeDetectorROIsAttribute</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">labelROILineEdit</span><span class="o">.</span><span class="n">textEdited</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_writeDetectorROIs</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">labelROILineEdit</span><span class="o">.</span><span class="n">textEdited</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">roiLineEditChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updateApplyButton</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">roiAliasesChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateROILineEdit</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">roiValueChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateROIDisplayText</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">roiNumberChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">setROIsNumber</span><span class="p">],</span>
            <span class="c1"># [self._mainwidget.sardanaEnabled, self.updateROIButton],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">mouseImagePositionChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_message</span><span class="p">],</span>
        <span class="p">]</span>

<div class="viewcode-block" id="ROIToolWidget.configure"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.ROIToolWidget.configure">[docs]</a>    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set configuration for the current tool</span>

<span class="sd">        :param configuration: configuration string</span>
<span class="sd">        :type configuration: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configuration</span><span class="p">:</span>
            <span class="n">cnf</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;aliases&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">aliases</span> <span class="o">=</span> <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;aliases&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">aliases</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">aliases</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">aliases</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">labelROILineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">aliases</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;rois_number&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">roiSpinBox</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;rois_number&quot;</span><span class="p">]))</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                    <span class="c1"># print(str(e))</span>
            <span class="k">if</span> <span class="s2">&quot;rois_coords&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateROIs</span><span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;rois_coords&quot;</span><span class="p">]),</span> <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;rois_coords&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="s2">&quot;apply&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;apply&quot;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_emitApplyROIPressed</span><span class="p">()</span>
            <span class="k">if</span> <span class="s2">&quot;fetch&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;fetch&quot;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_emitFetchROIPressed</span><span class="p">()</span></div>

<div class="viewcode-block" id="ROIToolWidget.configuration"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.ROIToolWidget.configuration">[docs]</a>    <span class="k">def</span> <span class="nf">configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides configuration for the current tool</span>

<span class="sd">        :returns configuration: configuration string</span>
<span class="sd">        :rtype configuration: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cnf</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;aliases&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">labelROILineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;rois_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">roiSpinBox</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;rois_coords&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">roiCoords</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">cnf</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">numpyEncoder</span><span class="p">)</span></div>

<div class="viewcode-block" id="ROIToolWidget.activate"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.ROIToolWidget.activate">[docs]</a>    <span class="k">def</span> <span class="nf">activate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; activates tool widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">changeROIRegion</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setROIsNumber</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">roiCoords</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__aliases</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">getElementNames</span><span class="p">(</span><span class="s2">&quot;ExpChannelList&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateROILineEdit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">roilabels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__updateCompleter</span><span class="p">()</span></div>
        <span class="c1"># self.updateROIButton(</span>
        <span class="c1">#     self.__settings.sardana or bool(self.__settings.analysisdevice))</span>

    <span class="k">def</span> <span class="nf">__updateCompleter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; updates the labelROI help</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">labelROILineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="n">sttext</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">sptext</span> <span class="o">=</span> <span class="n">sttext</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">stext</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">):</span>
            <span class="n">stext</span> <span class="o">=</span> <span class="n">sttext</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">sptext</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">stext</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sptext</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">stext</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aliases</span><span class="p">:</span>
                <span class="n">hints</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">stext</span><span class="p">,</span> <span class="n">al</span><span class="p">)</span> <span class="k">for</span> <span class="n">al</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aliases</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">hints</span> <span class="o">=</span> <span class="p">[</span><span class="n">stext</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aliases</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="n">completer</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QCompleter</span><span class="p">(</span><span class="n">hints</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">labelROILineEdit</span><span class="o">.</span><span class="n">setCompleter</span><span class="p">(</span><span class="n">completer</span><span class="p">)</span>

<div class="viewcode-block" id="ROIToolWidget.deactivate"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.ROIToolWidget.deactivate">[docs]</a>    <span class="k">def</span> <span class="nf">deactivate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; deactivates tool widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">roiCoordsChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span></div>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_writeDetectorROIs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; writes Detector rois and updates roi labels</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">roilabels</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">labelROILineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeDetectorROIsAttribute</span><span class="p">()</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides roi message</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">currentROI</span><span class="p">()</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">roiCoords</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">current</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">current</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">coords</span><span class="p">[</span><span class="n">current</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">setDisplayedText</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_emitApplyROIPressed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; emits applyROIPressed signal&quot;&quot;&quot;</span>

        <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">labelROILineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">singlerois</span><span class="p">:</span>
            <span class="n">slabel</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;|,| |</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
            <span class="n">slabel</span> <span class="o">=</span> <span class="p">[</span><span class="n">lb</span> <span class="k">for</span> <span class="n">lb</span> <span class="ow">in</span> <span class="n">slabel</span> <span class="k">if</span> <span class="n">lb</span><span class="p">]</span>
            <span class="n">lsl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">slabel</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">lsl</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">roiCoords</span><span class="p">()):</span>
                <span class="n">lsl</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">slabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;roi</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">lsl</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">labelROILineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">slabel</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_updateApplyButton</span><span class="p">()</span>
            <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">labelROILineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">labelROILineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;rois&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_updateApplyButton</span><span class="p">()</span>
            <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">labelROILineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">roispin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">roiSpinBox</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">applyROIPressed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">roispin</span><span class="p">)</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_emitFetchROIPressed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; emits fetchROIPressed signal&quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">labelROILineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fetchROIPressed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_updateApplyButton</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; updates applied button&quot;&quot;&quot;</span>
        <span class="n">stext</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">labelROILineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">roilabels</span> <span class="o">=</span> <span class="n">stext</span>
        <span class="n">currentlength</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">stext</span><span class="p">)</span>
        <span class="c1"># if not stext.strip():</span>
        <span class="c1"># self.__ui.applyROIPushButton.setEnabled(False)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__updateCompleter</span><span class="p">()</span>
        <span class="c1"># else:</span>
        <span class="c1">#    # self.__ui.applyROIPushButton.setEnabled(True)</span>
        <span class="k">if</span> <span class="n">stext</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">currentlength</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__textlength</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__updateCompleter</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__textlength</span> <span class="o">=</span> <span class="n">currentlength</span>

<div class="viewcode-block" id="ROIToolWidget.updateROILineEdit"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.ROIToolWidget.updateROILineEdit">[docs]</a>    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">updateROILineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; updates ROI line edit text</span>

<span class="sd">        :param text: text to update</span>
<span class="sd">        :type text: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">labelROILineEdit</span><span class="o">.</span><span class="n">hasFocus</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">labelROILineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_updateApplyButton</span><span class="p">()</span></div>

<div class="viewcode-block" id="ROIToolWidget.updateROIButton"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.ROIToolWidget.updateROIButton">[docs]</a>    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">updateROIButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enabled</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; enables/disables ROI buttons</span>

<span class="sd">        :param enable: buttons enabled</span>
<span class="sd">        :type enable: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span></div>
        <span class="c1"># self.__ui.applyROIPushButton.setEnabled(enabled)</span>
        <span class="c1"># self.__ui.fetchROIPushButton.setEnabled(enabled)</span>

<div class="viewcode-block" id="ROIToolWidget.updateApplyTips"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.ROIToolWidget.updateApplyTips">[docs]</a>    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">updateApplyTips</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; updates apply tips</span>

<span class="sd">        :param rid: current roi id</span>
<span class="sd">        :type rid: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">rid</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">applyROIPushButton</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
                <span class="s2">&quot;remove ROI aliases from the Door environment&quot;</span>
                <span class="s2">&quot; as well as from Active MntGrp&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">applyROIPushButton</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
                <span class="s2">&quot;add ROI aliases to the Door environment &quot;</span>
                <span class="s2">&quot;as well as to Active MntGrp&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ROIToolWidget.updateROIDisplayText"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.ROIToolWidget.updateROIDisplayText">[docs]</a>    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">updateROIDisplayText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">currentroi</span><span class="p">,</span> <span class="n">roiVal</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; updates ROI display text</span>

<span class="sd">        :param text: standard display text</span>
<span class="sd">        :type text: :obj:`str`</span>
<span class="sd">        :param currentroi: current roi label</span>
<span class="sd">        :type currentroi: :obj:`str`</span>
<span class="sd">        :param text: roi sum value</span>
<span class="sd">        :type text: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">roilabel</span> <span class="o">=</span> <span class="s2">&quot;roi [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">currentroi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">slabel</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">rlabel</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">labelROILineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">rlabel</span><span class="p">:</span>
            <span class="n">slabel</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;|,| |</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">rlabel</span><span class="p">)</span>
            <span class="n">slabel</span> <span class="o">=</span> <span class="p">[</span><span class="n">lb</span> <span class="k">for</span> <span class="n">lb</span> <span class="ow">in</span> <span class="n">slabel</span> <span class="k">if</span> <span class="n">lb</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">slabel</span><span class="p">:</span>
            <span class="n">roilabel</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">slabel</span><span class="p">[</span><span class="n">currentroi</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">currentroi</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">slabel</span><span class="p">)</span> <span class="k">else</span> <span class="n">slabel</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="p">(</span><span class="n">currentroi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">roiVal</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">roiInfoChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">; values = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">roilabel</span><span class="p">,</span> <span class="n">roiVal</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">roiInfoChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">roilabel</span><span class="p">,</span> <span class="n">roiVal</span><span class="p">))</span></div>

<div class="viewcode-block" id="ROIToolWidget.setROIsNumber"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.ROIToolWidget.setROIsNumber">[docs]</a>    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">setROIsNumber</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;sets a number of rois</span>

<span class="sd">        :param rid: number of rois</span>
<span class="sd">        :type rid: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">roiSpinBox</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">rid</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="LineCutToolWidget"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.LineCutToolWidget">[docs]</a><span class="k">class</span> <span class="nc">LineCutToolWidget</span><span class="p">(</span><span class="n">ToolBaseWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; line-cut tool widget</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#: (:obj:`str`) tool name</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;LineCut&quot;</span>
    <span class="c1">#: (:obj:`str`) tool name alias</span>
    <span class="n">alias</span> <span class="o">=</span> <span class="s2">&quot;linecut&quot;</span>
    <span class="c1">#: (:obj:`tuple` &lt;:obj:`str`&gt;) capitalized required packages</span>
    <span class="n">requires</span> <span class="o">=</span> <span class="p">()</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param parent: parent object</span>
<span class="sd">        :type parent: :class:`pyqtgraph.QtCore.QObject`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ToolBaseWidget</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

        <span class="c1">#: (:class:`Ui_LineCutToolWidget&#39;) ui_toolwidget object from qtdesigner</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span> <span class="o">=</span> <span class="n">_cutformclass</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">cuts</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">bottomplot</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">infolineedit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">infotips</span> <span class="o">=</span> \
            <span class="s2">&quot;coordinate info display for the mouse pointer&quot;</span>

        <span class="c1">#: (:obj:`int`) 1d x-coorindate index,</span>
        <span class="c1">#:          i.e. {0:Points, 1:&quot;X-Pixels&quot;, 2:&quot;Y-Pixels&quot;}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__xindex</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">#: (:obj:`bool`) plot cuts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__allcuts</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#: (:obj:`list`&lt;:class:`pyqtgraph.PlotDataItem`&gt;) 1D plot freezed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__freezed</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1">#: (:obj:`list`&lt;:class:`pyqtgraph.PlotDataItem`&gt;) 1D plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#: (:obj:`int`) current plot number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__nrplots</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1">#: (:class:`lavuelib.settings.Settings`) configuration settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">settings</span><span class="p">()</span>

        <span class="c1">#: (:obj:`list` &lt; [:class:`pyqtgraph.QtCore.pyqtSignal`, :obj:`str`] &gt;)</span>
        <span class="c1">#: list of [signal, slot] object to connect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signal2slot</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">cutSpinBox</span><span class="o">.</span><span class="n">valueChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updateCuts</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">cutSpinBox</span><span class="o">.</span><span class="n">valueChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">cutNumberChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setCutsNumber</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">cutCoordsChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plotCuts</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xcoordsComboBox</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_setXCoords</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xcoordsComboBox</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">mouseImagePositionChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_message</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">allcutsCheckBox</span><span class="o">.</span><span class="n">stateChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updateAllCuts</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">allcutsCheckBox</span><span class="o">.</span><span class="n">stateChanged</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">freezeBottomPlotClicked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_freezeplot</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">clearBottomPlotClicked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clearplot</span><span class="p">],</span>
        <span class="p">]</span>

<div class="viewcode-block" id="LineCutToolWidget.configure"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.LineCutToolWidget.configure">[docs]</a>    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set configuration for the current tool</span>

<span class="sd">        :param configuration: configuration string</span>
<span class="sd">        :type configuration: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configuration</span><span class="p">:</span>
            <span class="n">cnf</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;cuts_number&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">cutSpinBox</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;cuts_number&quot;</span><span class="p">]))</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                    <span class="c1"># print(str(e))</span>
            <span class="k">if</span> <span class="s2">&quot;all_cuts&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">allcutsCheckBox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;all_cuts&quot;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="s2">&quot;x_coordinates&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">idxs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">,</span> <span class="s2">&quot;x-pixels&quot;</span><span class="p">,</span> <span class="s2">&quot;y-pixels&quot;</span><span class="p">]</span>
                <span class="n">xcrd</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;x_coordinates&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="n">idxs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">xcrd</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xcoordsComboBox</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span></div>

<div class="viewcode-block" id="LineCutToolWidget.configuration"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.LineCutToolWidget.configuration">[docs]</a>    <span class="k">def</span> <span class="nf">configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides configuration for the current tool</span>

<span class="sd">        :returns configuration: configuration string</span>
<span class="sd">        :rtype configuration: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cnf</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;x_coordinates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xcoordsComboBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;all_cuts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">allcutsCheckBox</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;cuts_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">cutSpinBox</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">cnf</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">numpyEncoder</span><span class="p">)</span></div>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_freezeplot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; freeze plot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clearplot</span><span class="p">()</span>
        <span class="n">nrplots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__nrplots</span>
        <span class="k">while</span> <span class="n">nrplots</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__freezed</span><span class="p">):</span>
            <span class="n">cr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">onedbottomplot</span><span class="p">()</span>
            <span class="n">cr</span><span class="o">.</span><span class="n">setPen</span><span class="p">(</span><span class="n">_pg</span><span class="o">.</span><span class="n">mkColor</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__freezed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cr</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrplots</span><span class="p">):</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">xData</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">yData</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__freezed</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__freezed</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__freezed</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrplots</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__freezed</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__freezed</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__freezed</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_clearplot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; clear plot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">cr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__freezed</span><span class="p">:</span>
            <span class="n">cr</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_updateCuts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; update Cuts</span>

<span class="sd">        :param cid: cut id</span>
<span class="sd">        :type cid: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__allcuts</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__allcuts</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__allcuts</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateCuts</span><span class="p">(</span><span class="n">cid</span><span class="p">)</span>

<div class="viewcode-block" id="LineCutToolWidget.afterplot"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.LineCutToolWidget.afterplot">[docs]</a>    <span class="k">def</span> <span class="nf">afterplot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; command after plot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plotCuts</span><span class="p">()</span></div>

<div class="viewcode-block" id="LineCutToolWidget.activate"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.LineCutToolWidget.activate">[docs]</a>    <span class="k">def</span> <span class="nf">activate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; activates tool widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">onedbottomplot</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__nrplots</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">curve</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">:</span>
            <span class="n">curve</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="n">curve</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_updateAllCuts</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__allcuts</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plotCuts</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">bottomplotShowMenu</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="LineCutToolWidget.deactivate"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.LineCutToolWidget.deactivate">[docs]</a>    <span class="k">def</span> <span class="nf">deactivate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; activates tool widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">bottomplotShowMenu</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">curve</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">:</span>
            <span class="n">curve</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="n">curve</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">removebottomplot</span><span class="p">(</span><span class="n">curve</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">freezed</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__freezed</span><span class="p">:</span>
            <span class="n">freezed</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="n">freezed</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">removebottomplot</span><span class="p">(</span><span class="n">freezed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__freezed</span> <span class="o">=</span> <span class="p">[]</span></div>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_updateAllCuts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; updates X row status</span>

<span class="sd">        :param value: if True or not 0 x-cooridnates taken from the first row</span>
<span class="sd">        :param value: :obj:`int` or  :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__allcuts</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_updateCuts</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">cutSpinBox</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_setXCoords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xindex</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sets x-coodinates for 1d plot</span>

<span class="sd">        :param xindex: 1d x-coorindate index,</span>
<span class="sd">        :type xindex: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__xindex</span> <span class="o">=</span> <span class="n">xindex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plotCuts</span><span class="p">()</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_plotCuts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; plots the current 1d Cut</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__allcuts</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plotAllCuts</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plotCut</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_plotAllCuts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; plot all 1d Cuts</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">currentTool</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sendresults</span><span class="p">:</span>
                <span class="n">xl</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">yl</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">nrplots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">cutSpinBox</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__nrplots</span> <span class="o">!=</span> <span class="n">nrplots</span><span class="p">:</span>
                <span class="k">while</span> <span class="n">nrplots</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">onedbottomplot</span><span class="p">())</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrplots</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrplots</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__nrplots</span> <span class="o">=</span> <span class="n">nrplots</span>
                <span class="k">if</span> <span class="n">nrplots</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nrplots</span><span class="p">:</span>
                            <span class="n">cr</span><span class="o">.</span><span class="n">setPen</span><span class="p">(</span><span class="n">_pg</span><span class="o">.</span><span class="n">hsvColor</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">nrplots</span><span class="p">)))</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">cutCoords</span><span class="p">()</span>
            <span class="n">rws</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">rangeWindowScale</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrplots</span><span class="p">):</span>
                <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">cutData</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">nanmask</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">dt</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;f&#39;</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">min</span><span class="p">()):</span>
                            <span class="n">dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__xindex</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span>
                            <span class="n">crds</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">crds</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.00001</span><span class="p">]</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__xindex</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">crds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">crds</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">crds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">crds</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dx</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sendresults</span><span class="p">:</span>
                            <span class="n">xl</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">dx</span><span class="p">])</span>
                            <span class="n">yl</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">dt</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">rws</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
                            <span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dt</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">rws</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dx</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sendresults</span><span class="p">:</span>
                                <span class="n">xl</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">dx</span><span class="p">])</span>
                                <span class="n">yl</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">dt</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sendresults</span><span class="p">:</span>
                                <span class="n">xl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dt</span><span class="p">))))</span>
                                <span class="n">yl</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">dt</span><span class="p">])</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sendresults</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__sendresults</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span> <span class="n">yl</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_plotCut</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; plot the current 1d Cut</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__nrplots</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__nrplots</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">currentTool</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sendresults</span><span class="p">:</span>
                <span class="n">xl</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">yl</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">cutData</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setPen</span><span class="p">(</span><span class="n">_pg</span><span class="o">.</span><span class="n">mkColor</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">dt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">nanmask</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">dt</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;f&#39;</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">min</span><span class="p">()):</span>
                        <span class="n">dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__xindex</span><span class="p">:</span>
                    <span class="n">crds</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.00001</span><span class="p">]</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">currentCut</span><span class="p">()</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">crds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">cutCoords</span><span class="p">()[</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">currentCut</span><span class="p">()]</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__xindex</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">crds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">crds</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">crds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">crds</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dx</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sendresults</span><span class="p">:</span>
                        <span class="n">xl</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">dx</span><span class="p">])</span>
                        <span class="n">yl</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">dt</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rws</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">rangeWindowScale</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">rws</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
                        <span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dt</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">rws</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dx</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sendresults</span><span class="p">:</span>
                            <span class="n">xl</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">dx</span><span class="p">])</span>
                            <span class="n">yl</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">dt</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sendresults</span><span class="p">:</span>
                            <span class="n">xl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dt</span><span class="p">))))</span>
                            <span class="n">yl</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">dt</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sendresults</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__sendresults</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span> <span class="n">yl</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__sendresults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xl</span><span class="p">,</span> <span class="n">yl</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; send results to LavueController</span>

<span class="sd">        :param xl:  list of x&#39;s for each diffractogram</span>
<span class="sd">        :type xl: :obj:`list` &lt; :obj:`list` &lt;float&gt;&gt;</span>
<span class="sd">        :param yl:  list of values for each diffractogram</span>
<span class="sd">        :type yl: :obj:`list` &lt; :obj:`list` &lt;float&gt;&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tool&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">}</span>
        <span class="n">npl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xl</span><span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;imagename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">imageName</span><span class="p">()</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;nrlinecuts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xl</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npl</span><span class="p">):</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;linecut_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="n">xl</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">yl</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;unit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;point&quot;</span><span class="p">,</span> <span class="s2">&quot;x-pixel&quot;</span><span class="p">,</span> <span class="s2">&quot;y-pixel&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">__xindex</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span>
            <span class="s2">&quot;ToolResults&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">numpyEncoder</span><span class="p">))</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_setCutsNumber</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;sets a number of cuts</span>

<span class="sd">        :param cid: number of cuts</span>
<span class="sd">        :type cid: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">cutSpinBox</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">cid</span><span class="p">)</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides cut message</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">currentIntensity</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">intensity</span><span class="p">):</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ilabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scalingLabel</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">currentCut</span><span class="p">()</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">crds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">cutCoords</span><span class="p">()[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">currentCut</span><span class="p">()]</span>
            <span class="n">crds</span> <span class="o">=</span> <span class="s2">&quot;[[</span><span class="si">%.2f</span><span class="s2">, </span><span class="si">%.2f</span><span class="s2">], [</span><span class="si">%.2f</span><span class="s2">, </span><span class="si">%.2f</span><span class="s2">], width=</span><span class="si">%.2f</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">crds</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">crds</span> <span class="o">=</span> <span class="s2">&quot;[[0, 0], [0, 0], width=0]&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> \
           <span class="n">intensity</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">itn</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">it</span><span class="p">))</span>
                   <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">intensity</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">itn</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">, x = </span><span class="si">%.2f</span><span class="s2">, y = </span><span class="si">%.2f</span><span class="s2">, &quot;</span> \
                    <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> = (</span><span class="si">%.2f</span><span class="s2">, </span><span class="si">%.2f</span><span class="s2">, </span><span class="si">%.2f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">crds</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ilabel</span><span class="p">,</span>
                        <span class="n">itn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">itn</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">itn</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">, x = </span><span class="si">%.2f</span><span class="s2">, y = </span><span class="si">%.2f</span><span class="s2">, </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">crds</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ilabel</span><span class="p">,</span> <span class="n">intensity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">setDisplayedText</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>


<div class="viewcode-block" id="ProjectionToolWidget"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.ProjectionToolWidget">[docs]</a><span class="k">class</span> <span class="nc">ProjectionToolWidget</span><span class="p">(</span><span class="n">ToolBaseWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Projections tool widget</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#: (:obj:`str`) tool name</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Projections&quot;</span>
    <span class="c1">#: (:obj:`str`) tool name alias</span>
    <span class="n">alias</span> <span class="o">=</span> <span class="s2">&quot;projections&quot;</span>
    <span class="c1">#: (:obj:`tuple` &lt;:obj:`str`&gt;) capitalized required packages</span>
    <span class="n">requires</span> <span class="o">=</span> <span class="p">()</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param parent: parent object</span>
<span class="sd">        :type parent: :class:`pyqtgraph.QtCore.QObject`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ToolBaseWidget</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

        <span class="c1">#: (:class:`Ui_ProjectionToolWidget&#39;)</span>
        <span class="c1">#:      ui_toolwidget object from qtdesigner</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span> <span class="o">=</span> <span class="n">_projectionformclass</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1">#: (:class:`pyqtgraph.PlotDataItem`) 1D bottom plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__bottomplot</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:class:`pyqtgraph.PlotDataItem`) 1D bottom plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__rightplot</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`int`) function index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__funindex</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1">#: (:obj:`slice`) selected rows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__rows</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`slice`) selected columns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__columns</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`slice`) selected rows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`slice`) selected columns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dscolumns</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#: (:class:`lavuelib.settings.Settings`) configuration settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">settings</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">bottomplot</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">rightplot</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">vhbounds</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">infolineedit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">infotips</span> <span class="o">=</span> \
            <span class="s2">&quot;coordinate info display for the mouse pointer&quot;</span>

        <span class="c1">#: (:obj:`list` &lt; [:class:`pyqtgraph.QtCore.pyqtSignal`, :obj:`str`] &gt;)</span>
        <span class="c1">#: list of [signal, slot] object to connect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signal2slot</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">funComboBox</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_setFunction</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">funComboBox</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">rowsliceLineEdit</span><span class="o">.</span><span class="n">textChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updateRows</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">rowsliceLineEdit</span><span class="o">.</span><span class="n">textChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">columnsliceLineEdit</span><span class="o">.</span><span class="n">textChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updateColumns</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">columnsliceLineEdit</span><span class="o">.</span><span class="n">textChanged</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scalesChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updateRows</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scalesChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updateColumns</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">mouseImagePositionChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_message</span><span class="p">]</span>
        <span class="p">]</span>

    <span class="c1"># @debugmethod</span>
<div class="viewcode-block" id="ProjectionToolWidget.configure"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.ProjectionToolWidget.configure">[docs]</a>    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set configuration for the current tool</span>

<span class="sd">        :param configuration: configuration string</span>
<span class="sd">        :type configuration: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configuration</span><span class="p">:</span>
            <span class="n">cnf</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;mapping&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">idxs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;sum&quot;</span><span class="p">]</span>
                <span class="n">xcrd</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;mapping&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="n">idxs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">xcrd</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">funComboBox</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;rows&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">rowsliceLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;rows&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="s2">&quot;columns&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">columnsliceLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;columns&quot;</span><span class="p">])</span></div>

    <span class="c1"># @debugmethod</span>
<div class="viewcode-block" id="ProjectionToolWidget.configuration"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.ProjectionToolWidget.configuration">[docs]</a>    <span class="k">def</span> <span class="nf">configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides configuration for the current tool</span>

<span class="sd">        :returns configuration: configuration string</span>
<span class="sd">        :rtype configuration: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cnf</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;mapping&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">funComboBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;rows&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">rowsliceLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;columns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">columnsliceLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">cnf</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">numpyEncoder</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__updateslice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ds</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; create slices from the text</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="s2">&quot;ERROR&quot;</span>
        <span class="n">dsrows</span> <span class="o">=</span> <span class="s2">&quot;ERROR&quot;</span>
        <span class="k">if</span> <span class="n">text</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;:&quot;</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
                    <span class="n">slices</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
                    <span class="n">s0</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">slices</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">slices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">else</span> <span class="mi">0</span>
                    <span class="n">s1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">slices</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="n">slices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">slices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">s2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">slices</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">if</span> <span class="n">slices</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span>
                        <span class="n">rows</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">s0</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">dx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">dsrows</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">((</span><span class="n">s0</span><span class="o">-</span><span class="n">dx</span><span class="p">)</span><span class="o">/</span><span class="n">ds</span><span class="p">,</span> <span class="p">(</span><span class="n">s1</span><span class="o">-</span><span class="n">dx</span><span class="p">)</span><span class="o">/</span><span class="n">ds</span><span class="p">,</span> <span class="n">s2</span><span class="o">/</span><span class="n">ds</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">dsrows</span> <span class="o">=</span> <span class="n">rows</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">rows</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">s0</span><span class="p">,</span> <span class="n">s1</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">dx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">dsrows</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">((</span><span class="n">s0</span><span class="o">-</span><span class="n">dx</span><span class="p">)</span><span class="o">/</span><span class="n">ds</span><span class="p">,</span> <span class="p">(</span><span class="n">s1</span><span class="o">-</span><span class="n">dx</span><span class="p">)</span><span class="o">/</span><span class="n">ds</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">dsrows</span> <span class="o">=</span> <span class="n">rows</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">dx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">dsrows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">rows</span> <span class="o">-</span> <span class="n">dx</span><span class="p">)</span><span class="o">/</span><span class="n">ds</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dsrows</span> <span class="o">=</span> <span class="n">rows</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">dsrows</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">rows</span><span class="p">,</span> <span class="n">dsrows</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_updateSlices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; updates applied button&quot;&quot;&quot;</span>
        <span class="n">rtext</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">rowsliceLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">ctext</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">columnsliceLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">rwe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">rangeWindowEnabled</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">rwe</span><span class="p">:</span>
            <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">ds1</span><span class="p">,</span> <span class="n">ds2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span>
                <span class="n">useraxes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">noNone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__updateslice</span><span class="p">(</span>
                <span class="n">rtext</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">dy</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">ds2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__columns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dscolumns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__updateslice</span><span class="p">(</span>
                <span class="n">ctext</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">dx</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">ds1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__updateslice</span><span class="p">(</span><span class="n">rtext</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__columns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dscolumns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__updateslice</span><span class="p">(</span><span class="n">ctext</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rows</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateHBounds</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__rows</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateHBounds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rows</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__rows</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateHBounds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__rows</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rows</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__columns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateVBounds</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__columns</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateVBounds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__columns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__columns</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__columns</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateVBounds</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__columns</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__columns</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plotCurves</span><span class="p">()</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_updateRows</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; updates applied button&quot;&quot;&quot;</span>
        <span class="n">rtext</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">rowsliceLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">rwe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">rangeWindowEnabled</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">rwe</span><span class="p">:</span>
            <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">ds1</span><span class="p">,</span> <span class="n">ds2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span>
                <span class="n">useraxes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">noNone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__updateslice</span><span class="p">(</span>
                <span class="n">rtext</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">dy</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">ds2</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__updateslice</span><span class="p">(</span><span class="n">rtext</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rows</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateHBounds</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__rows</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateHBounds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rows</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__rows</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateHBounds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__rows</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rows</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plotCurves</span><span class="p">()</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_updateColumns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; updates applied button&quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">columnsliceLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">rwe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">rangeWindowEnabled</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">rwe</span><span class="p">:</span>
            <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">ds1</span><span class="p">,</span> <span class="n">ds2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span>
                <span class="n">useraxes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">noNone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rwe</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__columns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dscolumns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__updateslice</span><span class="p">(</span>
                <span class="n">text</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">dx</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">ds1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__columns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dscolumns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__updateslice</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__columns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateVBounds</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__columns</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateVBounds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__columns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__columns</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__columns</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateVBounds</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__columns</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__columns</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plotCurves</span><span class="p">()</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_setFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">findex</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set sum or mean function</span>

<span class="sd">        :param findex: function index, i.e. 0:mean, 1:sum</span>
<span class="sd">        :type findex: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__funindex</span> <span class="o">=</span> <span class="n">findex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plotCurves</span><span class="p">()</span>

<div class="viewcode-block" id="ProjectionToolWidget.afterplot"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.ProjectionToolWidget.afterplot">[docs]</a>    <span class="k">def</span> <span class="nf">afterplot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; command after plot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plotCurves</span><span class="p">()</span></div>

<div class="viewcode-block" id="ProjectionToolWidget.activate"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.ProjectionToolWidget.activate">[docs]</a>    <span class="k">def</span> <span class="nf">activate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; activates tool widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bottomplot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__bottomplot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">onedbarbottomplot</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rightplot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__rightplot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">onedbarrightplot</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__bottomplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__rightplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__bottomplot</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__rightplot</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_updateSlices</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plotCurves</span><span class="p">()</span></div>

<div class="viewcode-block" id="ProjectionToolWidget.deactivate"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.ProjectionToolWidget.deactivate">[docs]</a>    <span class="k">def</span> <span class="nf">deactivate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; activates tool widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bottomplot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__bottomplot</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__bottomplot</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">removebottomplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__bottomplot</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__bottomplot</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rightplot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__rightplot</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__rightplot</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">removerightplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__rightplot</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__rightplot</span> <span class="o">=</span> <span class="kc">None</span></div>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_plotCurves</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; plots the current image in 1d plots</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">currentTool</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="n">dts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">rawData</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">dts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">while</span> <span class="n">dts</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">dts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">dts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__funindex</span><span class="p">:</span>
                    <span class="n">npfun</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">npfun</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span> <span class="o">==</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">:</span>
                    <span class="n">sx</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                            <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span>
                                <span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;Mean of empty slice&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
                                <span class="n">sx</span> <span class="o">=</span> <span class="n">npfun</span><span class="p">(</span><span class="n">dts</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">sx</span> <span class="o">=</span> <span class="n">dts</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="n">sx</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                            <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span>
                                <span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;Mean of empty slice&#39;</span><span class="p">)</span>
                            <span class="n">sx</span> <span class="o">=</span> <span class="n">npfun</span><span class="p">(</span><span class="n">dts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="n">sx</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dscolumns</span> <span class="o">==</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">:</span>
                    <span class="n">sy</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dscolumns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                            <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span>
                                <span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;Mean of empty slice&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dscolumns</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
                                <span class="n">sy</span> <span class="o">=</span> <span class="n">npfun</span><span class="p">(</span><span class="n">dts</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__dscolumns</span><span class="p">,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">sy</span> <span class="o">=</span> <span class="n">dts</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__dscolumns</span><span class="p">,</span> <span class="p">:]</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="n">sy</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                        <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span>
                            <span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;Mean of empty slice&#39;</span><span class="p">)</span>
                        <span class="n">sy</span> <span class="o">=</span> <span class="n">npfun</span><span class="p">(</span><span class="n">dts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

                <span class="n">rwe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">rangeWindowEnabled</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">rwe</span><span class="p">:</span>
                    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span>
                        <span class="n">useraxes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">noNone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">transformations</span><span class="p">()[</span><span class="mi">3</span><span class="p">]:</span>
                        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span>
                        <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s1</span>
                    <span class="n">xx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                        <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">sx</span><span class="p">)</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">s1</span><span class="p">)))</span>
                    <span class="n">yy</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                        <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">sy</span><span class="p">)</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">s2</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">s1</span> <span class="o">=</span> <span class="mf">1.0</span>
                    <span class="n">s2</span> <span class="o">=</span> <span class="mf">1.0</span>
                    <span class="n">xx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sx</span><span class="p">)))</span>
                    <span class="n">yy</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sy</span><span class="p">)))</span>
                <span class="n">width</span> <span class="o">=</span> <span class="p">[</span><span class="n">s1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">sx</span><span class="p">)</span>
                <span class="n">height</span> <span class="o">=</span> <span class="p">[</span><span class="n">s2</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">sy</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__bottomplot</span><span class="o">.</span><span class="n">setOpts</span><span class="p">(</span>
                    <span class="n">y0</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">sx</span><span class="p">),</span> <span class="n">y1</span><span class="o">=</span><span class="n">sx</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">xx</span><span class="p">,</span>
                    <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__bottomplot</span><span class="o">.</span><span class="n">drawPicture</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__rightplot</span><span class="o">.</span><span class="n">setOpts</span><span class="p">(</span>
                    <span class="n">x0</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">sy</span><span class="p">),</span> <span class="n">x1</span><span class="o">=</span><span class="n">sy</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">yy</span><span class="p">,</span>
                    <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__rightplot</span><span class="o">.</span><span class="n">drawPicture</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sendresults</span><span class="p">:</span>
                    <span class="n">xslice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span>
                    <span class="n">yslice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dscolumns</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">xslice</span><span class="p">,</span> <span class="s2">&quot;start&quot;</span><span class="p">):</span>
                        <span class="n">xslice</span> <span class="o">=</span> <span class="p">[</span><span class="n">xslice</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">xslice</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="n">xslice</span><span class="o">.</span><span class="n">step</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">yslice</span><span class="p">,</span> <span class="s2">&quot;start&quot;</span><span class="p">):</span>
                        <span class="n">yslice</span> <span class="o">=</span> <span class="p">[</span><span class="n">yslice</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">yslice</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="n">yslice</span><span class="o">.</span><span class="n">step</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__sendresults</span><span class="p">(</span>
                        <span class="n">xx</span><span class="p">,</span>
                        <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">sx</span><span class="p">],</span>
                        <span class="n">s1</span><span class="p">,</span> <span class="n">xslice</span><span class="p">,</span>
                        <span class="n">yy</span><span class="p">,</span>
                        <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">sy</span><span class="p">],</span>
                        <span class="n">s2</span><span class="p">,</span> <span class="n">yslice</span><span class="p">,</span>
                        <span class="s2">&quot;sum&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__funindex</span> <span class="k">else</span> <span class="s2">&quot;mean&quot;</span>
                    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__sendresults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">sx</span><span class="p">,</span> <span class="n">xscale</span><span class="p">,</span> <span class="n">xslice</span><span class="p">,</span>
                      <span class="n">yy</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">yscale</span><span class="p">,</span> <span class="n">yslice</span><span class="p">,</span> <span class="n">fun</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; send results to LavueController</span>

<span class="sd">        :param xx:  x&#39;s coordinates</span>
<span class="sd">        :type xx:  :obj:`list` &lt;float&gt;</span>
<span class="sd">        :param sx:  projection to x coordinate</span>
<span class="sd">        :type sx:  :obj:`list` &lt;float&gt;</span>
<span class="sd">        :param xscale:  x scale</span>
<span class="sd">        :type xscale:  :obj:`float`</span>
<span class="sd">        :param xslice:  x slice</span>
<span class="sd">        :type xslice:  :obj:`list` &lt;float&gt;</span>
<span class="sd">        :param yy:  y&#39;s coordinates</span>
<span class="sd">        :type yy:  :obj:`list` &lt;float&gt;</span>
<span class="sd">        :param sy:  projection to y coordinate</span>
<span class="sd">        :type sy:  :obj:`list` &lt;float&gt;</span>
<span class="sd">        :param yscale:  y scale</span>
<span class="sd">        :type yscale:  :obj:`float`</span>
<span class="sd">        :param yslice:  y slice</span>
<span class="sd">        :type yslice:  :obj:`list` &lt;float&gt;</span>
<span class="sd">        :param fun:  projection function name</span>
<span class="sd">        :type fun:  :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tool&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">}</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;imagename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">imageName</span><span class="p">()</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;xx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xx</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;sx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sx</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;xscale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xscale</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;xslice&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xslice</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;yy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">yy</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;sy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sy</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;yscale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">yscale</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;yslice&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">yslice</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;function&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fun</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span>
            <span class="s2">&quot;ToolResults&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">numpyEncoder</span><span class="p">))</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides intensity message</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">intensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">currentIntensity</span><span class="p">()[:</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">intensity</span><span class="p">):</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span>
                <span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">it</span><span class="p">))</span>
                 <span class="k">else</span> <span class="n">it</span> <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">intensity</span><span class="p">])</span>
        <span class="n">ilabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scalingLabel</span><span class="p">()</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;x = </span><span class="si">%i</span><span class="s2">, y = </span><span class="si">%i</span><span class="s2">, </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ilabel</span><span class="p">,</span> <span class="n">intensity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">setDisplayedText</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>


<div class="viewcode-block" id="OneDToolWidget"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.OneDToolWidget">[docs]</a><span class="k">class</span> <span class="nc">OneDToolWidget</span><span class="p">(</span><span class="n">ToolBaseWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; 1d plot tool widget</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#: (:obj:`str`) tool name</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;1d-Plot&quot;</span>
    <span class="c1">#: (:obj:`str`) tool name alias</span>
    <span class="n">alias</span> <span class="o">=</span> <span class="s2">&quot;1d-plot&quot;</span>
    <span class="c1">#: (:obj:`tuple` &lt;:obj:`str`&gt;) capitalized required packages</span>
    <span class="n">requires</span> <span class="o">=</span> <span class="p">()</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param parent: parent object</span>
<span class="sd">        :type parent: :class:`pyqtgraph.QtCore.QObject`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ToolBaseWidget</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

        <span class="c1">#: (:class:`Ui_OneDToolWidget&#39;) ui_toolwidget object from qtdesigner</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span> <span class="o">=</span> <span class="n">_onedformclass</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1">#: (:obj:`list`&lt;:class:`pyqtgraph.PlotDataItem`&gt;) 1D plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#: (:obj:`int`) current plot number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__nrplots</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1">#: ((:obj:`list`&lt;:obj:`int`&gt;) selected rows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__rows</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1">#: ((:obj:`list`&lt;:obj:`int`&gt;) selected rows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1">#: ((:obj:`list`&lt;:obj:`str`&gt;) legend labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#: ((:obj:`bool`) x in first row</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__xinfirstrow</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#: ((:obj:`bool`) accumalate status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__accumulate</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#: ((:obj:`int`) buffer size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__buffersize</span> <span class="o">=</span> <span class="mi">1024</span>
        <span class="c1">#: ((:class:`ndarray`) buffer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#: (:class:`lavuelib.settings.Settings`) configuration settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">settings</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">rowsLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">bottomplot</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">infolineedit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">infotips</span> <span class="o">=</span> \
            <span class="s2">&quot;coordinate info display for the mouse pointer&quot;</span>

        <span class="c1">#: (:obj:`list` &lt; [:class:`pyqtgraph.QtCore.pyqtSignal`, :obj:`str`] &gt;)</span>
        <span class="c1">#: list of [signal, slot] object to connect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signal2slot</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">rowsLineEdit</span><span class="o">.</span><span class="n">textChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updateRows</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">rowsLineEdit</span><span class="o">.</span><span class="n">textChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scalesChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updateRows</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">sizeLineEdit</span><span class="o">.</span><span class="n">textChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setBufferSize</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">sizeLineEdit</span><span class="o">.</span><span class="n">textChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xCheckBox</span><span class="o">.</span><span class="n">stateChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updateXRow</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xCheckBox</span><span class="o">.</span><span class="n">stateChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">accuPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_startStopAccu</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">resetPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resetAccu</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">labelsPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setLabels</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">mouseImagePositionChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_message</span><span class="p">]</span>
        <span class="p">]</span>

<div class="viewcode-block" id="OneDToolWidget.configure"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.OneDToolWidget.configure">[docs]</a>    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set configuration for the current tool</span>

<span class="sd">        :param configuration: configuration string</span>
<span class="sd">        :type configuration: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configuration</span><span class="p">:</span>
            <span class="n">cnf</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;rows_to_plot&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">rowsLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;rows_to_plot&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="s2">&quot;buffer_size&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">sizeLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;buffer_size&quot;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="s2">&quot;collect&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_startStopAccu</span><span class="p">()</span>
            <span class="k">if</span> <span class="s2">&quot;xrow&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xCheckBox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;xrow&quot;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="s2">&quot;reset&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;reset&quot;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_resetAccu</span><span class="p">()</span>
            <span class="k">if</span> <span class="s2">&quot;labels&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__labels</span> <span class="o">=</span> <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">deactivate</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">activate</span><span class="p">()</span>

            <span class="k">if</span> <span class="s2">&quot;1d_stretch&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;1d_stretch&quot;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">bottomplotStretch</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>
                    <span class="c1"># print(str(e))</span>

<div class="viewcode-block" id="OneDToolWidget.configuration"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.OneDToolWidget.configuration">[docs]</a>    <span class="k">def</span> <span class="nf">configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides configuration for the current tool</span>

<span class="sd">        :returns configuration: configuration string</span>
<span class="sd">        :rtype configuration: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cnf</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;rows_to_plot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">rowsLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;buffer_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">sizeLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;buffer_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">sizeLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;collect&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__accumulate</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;xrow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">xCheckBox</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__labels</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">cnf</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">numpyEncoder</span><span class="p">)</span></div>

<div class="viewcode-block" id="OneDToolWidget.afterplot"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.OneDToolWidget.afterplot">[docs]</a>    <span class="k">def</span> <span class="nf">afterplot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; command after plot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plotCurves</span><span class="p">()</span></div>

<div class="viewcode-block" id="OneDToolWidget.beforeplot"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.OneDToolWidget.beforeplot">[docs]</a>    <span class="k">def</span> <span class="nf">beforeplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">rawarray</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; command  before plot</span>

<span class="sd">        :param array: 2d image array</span>
<span class="sd">        :type array: :class:`numpy.ndarray`</span>
<span class="sd">        :param rawarray: 2d raw image array</span>
<span class="sd">        :type rawarray: :class:`numpy.ndarray`</span>
<span class="sd">        :return: 2d image array and raw image</span>
<span class="sd">        :rtype: (:class:`numpy.ndarray`, :class:`numpy.ndarray`)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__accumulate</span><span class="p">:</span>
            <span class="n">dts</span> <span class="o">=</span> <span class="n">rawarray</span>
            <span class="k">while</span> <span class="n">dts</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">dts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">dts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">newrow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dts</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> \
               <span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">newrow</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__buffersize</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
                        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span><span class="p">[</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">__buffersize</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:,</span>
                            <span class="p">:],</span>
                         <span class="n">newrow</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span><span class="p">,</span> <span class="n">newrow</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">newrow</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span><span class="p">),</span> <span class="n">rawarray</span></div>

<div class="viewcode-block" id="OneDToolWidget.activate"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.OneDToolWidget.activate">[docs]</a>    <span class="k">def</span> <span class="nf">activate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; activates tool widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">sizeLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__buffersize</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_updateRows</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">onedshowlegend</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="OneDToolWidget.deactivate"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.OneDToolWidget.deactivate">[docs]</a>    <span class="k">def</span> <span class="nf">deactivate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; activates tool widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">cr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">:</span>
            <span class="n">cr</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="n">cr</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">removebottomplot</span><span class="p">(</span><span class="n">cr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__nrplots</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">onedshowlegend</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_setLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; launches label widget</span>

<span class="sd">        :returns: apply status</span>
<span class="sd">        :rtype: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dform</span> <span class="o">=</span> <span class="n">edListDialog</span><span class="o">.</span><span class="n">EdListDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">dform</span><span class="o">.</span><span class="n">record</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__labels</span> <span class="ow">or</span> <span class="p">[])</span>
        <span class="n">dform</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Tango Detector Attributes&quot;</span>
        <span class="n">dform</span><span class="o">.</span><span class="n">createGUI</span><span class="p">()</span>
        <span class="n">dform</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">dform</span><span class="o">.</span><span class="n">dirty</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__labels</span> <span class="o">=</span> <span class="n">dform</span><span class="o">.</span><span class="n">record</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">deactivate</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">activate</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">()</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_resetAccu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; reset accumulation buffer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">()</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_startStopAccu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; start/stop accumulation buffer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__accumulate</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__accumulate</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">accuPushButton</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Stop&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__accumulate</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">accuPushButton</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Collect&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">()</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_setBufferSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; start/stop accumulation buffer</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__buffersize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">sizeLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># print(str(e))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__buffersize</span> <span class="o">=</span> <span class="mi">1024</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_updateXRow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; updates X row status</span>

<span class="sd">        :param value: if True or not 0 x-cooridnates taken from the first row</span>
<span class="sd">        :param value: :obj:`int` or  :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__xinfirstrow</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">value</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_updateRows</span><span class="p">()</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_updateRows</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; updates applied button&quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">rowsLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dsrows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">rwe</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">text</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;ALL&quot;</span><span class="p">:</span>
                <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">rwe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">rangeWindowEnabled</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">rwe</span><span class="p">:</span>
                        <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">ds1</span><span class="p">,</span> <span class="n">ds2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span>
                            <span class="n">useraxes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">noNone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">transformations</span><span class="p">()[</span><span class="mi">3</span><span class="p">]:</span>
                            <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dx</span>
                            <span class="n">ds1</span><span class="p">,</span> <span class="n">ds2</span> <span class="o">=</span> <span class="n">ds2</span><span class="p">,</span> <span class="n">ds1</span>
                    <span class="n">stext</span> <span class="o">=</span> <span class="p">[</span><span class="n">rw</span> <span class="k">for</span> <span class="n">rw</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,| &quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span> <span class="k">if</span> <span class="n">rw</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">rw</span> <span class="ow">in</span> <span class="n">stext</span><span class="p">:</span>
                        <span class="k">if</span> <span class="s2">&quot;:&quot;</span> <span class="ow">in</span> <span class="n">rw</span><span class="p">:</span>
                            <span class="n">slices</span> <span class="o">=</span> <span class="n">rw</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
                            <span class="n">s0</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">slices</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">slices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">else</span> <span class="mi">0</span>
                            <span class="n">s1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">slices</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="n">slices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">else</span> <span class="mi">0</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">slices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                                <span class="n">s2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">slices</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">if</span> <span class="n">slices</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">else</span> <span class="mi">1</span>
                                <span class="n">rows</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">s0</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)))</span>
                                <span class="k">if</span> <span class="n">rwe</span><span class="p">:</span>
                                    <span class="n">dsrows</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                                        <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="n">s0</span><span class="o">-</span><span class="n">dy</span><span class="p">)</span><span class="o">/</span><span class="n">ds2</span><span class="p">),</span>
                                                   <span class="nb">int</span><span class="p">((</span><span class="n">s1</span><span class="o">-</span><span class="n">dy</span><span class="p">)</span><span class="o">/</span><span class="n">ds2</span><span class="p">),</span>
                                                   <span class="nb">int</span><span class="p">(</span><span class="n">s2</span><span class="o">/</span><span class="n">ds2</span><span class="p">))))</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">rows</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">s0</span><span class="p">,</span> <span class="n">s1</span><span class="p">)))</span>
                                <span class="k">if</span> <span class="n">rwe</span><span class="p">:</span>
                                    <span class="n">dsrows</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                                        <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="n">s0</span><span class="o">-</span><span class="n">dy</span><span class="p">)</span><span class="o">/</span><span class="n">ds2</span><span class="p">),</span>
                                                   <span class="nb">int</span><span class="p">((</span><span class="n">s1</span><span class="o">-</span><span class="n">dy</span><span class="p">)</span><span class="o">/</span><span class="n">ds2</span><span class="p">))))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">rw</span><span class="p">))</span>
                            <span class="k">if</span> <span class="n">rwe</span><span class="p">:</span>
                                <span class="n">dsrows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">rw</span><span class="p">)</span><span class="o">-</span><span class="n">dy</span><span class="p">)</span><span class="o">/</span><span class="n">ds2</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__rows</span> <span class="o">=</span> <span class="n">rows</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">rwe</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span> <span class="o">=</span> <span class="n">rows</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span> <span class="o">=</span> <span class="n">dsrows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plotCurves</span><span class="p">()</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_plotCurves</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; plots the current image in 1d plots</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">currentTool</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="n">reset</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sendresults</span><span class="p">:</span>
                <span class="n">xl</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">yl</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">dts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">rawData</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">dts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">while</span> <span class="n">dts</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">dts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">dts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dtnrpts</span> <span class="o">=</span> <span class="n">dts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__xinfirstrow</span><span class="p">:</span>
                            <span class="n">nrplots</span> <span class="o">=</span> <span class="n">dtnrpts</span> <span class="o">-</span> <span class="mi">1</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">nrplots</span> <span class="o">=</span> <span class="n">dtnrpts</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">nrplots</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">nrplots</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__nrplots</span> <span class="o">!=</span> <span class="n">nrplots</span><span class="p">:</span>
                    <span class="k">while</span> <span class="n">nrplots</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">):</span>
                        <span class="n">ii</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">)</span>
                        <span class="n">lb</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__labels</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__labels</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">ii</span><span class="p">:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__labels</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">lb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__labels</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lb</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">onedbottomplot</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">lb</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrplots</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrplots</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">)):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">nrplots</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__nrplots</span><span class="p">:</span>
                        <span class="n">reset</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__nrplots</span> <span class="o">=</span> <span class="n">nrplots</span>
                    <span class="k">if</span> <span class="n">nrplots</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nrplots</span><span class="p">:</span>
                                <span class="n">cr</span><span class="o">.</span><span class="n">setPen</span><span class="p">(</span><span class="n">_pg</span><span class="o">.</span><span class="n">hsvColor</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">nrplots</span><span class="p">)))</span>
                <span class="n">rwe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">rangeWindowEnabled</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">rwe</span><span class="p">:</span>
                    <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">ds1</span><span class="p">,</span> <span class="n">ds2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span>
                        <span class="n">useraxes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">noNone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">transformations</span><span class="p">()[</span><span class="mi">3</span><span class="p">]:</span>
                        <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dx</span>
                        <span class="n">ds1</span><span class="p">,</span> <span class="n">ds2</span> <span class="o">=</span> <span class="n">ds2</span><span class="p">,</span> <span class="n">ds1</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrplots</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__xinfirstrow</span> <span class="ow">and</span> <span class="n">i</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span>
                                    <span class="n">x</span><span class="o">=</span><span class="n">dts</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">dts</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sendresults</span><span class="p">:</span>
                                    <span class="n">xl</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">dts</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]])</span>
                                    <span class="n">yl</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">dts</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]])</span>
                            <span class="k">elif</span> <span class="n">rwe</span><span class="p">:</span>
                                <span class="n">y</span> <span class="o">=</span> <span class="n">dts</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
                                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
                                    <span class="n">dx</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">ds1</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sendresults</span><span class="p">:</span>
                                    <span class="n">xl</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">x</span><span class="p">])</span>
                                    <span class="n">yl</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">y</span><span class="p">])</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">dts</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sendresults</span><span class="p">:</span>
                                    <span class="n">dt</span> <span class="o">=</span> <span class="n">dts</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
                                    <span class="n">xl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dt</span><span class="p">))))</span>
                                    <span class="n">yl</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">dt</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dtnrpts</span><span class="p">):</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__xinfirstrow</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span>
                                    <span class="n">x</span><span class="o">=</span><span class="n">dts</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">dts</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sendresults</span><span class="p">:</span>
                                    <span class="n">xl</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">dts</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]])</span>
                                    <span class="n">yl</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span>
                                               <span class="n">dts</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span><span class="p">[</span><span class="n">i</span><span class="p">]]])</span>
                            <span class="k">elif</span> <span class="n">rwe</span><span class="p">:</span>
                                <span class="n">y</span> <span class="o">=</span> <span class="n">dts</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
                                    <span class="n">dx</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">ds1</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sendresults</span><span class="p">:</span>
                                    <span class="n">xl</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">x</span><span class="p">])</span>
                                    <span class="n">yl</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">y</span><span class="p">])</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span>
                                    <span class="n">dts</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sendresults</span><span class="p">:</span>
                                    <span class="n">dt</span> <span class="o">=</span> <span class="n">dts</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                                    <span class="n">xl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dt</span><span class="p">))))</span>
                                    <span class="n">yl</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">dt</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sendresults</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__sendresults</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span> <span class="n">yl</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">cr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">:</span>
                    <span class="n">cr</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">reset</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">deactivate</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">activate</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__sendresults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xl</span><span class="p">,</span> <span class="n">yl</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; send results to LavueController</span>

<span class="sd">        :param xl:  list of x&#39;s for each diffractogram</span>
<span class="sd">        :type xl: :obj:`list` &lt; :obj:`list` &lt;float&gt;&gt;</span>
<span class="sd">        :param yl:  list of values for each diffractogram</span>
<span class="sd">        :type yl: :obj:`list` &lt; :obj:`list` &lt;float&gt;&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tool&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">}</span>
        <span class="n">npl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xl</span><span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;imagename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">imageName</span><span class="p">()</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;nrplots&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xl</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npl</span><span class="p">):</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;onedplot_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="n">xl</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">yl</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span>
            <span class="s2">&quot;ToolResults&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">numpyEncoder</span><span class="p">))</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides intensity message</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">intensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">currentIntensity</span><span class="p">()[:</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">intensity</span><span class="p">):</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span>
                <span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">it</span><span class="p">))</span>
                 <span class="k">else</span> <span class="n">it</span> <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">intensity</span><span class="p">])</span>
        <span class="n">ilabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scalingLabel</span><span class="p">()</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;x = </span><span class="si">%i</span><span class="s2">, y = </span><span class="si">%i</span><span class="s2">, </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ilabel</span><span class="p">,</span> <span class="n">intensity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">setDisplayedText</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>


<div class="viewcode-block" id="AngleQToolWidget"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.AngleQToolWidget">[docs]</a><span class="k">class</span> <span class="nc">AngleQToolWidget</span><span class="p">(</span><span class="n">ToolBaseWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; angle/q tool widget</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#: (:obj:`str`) tool name</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Angle/Q&quot;</span>
    <span class="c1">#: (:obj:`str`) tool name alias</span>
    <span class="n">alias</span> <span class="o">=</span> <span class="s2">&quot;angle/q&quot;</span>
    <span class="c1">#: (:obj:`tuple` &lt;:obj:`str`&gt;) capitalized required packages</span>
    <span class="n">requires</span> <span class="o">=</span> <span class="p">()</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param parent: parent object</span>
<span class="sd">        :type parent: :class:`pyqtgraph.QtCore.QObject`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ToolBaseWidget</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

        <span class="c1">#: (:obj:`int`) geometry space index -&gt; 0: angle, 1 q-space</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__gspaceindex</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1">#: (:obj:`int`) plot index -&gt; 0: Cartesian, 1 polar-th, 2 polar-q</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1">#: (:class:`Ui_ROIToolWidget&#39;) ui_toolwidget object from qtdesigner</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span> <span class="o">=</span> <span class="n">_angleqformclass</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1">#: (:obj:`bool`) old lock value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__oldlocked</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#: (:class:`numpy.array`) radial array cache</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lastradial</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:class:`numpy.array`) angle array cache</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lastangle</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`float`) energy cache</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lastenergy</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`float`) radmax cache</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lastradmax</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`float`) plotindex cache</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lastpindex</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`float`) detdistance cache</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lastdistance</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`float`) center x cache</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lastcenterx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`float`) center y cache</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lastcentery</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`float`) pixelsizeycache</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lastpsizex</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`float`) pixelsizey cache</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lastpsizey</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:class:`numpy.array`) x array cache</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lastx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:class:`numpy.array`) y array cache</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lasty</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`float`) maxdim cache</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lastmaxdim</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#: (:obj:`float`) start position of radial q coordinate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__radqstart</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`float`) end position of radial q coordinate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__radqend</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`int`) grid size of radial q coordinate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__radqsize</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`float`) start position of radial theta coordinate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__radthstart</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`float`) end position of radial theta coordinate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__radthend</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`int`) grid size of radial theta coordinate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__radthsize</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`float`) start position of polar angle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__polstart</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`float`) end position of polar angle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__polend</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`int`) grid size of polar angle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__polsize</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#: (:obj:`float`) range changed flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__rangechanged</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># self.parameters.lines = True</span>
        <span class="c1">#: (:obj:`str`) infolineedit text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">infolineedit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">infotips</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">centerlines</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">toolscale</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># self.parameters.rightplot = True</span>

        <span class="c1">#: (`lavuelib.imageDisplayWidget.AxesParameters`) axes backup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__axes</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#: (:class:`lavuelib.settings.Settings`) configuration settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">settings</span><span class="p">()</span>

        <span class="c1">#: (:obj:`float`) radial coordinate factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__radmax</span> <span class="o">=</span> <span class="mf">1.</span>

        <span class="c1">#: (:obj:`float`) polar coordinate factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__polmax</span> <span class="o">=</span> <span class="mf">1.</span>

        <span class="c1">#: (:obj:`list` &lt; [:class:`pyqtgraph.QtCore.pyqtSignal`, :obj:`str`] &gt;)</span>
        <span class="c1">#: list of [signal, slot] object to connect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signal2slot</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">angleqPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setGeometry</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">rangePushButton</span><span class="o">.</span><span class="n">clicked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setPolarRange</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">angleqComboBox</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_setGSpaceIndex</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">angleqComboBox</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">plotComboBox</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_setPlotIndex</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">plotComboBox</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">mouseImageDoubleClicked</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_updateCenter</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">geometryChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateGeometryTip</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">geometryChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">mouseImagePositionChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_message</span><span class="p">]</span>
        <span class="p">]</span>

    <span class="c1"># @debugmethod</span>
<div class="viewcode-block" id="AngleQToolWidget.configure"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.AngleQToolWidget.configure">[docs]</a>    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set configuration for the current tool</span>

<span class="sd">        :param configuration: configuration string</span>
<span class="sd">        :type configuration: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configuration</span><span class="p">:</span>
            <span class="n">cnf</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;geometry&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_updateGeometry</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="c1"># print(str(e))</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">if</span> <span class="s2">&quot;plot_type&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">idxs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;pixels&quot;</span><span class="p">,</span> <span class="s2">&quot;polar-th&quot;</span><span class="p">,</span> <span class="s2">&quot;polar-q&quot;</span><span class="p">]</span>
                <span class="n">xcrd</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;plot_type&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="n">idxs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">xcrd</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">plotComboBox</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;units&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">idxs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;angles&quot;</span><span class="p">,</span> <span class="s2">&quot;q-space&quot;</span><span class="p">]</span>
                <span class="n">xcrd</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="n">idxs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">xcrd</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">angleqComboBox</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;plot_range&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_updatePolarRange</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;plot_range&quot;</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="c1"># print(str(e))</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>

    <span class="c1"># @debugmethod</span>
<div class="viewcode-block" id="AngleQToolWidget.configuration"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.AngleQToolWidget.configuration">[docs]</a>    <span class="k">def</span> <span class="nf">configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides configuration for the current tool</span>

<span class="sd">        :returns configuration: configuration string</span>
<span class="sd">        :rtype configuration: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cnf</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;plot_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">plotComboBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">angleqComboBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;plot_range&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__polstart</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__polend</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__polsize</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__radthstart</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radthend</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radthsize</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__radqstart</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radqend</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radqsize</span><span class="p">]</span>
        <span class="p">]</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;centerx&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span><span class="p">,</span>
            <span class="s2">&quot;centery&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span><span class="p">,</span>
            <span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">energy</span><span class="p">,</span>
            <span class="s2">&quot;pixelsizex&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizex</span><span class="p">,</span>
            <span class="s2">&quot;pixelsizey&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizey</span><span class="p">,</span>
            <span class="s2">&quot;detdistance&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">cnf</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">numpyEncoder</span><span class="p">)</span></div>

    <span class="c1"># @debugmethod</span>
<div class="viewcode-block" id="AngleQToolWidget.activate"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.AngleQToolWidget.activate">[docs]</a>    <span class="k">def</span> <span class="nf">activate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; activates tool widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__oldlocked</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateGeometryTip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateRangeTip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateCenter</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span><span class="p">)</span></div>

    <span class="c1"># @debugmethod</span>
<div class="viewcode-block" id="AngleQToolWidget.deactivate"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.AngleQToolWidget.deactivate">[docs]</a>    <span class="k">def</span> <span class="nf">deactivate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; deactivates tool widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setPlotIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>

    <span class="c1"># @debugmethod</span>
<div class="viewcode-block" id="AngleQToolWidget.beforeplot"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.AngleQToolWidget.beforeplot">[docs]</a>    <span class="k">def</span> <span class="nf">beforeplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">rawarray</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; command  before plot</span>

<span class="sd">        :param array: 2d image array</span>
<span class="sd">        :type array: :class:`numpy.ndarray`</span>
<span class="sd">        :param rawarray: 2d raw image array</span>
<span class="sd">        :type rawarray: :class:`numpy.ndarray`</span>
<span class="sd">        :return: 2d image array and raw image</span>
<span class="sd">        :rtype: (:class:`numpy.ndarray`, :class:`numpy.ndarray`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">transformations</span><span class="p">()[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">tdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plotPolarImage</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">array</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plotPolarImage</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">tdata</span><span class="p">,</span> <span class="n">tdata</span></div>

    <span class="k">def</span> <span class="nf">__havexychanged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radial</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; if xy changed</span>

<span class="sd">        :param radial: radial coordinate</span>
<span class="sd">        :type radial: :obj:`float` or :class:`numpy.array`</span>
<span class="sd">        :param angle: polar angle coordinate</span>
<span class="sd">        :type angle: :obj:`float` or :class:`numpy.array`</span>
<span class="sd">        :returns: flag if (x, y) have changed</span>
<span class="sd">        :rtype: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">recalc</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastradial</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastangle</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> \
           <span class="bp">self</span><span class="o">.</span><span class="n">__lastenergy</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastradmax</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> \
           <span class="bp">self</span><span class="o">.</span><span class="n">__lastpindex</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastdistance</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> \
           <span class="bp">self</span><span class="o">.</span><span class="n">__lastcenterx</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastcentery</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> \
           <span class="bp">self</span><span class="o">.</span><span class="n">__lastpsizex</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastpsizey</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> \
           <span class="bp">self</span><span class="o">.</span><span class="n">__lastx</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lasty</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">recalc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastenergy</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">energy</span><span class="p">:</span>
            <span class="n">recalc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastradmax</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radmax</span><span class="p">:</span>
            <span class="n">recalc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastpindex</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span><span class="p">:</span>
            <span class="n">recalc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastdistance</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span><span class="p">:</span>
            <span class="n">recalc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastcenterx</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span><span class="p">:</span>
            <span class="n">recalc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastcentery</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span><span class="p">:</span>
            <span class="n">recalc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastpsizex</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizex</span><span class="p">:</span>
            <span class="n">recalc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastpsizey</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizey</span><span class="p">:</span>
            <span class="n">recalc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">radial</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span>
              <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__lastradial</span><span class="p">,</span> <span class="n">radial</span><span class="p">)):</span>
            <span class="n">recalc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">radial</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
              <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastradial</span> <span class="o">!=</span> <span class="n">radial</span><span class="p">):</span>
            <span class="n">recalc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
              <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__lastangle</span><span class="p">,</span> <span class="n">angle</span><span class="p">)):</span>
            <span class="n">recalc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastangle</span> <span class="o">!=</span> <span class="n">angle</span><span class="p">:</span>
            <span class="n">recalc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">recalc</span>

    <span class="k">def</span> <span class="nf">__intintensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radial</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; intensity interpolation function</span>

<span class="sd">        :param radial: radial coordinate</span>
<span class="sd">        :type radial: :obj:`float` or :class:`numpy.array`</span>
<span class="sd">        :param angle: polar angle coordinate</span>
<span class="sd">        :type angle: :obj:`float` or :class:`numpy.array`</span>
<span class="sd">        :return: interpolated intensity</span>
<span class="sd">        :rtype: :obj:`float` or :class:`numpy.array`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rangechanged</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__havexychanged</span><span class="p">(</span><span class="n">radial</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">rstart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radthstart</span> \
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radthstart</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="n">radial</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radmax</span> <span class="o">+</span> <span class="n">rstart</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">wavelength</span> <span class="o">=</span> <span class="mf">12398.4193</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">energy</span>
                <span class="n">rstart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radqstart</span> \
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radqstart</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">radial</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radmax</span> <span class="o">+</span> <span class="n">rstart</span><span class="p">)</span> <span class="o">*</span> <span class="n">wavelength</span>
                    <span class="o">/</span> <span class="p">(</span><span class="mf">4.</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__polsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> \
               <span class="bp">self</span><span class="o">.</span><span class="n">__polstart</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__polend</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">pstart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__polstart</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__polstart</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="n">angle</span> <span class="o">=</span> <span class="n">angle</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__polmax</span> <span class="o">+</span> <span class="n">pstart</span>
            <span class="n">fac</span> <span class="o">=</span> <span class="mf">1000.</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__lastx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span> <span class="o">+</span> \
                <span class="n">fac</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span> \
                <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizex</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__lasty</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span> <span class="o">+</span> \
                <span class="n">fac</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span> \
                <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizey</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__lastenergy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">energy</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__lastradmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radmax</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__lastpindex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__lastdistance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__lastcenterx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__lastcentery</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__lastpsizex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizex</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__lastpsizey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizey</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__lastradial</span> <span class="o">=</span> <span class="n">radial</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__lastangle</span> <span class="o">=</span> <span class="n">angle</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__rangechanged</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__inter</span><span class="p">,</span> <span class="s2">&quot;ev&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__inter</span><span class="o">.</span><span class="n">ev</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__lastx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lasty</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__inter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__lastx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lasty</span><span class="p">],</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">__calculateRadMax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pindex</span><span class="p">,</span> <span class="n">rdata</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; recalculates radmax</span>

<span class="sd">        :param rarray: 2d image array</span>
<span class="sd">        :type rarray: :class:`numpy.ndarray`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">rdata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">currentData</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">rdata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">pindex</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastmaxdim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> \
                   <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radthsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">maxdim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastmaxdim</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">maxdim</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">rdata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rdata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">rstart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radthstart</span> \
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radthstart</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radthend</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">th0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pixel2theta</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">th1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pixel2theta</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rdata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">th2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pixel2theta</span><span class="p">(</span><span class="n">rdata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">th3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pixel2theta</span><span class="p">(</span>
                        <span class="n">rdata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rdata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">rmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">th0</span><span class="p">,</span> <span class="n">th1</span><span class="p">,</span> <span class="n">th2</span><span class="p">,</span> <span class="n">th3</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                        <span class="n">rmax</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rmax</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__radthend</span> <span class="o">-</span> <span class="n">rstart</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radthsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">maxdim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radthsize</span>
                <span class="k">if</span> <span class="n">rmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># self._setGeometry()</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Please set the detector geometry to continue&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__radmax</span> <span class="o">=</span> <span class="n">rmax</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">maxdim</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">pindex</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastmaxdim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> \
                   <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radqsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">maxdim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastmaxdim</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">maxdim</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">rdata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rdata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">rstart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radqstart</span> \
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radqstart</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radqend</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">q0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pixel2q</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">q1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pixel2q</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rdata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">q2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pixel2q</span><span class="p">(</span><span class="n">rdata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">q3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pixel2q</span><span class="p">(</span>
                        <span class="n">rdata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rdata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">rmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">q0</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="n">q3</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                        <span class="n">rmax</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rmax</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__radqend</span> <span class="o">-</span> <span class="n">rstart</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radqsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">maxdim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radqsize</span>
                <span class="k">if</span> <span class="n">rmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># self._setGeometry()</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Please set the detector geometry to continue&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__radmax</span> <span class="o">=</span> <span class="n">rmax</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">maxdim</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pindex</span><span class="p">:</span>
                <span class="n">psize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__polsize</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__polsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">360</span>
                <span class="n">pstart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__polstart</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__polstart</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="n">pend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__polend</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__polend</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">360</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__polmax</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">pend</span> <span class="o">-</span> <span class="n">pstart</span><span class="p">)</span> <span class="o">/</span> <span class="n">psize</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">__plotPolarImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rdata</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; intensity interpolation function</span>

<span class="sd">        :param rarray: 2d image array</span>
<span class="sd">        :type rarray: :class:`numpy.ndarray`</span>
<span class="sd">        :return: 2d image array</span>
<span class="sd">        :rtype: :class:`numpy.ndarray`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">energy</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> \
           <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizex</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizey</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rdata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">rdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">currentData</span><span class="p">()</span>
            <span class="n">rwe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">rangeWindowEnabled</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">rwe</span><span class="p">:</span>
                <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">ds1</span><span class="p">,</span> <span class="n">ds2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span>
                    <span class="n">useraxes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">noNone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">dx</span><span class="p">),</span>
                                    <span class="nb">int</span><span class="p">((</span><span class="n">rdata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">ds1</span> <span class="o">+</span> <span class="n">dx</span><span class="p">),</span>
                                    <span class="nb">int</span><span class="p">(</span><span class="n">ds1</span><span class="p">)))</span>

                <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">dy</span><span class="p">),</span>
                                    <span class="nb">int</span><span class="p">((</span><span class="n">rdata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">ds2</span> <span class="o">+</span> <span class="n">dy</span><span class="p">),</span>
                                    <span class="nb">int</span><span class="p">(</span><span class="n">ds2</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">rdata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">rdata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">__inter</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">RegularGridInterpolator</span><span class="p">(</span>
                <span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">),</span> <span class="n">rdata</span><span class="p">,</span>
                <span class="n">fill_value</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scaling</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;log&#39;</span>
                            <span class="k">else</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span>
                <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="n">maxpolar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__polsize</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__polsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">360</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radthsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__lastmaxdim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radthsize</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__lastmaxdim</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">rdata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rdata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radqsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__lastmaxdim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radqsize</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__lastmaxdim</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">rdata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rdata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__calculateRadMax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span><span class="p">,</span> <span class="n">rdata</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="n">tdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfunction</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intintensity</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span>
                <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__lastmaxdim</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">maxpolar</span><span class="p">)),</span>
                <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="c1"># else:</span>
            <span class="c1">#     self.__inter = scipy.interpolate.RectBivariateSpline(</span>
            <span class="c1">#         xx, yy, rdata)</span>
            <span class="c1">#     tdata = np.fromfunction(</span>
            <span class="c1">#         lambda x, y: self.__intintensity(x, y),</span>
            <span class="c1">#         (int(self.__lastmaxdim), int(maxpolar)),</span>
            <span class="c1">#         dtype=float)</span>
            <span class="k">return</span> <span class="n">tdata</span>

    <span class="c1"># @debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_updateCenter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; updates the image center</span>

<span class="sd">        :param xdata: x pixel position</span>
<span class="sd">        :type xdata: :obj:`float`</span>
<span class="sd">        :param ydata: y-pixel position</span>
<span class="sd">        :type ydata: :obj:`float`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">txdata</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">rangeWindowEnabled</span><span class="p">():</span>
                <span class="n">txdata</span><span class="p">,</span> <span class="n">tydata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scaledxy</span><span class="p">(</span>
                    <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">useraxes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">txdata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">xdata</span> <span class="o">=</span> <span class="n">txdata</span>
                    <span class="n">ydata</span> <span class="o">=</span> <span class="n">tydata</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">xdata</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span><span class="s2">&quot;BeamCenterX&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">xdata</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span><span class="s2">&quot;BeamCenterY&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">ydata</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_message</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateGeometryTip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">()</span>

    <span class="c1"># @debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides geometry message</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">currentIntensity</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">intensity</span><span class="p">):</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span>
                <span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">it</span><span class="p">))</span>
                 <span class="k">else</span> <span class="n">it</span> <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">intensity</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">rangeWindowEnabled</span><span class="p">():</span>
            <span class="n">txdata</span><span class="p">,</span> <span class="n">tydata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scaledxy</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">useraxes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">txdata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">txdata</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">tydata</span>
        <span class="n">ilabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scalingLabel</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__gspaceindex</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">thetax</span><span class="p">,</span> <span class="n">thetay</span><span class="p">,</span> <span class="n">thetatotal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pixel2theta</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">thetax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;th_x = </span><span class="si">%f</span><span class="s2"> deg, th_y = </span><span class="si">%f</span><span class="s2"> deg,&quot;</span> \
                              <span class="s2">&quot; th_tot = </span><span class="si">%f</span><span class="s2"> deg, </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%.2f</span><span class="s2">&quot;</span> \
                              <span class="o">%</span> <span class="p">(</span><span class="n">thetax</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
                                 <span class="n">thetay</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
                                 <span class="n">thetatotal</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
                                 <span class="n">ilabel</span><span class="p">,</span> <span class="n">intensity</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">qx</span><span class="p">,</span> <span class="n">qy</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pixel2q</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">qx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">message</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;q_x = </span><span class="si">%f</span><span class="s2"> 1/</span><span class="se">\u212B</span><span class="s2">, q_y = </span><span class="si">%f</span><span class="s2"> 1/</span><span class="se">\u212B</span><span class="s2">, &quot;</span> \
                              <span class="sa">u</span><span class="s2">&quot;q = </span><span class="si">%f</span><span class="s2"> 1/</span><span class="se">\u212B</span><span class="s2">, </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%.2f</span><span class="s2">&quot;</span> \
                              <span class="o">%</span> <span class="p">(</span><span class="n">qx</span><span class="p">,</span> <span class="n">qy</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">ilabel</span><span class="p">,</span> <span class="n">intensity</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">rstart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radthstart</span> \
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radthstart</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">pstart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__polstart</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__polstart</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">iscaling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scaling</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">iscaling</span> <span class="o">!=</span> <span class="s2">&quot;linear&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ilabel</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">iscaling</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">ilabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;(&quot;</span><span class="p">:</span>
                    <span class="n">ilabel</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">iscaling</span><span class="p">,</span> <span class="n">ilabel</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ilabel</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">iscaling</span><span class="p">,</span> <span class="n">ilabel</span><span class="p">)</span>

            <span class="n">message</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;th_tot = </span><span class="si">%f</span><span class="s2"> deg, polar = </span><span class="si">%f</span><span class="s2"> deg, &quot;</span> \
                      <span class="sa">u</span><span class="s2">&quot; </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                          <span class="n">x</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radmax</span> <span class="o">+</span> <span class="n">rstart</span><span class="p">,</span>
                          <span class="n">y</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__polmax</span> <span class="o">+</span> <span class="n">pstart</span><span class="p">,</span>
                          <span class="n">ilabel</span><span class="p">,</span> <span class="n">intensity</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">iscaling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scaling</span><span class="p">()</span>
            <span class="n">pstart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__polstart</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__polstart</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">rstart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radqstart</span> \
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radqstart</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">iscaling</span> <span class="o">!=</span> <span class="s2">&quot;linear&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ilabel</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">iscaling</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">ilabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;(&quot;</span><span class="p">:</span>
                    <span class="n">ilabel</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">iscaling</span><span class="p">,</span> <span class="n">ilabel</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ilabel</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">iscaling</span><span class="p">,</span> <span class="n">ilabel</span><span class="p">)</span>

            <span class="n">message</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;q = </span><span class="si">%f</span><span class="s2"> 1/</span><span class="se">\u212B</span><span class="s2">, polar = </span><span class="si">%f</span><span class="s2"> deg, &quot;</span> \
                      <span class="sa">u</span><span class="s2">&quot; </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                          <span class="n">x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radmax</span> <span class="o">+</span> <span class="n">rstart</span><span class="p">,</span>
                          <span class="n">y</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__polmax</span> <span class="o">+</span> <span class="n">pstart</span><span class="p">,</span>
                          <span class="n">ilabel</span><span class="p">,</span> <span class="n">intensity</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">setDisplayedText</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__pixel2theta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; converts coordinates from pixel positions to theta angles</span>

<span class="sd">        :param xdata: x pixel position</span>
<span class="sd">        :type xdata: :obj:`float`</span>
<span class="sd">        :param ydata: y-pixel position</span>
<span class="sd">        :type ydata: :obj:`float`</span>
<span class="sd">        :param xy: flag</span>
<span class="sd">        :type xy: :obj:`bool`</span>
<span class="sd">        :returns: x-theta, y-theta, total-theta</span>
<span class="sd">        :rtype: (:obj:`float`, :obj:`float`, :obj:`float`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">thetax</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">thetay</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">thetatotal</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">energy</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">xcentered</span> <span class="o">=</span> <span class="n">xdata</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span>
            <span class="n">ycentered</span> <span class="o">=</span> <span class="n">ydata</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span>
            <span class="k">if</span> <span class="n">xy</span><span class="p">:</span>
                <span class="n">thetax</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span>
                    <span class="n">xcentered</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizex</span> <span class="o">/</span> <span class="mf">1000.</span>
                    <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span><span class="p">)</span>
                <span class="n">thetay</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span>
                    <span class="n">ycentered</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizey</span> <span class="o">/</span> <span class="mf">1000.</span>
                    <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                <span class="p">(</span><span class="n">xcentered</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizex</span> <span class="o">/</span> <span class="mf">1000.</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">ycentered</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizey</span> <span class="o">/</span> <span class="mf">1000.</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">thetatotal</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span>
                <span class="n">r</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">thetax</span><span class="p">,</span> <span class="n">thetay</span><span class="p">,</span> <span class="n">thetatotal</span>

    <span class="k">def</span> <span class="nf">__pixel2q</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; converts coordinates from pixel positions to q-space coordinates</span>

<span class="sd">        :param xdata: x pixel position</span>
<span class="sd">        :type xdata: :obj:`float`</span>
<span class="sd">        :param ydata: y-pixel position</span>
<span class="sd">        :type ydata: :obj:`float`</span>
<span class="sd">        :param xy: flag</span>
<span class="sd">        :type xy: :obj:`bool`</span>
<span class="sd">        :returns: q_x, q_y, q_total</span>
<span class="sd">        :rtype: (:obj:`float`, :obj:`float`, :obj:`float`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">qx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">qy</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">q</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">energy</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">thetax</span><span class="p">,</span> <span class="n">thetay</span><span class="p">,</span> <span class="n">thetatotal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pixel2theta</span><span class="p">(</span>
                <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">xy</span><span class="p">)</span>
            <span class="n">wavelength</span> <span class="o">=</span> <span class="mf">12398.4193</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">energy</span>
            <span class="k">if</span> <span class="n">xy</span><span class="p">:</span>
                <span class="n">qx</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">wavelength</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">thetax</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
                <span class="n">qy</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">wavelength</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">thetay</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
            <span class="n">q</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">wavelength</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">thetatotal</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">qx</span><span class="p">,</span> <span class="n">qy</span><span class="p">,</span> <span class="n">q</span>

    <span class="k">def</span> <span class="nf">__tipmessage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides geometry messate</span>

<span class="sd">        :returns: geometry text</span>
<span class="sd">        :rtype: :obj:`unicode`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="sa">u</span><span class="s2">&quot;geometry:</span><span class="se">\n</span><span class="s2">&quot;</span> \
            <span class="sa">u</span><span class="s2">&quot;  center = (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">) pixels</span><span class="se">\n</span><span class="s2">&quot;</span> \
            <span class="sa">u</span><span class="s2">&quot;  pixel_size = (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">) </span><span class="se">\u00B5</span><span class="s2">m</span><span class="se">\n</span><span class="s2">&quot;</span> \
            <span class="sa">u</span><span class="s2">&quot;  detector_distance = </span><span class="si">%s</span><span class="s2"> mm</span><span class="se">\n</span><span class="s2">&quot;</span> \
            <span class="sa">u</span><span class="s2">&quot;  energy = </span><span class="si">%s</span><span class="s2"> eV&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizex</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizey</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">energy</span>
            <span class="p">)</span>

    <span class="c1"># @debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_setPolarRange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; launches range widget</span>

<span class="sd">        :returns: apply status</span>
<span class="sd">        :rtype: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cnfdlg</span> <span class="o">=</span> <span class="n">rangeDialog</span><span class="o">.</span><span class="n">RangeDialog</span><span class="p">()</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">polstart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__polstart</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">polend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__polend</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">polsize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__polsize</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">radqstart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radqstart</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">radqend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radqend</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">radqsize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radqsize</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">radthstart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radthstart</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">radthend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radthend</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">radthsize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radthsize</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">createGUI</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">exec_</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__polstart</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">polstart</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__polend</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">polend</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__polsize</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">polsize</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__radthstart</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">radthstart</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__radthend</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">radthend</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__radthsize</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">radthsize</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__radqstart</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">radqstart</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__radqend</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">radqend</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__radqsize</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">radqsize</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__rangechanged</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateRangeTip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setPlotIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitReplotImage</span><span class="p">()</span>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">_updatePolarRange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotrange</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; update polar range</span>

<span class="sd">        :returns: (start, end, size) for polar, theta and q coordinates</span>
<span class="sd">        :rtype: :obj:`list`&lt; [:obj:`float` ,:obj:`float` ,:obj:`float`] &gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__polstart</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">plotrange</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__polstart</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__polend</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">plotrange</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__polend</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__polsize</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">plotrange</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__polsize</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__radthstart</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">plotrange</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__radthstart</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__radthend</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">plotrange</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__radthend</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__radthsize</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">plotrange</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__radthsize</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__radqstart</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">plotrange</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__radqstart</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__radqend</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">plotrange</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__radqend</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__radqsize</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">plotrange</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__radqsize</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__rangechanged</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateRangeTip</span><span class="p">()</span>
        <span class="c1"># self._setPlotIndex(self.__plotindex)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitReplotImage</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">()</span>

    <span class="c1"># @debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_updateGeometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geometry</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; update geometry widget</span>

<span class="sd">        :param geometry: geometry dictionary</span>
<span class="sd">        :type geometry: :obj:`dict` &lt; :obj:`str`, :obj:`list`&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;centerx&quot;</span> <span class="ow">in</span> <span class="n">geometry</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;centerx&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span>
                    <span class="s2">&quot;BeamCenterX&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;centery&quot;</span> <span class="ow">in</span> <span class="n">geometry</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;centery&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span>
                    <span class="s2">&quot;BeamCenterY&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;energy&quot;</span> <span class="ow">in</span> <span class="n">geometry</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">energy</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span>
                    <span class="s2">&quot;Energy&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">energy</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;pixelsizex&quot;</span> <span class="ow">in</span> <span class="n">geometry</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizex</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;pixelsizex&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;pixelsizey&quot;</span> <span class="ow">in</span> <span class="n">geometry</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizey</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;pixelsizey&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;detdistance&quot;</span> <span class="ow">in</span> <span class="n">geometry</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;detdistance&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span>
                <span class="s2">&quot;DetectorDistance&quot;</span><span class="p">,</span>
                <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="n">geometry</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateGeometryTip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateCenter</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitReplotImage</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">()</span>

    <span class="c1"># @debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_setGeometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; launches geometry widget</span>

<span class="sd">        :returns: apply status</span>
<span class="sd">        :rtype: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cnfdlg</span> <span class="o">=</span> <span class="n">geometryDialog</span><span class="o">.</span><span class="n">GeometryDialog</span><span class="p">()</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">centery</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">energy</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">pixelsizex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizex</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">pixelsizey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizey</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">detdistance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">createGUI</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">exec_</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">centerx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">centery</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">energy</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">energy</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizex</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">pixelsizex</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizey</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">pixelsizey</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">detdistance</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span>
                <span class="s2">&quot;BeamCenterX&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span>
                <span class="s2">&quot;BeamCenterY&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span>
                <span class="s2">&quot;Energy&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">energy</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span>
                <span class="s2">&quot;DetectorDistance&quot;</span><span class="p">,</span>
                <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateGeometryTip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateCenter</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitReplotImage</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">()</span>

    <span class="c1"># @debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_setGSpaceIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gindex</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set gspace index</span>

<span class="sd">        :param gspace: g-space index, i.e. angle or q-space</span>
<span class="sd">        :type gspace: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__gspaceindex</span> <span class="o">=</span> <span class="n">gindex</span>

    <span class="c1"># @debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_setPlotIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pindex</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set gspace index</span>

<span class="sd">        :param gspace: g-space index,</span>
<span class="sd">        :         i.e. 0: Cartesian, 1: polar-th, 2: polar-q</span>
<span class="sd">        :type gspace: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pindex</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__calculateRadMax</span><span class="p">(</span><span class="n">pindex</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">plotComboBox</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">centerlines</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">toolscale</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">pindex</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">rscale</span> <span class="o">=</span> <span class="mf">180.</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radmax</span>
                <span class="n">rstart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radthstart</span> \
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radthstart</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radmax</span>
                <span class="n">rstart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radqstart</span> \
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radqstart</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">pstart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__polstart</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__polstart</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">pscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__polmax</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">setToolScale</span><span class="p">([</span><span class="n">rstart</span><span class="p">,</span> <span class="n">pstart</span><span class="p">],</span> <span class="p">[</span><span class="n">rscale</span><span class="p">,</span> <span class="n">pscale</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__oldlocked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">setAspectLocked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__oldlocked</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">setAspectLocked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__oldlocked</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">centerlines</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">toolscale</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">pindex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span> <span class="o">=</span> <span class="n">pindex</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">plotComboBox</span><span class="o">.</span><span class="n">currentIndex</span> <span class="o">!=</span> <span class="n">pindex</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">plotComboBox</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">pindex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateinfowidgets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitReplotImage</span><span class="p">()</span>

<div class="viewcode-block" id="AngleQToolWidget.updateGeometryTip"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.AngleQToolWidget.updateGeometryTip">[docs]</a>    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">updateGeometryTip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; update geometry tips</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tipmessage</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateDisplayedTextTip</span><span class="p">(</span>
            <span class="s2">&quot;coordinate info display for the mouse pointer</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span>
            <span class="o">%</span> <span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">angleqPushButton</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
            <span class="s2">&quot;Input physical parameters</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">angleqComboBox</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
            <span class="s2">&quot;Select the display space</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">toolLabel</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
            <span class="s2">&quot;coordinate info display for the mouse pointer</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">message</span><span class="p">)</span></div>

<div class="viewcode-block" id="AngleQToolWidget.updateRangeTip"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.AngleQToolWidget.updateRangeTip">[docs]</a>    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">updateRangeTip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; update geometry tips</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">rangePushButton</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
            <span class="sa">u</span><span class="s2">&quot;Polar: [</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">] deg, size=</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">u</span><span class="s2">&quot;th_tot: [</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">] deg, size=</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">u</span><span class="s2">&quot;q: [</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">] 1/</span><span class="se">\u212B</span><span class="s2">, size=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__polstart</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__polstart</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__polend</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__polend</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;360&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__polsize</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__polsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;max&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__radthstart</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radthstart</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__radthend</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radthend</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;thmax&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__radthsize</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radthsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;max&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__radqstart</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radqstart</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__radqend</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radqend</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;qmax&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__radqsize</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radqsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;max&quot;</span><span class="p">)</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="DiffractogramToolWidget"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.DiffractogramToolWidget">[docs]</a><span class="k">class</span> <span class="nc">DiffractogramToolWidget</span><span class="p">(</span><span class="n">ToolBaseWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; diffractogram tool widget</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#: (:obj:`str`) tool name</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Diffractogram&quot;</span>
    <span class="c1">#: (:obj:`str`) tool name alias</span>
    <span class="n">alias</span> <span class="o">=</span> <span class="s2">&quot;diffractogram&quot;</span>
    <span class="c1">#: (:obj:`tuple` &lt;:obj:`str`&gt;) capitalized required packages</span>
    <span class="n">requires</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;PYFAI&quot;</span><span class="p">,)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param parent: parent object</span>
<span class="sd">        :type parent: :class:`pyqtgraph.QtCore.QObject`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ToolBaseWidget</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

        <span class="c1">#: (:obj:`int`) unit index</span>
        <span class="c1">#               -&gt;  0: q_nm^-1, 1: q_A-1, 2: 2th_deg, 3: 2th_rad</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__unitindex</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">#: (:obj:`list` &lt;:obj:`str`&gt;) list of units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__units</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;q_nm^-1&quot;</span><span class="p">,</span> <span class="s2">&quot;q_A^-1&quot;</span><span class="p">,</span> <span class="s2">&quot;2th_deg&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;2th_rad&quot;</span><span class="p">,</span> <span class="s2">&quot;r_mm&quot;</span><span class="p">,</span> <span class="s2">&quot;r_pixel&quot;</span><span class="p">]</span>

        <span class="c1">#: (:obj:`int`) plot index</span>
        <span class="c1">#               -&gt;  0: Image, &lt;i&gt;: Buffer &lt;i&gt;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">#: (:obj:`bool`) old lock value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__oldlocked</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:class:`Ui_ROIToolWidget&#39;) ui_toolwidget object from qtdesigner</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span> <span class="o">=</span> <span class="n">_diffractogramformclass</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1">#: (:obj:`bool`) old lock value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__oldlocked</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#: (:obj:`bool`) reset scale flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__resetscale</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1">#: ((:obj:`bool`) show diffractogram status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__showdiff</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1">#: (:obj:`list` &lt; [:obj:`float`, :obj:`float`] &gt;)</span>
        <span class="c1">#          range positions of radial in current units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__radrange</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="c1">#: (:obj:`list` &lt; :obj:`float`&gt;) start position of radial in deg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__radstart</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="c1">#: (:obj:`list` &lt; :obj:`float &gt;) end position of radial in deg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__radend</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="c1">#: (:obj:`list` &lt; :obj:`float`&gt;) start position of azimuth angle in deg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__azstart</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="c1">#: (:obj:`list` &lt; :obj:`float`&gt;) end position of azimuth angle in deg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__azend</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="c1">#: (:obj:`list` &lt; [:obj:`float`, :obj:`float`] &gt; )</span>
        <span class="c1">#          range positions of azimuth in deg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__azrange</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>

        <span class="c1">#: (:obj:`list`&lt;:class:`pyqtgraph.PlotDataItem`&gt;) 1D plot freezed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__freezed</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1">#: (:obj:`list`&lt;:class:`pyqtgraph.PlotDataItem`&gt;) 1D plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#: (:obj:`int`) current plot number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__nrplots</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1">#: (:obj:`bool`) progressbar is running</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__progressFlag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#: (:class:`pyqtgraph.QtWidgets.QProgressDialog`) progress bar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__progress</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`list` &lt;:class:`lavuelib.commandThread.CommandThread`&gt;) \</span>
        <span class="c1">#:     command thread</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__commandthread</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#: ( :obj:`list` &lt;  :obj:`list` &lt;  :obj:`list` &lt; (float, float) &gt; &gt; &gt;)</span>
        <span class="c1">#    list of region lines</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__regions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1">#: (:obj:`list` &lt; (int, int, int) &gt; ) list with region colors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__colors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#: ( (:obj:`int`, :obj:`int&#39;, :obj:`int`)) default pen color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__defpen</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">127</span><span class="p">)</span>

        <span class="c1">#: (:obj:`bool`) accumalate status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__accumulate</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#: (:obj:`bool`) show buffer status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__showbuffer</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#: (:obj:`int`) buffer size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__buffersize</span> <span class="o">=</span> <span class="mi">1024</span>
        <span class="c1">#: ([:class:`ndarray`,:class:`ndarray` :class:`ndarray`,</span>
        <span class="c1">#     :class:`ndarray`]) y-buffers for diffractogram</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__buffers</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="c1">#: (:obj:`list` &lt; [:obj:`int`, :obj:`int`] &gt; )</span>
        <span class="c1">#      x-buffers of (position, scale) for diffractogram</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__xbuffers</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="c1">#: (:obj:`list` &lt; `list` &lt; :obj:`int` &gt; &gt; ) time stamps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__timestamps</span> <span class="o">=</span> <span class="p">[[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]]</span>

        <span class="c1"># self.parameters.lines = True</span>
        <span class="c1">#: (:obj:`str`) infolineedit text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">infolineedit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">infotips</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">bottomplot</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">centerlines</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">toolscale</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">regions</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># self.parameters.rightplot = True</span>

        <span class="c1">#: (`lavuelib.imageDisplayWidget.AxesParameters`) axes backup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__axes</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#: (:class:`lavuelib.settings.Settings`) configuration settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">settings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setColors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">roiscolors</span><span class="p">)</span>
        <span class="c1">#: (:obj:`list` &lt; [:class:`pyqtgraph.QtCore.pyqtSignal`, :obj:`str`] &gt;)</span>
        <span class="c1">#: list of [signal, slot] object to connect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signal2slot</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">diffSpinBox</span><span class="o">.</span><span class="n">valueChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updateDiffNumber</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">diffSpinBox</span><span class="o">.</span><span class="n">valueChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">rangePushButton</span><span class="o">.</span><span class="n">clicked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setPolarRange</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">showPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_showhideDiff</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">nextPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nextPlotDiff</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">calibrationPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loadCalibration</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">unitComboBox</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_setUnitIndex</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">unitComboBox</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">mainplotComboBox</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_setPlotIndex</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">mainplotComboBox</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">mouseImageDoubleClicked</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_updateCenter</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">sizeLineEdit</span><span class="o">.</span><span class="n">textChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setBufferSize</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">sizeLineEdit</span><span class="o">.</span><span class="n">textChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">accuPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_startStopAccu</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">bufferPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_showBuffer</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">resetPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resetAccu</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">geometryChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateGeometryTip</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">geometryChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">geometryChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updateSetCenter</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">freezeBottomPlotClicked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_freezeplot</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">clearBottomPlotClicked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clearplot</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">mouseImagePositionChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_message</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">colorsChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">setColors</span><span class="p">]</span>
        <span class="p">]</span>
        <span class="c1"># self.__ui.showPushButton.hide()</span>
        <span class="c1"># self.__ui.nextPushButton.hide()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_showBuffer</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># @debugmethod</span>
<div class="viewcode-block" id="DiffractogramToolWidget.configure"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.DiffractogramToolWidget.configure">[docs]</a>    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set configuration for the current tool</span>

<span class="sd">        :param configuration: configuration string</span>
<span class="sd">        :type configuration: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configuration</span><span class="p">:</span>
            <span class="n">cnf</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;calibration&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">calib</span> <span class="o">=</span> <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;calibration&quot;</span><span class="p">]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_loadCalibration</span><span class="p">(</span><span class="n">calib</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">if</span> <span class="s2">&quot;diff_number&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">diffSpinBox</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;diff_number&quot;</span><span class="p">]))</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                    <span class="c1"># print(str(e))</span>
            <span class="k">if</span> <span class="s2">&quot;diff_ranges&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_updatePolarRange</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;diff_ranges&quot;</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="c1"># print(str(e))</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">if</span> <span class="s2">&quot;diff_units&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">idxs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;q [1/nm]&quot;</span><span class="p">,</span> <span class="s2">&quot;q [1/A]&quot;</span><span class="p">,</span> <span class="s2">&quot;2th [deg]&quot;</span><span class="p">,</span> <span class="s2">&quot;2th [rad]&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;r [mm]&quot;</span><span class="p">,</span> <span class="s2">&quot;r [pixel]&quot;</span><span class="p">]</span>
                <span class="n">xcrd</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;diff_units&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="n">idxs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">xcrd</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">unitComboBox</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;show_diff&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;show_diff&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">showPushButton</span><span class="o">.</span><span class="n">text</span><span class="p">())</span> <span class="o">==</span> <span class="s2">&quot;Show&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_showhideDiff</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">showPushButton</span><span class="o">.</span><span class="n">text</span><span class="p">())</span> <span class="o">==</span> <span class="s2">&quot;Stop&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_showhideDiff</span><span class="p">()</span>
            <span class="k">if</span> <span class="s2">&quot;stop_diff&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;stop_diff&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">showPushButton</span><span class="o">.</span><span class="n">text</span><span class="p">())</span> <span class="o">==</span> <span class="s2">&quot;Stop&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_showhideDiff</span><span class="p">()</span>
            <span class="k">if</span> <span class="s2">&quot;next&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;next&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">nextPushButton</span><span class="o">.</span><span class="n">text</span><span class="p">())</span> <span class="o">==</span> <span class="s2">&quot;Next&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_nextPlotDiff</span><span class="p">()</span>
            <span class="k">if</span> <span class="s2">&quot;main_plot&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">idxs</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="s2">&quot;buffer 1&quot;</span><span class="p">,</span> <span class="s2">&quot;buffer 2&quot;</span><span class="p">,</span> <span class="s2">&quot;buffer 3&quot;</span><span class="p">,</span> <span class="s2">&quot;buffer 4&quot;</span><span class="p">]</span>
                <span class="n">xcrd</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;main_plot&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="n">idxs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">xcrd</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                    <span class="c1"># print(str(e))</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">mainplotComboBox</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;buffering&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_showBuffer</span><span class="p">()</span>
            <span class="k">if</span> <span class="s2">&quot;buffer_size&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">sizeLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;buffer_size&quot;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="s2">&quot;reset&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;reset&quot;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_resetAccu</span><span class="p">()</span>
            <span class="k">if</span> <span class="s2">&quot;collect&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;collect&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__accumulate</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_startStopAccu</span><span class="p">()</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;collect&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__accumulate</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_startStopAccu</span><span class="p">()</span></div>

    <span class="c1"># @debugmethod</span>
<div class="viewcode-block" id="DiffractogramToolWidget.configuration"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.DiffractogramToolWidget.configuration">[docs]</a>    <span class="k">def</span> <span class="nf">configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides configuration for the current tool</span>

<span class="sd">        :returns configuration: configuration string</span>
<span class="sd">        :rtype configuration: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cnf</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;calibration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">calibrationfilename</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;diff_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">diffSpinBox</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">ranges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">nip</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;diff_number&quot;</span><span class="p">]):</span>
            <span class="n">azs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__azstart</span><span class="p">[</span><span class="n">nip</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__azstart</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">nip</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">aze</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__azend</span><span class="p">[</span><span class="n">nip</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__azend</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">nip</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">rds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radstart</span><span class="p">[</span><span class="n">nip</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__radstart</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">nip</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">rde</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radend</span><span class="p">[</span><span class="n">nip</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__radend</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">nip</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">ranges</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">azs</span><span class="p">,</span> <span class="n">aze</span><span class="p">,</span> <span class="n">rds</span><span class="p">,</span> <span class="n">rde</span><span class="p">])</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;diff_ranges&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ranges</span>
        <span class="n">units</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;q [1/nm]&quot;</span><span class="p">,</span> <span class="s2">&quot;q [1/A]&quot;</span><span class="p">,</span> <span class="s2">&quot;2th [deg]&quot;</span><span class="p">,</span> <span class="s2">&quot;2th [rad]&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;r [mm]&quot;</span><span class="p">,</span> <span class="s2">&quot;r [pixel]&quot;</span><span class="p">]</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">unitComboBox</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;diff_units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">units</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;buffer_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">sizeLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;buffer_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">sizeLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;buffering&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__showbuffer</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;collect&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__accumulate</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;show_diff&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__showdiff</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;main_plot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">mainplotComboBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">cnf</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">numpyEncoder</span><span class="p">)</span></div>

    <span class="c1"># @debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_setBufferSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; start/stop accumulation buffer</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__buffersize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">sizeLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_resetAccu</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># print(str(e))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__buffersize</span> <span class="o">=</span> <span class="mi">1024</span>

    <span class="c1"># @debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_resetAccu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; reset accumulation buffer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__buffers</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__xbuffers</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__timestamps</span> <span class="o">=</span> <span class="p">[[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]]</span>
        <span class="c1"># np.empty(shape=(int(self.__settings.diffnpt), 0))</span>
        <span class="c1"># diffdata = None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__resetscale</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">diffdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateImage</span><span class="p">(</span><span class="n">diffdata</span><span class="p">,</span> <span class="n">diffdata</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">()</span>

    <span class="c1"># @debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_startStopAccu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; start/stop accumulation buffer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__accumulate</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__accumulate</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">accuPushButton</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Stop&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__accumulate</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">accuPushButton</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Collect&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">()</span>

    <span class="c1"># @debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_showBuffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show/hide buffer widgets</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__showbuffer</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">status</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__showbuffer</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__showbuffer</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">hasThemeIcon</span><span class="p">(</span><span class="s2">&quot;go-up&quot;</span><span class="p">):</span>
                <span class="n">icon</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">fromTheme</span><span class="p">(</span><span class="s2">&quot;go-up&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">bufferPushButton</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">icon</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># self.__ui.bufferPushButton.setText(u&quot; \u25B2 Buffering&quot;)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">bufferPushButton</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot; </span><span class="se">\u25B4</span><span class="s2"> Buffering &quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">bufferFrame</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__showbuffer</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">hasThemeIcon</span><span class="p">(</span><span class="s2">&quot;go-down&quot;</span><span class="p">):</span>
                <span class="n">icon</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">fromTheme</span><span class="p">(</span><span class="s2">&quot;go-down&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">bufferPushButton</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">icon</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># self.__ui.bufferPushButton.setText(u&quot; \u25BC Buffering&quot;)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">bufferPushButton</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot; </span><span class="se">\u25BE</span><span class="s2"> Buffering &quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">bufferFrame</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adjustSize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">()</span>

    <span class="c1"># @debugmethod</span>
<div class="viewcode-block" id="DiffractogramToolWidget.setColors"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.DiffractogramToolWidget.setColors">[docs]</a>    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">setColors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sets colors</span>

<span class="sd">        :param colors: json list of roi colors</span>
<span class="sd">        :type colors: :obj:`str`</span>
<span class="sd">        :returns: change status</span>
<span class="sd">        :rtype: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cl</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">clit</span> <span class="ow">in</span> <span class="n">cl</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">clit</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                        <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__colors</span>
            <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__colors</span> <span class="o">!=</span> <span class="n">colors</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__colors</span> <span class="o">=</span> <span class="n">colors</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">):</span>
                <span class="n">clr</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)])</span> <span class="k">if</span> <span class="n">colors</span> \
                    <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">__defpen</span>
                <span class="n">cr</span><span class="o">.</span><span class="n">setPen</span><span class="p">(</span><span class="n">_pg</span><span class="o">.</span><span class="n">mkPen</span><span class="p">(</span><span class="n">clr</span><span class="p">))</span></div>

    <span class="c1"># @debugmethod</span>
<div class="viewcode-block" id="DiffractogramToolWidget.runProgress"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.DiffractogramToolWidget.runProgress">[docs]</a>    <span class="k">def</span> <span class="nf">runProgress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commands</span><span class="p">,</span> <span class="n">onclose</span><span class="o">=</span><span class="s2">&quot;_closeReset&quot;</span><span class="p">,</span>
                    <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Updating diffractogram ranges ...&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; starts progress thread with the given commands</span>

<span class="sd">        :param commands: list of commands</span>
<span class="sd">        :type commands: :obj:`list` &lt;:obj:`str`&gt;</span>
<span class="sd">        :param onclose: close command name</span>
<span class="sd">        :type onclose: :obj:`str`</span>
<span class="sd">        :param text: text to display</span>
<span class="sd">        :type text: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__progress</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__commandthread</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__commandthread</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__commandthread</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__commandthread</span> <span class="o">=</span> <span class="n">commandThread</span><span class="o">.</span><span class="n">CommandThread</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">commands</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="p">)</span>
        <span class="n">oncloseaction</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">onclose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__commandthread</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="n">oncloseaction</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">QueuedConnection</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__progress</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__progress</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QProgressDialog</span><span class="p">(</span>
            <span class="n">text</span><span class="p">,</span> <span class="s2">&quot;Cancel&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__progress</span><span class="o">.</span><span class="n">setWindowModality</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">WindowModal</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__progress</span><span class="o">.</span><span class="n">setCancelButton</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__progress</span><span class="o">.</span><span class="n">rejected</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">waitForThread</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">QueuedConnection</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__commandthread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__progress</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

    <span class="c1"># @debugmethod</span>
<div class="viewcode-block" id="DiffractogramToolWidget.waitForThread"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.DiffractogramToolWidget.waitForThread">[docs]</a>    <span class="k">def</span> <span class="nf">waitForThread</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; waits for running thread</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;waiting for Thread&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__commandthread</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__commandthread</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;waiting for Thread ENDED&quot;</span><span class="p">)</span></div>

    <span class="c1"># @debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_freezeplot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; freeze plot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clearplot</span><span class="p">()</span>
        <span class="n">nrplots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__nrplots</span>
        <span class="k">while</span> <span class="n">nrplots</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__freezed</span><span class="p">):</span>
            <span class="n">cr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">onedbottomplot</span><span class="p">()</span>
            <span class="n">cr</span><span class="o">.</span><span class="n">setPen</span><span class="p">(</span><span class="n">_pg</span><span class="o">.</span><span class="n">mkColor</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__freezed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cr</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrplots</span><span class="p">):</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">xData</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">yData</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__freezed</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__freezed</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__freezed</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrplots</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__freezed</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__freezed</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__freezed</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># print(type(cr))</span>

    <span class="c1"># @debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_clearplot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; clear freezed plot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">cr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__freezed</span><span class="p">:</span>
            <span class="n">cr</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># @debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_updateDiffNumber</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">did</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; update diffractorgram number</span>

<span class="sd">        :param did: diffractogram id</span>
<span class="sd">        :type did: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">QtCore</span><span class="o">.</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateRangeTip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__updateBufferCombobox</span><span class="p">(</span><span class="n">did</span><span class="p">)</span>
        <span class="c1"># self.__nrplots = self.__ui.diffSpinBox.value()</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plotDiff</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setColors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">roiscolors</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="c1"># self.__updateregion()</span>
        <span class="n">QtCore</span><span class="o">.</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__regions</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__nrplots</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">regions</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">QtCore</span><span class="o">.</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_updateRegionsAndPlot</span><span class="p">()</span>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">__updateBufferCombobox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">did</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; update buffer combobox</span>

<span class="sd">        :param did: diffractogram id</span>
<span class="sd">        :type did: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">combo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">mainplotComboBox</span>
        <span class="c1"># idx = combo.currentIndex()</span>
        <span class="n">cnt</span> <span class="o">=</span> <span class="n">combo</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">did</span> <span class="o">&gt;=</span> <span class="n">cnt</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cnt</span><span class="p">:</span>
                <span class="n">combo</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s2">&quot;Buffer </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cnt</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">combo</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s2">&quot;Image&quot;</span><span class="p">)</span>
            <span class="n">cnt</span> <span class="o">=</span> <span class="n">combo</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">did</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">cnt</span><span class="p">:</span>
            <span class="n">combo</span><span class="o">.</span><span class="n">removeItem</span><span class="p">(</span><span class="n">cnt</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">cnt</span> <span class="o">=</span> <span class="n">combo</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="c1"># if idx &gt;= cnt:</span>
        <span class="c1">#     changed = True</span>

    <span class="c1"># @debugmethod</span>
<div class="viewcode-block" id="DiffractogramToolWidget.afterplot"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.DiffractogramToolWidget.afterplot">[docs]</a>    <span class="k">def</span> <span class="nf">afterplot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; command after plot</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

    <span class="c1"># @debugmethod</span>
<div class="viewcode-block" id="DiffractogramToolWidget.activate"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.DiffractogramToolWidget.activate">[docs]</a>    <span class="k">def</span> <span class="nf">activate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; activates tool widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__oldlocked</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">sizeLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__buffersize</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateGeometryTip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateRangeTip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateCenter</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__updateButtons</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">onedbottomplot</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__nrplots</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">curve</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">:</span>
            <span class="n">curve</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="n">curve</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setColors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">roiscolors</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="c1"># if self.__settings.calibrationfilename:</span>
        <span class="c1">#     self._loadCalibration(</span>
        <span class="c1">#         self.__settings.calibrationfilename)</span>
        <span class="c1"># self.__ui.diffSpinBox.setEnabled(False)</span>
        <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">aimutex</span><span class="p">):</span>
            <span class="n">aistat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">aistat</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plotDiff</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">bottomplotShowMenu</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">mainplotComboBox</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setPlotIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>

    <span class="c1"># @debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_nextPlotDiff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; plot all diffractograms and update</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plotDiffWithBuffering</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> \
           <span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__buffers</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__buffers</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">diffdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__buffers</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">diffdata</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">diffdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__resetscale</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="c1"># np.empty(shape=(int(self.__settings.diffnpt), 0))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateImage</span><span class="p">(</span><span class="n">diffdata</span><span class="p">,</span> <span class="n">diffdata</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">()</span>

    <span class="c1"># @debugmethod</span>
<div class="viewcode-block" id="DiffractogramToolWidget.deactivate"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.DiffractogramToolWidget.deactivate">[docs]</a>    <span class="k">def</span> <span class="nf">deactivate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; deactivates tool widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">waitForThread</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">bottomplotShowMenu</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">curve</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">:</span>
            <span class="n">curve</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="n">curve</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">removebottomplot</span><span class="p">(</span><span class="n">curve</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">freezed</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__freezed</span><span class="p">:</span>
            <span class="n">freezed</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="n">freezed</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">removebottomplot</span><span class="p">(</span><span class="n">freezed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__freezed</span> <span class="o">=</span> <span class="p">[]</span></div>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">_plotDiffWithBuffering</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; plot diffractogram with buffering</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xl</span><span class="p">,</span> <span class="n">yl</span><span class="p">,</span> <span class="n">ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plotDiff</span><span class="p">()</span>
        <span class="c1"># print(yl)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__accumulate</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">yy</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">yl</span><span class="p">):</span>
                <span class="n">newrow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">yy</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__buffers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> \
                   <span class="bp">self</span><span class="o">.</span><span class="n">__buffers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">newrow</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__buffers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__buffersize</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__buffers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
                            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__buffers</span><span class="p">[</span><span class="n">i</span><span class="p">][</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">__buffers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">__buffersize</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:,</span>
                                <span class="p">:],</span>
                             <span class="n">newrow</span><span class="p">]</span>
                        <span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__timestamps</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__timestamps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__buffers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
                            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__buffers</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">newrow</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__timestamps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__buffers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">yy</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__timestamps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ts</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__xbuffers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__resetscale</span><span class="p">:</span>
                    <span class="n">xbuf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xl</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">pos</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="n">sc</span> <span class="o">=</span> <span class="mf">1.0</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xbuf</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">pos</span> <span class="o">=</span> <span class="n">xbuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xbuf</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">sc</span> <span class="o">=</span> <span class="p">(</span><span class="n">xbuf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xbuf</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xbuf</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__xbuffers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pos</span><span class="p">,</span> <span class="n">sc</span><span class="p">]</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">mainplotComboBox</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span> <span class="o">-</span>
                       <span class="mi">1</span> <span class="o">==</span> <span class="n">i</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">setToolScale</span><span class="p">(</span>
                            <span class="p">[</span><span class="n">pos</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">sc</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                        <span class="c1"># self._mainwidget.setToolScale(</span>
                        <span class="c1">#    [0, 0], [1, 1])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__resetscale</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># @debugmethod</span>
<div class="viewcode-block" id="DiffractogramToolWidget.beforeplot"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.DiffractogramToolWidget.beforeplot">[docs]</a>    <span class="k">def</span> <span class="nf">beforeplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">rawarray</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; command  before plot</span>

<span class="sd">        :param array: 2d image array</span>
<span class="sd">        :type array: :class:`numpy.ndarray`</span>
<span class="sd">        :param rawarray: 2d raw image array</span>
<span class="sd">        :type rawarray: :class:`numpy.ndarray`</span>
<span class="sd">        :return: 2d image array and raw image</span>
<span class="sd">        :rtype: (:class:`numpy.ndarray`, :class:`numpy.ndarray`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__showdiff</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plotDiffWithBuffering</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> \
           <span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__buffers</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__buffers</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">diffdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__buffers</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">diffdata</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">diffdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__resetscale</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="c1"># np.empty(shape=(int(self.__settings.diffnpt), 0))</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">diffdata</span><span class="p">,</span> <span class="n">diffdata</span><span class="p">)</span></div>

    <span class="c1"># @debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_updateCenter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; updates the image center</span>

<span class="sd">        :param xdata: x pixel position</span>
<span class="sd">        :type xdata: :obj:`float`</span>
<span class="sd">        :param ydata: y-pixel position</span>
<span class="sd">        :type ydata: :obj:`float`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">txdata</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">rangeWindowEnabled</span><span class="p">():</span>
                <span class="n">txdata</span><span class="p">,</span> <span class="n">tydata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scaledxy</span><span class="p">(</span>
                    <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">useraxes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">txdata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">xdata</span> <span class="o">=</span> <span class="n">txdata</span>
                    <span class="n">ydata</span> <span class="o">=</span> <span class="n">tydata</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">xdata</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">aimutex</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">aif</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">getFit2D</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">setFit2D</span><span class="p">(</span><span class="n">aif</span><span class="p">[</span><span class="s2">&quot;directDist&quot;</span><span class="p">],</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span><span class="p">,</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span><span class="p">,</span>
                                                <span class="n">aif</span><span class="p">[</span><span class="s2">&quot;tilt&quot;</span><span class="p">],</span>
                                                <span class="n">aif</span><span class="p">[</span><span class="s2">&quot;tiltPlanRotation&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span><span class="s2">&quot;BeamCenterX&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">xdata</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span><span class="s2">&quot;BeamCenterY&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">ydata</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_message</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__updateregion</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plotDiff</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateGeometryTip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_resetAccu</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">()</span>
            <span class="c1"># self.__resetscale = True</span>

    <span class="c1"># @debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_updateSetCenter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; updates the image center</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># return</span>
        <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">aimutex</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">aif</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">getFit2D</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">setFit2D</span><span class="p">(</span><span class="n">aif</span><span class="p">[</span><span class="s2">&quot;directDist&quot;</span><span class="p">],</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span><span class="p">,</span>
                                            <span class="n">aif</span><span class="p">[</span><span class="s2">&quot;tilt&quot;</span><span class="p">],</span>
                                            <span class="n">aif</span><span class="p">[</span><span class="s2">&quot;tiltPlanRotation&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resetAccu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__updateregion</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plotDiff</span><span class="p">()</span>
        <span class="c1"># self.__resetscale = True</span>

    <span class="c1"># @debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_loadCalibration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load calibration file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fileName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fileDialog</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFileDialog</span><span class="p">()</span>
            <span class="n">fileout</span> <span class="o">=</span> <span class="n">fileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="p">,</span> <span class="s1">&#39;Open calibration file&#39;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">calibrationfilename</span> <span class="ow">or</span> <span class="s1">&#39;/ramdisk/&#39;</span><span class="p">,</span>
                <span class="s2">&quot;PONI (*.poni);;All files (*)&quot;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fileout</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="n">fileName</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fileout</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fileName</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fileout</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fileName</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">aimutex</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span> <span class="o">=</span> <span class="n">pyFAI</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
                <span class="c1"># self.__settings.ai.rot1 = 0</span>
                <span class="c1"># self.__settings.ai.rot1 = math.pi/4 * 0.5</span>
                <span class="c1"># self.__settings.ai.rot1 = math.pi/4 * 0.75</span>
                <span class="c1"># self.__settings.ai.rot1 = math.pi/4.</span>
                <span class="c1"># self.__settings.ai.rot2 = math.pi/4.</span>
                <span class="c1"># self.__settings.ai.rot3 = math.pi/2.</span>
                <span class="c1"># print(str(self.__settings.ai))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">calibrationfilename</span> <span class="o">=</span> <span class="n">fileName</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__writedetsettings</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateCenter</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># print(str(e))</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">aimutex</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">aimutex</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__updateButtons</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__updateregion</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateGeometryTip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_resetAccu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__resetscale</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">__writedetsettings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; write detector settings from ai object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">updateDetectorParameters</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeDetectorAttributes</span><span class="p">()</span>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">__updateButtons</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; update buttons</span>

<span class="sd">        :param status: show button flag</span>
<span class="sd">        :type status: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">showPushButton</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">nextPushButton</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">diffSpinBox</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>

    <span class="c1"># @debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides geometry message</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">currentIntensity</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">intensity</span><span class="p">):</span>
                <span class="n">intensity</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span>
                    <span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">it</span><span class="p">))</span>
                     <span class="k">else</span> <span class="n">it</span> <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">intensity</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">rangeWindowEnabled</span><span class="p">():</span>
                <span class="n">txdata</span><span class="p">,</span> <span class="n">tydata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scaledxy</span><span class="p">(</span>
                    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">useraxes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">txdata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">txdata</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">tydata</span>
            <span class="n">ilabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scalingLabel</span><span class="p">()</span>
            <span class="n">chi</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">aimutex</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">chi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">chi</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">y</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chi</span><span class="p">):</span>
                        <span class="n">chi</span> <span class="o">=</span> <span class="n">chi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__unitindex</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
                <span class="n">tth</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">aimutex</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">tth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">tth</span><span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">y</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">])),</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tth</span><span class="p">):</span>
                            <span class="n">tth</span> <span class="o">=</span> <span class="n">tth</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">tth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">chi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;rad&quot;</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__unitindex</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;deg&quot;</span>
                        <span class="n">chi</span> <span class="o">=</span> <span class="n">chi</span> <span class="o">*</span> <span class="mf">180.</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span>
                        <span class="n">tth</span> <span class="o">=</span> <span class="n">tth</span> <span class="o">*</span> <span class="mf">180.</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span>
                    <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;x, y = [</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">], tth = </span><span class="si">%f</span><span class="s2"> </span><span class="si">%s</span><span class="s2">, chi = </span><span class="si">%f</span><span class="s2"> </span><span class="si">%s</span><span class="s2">,&quot;</span> \
                              <span class="s2">&quot; </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%.2f</span><span class="s2">&quot;</span> \
                              <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">tth</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span>
                                 <span class="n">chi</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span>
                                 <span class="n">ilabel</span><span class="p">,</span> <span class="n">intensity</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__unitindex</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">ap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__approxpoint</span><span class="p">(</span><span class="n">tth</span><span class="p">,</span> <span class="n">chi</span><span class="p">)</span>
                        <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot; $</span><span class="si">%s</span><span class="s2">$&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">ap</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;x, y = [</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">], </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ilabel</span><span class="p">,</span> <span class="n">intensity</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__unitindex</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
                <span class="n">qa</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">aimutex</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">qa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">qFunction</span><span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">y</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">])),</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">qa</span><span class="p">):</span>
                            <span class="n">qa</span> <span class="o">=</span> <span class="n">qa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">qa</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">chi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">unit</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;1/</span><span class="se">\u212B</span><span class="s2">&quot;</span>
                    <span class="n">chi</span> <span class="o">=</span> <span class="n">chi</span> <span class="o">*</span> <span class="mf">180.</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__unitindex</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;1/nm&quot;</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__unitindex</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">qa</span> <span class="o">=</span> <span class="n">qa</span> <span class="o">/</span> <span class="mf">10.</span>
                    <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;x, y = [</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">], q = </span><span class="si">%f</span><span class="s2"> </span><span class="si">%s</span><span class="s2">, chi = </span><span class="si">%f</span><span class="s2"> </span><span class="si">%s</span><span class="s2">,&quot;</span> \
                              <span class="s2">&quot; </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%.2f</span><span class="s2">&quot;</span> \
                              <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">qa</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span>
                                 <span class="n">chi</span><span class="p">,</span> <span class="s2">&quot;deg&quot;</span><span class="p">,</span>
                                 <span class="n">ilabel</span><span class="p">,</span> <span class="n">intensity</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;x, y = [</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">], </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ilabel</span><span class="p">,</span> <span class="n">intensity</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__unitindex</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span>
                <span class="n">ra</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">aimutex</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">ra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">rFunction</span><span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">y</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">])),</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ra</span><span class="p">):</span>
                            <span class="n">ra</span> <span class="o">=</span> <span class="n">ra</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1000.</span>
                <span class="k">if</span> <span class="n">ra</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">chi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">chi</span> <span class="o">=</span> <span class="n">chi</span> <span class="o">*</span> <span class="mf">180.</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span>
                    <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;x, y = [</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">], r = </span><span class="si">%f</span><span class="s2"> </span><span class="si">%s</span><span class="s2">, chi = </span><span class="si">%f</span><span class="s2"> </span><span class="si">%s</span><span class="s2">,&quot;</span> \
                              <span class="s2">&quot; </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%.2f</span><span class="s2">&quot;</span> \
                              <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="s2">&quot;mm&quot;</span><span class="p">,</span>
                                 <span class="n">chi</span><span class="p">,</span> <span class="s2">&quot;deg&quot;</span><span class="p">,</span>
                                 <span class="n">ilabel</span><span class="p">,</span> <span class="n">intensity</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;x, y = [</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">], </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ilabel</span><span class="p">,</span> <span class="n">intensity</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__unitindex</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span>
                <span class="n">cx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span>
                <span class="n">cy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span>
                <span class="n">ra</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">cx</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">cy</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ra</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">chi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">chi</span> <span class="o">=</span> <span class="n">chi</span> <span class="o">*</span> <span class="mf">180.</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span>
                    <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;x, y = [</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">], r = </span><span class="si">%f</span><span class="s2"> </span><span class="si">%s</span><span class="s2">, chi = </span><span class="si">%f</span><span class="s2"> </span><span class="si">%s</span><span class="s2">,&quot;</span> \
                              <span class="s2">&quot; </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%.2f</span><span class="s2">&quot;</span> \
                              <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="s2">&quot;pixel&quot;</span><span class="p">,</span>
                                 <span class="n">chi</span><span class="p">,</span> <span class="s2">&quot;deg&quot;</span><span class="p">,</span>
                                 <span class="n">ilabel</span><span class="p">,</span> <span class="n">intensity</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;x, y = [</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">], </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ilabel</span><span class="p">,</span> <span class="n">intensity</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ix</span><span class="p">,</span> <span class="n">iy</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">currentIntensity</span><span class="p">()</span>
            <span class="n">ilabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scalingLabel</span><span class="p">()</span>
            <span class="n">pindex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">mainplotComboBox</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">sc</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="n">tst</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__xbuffers</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">pindex</span> <span class="ow">and</span> \
               <span class="bp">self</span><span class="o">.</span><span class="n">__xbuffers</span><span class="p">[</span><span class="n">pindex</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]:</span>
                <span class="n">pos</span><span class="p">,</span> <span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__xbuffers</span><span class="p">[</span><span class="n">pindex</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">xc</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">sc</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__timestamps</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">pindex</span> <span class="ow">and</span> \
               <span class="bp">self</span><span class="o">.</span><span class="n">__timestamps</span><span class="p">[</span><span class="n">pindex</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]:</span>
                <span class="n">tst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__timestamps</span><span class="p">[</span><span class="n">pindex</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">it</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">iy</span><span class="p">)</span>
            <span class="c1"># itx = int(ix)</span>
            <span class="k">if</span> <span class="n">it</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">tst</span><span class="p">)</span> <span class="ow">and</span> <span class="n">it</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ts</span> <span class="o">=</span> <span class="n">tst</span><span class="p">[</span><span class="n">it</span><span class="p">]</span>
                <span class="c1"># store first tst[0]</span>
                <span class="c1"># ts = tst[it] - tst[0]</span>
            <span class="n">units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__units</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__unitindex</span><span class="p">]</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">unitComboBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
            <span class="k">if</span> <span class="s2">&quot;[&quot;</span> <span class="ow">in</span> <span class="n">xlabel</span><span class="p">:</span>
                <span class="n">xlabel</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="n">xlabel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">units</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;no: </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%.2f</span><span class="s2"> (time = </span><span class="si">%s</span><span class="s2"> s)&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">it</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">xc</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span>  <span class="n">ilabel</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">ts</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">setDisplayedText</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">__tipmessage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides geometry messate</span>

<span class="sd">        :returns: geometry text</span>
<span class="sd">        :rtype: :obj:`unicode`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tips</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">aimutex</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span><span class="p">:</span>
                <span class="n">tips</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tips</span>

    <span class="c1"># @debugmethod</span>
<div class="viewcode-block" id="DiffractogramToolWidget.updateGeometryTip"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.DiffractogramToolWidget.updateGeometryTip">[docs]</a>    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">updateGeometryTip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; update geometry tips</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tipmessage</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">calibrationPushButton</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
            <span class="s2">&quot;Input physical parameters</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">message</span><span class="p">)</span></div>

    <span class="c1"># @debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_showhideDiff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show or hide diffractogram</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__showdiff</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__showdiff</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">showPushButton</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Stop&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plotDiff</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__showdiff</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">showPushButton</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Show&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">()</span>

    <span class="c1"># @debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_plotDiff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; plot all diffractograms</span>

<span class="sd">        :returns: (list of x&#39;s for each diffractogram,</span>
<span class="sd">                   list of y&#39;s for each diffractogram,</span>
<span class="sd">                   integer timestamp)</span>

<span class="sd">        :rtype: (:obj:`list` &lt; :obj:`list` &lt;float&gt;&gt;,</span>
<span class="sd">                 :obj:`list` &lt; :obj:`list` &lt;float&gt;&gt;,</span>
<span class="sd">                 int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">aimutex</span><span class="p">):</span>
            <span class="n">aistat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">xl</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">yl</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">aistat</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">currentTool</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sendresults</span><span class="p">:</span>
                    <span class="n">xl</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">yl</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">pxl</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">pyl</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">pel</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">nrplots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">diffSpinBox</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__nrplots</span> <span class="o">!=</span> <span class="n">nrplots</span><span class="p">:</span>
                    <span class="k">while</span> <span class="n">nrplots</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">onedbottomplot</span><span class="p">())</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrplots</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrplots</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">)):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__nrplots</span> <span class="o">=</span> <span class="n">nrplots</span>
                    <span class="k">if</span> <span class="n">nrplots</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nrplots</span><span class="p">:</span>
                                <span class="n">colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__colors</span>
                                <span class="n">clr</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)])</span> \
                                    <span class="k">if</span> <span class="n">colors</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">__defpen</span>
                                <span class="n">cr</span><span class="o">.</span><span class="n">setPen</span><span class="p">(</span><span class="n">_pg</span><span class="o">.</span><span class="n">mkPen</span><span class="p">(</span><span class="n">clr</span><span class="p">))</span>
                <span class="n">dts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">rawData</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">dts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">while</span> <span class="n">dts</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">dts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">dts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">trans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">transformations</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">csa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">correctsolidangle</span>
                    <span class="n">unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__units</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__unitindex</span><span class="p">]</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__unitindex</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span>
                        <span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;r_mm&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__units</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__unitindex</span><span class="p">]</span>
                    <span class="n">dts</span> <span class="o">=</span> <span class="n">dts</span> <span class="k">if</span> <span class="n">trans</span> <span class="k">else</span> <span class="n">dts</span><span class="o">.</span><span class="n">T</span>
                    <span class="n">mask</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">dts</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;f&#39;</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">dts</span><span class="o">.</span><span class="n">min</span><span class="p">()):</span>
                        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">dts</span><span class="p">)</span>
                        <span class="n">dts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dts</span><span class="p">)</span>
                        <span class="n">dts</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
                        <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showhighvaluemask</span> <span class="ow">and</span> \
                       <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">maskValue</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> \
                       <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">maskValueIndices</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dts</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">mask</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">maskValueIndices</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                            <span class="k">return</span> <span class="n">xl</span><span class="p">,</span> <span class="n">yl</span><span class="p">,</span> <span class="n">timestamp</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showmask</span> <span class="ow">and</span> \
                       <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">applyMask</span><span class="p">()</span> <span class="ow">and</span> \
                       <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">maskIndices</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dts</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">mask</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">maskIndices</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                            <span class="k">return</span> <span class="n">xl</span><span class="p">,</span> <span class="n">yl</span><span class="p">,</span> <span class="n">timestamp</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrplots</span><span class="p">):</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">aimutex</span><span class="p">):</span>
                                <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">integrate1d</span><span class="p">(</span>
                                    <span class="n">dts</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">diffnpt</span><span class="p">,</span>
                                    <span class="n">correctSolidAngle</span><span class="o">=</span><span class="n">csa</span><span class="p">,</span>
                                    <span class="n">radial_range</span><span class="o">=</span><span class="p">(</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">__radrange</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__radrange</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">i</span> <span class="k">else</span> <span class="kc">None</span><span class="p">),</span>
                                    <span class="n">azimuth_range</span><span class="o">=</span><span class="p">(</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">__azrange</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__azrange</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">i</span> <span class="k">else</span> <span class="kc">None</span><span class="p">),</span>
                                    <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
                            <span class="c1"># print(res)</span>
                            <span class="n">x</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">y</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__unitindex</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span>
                                <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">aimutex</span><span class="p">):</span>
                                    <span class="n">aif</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">getFit2D</span><span class="p">()</span>
                                <span class="k">if</span> <span class="n">aif</span><span class="p">[</span><span class="s2">&quot;pixelX&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">aif</span><span class="p">[</span><span class="s2">&quot;pixelY&quot;</span><span class="p">]:</span>
                                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__azrange</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                        <span class="n">azs</span><span class="p">,</span> <span class="n">aze</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="n">azs</span><span class="p">,</span> <span class="n">aze</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__azrange</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                                        <span class="n">azs</span> <span class="o">*=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>
                                        <span class="n">aze</span> <span class="o">*=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>
                                    <span class="n">facx</span> <span class="o">=</span> <span class="mf">1000.</span><span class="o">/</span><span class="n">aif</span><span class="p">[</span><span class="s2">&quot;pixelX&quot;</span><span class="p">]</span>
                                    <span class="n">facy</span> <span class="o">=</span> <span class="mf">1000.</span><span class="o">/</span><span class="n">aif</span><span class="p">[</span><span class="s2">&quot;pixelY&quot;</span><span class="p">]</span>
                                    <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">aimutex</span><span class="p">):</span>
                                        <span class="n">cs1</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span>
                                            <span class="n">azs</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">rot3</span><span class="p">)</span>
                                        <span class="n">cs2</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span>
                                            <span class="n">aze</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">rot3</span><span class="p">)</span>
                                        <span class="n">sn1</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span>
                                            <span class="n">azs</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">rot3</span><span class="p">)</span>
                                        <span class="n">sn2</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span>
                                            <span class="n">aze</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">rot3</span><span class="p">)</span>
                                        <span class="n">fc1</span> <span class="o">=</span> <span class="n">facx</span> <span class="o">*</span> <span class="n">cs1</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">rot1</span><span class="p">)</span>
                                        <span class="n">fc2</span> <span class="o">=</span> <span class="n">facx</span> <span class="o">*</span> <span class="n">cs2</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">rot1</span><span class="p">)</span>
                                        <span class="n">fs1</span> <span class="o">=</span> <span class="n">facy</span> <span class="o">*</span> <span class="n">sn1</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">rot2</span><span class="p">)</span>
                                        <span class="n">fs2</span> <span class="o">=</span> <span class="n">facy</span> <span class="o">*</span> <span class="n">sn2</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">rot2</span><span class="p">)</span>
                                    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span>
                                        <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                                            <span class="p">(</span><span class="n">fc1</span> <span class="o">*</span> <span class="n">r</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">fs1</span> <span class="o">*</span> <span class="n">r</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                                         <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                                             <span class="p">(</span><span class="n">fc2</span> <span class="o">*</span> <span class="n">r</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">fs2</span> <span class="o">*</span> <span class="n">r</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
                                        <span class="o">/</span> <span class="mi">2</span>
                                        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sendresults</span> <span class="ow">or</span> \
                               <span class="bp">self</span><span class="o">.</span><span class="n">__accumulate</span><span class="p">:</span>
                                <span class="n">xl</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">x</span><span class="p">])</span>
                                <span class="n">yl</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">y</span><span class="p">])</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sendresults</span><span class="p">:</span>
                                <span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">,</span> <span class="n">pe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__findpeaks2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                                <span class="n">pxl</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">px</span><span class="p">])</span>
                                <span class="n">pyl</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">py</span><span class="p">])</span>
                                <span class="n">pel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">pe</span><span class="p">))</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="c1"># print(str(e))</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                            <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrplots</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__curves</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sendresults</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__sendresults</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span> <span class="n">yl</span><span class="p">,</span> <span class="n">pxl</span><span class="p">,</span> <span class="n">pyl</span><span class="p">,</span> <span class="n">pel</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xl</span><span class="p">,</span> <span class="n">yl</span><span class="p">,</span> <span class="n">timestamp</span>

    <span class="k">def</span> <span class="nf">__sendresults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xl</span><span class="p">,</span> <span class="n">yl</span><span class="p">,</span> <span class="n">pxl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pyl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">timestamp</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; send results to LavueController</span>

<span class="sd">        :param xl:  list of x&#39;s for each diffractogram</span>
<span class="sd">        :type xl: :obj:`list` &lt; :obj:`list` &lt;float&gt;&gt;</span>
<span class="sd">        :param yl:  list of values for each diffractogram</span>
<span class="sd">        :type yl: :obj:`list` &lt; :obj:`list` &lt;float&gt;&gt;</span>
<span class="sd">        :param pxl:  list of peak x&#39;s for each diffractogram</span>
<span class="sd">        :type pxl: :obj:`list` &lt; :obj:`list` &lt;float&gt;&gt;</span>
<span class="sd">        :param pyl:  list of peak values for each diffractogram</span>
<span class="sd">        :type pyl: :obj:`list` &lt; :obj:`list` &lt;float&gt;&gt;</span>
<span class="sd">        :param pel:  peak x&#39;s errors for each diffractogram</span>
<span class="sd">        :type pel:  :obj:`list` &lt;float&gt;</span>
<span class="sd">        :param timestamp:  timestamp</span>
<span class="sd">        :type timestamp:  :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tool&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">}</span>
        <span class="n">npl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xl</span><span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;imagename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">imageName</span><span class="p">()</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timestamp</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;nrdiffs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xl</span><span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;calibration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">calibrationfilename</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npl</span><span class="p">):</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;radial_range_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radrange</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> \
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__radrange</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">i</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;azimuth_range_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__azrange</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> \
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__azrange</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">i</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;diff_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="n">xl</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">yl</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">pxl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">pyl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pxl</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">i</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">pyl</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;peaks_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pxl</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">pyl</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                    <span class="k">if</span> <span class="n">pel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;peaks_</span><span class="si">%s</span><span class="s2">_error&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">pel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;unit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__units</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__unitindex</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span>
            <span class="s2">&quot;ToolResults&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">numpyEncoder</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__findpeaks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">nr</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; find peaks from diffractogram</span>

<span class="sd">        :param x:  x of diffractogram</span>
<span class="sd">        :type x:  :obj:`list` &lt;float&gt;&gt;</span>
<span class="sd">        :param y:  values of diffractogram</span>
<span class="sd">        :type y:  :obj:`list` &lt;float&gt;&gt;</span>
<span class="sd">        :param nr:  list of peak x&#39;s for each diffractogram</span>
<span class="sd">        :type nr: :obj:`int`</span>
<span class="sd">        :returns: (peak_xs, peak_values, x_error)</span>
<span class="sd">        :rtype: (:obj:`list` &lt;float&gt;, :obj:`list` &lt;float&gt;, :obj:`float`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">xml</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">yml</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">iml</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">eml</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">it</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">t</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="ow">and</span> <span class="n">it</span> <span class="o">&lt;</span> <span class="n">nr</span><span class="p">:</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="n">tm</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">im</span><span class="p">]</span>
            <span class="n">iml</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
            <span class="n">xml</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">im</span><span class="p">])</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tm</span><span class="p">)</span>
            <span class="n">er</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">im</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">im</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
                     <span class="n">x</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">im</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">im</span><span class="p">])</span>
            <span class="n">eml</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">er</span><span class="p">)</span>
            <span class="n">it</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># print(&quot;%s. found %s (%s +- %s, %s)&quot; % (it, im, x[im], er, tm))</span>

            <span class="n">i1</span> <span class="o">=</span> <span class="n">im</span>
            <span class="k">while</span> <span class="n">i1</span> <span class="ow">and</span> <span class="n">t</span><span class="p">[</span><span class="n">i1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">t</span><span class="p">[</span><span class="n">i1</span><span class="p">]:</span>
                <span class="n">i1</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">ib</span> <span class="o">=</span> <span class="n">i1</span>

            <span class="n">i1</span> <span class="o">=</span> <span class="n">im</span>
            <span class="k">while</span> <span class="n">i1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="ow">and</span> <span class="n">t</span><span class="p">[</span><span class="n">i1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">t</span><span class="p">[</span><span class="n">i1</span><span class="p">]:</span>
                <span class="n">i1</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">ie</span> <span class="o">=</span> <span class="n">i1</span>
            <span class="c1"># print(t)</span>
            <span class="c1"># print(&quot;cut: [%s: %s]&quot; %  (ib, ie))</span>
            <span class="n">t</span><span class="p">[</span><span class="n">ib</span><span class="p">:(</span><span class="n">ie</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># print(t)</span>
        <span class="k">return</span> <span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">xml</span><span class="p">],</span>
                <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">yml</span><span class="p">],</span>
                <span class="nb">max</span><span class="p">(</span><span class="n">eml</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__findpeaks2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">nr</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; find peaks from diffractogram with scipy</span>

<span class="sd">        :param x:  x of diffractogram</span>
<span class="sd">        :type x:  :obj:`list` &lt;float&gt;&gt;</span>
<span class="sd">        :param y:  values of diffractogram</span>
<span class="sd">        :type y:  :obj:`list` &lt;float&gt;&gt;</span>
<span class="sd">        :param nr:  list of peak x&#39;s for each diffractogram</span>
<span class="sd">        :type nr: :obj:`int`</span>
<span class="sd">        :returns: (peak_xs, peak_values, x_error)</span>
<span class="sd">        :rtype: (:obj:`list` &lt;float&gt;, :obj:`list` &lt;float&gt;, :obj:`float`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">InterpolatedUnivariateSpline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">xml</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">derivative</span><span class="p">()</span><span class="o">.</span><span class="n">roots</span><span class="p">()</span>
        <span class="n">yml</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">xml</span><span class="p">)</span>
        <span class="n">er</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)])</span>
        <span class="n">iml</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argpartition</span><span class="p">(</span><span class="n">yml</span><span class="p">,</span> <span class="o">-</span><span class="n">nr</span><span class="p">)[</span><span class="o">-</span><span class="n">nr</span><span class="p">:]</span>
        <span class="n">iml</span> <span class="o">=</span> <span class="n">iml</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="o">-</span><span class="n">yml</span><span class="p">[</span><span class="n">iml</span><span class="p">])]</span>
        <span class="n">iml</span> <span class="o">=</span> <span class="n">iml</span><span class="p">[:</span><span class="n">nr</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">xml</span><span class="p">[</span><span class="n">iml</span><span class="p">]],</span>
                <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">yml</span><span class="p">[</span><span class="n">iml</span><span class="p">]],</span>
                <span class="n">er</span><span class="p">)</span>

    <span class="c1"># @debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_setPolarRange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; launches range widget</span>

<span class="sd">        :returns: apply status</span>
<span class="sd">        :rtype: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nrplots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">diffSpinBox</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">nrplots</span><span class="p">:</span>
            <span class="n">cnfdlg</span> <span class="o">=</span> <span class="n">diffRangeDialog</span><span class="o">.</span><span class="n">DiffRangeTabDialog</span><span class="p">(</span><span class="n">nrplots</span><span class="p">)</span>
            <span class="n">cnfdlg</span><span class="o">.</span><span class="n">azstart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__azstart</span>
            <span class="n">cnfdlg</span><span class="o">.</span><span class="n">azend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__azend</span>
            <span class="n">cnfdlg</span><span class="o">.</span><span class="n">radstart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radstart</span>
            <span class="n">cnfdlg</span><span class="o">.</span><span class="n">radend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radend</span>
            <span class="n">cnfdlg</span><span class="o">.</span><span class="n">radunitindex</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">cnfdlg</span><span class="o">.</span><span class="n">createGUI</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">exec_</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__azstart</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">azstart</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__azend</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">azend</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__radstart</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">radstart</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__radend</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">radend</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__updateregion</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_resetAccu</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">()</span>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">_updatePolarRange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ranges</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; update diffractogram ranges</span>

<span class="sd">        :param ranges: list of [azimuth_start, azimuth_end,</span>
<span class="sd">                                radial_start, radial_end]</span>
<span class="sd">                       elements for each diffractograms</span>
<span class="sd">        :type ranges: :obj:`list` &lt; [</span>
<span class="sd">                           :obj:`float`, :obj:`float`,</span>
<span class="sd">                           :obj:`float`, :obj:`float` ]&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nrplots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">diffSpinBox</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">nrplots</span><span class="p">:</span>
            <span class="n">azstart</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">azend</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">radstart</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">radend</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">rn</span> <span class="ow">in</span> <span class="n">ranges</span><span class="p">:</span>
                <span class="n">azstart</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rn</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">azend</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rn</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">radstart</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rn</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">radend</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rn</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__azstart</span> <span class="o">=</span> <span class="n">azstart</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__azend</span> <span class="o">=</span> <span class="n">azend</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__radstart</span> <span class="o">=</span> <span class="n">radstart</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__radend</span> <span class="o">=</span> <span class="n">radend</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__updateregion</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_resetAccu</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__updateaz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; update azimuth range in deg</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nrplots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">diffSpinBox</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__azrange</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__azend</span><span class="p">),</span> <span class="n">nrplots</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__azend</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__azstart</span><span class="p">),</span> <span class="n">nrplots</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__azstart</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrplots</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__azend</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__azstart</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__azrange</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__azend</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                  <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__azstart</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__azstart</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__azstart</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__azend</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__azend</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">360</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__azrange</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">__azstart</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">__azend</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>

    <span class="k">def</span> <span class="nf">__updaterad</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;update radial range in deg</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nrplots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">diffSpinBox</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__radrange</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__radend</span><span class="p">),</span> <span class="n">nrplots</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__radend</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__radstart</span><span class="p">),</span> <span class="n">nrplots</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__radstart</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrplots</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radend</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> \
               <span class="bp">self</span><span class="o">.</span><span class="n">__radstart</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radstart</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__radstart</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radend</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__radend</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">90</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radend</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radstart</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__radrange</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__unitindex</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__radrange</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__radstart</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radend</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radstart</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>
                    <span class="n">re</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radend</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__unitindex</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">oneoverlength</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">energy</span> <span class="o">/</span> <span class="mf">12398.4193</span>
                        <span class="n">fac</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">oneoverlength</span>
                        <span class="n">qs</span> <span class="o">=</span> <span class="n">fac</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rs</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
                        <span class="n">qe</span> <span class="o">=</span> <span class="n">fac</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">re</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__unitindex</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">qs</span> <span class="o">=</span> <span class="n">qs</span> <span class="o">*</span> <span class="mf">10.</span>
                            <span class="n">qe</span> <span class="o">=</span> <span class="n">qe</span> <span class="o">*</span> <span class="mf">10.</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__radrange</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">qs</span><span class="p">,</span> <span class="n">qe</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__unitindex</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__radrange</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">rs</span><span class="p">,</span> <span class="n">re</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__unitindex</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="p">[</span><span class="n">rbb</span><span class="p">,</span> <span class="n">rbe</span><span class="p">,</span> <span class="n">reb</span><span class="p">,</span> <span class="n">ree</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">]</span> <span class="o">=</span> \
                                <span class="bp">self</span><span class="o">.</span><span class="n">__getcorners</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">__radstart</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">__radend</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">__azstart</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">__azend</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                                <span class="s2">&quot;RESULT </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                                    <span class="nb">str</span><span class="p">(</span><span class="n">rbb</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="n">rbb</span><span class="o">.</span><span class="n">success</span><span class="p">,</span> <span class="n">rbb</span><span class="o">.</span><span class="n">fun</span><span class="p">))</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                                <span class="s2">&quot;RESULT </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                                    <span class="nb">str</span><span class="p">(</span><span class="n">rbe</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="n">rbe</span><span class="o">.</span><span class="n">success</span><span class="p">,</span> <span class="n">rbe</span><span class="o">.</span><span class="n">fun</span><span class="p">))</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                                <span class="s2">&quot;RESULT </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                                    <span class="nb">str</span><span class="p">(</span><span class="n">reb</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="n">reb</span><span class="o">.</span><span class="n">success</span><span class="p">,</span> <span class="n">reb</span><span class="o">.</span><span class="n">fun</span><span class="p">))</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                                <span class="s2">&quot;RESULT </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                                    <span class="nb">str</span><span class="p">(</span><span class="n">ree</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="n">ree</span><span class="o">.</span><span class="n">success</span><span class="p">,</span> <span class="n">ree</span><span class="o">.</span><span class="n">fun</span><span class="p">))</span>
                            <span class="n">rsl</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="n">rel</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="k">if</span> <span class="n">rbb</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                                <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">aimutex</span><span class="p">):</span>
                                    <span class="n">ra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">rFunction</span><span class="p">(</span>
                                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rbb</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">]),</span>
                                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rbb</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">]))</span>
                                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ra</span><span class="p">):</span>
                                        <span class="n">rsl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ra</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1000.</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">rbe</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                                <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">aimutex</span><span class="p">):</span>
                                    <span class="n">ra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">rFunction</span><span class="p">(</span>
                                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rbe</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">]),</span>
                                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rbe</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">]))</span>
                                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ra</span><span class="p">):</span>
                                        <span class="n">rsl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ra</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1000.</span><span class="p">)</span>

                            <span class="k">if</span> <span class="n">reb</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                                <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">aimutex</span><span class="p">):</span>
                                    <span class="n">ra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">rFunction</span><span class="p">(</span>
                                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">reb</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">]),</span>
                                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">reb</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">]))</span>
                                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ra</span><span class="p">):</span>
                                        <span class="n">rel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ra</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1000.</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">ree</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                                <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">aimutex</span><span class="p">):</span>
                                    <span class="n">ra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">rFunction</span><span class="p">(</span>
                                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ree</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">]),</span>
                                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ree</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">]))</span>
                                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ra</span><span class="p">):</span>
                                        <span class="n">rel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ra</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1000.</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">rsl</span><span class="p">:</span>
                                <span class="n">rs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rsl</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">rs</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">rs</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span>
                            <span class="k">if</span> <span class="n">rel</span><span class="p">:</span>
                                <span class="n">re</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rel</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">re</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">re</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                            <span class="n">rs</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">rs</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span>
                            <span class="n">re</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">re</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__radrange</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">rs</span><span class="p">,</span> <span class="n">re</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">__updateregion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; update diffractogram region</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__updateaz</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__updaterad</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateRangeTip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runProgress</span><span class="p">([</span><span class="s2">&quot;findregions&quot;</span><span class="p">],</span> <span class="s2">&quot;_updateRegionsAndPlot&quot;</span><span class="p">)</span>

    <span class="c1"># @debugmethod</span>
<div class="viewcode-block" id="DiffractogramToolWidget.findregions"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.DiffractogramToolWidget.findregions">[docs]</a>    <span class="k">def</span> <span class="nf">findregions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; find regions lists</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nrplots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">diffSpinBox</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">regions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">aimutex</span><span class="p">):</span>
            <span class="n">aistat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrplots</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">__azrange</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__azrange</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">or</span>
               <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__radrange</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radrange</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="ow">and</span> <span class="n">aistat</span><span class="p">:</span>
                <span class="n">azstart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__azstart</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> \
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__azstart</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="n">azend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__azend</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> \
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__azend</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">360</span>
                <span class="n">radstart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radstart</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> \
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radstart</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="n">radend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radend</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> \
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radend</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">70</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">regions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__findregion</span><span class="p">(</span><span class="n">radstart</span><span class="p">,</span> <span class="n">radend</span><span class="p">,</span> <span class="n">azstart</span><span class="p">,</span> <span class="n">azend</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                        <span class="c1"># print(str(e))</span>
                        <span class="n">regions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__findregion2</span><span class="p">(</span>
                                <span class="n">radstart</span><span class="p">,</span> <span class="n">radend</span><span class="p">,</span> <span class="n">azstart</span><span class="p">,</span> <span class="n">azend</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e2</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e2</span><span class="p">))</span>
                        <span class="c1"># print(str(e2))</span>
                        <span class="c1"># regions.append([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__regions</span> <span class="o">=</span> <span class="n">regions</span></div>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">_updateRegionsAndPlot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">regions</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; update regions and plots</span>

<span class="sd">        :param regions: list of region lines</span>
<span class="sd">        :type regions: :obj:`list` &lt;  :obj:`list` &lt;  :obj:`list`</span>
<span class="sd">                  &lt; (:obj:`float`, :obj:`float`) &gt; &gt; &gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">regions</span> <span class="o">=</span> <span class="n">regions</span> <span class="k">if</span> <span class="n">regions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">__regions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateRegions</span><span class="p">(</span><span class="n">regions</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resetAccu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plotDiff</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_closeReset</span><span class="p">()</span>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">_closeReset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; close reset method for progressbar</span>

<span class="sd">        :returns: progress status</span>
<span class="sd">        :rtype: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">status</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;closing Progress&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__progress</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__progress</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__commandthread</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__commandthread</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;Problems in updating Channels </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__commandthread</span><span class="o">.</span><span class="n">error</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__commandthread</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">status</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__progress</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__progress</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__progress</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">waitForThread</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;closing Progress ENDED&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">status</span>

    <span class="k">def</span> <span class="nf">__findregion2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radstart</span><span class="p">,</span> <span class="n">radend</span><span class="p">,</span> <span class="n">azstart</span><span class="p">,</span> <span class="n">azend</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; find region defined by angle range using image masking method</span>

<span class="sd">        :param radstart: start of radial region</span>
<span class="sd">        :type radstart: :obj:`float`</span>
<span class="sd">        :param radend: end of radial region</span>
<span class="sd">        :type radend: :obj:`float`</span>
<span class="sd">        :param azstart: start of azimuth region</span>
<span class="sd">        :type azstart: :obj:`float`</span>
<span class="sd">        :param azend: end of azimuth region</span>
<span class="sd">        :type azend: :obj:`float`</span>
<span class="sd">        :returns: list of region lines</span>
<span class="sd">        :rtype:  :obj:`list` &lt; :obj:`list` &lt; (float, float) &gt; &gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">azend</span> <span class="o">-</span> <span class="n">azstart</span> <span class="o">&gt;=</span> <span class="mi">360</span><span class="p">:</span>
            <span class="n">azstart</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">azend</span> <span class="o">=</span> <span class="mi">360</span>
        <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">aimutex</span><span class="p">):</span>
            <span class="n">aistat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">aistat</span><span class="p">:</span>
            <span class="n">dts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">rawData</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">dts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">while</span> <span class="n">dts</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">dts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">dts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dts</span><span class="o">.</span><span class="n">shape</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">dts</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="n">dts</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">shape</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1000.</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">]</span>
            <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">aimutex</span><span class="p">):</span>
                <span class="n">tta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">twoThetaArray</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
                <span class="n">cha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">chiArray</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">rb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__degtrim</span><span class="p">(</span><span class="n">radstart</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>
            <span class="n">re</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__degtrim</span><span class="p">(</span><span class="n">radend</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>

            <span class="n">ab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__degtrim</span><span class="p">(</span><span class="n">azstart</span><span class="p">,</span> <span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>
            <span class="n">ae</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__degtrim</span><span class="p">(</span><span class="n">azend</span><span class="p">,</span> <span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>

            <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">if</span> <span class="n">azend</span> <span class="o">-</span> <span class="n">azstart</span> <span class="o">&lt;</span> <span class="mi">360</span><span class="p">:</span>
                <span class="n">chmask</span> <span class="o">=</span> <span class="p">(</span><span class="n">cha</span> <span class="o">&lt;</span> <span class="n">ab</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">cha</span> <span class="o">&gt;</span> <span class="n">ae</span><span class="p">)</span>
                <span class="n">ttaa</span> <span class="o">=</span> <span class="p">(</span><span class="n">tta</span> <span class="o">-</span> <span class="n">rb</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">tta</span> <span class="o">-</span> <span class="n">re</span><span class="p">)</span>
                <span class="n">ttaa</span><span class="p">[</span><span class="n">chmask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span>
                <span class="n">rblines</span> <span class="o">=</span> <span class="n">functions</span><span class="o">.</span><span class="n">isocurve</span><span class="p">(</span>
                    <span class="n">ttaa</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">connected</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;RUN1 </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">rblines</span><span class="p">))</span>

                <span class="n">thmask</span> <span class="o">=</span> <span class="p">(</span><span class="n">tta</span> <span class="o">&lt;</span> <span class="n">rb</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">tta</span> <span class="o">&gt;</span> <span class="n">re</span><span class="p">)</span>
                <span class="n">chaa</span> <span class="o">=</span> <span class="p">(</span><span class="n">cha</span> <span class="o">-</span> <span class="n">ab</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">cha</span> <span class="o">-</span> <span class="n">ae</span><span class="p">)</span>
                <span class="n">chaa</span><span class="p">[</span><span class="n">thmask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span>
                <span class="n">ablines</span> <span class="o">=</span> <span class="n">functions</span><span class="o">.</span><span class="n">isocurve</span><span class="p">(</span>
                    <span class="n">chaa</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">connected</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;RUN2 </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">ablines</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ttaa</span> <span class="o">=</span> <span class="p">(</span><span class="n">tta</span> <span class="o">-</span> <span class="n">rb</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">tta</span> <span class="o">-</span> <span class="n">re</span><span class="p">)</span>
                <span class="n">rblines</span> <span class="o">=</span> <span class="n">functions</span><span class="o">.</span><span class="n">isocurve</span><span class="p">(</span>
                    <span class="n">ttaa</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">connected</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;RUN4 </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">rblines</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">rblines</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">([(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">line</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">azend</span> <span class="o">-</span> <span class="n">azstart</span> <span class="o">&lt;</span> <span class="mi">360</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">ablines</span><span class="p">:</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">([(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">line</span><span class="p">])</span>
            <span class="c1"># for line in relines:</span>
            <span class="c1">#     lines.append([(p[1], p[0]) for p in line])</span>

            <span class="c1"># print(lines)</span>
            <span class="k">return</span> <span class="n">lines</span>
            <span class="c1"># self._mainwidget.updateRegions(lines)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
            <span class="c1"># self._mainwidget.updateRegions([[(0, 0)]])</span>

    <span class="k">def</span> <span class="nf">__findregion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radstart</span><span class="p">,</span> <span class="n">radend</span><span class="p">,</span> <span class="n">azstart</span><span class="p">,</span> <span class="n">azend</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; find region defined by angle range using Newton method</span>

<span class="sd">        :param radstart: start of radial region</span>
<span class="sd">        :type radstart: :obj:`float`</span>
<span class="sd">        :param radend: end of radial region</span>
<span class="sd">        :type radend: :obj:`float`</span>
<span class="sd">        :param azstart: start of azimuth region</span>
<span class="sd">        :type azstart: :obj:`float`</span>
<span class="sd">        :param azend: end of azimuth region</span>
<span class="sd">        :type azend: :obj:`float`</span>
<span class="sd">        :returns: list of region lines</span>
<span class="sd">        :rtype:  :obj:`list` &lt; :obj:`list` &lt; (float, float) &gt; &gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">azend</span> <span class="o">-</span> <span class="n">azstart</span> <span class="o">&gt;=</span> <span class="mi">360</span><span class="p">:</span>
            <span class="n">azstart</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">azend</span> <span class="o">=</span> <span class="mi">360</span>
        <span class="p">[</span><span class="n">rbb</span><span class="p">,</span> <span class="n">rbe</span><span class="p">,</span> <span class="n">reb</span><span class="p">,</span> <span class="n">ree</span><span class="p">,</span> <span class="n">rb</span><span class="p">,</span> <span class="n">re</span><span class="p">,</span> <span class="n">ab</span><span class="p">,</span> <span class="n">ae</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getcorners</span><span class="p">(</span>
            <span class="n">radstart</span><span class="p">,</span> <span class="n">radend</span><span class="p">,</span> <span class="n">azstart</span><span class="p">,</span> <span class="n">azend</span><span class="p">)</span>
        <span class="n">azb</span> <span class="o">=</span> <span class="n">azstart</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>
        <span class="n">aze</span> <span class="o">=</span> <span class="n">azend</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;RESULT </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rbb</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="n">rbb</span><span class="o">.</span><span class="n">success</span><span class="p">,</span> <span class="n">rbb</span><span class="o">.</span><span class="n">fun</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;RESULT </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rbe</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="n">rbe</span><span class="o">.</span><span class="n">success</span><span class="p">,</span> <span class="n">rbe</span><span class="o">.</span><span class="n">fun</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;RESULT </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">reb</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="n">reb</span><span class="o">.</span><span class="n">success</span><span class="p">,</span> <span class="n">reb</span><span class="o">.</span><span class="n">fun</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;RESULT </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ree</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="n">ree</span><span class="o">.</span><span class="n">success</span><span class="p">,</span> <span class="n">ree</span><span class="o">.</span><span class="n">fun</span><span class="p">))</span>
        <span class="c1"># print(&quot;RESULT %s %s %s&quot; % (str(rbb.x), rbb.success, rbb.fun))</span>
        <span class="c1"># print(&quot;RESULT %s %s %s&quot; % (str(rbe.x), rbe.success, rbe.fun))</span>
        <span class="c1"># print(&quot;RESULT %s %s %s&quot; % (str(reb.x), reb.success, reb.fun))</span>
        <span class="c1"># print(&quot;RESULT %s %s %s&quot; % (str(ree.x), ree.success, ree.fun))</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">azend</span> <span class="o">-</span> <span class="n">azstart</span> <span class="o">&lt;</span> <span class="mi">360</span><span class="p">:</span>
            <span class="n">pbbeb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__findfixchipath</span><span class="p">(</span><span class="n">rbb</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">reb</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">ab</span><span class="p">,</span> <span class="n">rb</span><span class="p">,</span> <span class="n">re</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pbbeb</span><span class="p">)</span>
            <span class="n">pbeee</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__findfixchipath</span><span class="p">(</span><span class="n">rbe</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">ree</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">ae</span><span class="p">,</span> <span class="n">rb</span><span class="p">,</span> <span class="n">re</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pbeee</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radstart</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">pbbbe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__findfixradpath</span><span class="p">(</span>
                <span class="n">rbb</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">rbe</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">rb</span><span class="p">,</span> <span class="n">azb</span><span class="p">,</span> <span class="n">aze</span><span class="p">,</span>
                <span class="n">full</span><span class="o">=</span><span class="p">(</span><span class="n">azend</span> <span class="o">-</span> <span class="n">azstart</span> <span class="o">&gt;=</span> <span class="mi">360</span><span class="p">))</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pbbbe</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radend</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">60</span><span class="p">:</span>
            <span class="n">pebee</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__findfixradpath</span><span class="p">(</span>
                <span class="n">reb</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">ree</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">re</span><span class="p">,</span> <span class="n">azb</span><span class="p">,</span> <span class="n">aze</span><span class="p">,</span>
                <span class="n">full</span><span class="o">=</span><span class="p">(</span><span class="n">azend</span> <span class="o">-</span> <span class="n">azstart</span> <span class="o">&gt;=</span> <span class="mi">360</span><span class="p">))</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pebee</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lines</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__degtrim</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">vl</span><span class="p">,</span> <span class="n">lowbound</span><span class="p">,</span> <span class="n">upbound</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; trim angle value to bounds in deg</span>

<span class="sd">        :param vl: value to trim</span>
<span class="sd">        :type vl: :obj:`float`</span>
<span class="sd">        :param lowbound: lower bound of value</span>
<span class="sd">        :type lowbound: :obj:`float`</span>
<span class="sd">        :param upbound: upper blund of value</span>
<span class="sd">        :type upbound: :obj:`float`</span>
<span class="sd">        :returns: trimmed value</span>
<span class="sd">        :rtype: :obj:`float`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="n">vl</span> <span class="o">&gt;=</span> <span class="n">upbound</span><span class="p">:</span>
            <span class="n">vl</span> <span class="o">-=</span> <span class="mi">360</span>
        <span class="k">while</span> <span class="n">vl</span> <span class="o">&lt;</span> <span class="n">lowbound</span><span class="p">:</span>
            <span class="n">vl</span> <span class="o">+=</span> <span class="mi">360</span>
        <span class="k">return</span> <span class="n">vl</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__radtrim</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">vl</span><span class="p">,</span> <span class="n">lowbound</span><span class="p">,</span> <span class="n">upbound</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; trim angle value to bounds in rad</span>

<span class="sd">        :param vl: value to trim</span>
<span class="sd">        :type vl: :obj:`float`</span>
<span class="sd">        :param lowbound: lower bound of value</span>
<span class="sd">        :type lowbound: :obj:`float`</span>
<span class="sd">        :param upbound: upper blund of value</span>
<span class="sd">        :type upbound: :obj:`float`</span>
<span class="sd">        :returns: trimmed value</span>
<span class="sd">        :rtype: :obj:`float`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="n">vl</span> <span class="o">&gt;=</span> <span class="n">upbound</span><span class="p">:</span>
            <span class="n">vl</span> <span class="o">-=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">while</span> <span class="n">vl</span> <span class="o">&lt;</span> <span class="n">lowbound</span><span class="p">:</span>
            <span class="n">vl</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">return</span> <span class="n">vl</span>

    <span class="k">def</span> <span class="nf">__findfixchipath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xstart</span><span class="p">,</span> <span class="n">xend</span><span class="p">,</span> <span class="n">chi</span><span class="p">,</span> <span class="n">radstart</span><span class="p">,</span> <span class="n">radend</span><span class="p">,</span>
                         <span class="n">step</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="mf">1.e-10</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; find a path for fix azimuth angle</span>

<span class="sd">        :param xstart: start point</span>
<span class="sd">        :type xstart: :obj:`float`</span>
<span class="sd">        :param xend: end point</span>
<span class="sd">        :type xend: :obj:`float`</span>
<span class="sd">        :param chi: chi angle value</span>
<span class="sd">        :type chi: :obj:`float`</span>
<span class="sd">        :param radstart: radial angle start value</span>
<span class="sd">        :type radstart: :obj:`float`</span>
<span class="sd">        :param radend: radial angle end value</span>
<span class="sd">        :type radend: :obj:`float`</span>
<span class="sd">        :param fmax: maximal allowed value for the test function</span>
<span class="sd">        :type fmax: :obj:`float`</span>
<span class="sd">        :returns: list of points</span>
<span class="sd">        :rtype: :obj:`list` &lt; (float, float) &gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">xstart</span><span class="p">)]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dist2</span><span class="p">(</span><span class="n">xstart</span><span class="p">,</span> <span class="n">xend</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">step</span> <span class="o">*</span> <span class="n">step</span><span class="p">:</span>
            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">xend</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">points</span>

        <span class="n">alphas</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cut</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">tchi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__radtrim</span><span class="p">(</span><span class="n">chi</span><span class="p">,</span> <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tchi</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">tchi</span> <span class="o">&gt;</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">cut</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">cchi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__chi</span><span class="p">(</span><span class="n">xstart</span><span class="p">,</span> <span class="n">cut</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">xstart</span>

        <span class="k">def</span> <span class="nf">rsfun</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">cut</span><span class="p">,</span> <span class="n">chi</span><span class="p">):</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">step</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span>
                 <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">step</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="p">)]</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__chi</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">cut</span><span class="p">)</span> <span class="o">-</span> <span class="n">chi</span><span class="p">]</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">rsfun</span><span class="p">,</span> <span class="n">cchi</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">cut</span><span class="p">,</span> <span class="n">cchi</span><span class="p">))</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">step</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
             <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">step</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tth</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tth</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> \
           <span class="p">(</span><span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">success</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">fun</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">fmax</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">rsfun</span><span class="p">,</span> <span class="o">-</span> <span class="n">cchi</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">cut</span><span class="p">,</span> <span class="n">cchi</span><span class="p">))</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">step</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                 <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">step</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tth</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tth</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> \
               <span class="p">(</span><span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">success</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">fun</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">fmax</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;__findfixchipath: Cannot find the next point&quot;</span><span class="p">)</span>

        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dist2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">xend</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">step</span> <span class="o">*</span> <span class="n">step</span><span class="p">:</span>
            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">xend</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">points</span>
        <span class="n">alphas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">waking</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">maxit</span> <span class="o">=</span> <span class="mi">10000</span>
        <span class="n">it</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">istep</span> <span class="o">=</span> <span class="n">step</span>
        <span class="k">while</span> <span class="n">waking</span> <span class="ow">and</span> <span class="n">maxit</span> <span class="o">&gt;</span> <span class="n">it</span><span class="p">:</span>
            <span class="n">it</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">alp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__fitnext</span><span class="p">(</span><span class="n">alphas</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:])</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">y</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">rsfun</span><span class="p">,</span> <span class="n">alp</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">istep</span><span class="p">,</span> <span class="n">cut</span><span class="p">,</span> <span class="n">cchi</span><span class="p">))</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">istep</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                 <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">istep</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tth</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tth</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> \
               <span class="p">(</span><span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">success</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">fun</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">fmax</span><span class="p">):</span>
                <span class="n">istep</span> <span class="o">=</span> <span class="n">step</span> <span class="o">/</span> <span class="mf">2.</span>
                <span class="k">continue</span>

            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dist2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">xend</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">istep</span> <span class="o">*</span> <span class="n">istep</span><span class="p">:</span>
                <span class="n">waking</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">alphas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">istep</span> <span class="o">=</span> <span class="n">step</span>
        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">xend</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">points</span>

    <span class="k">def</span> <span class="nf">__findfixradpath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xstart</span><span class="p">,</span> <span class="n">xend</span><span class="p">,</span> <span class="n">rad</span><span class="p">,</span> <span class="n">azstart</span><span class="p">,</span> <span class="n">azend</span><span class="p">,</span>
                         <span class="n">step</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="mf">1.e-10</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; find a path for fixed radial angle</span>

<span class="sd">        :param xstart: start point</span>
<span class="sd">        :type xstart: :obj:`float`</span>
<span class="sd">        :param xend: end point</span>
<span class="sd">        :type xend: :obj:`float`</span>
<span class="sd">        :param rad: radial angle value</span>
<span class="sd">        :type rad: :obj:`float`</span>
<span class="sd">        :param azstart: azimuth angle start value</span>
<span class="sd">        :type azstart: :obj:`float`</span>
<span class="sd">        :param azend: azimuth angle end value</span>
<span class="sd">        :type azend: :obj:`float`</span>
<span class="sd">        :param fmax: maximal allowed value for the test function</span>
<span class="sd">        :type fmax: :obj:`float`</span>
<span class="sd">        :param full: full angle flag</span>
<span class="sd">        :type full: :obj:`bool`</span>
<span class="sd">        :returns: list of points</span>
<span class="sd">        :rtype: :obj:`list` &lt; (float, float) &gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">aze</span> <span class="o">=</span> <span class="n">azend</span>
        <span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">xstart</span><span class="p">)]</span>
        <span class="k">while</span> <span class="n">azstart</span> <span class="o">&gt;</span> <span class="n">aze</span><span class="p">:</span>
            <span class="n">aze</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>

        <span class="n">alphas</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cut</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">tth1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tth</span><span class="p">(</span><span class="n">xstart</span><span class="p">)</span>
        <span class="n">tth2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tth</span><span class="p">([</span><span class="n">xstart</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">xstart</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">tth3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tth</span><span class="p">([</span><span class="n">xstart</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xstart</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">dth</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">tth1</span> <span class="o">-</span> <span class="n">tth2</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">tth1</span> <span class="o">-</span> <span class="n">tth3</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">rad</span><span class="o">/</span><span class="n">dth</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">10.</span> <span class="o">*</span> <span class="n">step</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">rad</span> <span class="o">/</span> <span class="n">dth</span><span class="p">)</span> <span class="o">/</span> <span class="mf">10.</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">rad</span><span class="o">/</span><span class="n">dth</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">10000.</span> <span class="o">*</span> <span class="n">step</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">rad</span> <span class="o">/</span> <span class="n">dth</span><span class="p">)</span> <span class="o">/</span> <span class="mf">10000.</span>
        <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">__dist2</span><span class="p">(</span><span class="n">xstart</span><span class="p">,</span> <span class="n">xend</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">step</span> <span class="o">*</span> <span class="n">step</span>
             <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">azstart</span> <span class="o">-</span> <span class="n">aze</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="ow">or</span> <span class="n">step</span> <span class="o">&lt;</span> <span class="mf">1.e-6</span><span class="p">):</span>
            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">xend</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">points</span>

        <span class="c1"># tth = self.__tth(xstart)</span>
        <span class="n">tchi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__chi</span><span class="p">(</span><span class="n">xstart</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tchi</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">tchi</span> <span class="o">&gt;</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">cut</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">cchi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__chi</span><span class="p">(</span><span class="n">xstart</span><span class="p">,</span> <span class="n">cut</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">xstart</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;CUT </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cut</span><span class="p">,</span> <span class="n">cchi</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">rsfun</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">cut</span><span class="p">,</span> <span class="n">tth</span><span class="p">):</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">step</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span>
                 <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">step</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="p">)]</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__tth</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">tth</span><span class="p">]</span>

        <span class="n">itm</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">it</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">istep</span> <span class="o">=</span> <span class="n">step</span>
        <span class="k">while</span> <span class="n">it</span> <span class="o">&lt;</span> <span class="n">itm</span><span class="p">:</span>
            <span class="n">it</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">rsfun</span><span class="p">,</span> <span class="n">cchi</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
                                      <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">istep</span><span class="p">,</span> <span class="n">cut</span><span class="p">,</span> <span class="n">rad</span><span class="p">))</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">istep</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                 <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">istep</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__chi</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cut</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">__chi</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">cut</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> \
               <span class="p">(</span><span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">success</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">fun</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">fmax</span><span class="p">):</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">rsfun</span><span class="p">,</span> <span class="o">-</span><span class="n">cchi</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
                                          <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">istep</span><span class="p">,</span> <span class="n">cut</span><span class="p">,</span> <span class="n">rad</span><span class="p">))</span>
                <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">istep</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                     <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">istep</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__chi</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cut</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">__chi</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">cut</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> \
                   <span class="p">(</span><span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">success</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">fun</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">fmax</span><span class="p">):</span>
                    <span class="n">istep</span> <span class="o">=</span> <span class="n">istep</span> <span class="o">/</span> <span class="mf">2.</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">it</span> <span class="o">==</span> <span class="n">itm</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;__findfixradpath: Cannot find the next point&quot;</span><span class="p">)</span>

        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dist2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">xend</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">step</span> <span class="o">*</span> <span class="n">step</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">full</span><span class="p">:</span>
            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">xend</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">points</span>
        <span class="n">alphas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">waking</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">maxit</span> <span class="o">=</span> <span class="mi">10000</span>
        <span class="n">it</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">istep</span> <span class="o">=</span> <span class="n">step</span>
        <span class="k">while</span> <span class="n">waking</span> <span class="ow">and</span> <span class="n">maxit</span> <span class="o">&gt;</span> <span class="n">it</span><span class="p">:</span>
            <span class="n">it</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">alp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__fitnext</span><span class="p">(</span><span class="n">alphas</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:])</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">y</span>
            <span class="n">tchi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__chi</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cut</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tchi</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">tchi</span> <span class="o">&gt;</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">cut</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cut</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="n">res</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">rsfun</span><span class="p">,</span> <span class="n">alp</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">istep</span><span class="p">,</span> <span class="n">cut</span><span class="p">,</span> <span class="n">rad</span><span class="p">))</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">istep</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                 <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">istep</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__chi</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cut</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">__chi</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">cut</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> \
               <span class="p">(</span><span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">success</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">fun</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">fmax</span><span class="p">):</span>
                <span class="n">istep</span> <span class="o">=</span> <span class="n">step</span> <span class="o">/</span> <span class="mf">2.</span>
                <span class="k">continue</span>

            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dist2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">xend</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">istep</span> <span class="o">*</span> <span class="n">istep</span><span class="p">:</span>
                <span class="n">waking</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">alphas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">istep</span> <span class="o">=</span> <span class="n">step</span>
        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">xend</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">points</span>

    <span class="k">def</span> <span class="nf">__fitnext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; fits next y value</span>

<span class="sd">        :param y: list of y values</span>
<span class="sd">        :type y: :obj:`list` &lt;:obj:`float`&gt;</span>
<span class="sd">        :param x: list of x values</span>
<span class="sd">        :type x: :obj:`list` &lt;:obj:`float`&gt;</span>
<span class="sd">        :param x0: next x value</span>
<span class="sd">        :type x0: :obj:`float`</span>
<span class="sd">        :returns: next y value</span>
<span class="sd">        :rtype: :obj:`float`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">n</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))(</span><span class="n">x0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__dist2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; distance square of x and y</span>

<span class="sd">        :param x: 2d point x</span>
<span class="sd">        :type x: :obj:`list` &lt;:obj:`float`&gt;</span>
<span class="sd">        :param y: 2d point y</span>
<span class="sd">        :type y: :obj:`list` &lt;:obj:`float`&gt;</span>
<span class="sd">        :returns: distance square</span>
<span class="sd">        :rtype: :obj:`float`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">d0</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">d1</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">d0</span> <span class="o">*</span> <span class="n">d0</span> <span class="o">+</span> <span class="n">d1</span> <span class="o">*</span> <span class="n">d1</span>

    <span class="k">def</span> <span class="nf">__chi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">cut</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; chi of left bottom pixel corner in rad</span>

<span class="sd">        :param x: 2d point x</span>
<span class="sd">        :type x: :obj:`list` &lt;:obj:`float`&gt;</span>
<span class="sd">        :param cut: cut position in rad</span>
<span class="sd">        :type cut: :obj:`float`</span>
<span class="sd">        :returns: chi value</span>
<span class="sd">        :rtype: :obj:`float`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">aimutex</span><span class="p">):</span>
            <span class="n">chi</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">chi</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">]))[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">cut</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">chi</span> <span class="o">&gt;</span> <span class="n">cut</span> <span class="ow">and</span> <span class="n">cut</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
            <span class="n">chi</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">return</span> <span class="n">chi</span>

    <span class="k">def</span> <span class="nf">__tth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; tth of left bottom pixel corner in rad</span>

<span class="sd">        :param x: 2d point x</span>
<span class="sd">        :type x: :obj:`list` &lt;:obj:`float`&gt;</span>
<span class="sd">        :param path: path method</span>
<span class="sd">        :type path: :obj:`str`</span>
<span class="sd">        :returns: chi value</span>
<span class="sd">        :rtype: :obj:`float`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">aimutex</span><span class="p">):</span>
            <span class="n">tth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">tth</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">]),</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">tth</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__findpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">az</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">itmax</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="mf">1e-9</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; find a point in pixels</span>

<span class="sd">        :param rd: radial coordinate</span>
<span class="sd">        :type rd: :obj:`float`</span>
<span class="sd">        :param az: azimuth coordinate</span>
<span class="sd">        :type az: :obj:`float`</span>
<span class="sd">        :param shape: shape of the image</span>
<span class="sd">        :type shape: [:obj:`float`, :obj:`float`]</span>
<span class="sd">        :param start: start coordinate</span>
<span class="sd">        :type start: [:obj:`float`, :obj:`float`]</span>
<span class="sd">        :param itmaxstart: maximal number of tries</span>
<span class="sd">        :type start: :obj:`int`</span>
<span class="sd">        :param fmax: maximal allowed value for the test function</span>
<span class="sd">        :type fmax: :obj:`float`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">rafun</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__tth</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">f1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__chi</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">f2</span><span class="p">]</span>
        <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">it</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__approxpoint</span><span class="p">(</span><span class="n">rd</span><span class="p">,</span> <span class="n">az</span><span class="p">)</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">found</span> <span class="ow">and</span> <span class="n">it</span> <span class="o">&lt;</span> <span class="n">itmax</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">rafun</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="p">(</span><span class="n">rd</span><span class="p">,</span> <span class="n">az</span><span class="p">))</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">fun</span>
            <span class="n">f2</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">found</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">success</span> <span class="ow">and</span> <span class="n">f2</span> <span class="o">&lt;</span> <span class="n">fmax</span>
            <span class="n">it</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">start</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                     <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Tries: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">it</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span> <span class="nf">__getcorners</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radstart</span><span class="p">,</span> <span class="n">radend</span><span class="p">,</span> <span class="n">azstart</span><span class="p">,</span> <span class="n">azend</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; find region corners</span>

<span class="sd">        :param radstart: start of radial region in deg</span>
<span class="sd">        :type radstart: :obj:`float`</span>
<span class="sd">        :param radend: end of radial region in deg</span>
<span class="sd">        :type radend: :obj:`float`</span>
<span class="sd">        :param azstart: start of azimuth region in deg</span>
<span class="sd">        :type azstart: :obj:`float`</span>
<span class="sd">        :param azend: end of azimuth region in deg</span>
<span class="sd">        :type azend: :obj:`float`</span>
<span class="sd">        :returns: [rbb, rbe, reb, ree, rb, re, ab, ae]</span>
<span class="sd">                  where rbb, rbe, reb, ree</span>
<span class="sd">                   are result objects of found region corners</span>
<span class="sd">                  while rb, re, ab, ae</span>
<span class="sd">                   are input angles in radians</span>
<span class="sd">        :rtype:  :obj:`list` &lt;:obj:`float`&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">aimutex</span><span class="p">):</span>
            <span class="n">aistat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">aistat</span><span class="p">:</span>
            <span class="n">dts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">rawData</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">dts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">while</span> <span class="n">dts</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">dts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">dts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dts</span><span class="o">.</span><span class="n">shape</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">dts</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="n">dts</span><span class="o">.</span><span class="n">shape</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1000.</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">]</span>

            <span class="n">rb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__degtrim</span><span class="p">(</span><span class="n">radstart</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>
            <span class="n">re</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__degtrim</span><span class="p">(</span><span class="n">radend</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>
            <span class="n">ab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__degtrim</span><span class="p">(</span><span class="n">azstart</span><span class="p">,</span> <span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>
            <span class="n">ae</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__degtrim</span><span class="p">(</span><span class="n">azend</span><span class="p">,</span> <span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>

            <span class="n">rbb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__findpoint</span><span class="p">(</span><span class="n">rb</span><span class="p">,</span> <span class="n">ab</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>
            <span class="n">rbe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__findpoint</span><span class="p">(</span><span class="n">rb</span><span class="p">,</span> <span class="n">ae</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>
            <span class="n">ree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__findpoint</span><span class="p">(</span><span class="n">re</span><span class="p">,</span> <span class="n">ae</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>
            <span class="n">reb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__findpoint</span><span class="p">(</span><span class="n">re</span><span class="p">,</span> <span class="n">ab</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>

            <span class="k">return</span> <span class="p">[</span><span class="n">rbb</span><span class="p">,</span> <span class="n">rbe</span><span class="p">,</span> <span class="n">reb</span><span class="p">,</span> <span class="n">ree</span><span class="p">,</span> <span class="n">rb</span><span class="p">,</span> <span class="n">re</span><span class="p">,</span> <span class="n">ab</span><span class="p">,</span> <span class="n">ae</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__approxpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rad</span><span class="p">,</span> <span class="n">az</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; find approximate x,y coorinates from angles</span>

<span class="sd">        :param rad: radial angle in rad</span>
<span class="sd">        :type rad: :obj:`float`</span>
<span class="sd">        :param az: azimuth angle in rad</span>
<span class="sd">        :type az: :obj:`float`</span>
<span class="sd">        :returns: [x, y] coordinates</span>
<span class="sd">        :rtype:  [:obj:`float`, :obj:`float`]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">aimutex</span><span class="p">):</span>
            <span class="n">aistat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">ai</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">aistat</span><span class="p">:</span>
            <span class="n">tnr</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">rad</span><span class="p">)</span>
            <span class="n">csa</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">az</span><span class="p">)</span>
            <span class="n">sna</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">az</span><span class="p">)</span>
            <span class="n">dst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span>
            <span class="n">xc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span>
            <span class="n">yc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span>
            <span class="n">px</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizex</span> <span class="o">/</span> <span class="mf">1000.</span>
            <span class="n">py</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizey</span> <span class="o">/</span> <span class="mf">1000.</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">dst</span> <span class="o">*</span> <span class="n">sna</span> <span class="o">*</span> <span class="n">tnr</span> <span class="o">+</span> <span class="n">yc</span> <span class="o">*</span> <span class="n">py</span><span class="p">)</span><span class="o">/</span><span class="n">py</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">dst</span> <span class="o">*</span> <span class="n">csa</span> <span class="o">*</span> <span class="n">tnr</span> <span class="o">+</span> <span class="n">xc</span> <span class="o">*</span> <span class="n">px</span><span class="p">)</span><span class="o">/</span><span class="n">px</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span>

    <span class="c1"># @debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_setUnitIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uindex</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set unit index</span>

<span class="sd">        :param uindex: unit index, i.e. q_nm^-1, q_A^-1, 2th_deg, 2th_rad</span>
<span class="sd">        :type uindex: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__unitindex</span> <span class="o">!=</span> <span class="n">uindex</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_resetAccu</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__unitindex</span> <span class="o">=</span> <span class="n">uindex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__updaterad</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plotDiff</span><span class="p">()</span>

    <span class="c1"># @debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_setPlotIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pindex</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set plot index</span>

<span class="sd">        :param pindex: plot index -&gt; 0: Image, &lt;i&gt;: Buffer &lt;i&gt;</span>
<span class="sd">        :type pindex: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pindex</span> <span class="ow">and</span> <span class="n">pindex</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">centerlines</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">toolscale</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">regions</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__xbuffers</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">pindex</span> <span class="ow">and</span> \
               <span class="bp">self</span><span class="o">.</span><span class="n">__xbuffers</span><span class="p">[</span><span class="n">pindex</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]:</span>
                <span class="n">pos</span><span class="p">,</span> <span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__xbuffers</span><span class="p">[</span><span class="n">pindex</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">setToolScale</span><span class="p">([</span><span class="n">pos</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">sc</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">setToolScale</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="c1"># self._mainwidget.setToolScale([0, 0], [1, 1])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__oldlocked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">setAspectLocked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__oldlocked</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">setAspectLocked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__oldlocked</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">centerlines</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">toolscale</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">regions</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">pindex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span> <span class="o">=</span> <span class="n">pindex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateinfowidgets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitReplotImage</span><span class="p">()</span>

    <span class="c1"># @debugmethod</span>
<div class="viewcode-block" id="DiffractogramToolWidget.updateRangeTip"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.DiffractogramToolWidget.updateRangeTip">[docs]</a>    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">updateRangeTip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; update geometry tips</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;&quot;</span>
        <span class="n">nrplots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">diffSpinBox</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrplots</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">nrplots</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">. &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">text</span> <span class="o">+=</span> \
                <span class="sa">u</span><span class="s2">&quot;Radial range: [</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">] deg; Azimuth range: [</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">] deg&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__radstart</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__radstart</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">i</span> <span class="ow">and</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__radstart</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">else</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__radend</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__radend</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">i</span> <span class="ow">and</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__radend</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">else</span> <span class="s2">&quot;90&quot;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__azstart</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__azstart</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">i</span> <span class="ow">and</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__azstart</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">else</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__azend</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__azend</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">i</span> <span class="ow">and</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__azend</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">else</span> <span class="s2">&quot;360&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nrplots</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">rangePushButton</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="MaximaToolWidget"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.MaximaToolWidget">[docs]</a><span class="k">class</span> <span class="nc">MaximaToolWidget</span><span class="p">(</span><span class="n">ToolBaseWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; maxima tool widget</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#: (:obj:`str`) tool name</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Maxima&quot;</span>
    <span class="c1">#: (:obj:`str`) tool name alias</span>
    <span class="n">alias</span> <span class="o">=</span> <span class="s2">&quot;maxima&quot;</span>
    <span class="c1">#: (:obj:`tuple` &lt;:obj:`str`&gt;) capitalized required packages</span>
    <span class="n">requires</span> <span class="o">=</span> <span class="p">()</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param parent: parent object</span>
<span class="sd">        :type parent: :class:`pyqtgraph.QtCore.QObject`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ToolBaseWidget</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

        <span class="c1">#: (:obj:`int`) geometry space index -&gt; 0: angle, 1 q-space</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__gspaceindex</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1">#: (:obj:`int`) plot index -&gt; 0: Cartesian, 1 polar-th, 2 polar-q</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1">#: (:class:`Ui_ROIToolWidget&#39;) ui_toolwidget object from qtdesigner</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span> <span class="o">=</span> <span class="n">_maximaformclass</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># self.parameters.lines = True</span>
        <span class="c1">#: (:obj:`str`) infolineedit text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">infolineedit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">infotips</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">centerlines</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">toolscale</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">maxima</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># self.parameters.rightplot = True</span>

        <span class="c1">#: (`lavuelib..imageDisplayWidget.AxesParameters`) axes backup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__axes</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#: (:class:`lavuelib.settings.Settings`) configuration settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">settings</span><span class="p">()</span>

        <span class="c1">#: (:obj:`float`) radail coordinate factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__radmax</span> <span class="o">=</span> <span class="mf">1.</span>

        <span class="c1">#: (:obj:`float`) polar coordinate factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__polmax</span> <span class="o">=</span> <span class="mf">1.</span>

        <span class="c1">#: (:obj:`bool`) reploting flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__reploting</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1">#: (:obj:`bool`) reploting flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__updating</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1">#: (:obj:`list`) last combo items</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lastcomboitems</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1">#: (:obj:`list` &lt; [:class:`pyqtgraph.QtCore.pyqtSignal`, :obj:`str`] &gt;)</span>
        <span class="c1">#: list of [signal, slot] object to connect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signal2slot</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">angleqPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setGeometry</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">angleqComboBox</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_setGSpaceIndex</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">angleqComboBox</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">mouseImageDoubleClicked</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_updateCenter</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">maximaComboBox</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replot</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">maximaComboBox</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">numberSpinBox</span><span class="o">.</span><span class="n">valueChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replot</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">numberSpinBox</span><span class="o">.</span><span class="n">valueChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">geometryChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateGeometryTip</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">geometryChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">mouseImagePositionChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_message</span><span class="p">]</span>
        <span class="p">]</span>

    <span class="c1"># @debugmethod</span>
<div class="viewcode-block" id="MaximaToolWidget.configure"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.MaximaToolWidget.configure">[docs]</a>    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set configuration for the current tool</span>

<span class="sd">        :param configuration: configuration string</span>
<span class="sd">        :type configuration: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configuration</span><span class="p">:</span>
            <span class="n">cnf</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;geometry&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_updateGeometry</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="c1"># print(str(e))</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">if</span> <span class="s2">&quot;maxima_number&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">numberSpinBox</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;maxima_number&quot;</span><span class="p">]))</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                    <span class="c1"># print(str(e))</span>
            <span class="k">if</span> <span class="s2">&quot;units&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">idxs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;angles&quot;</span><span class="p">,</span> <span class="s2">&quot;q-space&quot;</span><span class="p">,</span> <span class="s2">&quot;xy-space&quot;</span><span class="p">]</span>
                <span class="n">xcrd</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="n">idxs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">xcrd</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">angleqComboBox</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;current_maximum&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">cmx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;current_maximum&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">maximaComboBox</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">cmx</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="c1"># print(str(e))</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                    <span class="n">cmx</span> <span class="o">=</span> <span class="mi">0</span></div>

    <span class="c1"># @debugmethod</span>
<div class="viewcode-block" id="MaximaToolWidget.configuration"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.MaximaToolWidget.configuration">[docs]</a>    <span class="k">def</span> <span class="nf">configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides configuration for the current tool</span>

<span class="sd">        :returns configuration: configuration string</span>
<span class="sd">        :rtype configuration: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cnf</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">angleqComboBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;maxima_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">numberSpinBox</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;current_maximum&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">maximaComboBox</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;centerx&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span><span class="p">,</span>
            <span class="s2">&quot;centery&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span><span class="p">,</span>
            <span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">energy</span><span class="p">,</span>
            <span class="s2">&quot;pixelsizex&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizex</span><span class="p">,</span>
            <span class="s2">&quot;pixelsizey&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizey</span><span class="p">,</span>
            <span class="s2">&quot;detdistance&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">cnf</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">numpyEncoder</span><span class="p">)</span></div>

<div class="viewcode-block" id="MaximaToolWidget.activate"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.MaximaToolWidget.activate">[docs]</a>    <span class="k">def</span> <span class="nf">activate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; activates tool widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateGeometryTip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateCenter</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span><span class="p">)</span></div>

<div class="viewcode-block" id="MaximaToolWidget.deactivate"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.MaximaToolWidget.deactivate">[docs]</a>    <span class="k">def</span> <span class="nf">deactivate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; deactivates tool widget</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="MaximaToolWidget.beforeplot"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.MaximaToolWidget.beforeplot">[docs]</a>    <span class="k">def</span> <span class="nf">beforeplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">rawarray</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; command  before plot</span>

<span class="sd">        :param array: 2d image array</span>
<span class="sd">        :type array: :class:`numpy.ndarray`</span>
<span class="sd">        :param rawarray: 2d raw image array</span>
<span class="sd">        :type rawarray: :class:`numpy.ndarray`</span>
<span class="sd">        :return: 2d image array and raw image</span>
<span class="sd">        :rtype: (:class:`numpy.ndarray`, :class:`numpy.ndarray`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">rawarray</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">rawarray</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="k">while</span> <span class="n">rawarray</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">rawarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">rawarray</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">numberSpinBox</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
            <span class="n">nr</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span> <span class="n">rawarray</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">nanmask</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">rawarray</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;f&#39;</span> <span class="ow">and</span> \
                       <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">rawarray</span><span class="o">.</span><span class="n">min</span><span class="p">()):</span>
                        <span class="n">rawarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">rawarray</span><span class="p">)</span>
                <span class="n">fidxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">rawarray</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="o">-</span><span class="n">nr</span><span class="p">:]</span>
                <span class="n">aidxs</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">rawarray</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                         <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">fidxs</span><span class="p">]</span>
                <span class="n">naidxs</span> <span class="o">=</span> <span class="n">aidxs</span>
                <span class="n">rwe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">rangeWindowEnabled</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">rwe</span><span class="p">:</span>
                    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span>
                        <span class="n">useraxes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">noNone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">naidxs</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">s1</span> <span class="o">+</span> <span class="n">x</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">j</span> <span class="o">*</span> <span class="n">s2</span> <span class="o">+</span> <span class="n">y</span><span class="p">))</span>
                              <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">aidxs</span><span class="p">]</span>
                    <span class="n">offset</span> <span class="o">=</span> <span class="p">[</span><span class="n">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">s1</span><span class="p">,</span> <span class="n">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">s2</span><span class="p">]</span>
                <span class="n">maxidxs</span> <span class="o">=</span> <span class="p">[[</span><span class="n">naidxs</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">naidxs</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">rawarray</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]]</span>
                           <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">aidxs</span><span class="p">)]</span>
                <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__updatemaxima</span><span class="p">(</span><span class="n">maxidxs</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">current</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">aidxs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aidxs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">naidxs</span><span class="p">)</span> <span class="o">-</span> <span class="n">current</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">setMaximaPos</span><span class="p">(</span><span class="n">naidxs</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__updatemaxima</span><span class="p">([])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">setMaximaPos</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__reploting</span> <span class="o">=</span> <span class="kc">False</span></div>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">__updatemaxima</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxidxs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; updates maxima in the combobox</span>

<span class="sd">        :param maxidxs: list with [[xn,yn, maxn], ... [x1,y1, max1]]</span>
<span class="sd">        :type maxidxs:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__updating</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">combo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">maximaComboBox</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">combo</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">maxidxs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">idx</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">maxidxs</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">maxidxs</span><span class="p">)</span> <span class="ow">and</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">QtCore</span><span class="o">.</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">transformations</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">trans</span><span class="p">:</span>
            <span class="n">comboitems</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2"> at (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">vl</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">vl</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                          <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">vl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">maxidxs</span><span class="p">))]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">comboitems</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2"> at (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">vl</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">vl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vl</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                          <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">vl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">maxidxs</span><span class="p">))]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastcomboitems</span> <span class="o">!=</span> <span class="n">comboitems</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__lastcomboitems</span> <span class="o">!=</span> <span class="n">comboitems</span>
            <span class="n">combo</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="c1"># self.__reploting = True</span>
            <span class="n">combo</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span><span class="n">comboitems</span><span class="p">)</span>
            <span class="n">combo</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__updating</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sendresults</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__sendresults</span><span class="p">(</span><span class="n">maxidxs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">idx</span>

    <span class="k">def</span> <span class="nf">__sendresults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxidxs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; send results to LavueController</span>

<span class="sd">        :param maxidxs: list with [[xn,yn, maxn], ... [x1,y1, max1]]</span>
<span class="sd">        :type maxidxs:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tool&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">}</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;imagename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">imageName</span><span class="p">()</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;maxima&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxidxs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span>
            <span class="s2">&quot;ToolResults&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">numpyEncoder</span><span class="p">))</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_updateCenter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; updates the image center</span>

<span class="sd">        :param xdata: x pixel position</span>
<span class="sd">        :type xdata: :obj:`float`</span>
<span class="sd">        :param ydata: y-pixel position</span>
<span class="sd">        :type ydata: :obj:`float`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">txdata</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">rangeWindowEnabled</span><span class="p">():</span>
            <span class="n">txdata</span><span class="p">,</span> <span class="n">tydata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scaledxy</span><span class="p">(</span>
                <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">useraxes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">txdata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">xdata</span> <span class="o">=</span> <span class="n">txdata</span>
                <span class="n">ydata</span> <span class="o">=</span> <span class="n">tydata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">xdata</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span><span class="s2">&quot;BeamCenterX&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">xdata</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span><span class="s2">&quot;BeamCenterY&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">ydata</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_message</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateGeometryTip</span><span class="p">()</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_replot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__reploting</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__updating</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__reploting</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitReplotImage</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides geometry message</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">currentIntensity</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">intensity</span><span class="p">):</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span>
                <span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">it</span><span class="p">))</span>
                 <span class="k">else</span> <span class="n">it</span> <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">intensity</span><span class="p">])</span>
        <span class="n">txdata</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">rangeWindowEnabled</span><span class="p">():</span>
            <span class="n">txdata</span><span class="p">,</span> <span class="n">tydata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scaledxy</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">useraxes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">txdata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">txdata</span><span class="p">,</span> <span class="n">tydata</span>
        <span class="n">ilabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scalingLabel</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__gspaceindex</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">thetax</span><span class="p">,</span> <span class="n">thetay</span><span class="p">,</span> <span class="n">thetatotal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pixel2theta</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">thetax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;th_x = </span><span class="si">%f</span><span class="s2"> deg, th_y = </span><span class="si">%f</span><span class="s2"> deg,&quot;</span> \
                          <span class="s2">&quot; th_tot = </span><span class="si">%f</span><span class="s2"> deg, </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%.2f</span><span class="s2">&quot;</span> \
                          <span class="o">%</span> <span class="p">(</span><span class="n">thetax</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
                             <span class="n">thetay</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
                             <span class="n">thetatotal</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
                             <span class="n">ilabel</span><span class="p">,</span> <span class="n">intensity</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__gspaceindex</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">qx</span><span class="p">,</span> <span class="n">qy</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pixel2q</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">qx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;q_x = </span><span class="si">%f</span><span class="s2"> 1/</span><span class="se">\u212B</span><span class="s2">, q_y = </span><span class="si">%f</span><span class="s2"> 1/</span><span class="se">\u212B</span><span class="s2">, &quot;</span> \
                          <span class="sa">u</span><span class="s2">&quot;q = </span><span class="si">%f</span><span class="s2"> 1/</span><span class="se">\u212B</span><span class="s2">, </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%.2f</span><span class="s2">&quot;</span> \
                          <span class="o">%</span> <span class="p">(</span><span class="n">qx</span><span class="p">,</span> <span class="n">qy</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">ilabel</span><span class="p">,</span> <span class="n">intensity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;x = </span><span class="si">%.2f</span><span class="s2">, y = </span><span class="si">%.2f</span><span class="s2">, </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ilabel</span><span class="p">,</span> <span class="n">intensity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">setDisplayedText</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__pixel2theta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; converts coordinates from pixel positions to theta angles</span>

<span class="sd">        :param xdata: x pixel position</span>
<span class="sd">        :type xdata: :obj:`float`</span>
<span class="sd">        :param ydata: y-pixel position</span>
<span class="sd">        :type ydata: :obj:`float`</span>
<span class="sd">        :param xy: flag</span>
<span class="sd">        :type xy: :obj:`bool`</span>
<span class="sd">        :returns: x-theta, y-theta, total-theta</span>
<span class="sd">        :rtype: (:obj:`float`, :obj:`float`, :obj:`float`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">thetax</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">thetay</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">thetatotal</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">energy</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">xcentered</span> <span class="o">=</span> <span class="n">xdata</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span>
            <span class="n">ycentered</span> <span class="o">=</span> <span class="n">ydata</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span>
            <span class="k">if</span> <span class="n">xy</span><span class="p">:</span>
                <span class="n">thetax</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span>
                    <span class="n">xcentered</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizex</span> <span class="o">/</span> <span class="mf">1000.</span>
                    <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span><span class="p">)</span>
                <span class="n">thetay</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span>
                    <span class="n">ycentered</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizey</span> <span class="o">/</span> <span class="mf">1000.</span>
                    <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                <span class="p">(</span><span class="n">xcentered</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizex</span> <span class="o">/</span> <span class="mf">1000.</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">ycentered</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizey</span> <span class="o">/</span> <span class="mf">1000.</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">thetatotal</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span>
                <span class="n">r</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">thetax</span><span class="p">,</span> <span class="n">thetay</span><span class="p">,</span> <span class="n">thetatotal</span>

    <span class="k">def</span> <span class="nf">__pixel2q</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; converts coordinates from pixel positions to q-space coordinates</span>

<span class="sd">        :param xdata: x pixel position</span>
<span class="sd">        :type xdata: :obj:`float`</span>
<span class="sd">        :param ydata: y-pixel position</span>
<span class="sd">        :type ydata: :obj:`float`</span>
<span class="sd">        :param xy: flag</span>
<span class="sd">        :type xy: :obj:`bool`</span>
<span class="sd">        :returns: q_x, q_y, q_total</span>
<span class="sd">        :rtype: (:obj:`float`, :obj:`float`, :obj:`float`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">qx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">qy</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">q</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">energy</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">thetax</span><span class="p">,</span> <span class="n">thetay</span><span class="p">,</span> <span class="n">thetatotal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pixel2theta</span><span class="p">(</span>
                <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">xy</span><span class="p">)</span>
            <span class="n">wavelength</span> <span class="o">=</span> <span class="mf">12398.4193</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">energy</span>
            <span class="k">if</span> <span class="n">xy</span><span class="p">:</span>
                <span class="n">qx</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">wavelength</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">thetax</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
                <span class="n">qy</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">wavelength</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">thetay</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
            <span class="n">q</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">wavelength</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">thetatotal</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">qx</span><span class="p">,</span> <span class="n">qy</span><span class="p">,</span> <span class="n">q</span>

    <span class="k">def</span> <span class="nf">__tipmessage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides geometry messate</span>

<span class="sd">        :returns: geometry text</span>
<span class="sd">        :rtype: :obj:`unicode`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="sa">u</span><span class="s2">&quot;geometry:</span><span class="se">\n</span><span class="s2">&quot;</span> \
            <span class="sa">u</span><span class="s2">&quot;  center = (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">) pixels</span><span class="se">\n</span><span class="s2">&quot;</span> \
            <span class="sa">u</span><span class="s2">&quot;  pixel_size = (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">) </span><span class="se">\u00B5</span><span class="s2">m</span><span class="se">\n</span><span class="s2">&quot;</span> \
            <span class="sa">u</span><span class="s2">&quot;  detector_distance = </span><span class="si">%s</span><span class="s2"> mm</span><span class="se">\n</span><span class="s2">&quot;</span> \
            <span class="sa">u</span><span class="s2">&quot;  energy = </span><span class="si">%s</span><span class="s2"> eV&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizex</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizey</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">energy</span>
            <span class="p">)</span>

    <span class="c1"># @debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_setGeometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; launches geometry widget</span>

<span class="sd">        :returns: apply status</span>
<span class="sd">        :rtype: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cnfdlg</span> <span class="o">=</span> <span class="n">geometryDialog</span><span class="o">.</span><span class="n">GeometryDialog</span><span class="p">()</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">centery</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">energy</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">pixelsizex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizex</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">pixelsizey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizey</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">detdistance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">createGUI</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">exec_</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">centerx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">centery</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">energy</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">energy</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizex</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">pixelsizex</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizey</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">pixelsizey</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">detdistance</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span>
                <span class="s2">&quot;BeamCenterX&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span>
                <span class="s2">&quot;BeamCenterY&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span>
                <span class="s2">&quot;Energy&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">energy</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span>
                <span class="s2">&quot;DetectorDistance&quot;</span><span class="p">,</span>
                <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateGeometryTip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateCenter</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitReplotImage</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">()</span>

    <span class="c1"># @debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_updateGeometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geometry</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; update geometry widget</span>

<span class="sd">        :param geometry: geometry dictionary</span>
<span class="sd">        :type geometry: :obj:`dict` &lt; :obj:`str`, :obj:`list`&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;centerx&quot;</span> <span class="ow">in</span> <span class="n">geometry</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;centerx&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span>
                    <span class="s2">&quot;BeamCenterX&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;centery&quot;</span> <span class="ow">in</span> <span class="n">geometry</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;centery&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span>
                    <span class="s2">&quot;BeamCenterY&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;energy&quot;</span> <span class="ow">in</span> <span class="n">geometry</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">energy</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span>
                    <span class="s2">&quot;Energy&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">energy</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;pixelsizex&quot;</span> <span class="ow">in</span> <span class="n">geometry</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizex</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;pixelsizex&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;pixelsizey&quot;</span> <span class="ow">in</span> <span class="n">geometry</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizey</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;pixelsizey&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;detdistance&quot;</span> <span class="ow">in</span> <span class="n">geometry</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;detdistance&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span>
                <span class="s2">&quot;DetectorDistance&quot;</span><span class="p">,</span>
                <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="n">geometry</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateGeometryTip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateCenter</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plotindex</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitReplotImage</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">()</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_setGSpaceIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gindex</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set gspace index</span>

<span class="sd">        :param gspace: g-space index, i.e. angle or q-space</span>
<span class="sd">        :type gspace: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__gspaceindex</span> <span class="o">=</span> <span class="n">gindex</span>

<div class="viewcode-block" id="MaximaToolWidget.updateGeometryTip"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.MaximaToolWidget.updateGeometryTip">[docs]</a>    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">updateGeometryTip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; update geometry tips</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tipmessage</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateDisplayedTextTip</span><span class="p">(</span>
            <span class="s2">&quot;coordinate info display for the mouse pointer</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span>
            <span class="o">%</span> <span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">angleqPushButton</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
            <span class="s2">&quot;Input physical parameters</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">angleqComboBox</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
            <span class="s2">&quot;Select the display space</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">message</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="QROIProjToolWidget"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.QROIProjToolWidget">[docs]</a><span class="k">class</span> <span class="nc">QROIProjToolWidget</span><span class="p">(</span><span class="n">ToolBaseWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; angle/q +roi + projections tool widget</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#: (:class:`pyqtgraph.QtCore.pyqtSignal`) apply ROI pressed signal</span>
    <span class="n">applyROIPressed</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
    <span class="c1">#: (:class:`pyqtgraph.QtCore.pyqtSignal`) fetch ROI pressed signal</span>
    <span class="n">fetchROIPressed</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="c1">#: (:class:`pyqtgraph.QtCore.pyqtSignal`) roi info Changed signal</span>
    <span class="n">roiInfoChanged</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="c1">#: (:obj:`str`) tool name</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Q+ROI+Proj&quot;</span>
    <span class="c1">#: (:obj:`str`) tool name alias</span>
    <span class="n">alias</span> <span class="o">=</span> <span class="s2">&quot;q+roi+proj&quot;</span>
    <span class="c1">#: (:obj:`tuple` &lt;:obj:`str`&gt;) capitalized required packages</span>
    <span class="n">requires</span> <span class="o">=</span> <span class="p">()</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param parent: parent object</span>
<span class="sd">        :type parent: :class:`pyqtgraph.QtCore.QObject`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ToolBaseWidget</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

        <span class="c1">#: (:obj:`int`) geometry space index -&gt; 0: angle, 1 q-space</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__gspaceindex</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1">#: (:class:`Ui_ROIToolWidget&#39;) ui_toolwidget object from qtdesigner</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span> <span class="o">=</span> <span class="n">_qroiprojformclass</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1">#: (:class:`pyqtgraph.PlotDataItem`) 1D bottom plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__bottomplot</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:class:`pyqtgraph.PlotDataItem`) 1D bottom plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__rightplot</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`int`) function index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__funindex</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1">#: (:obj:`slice`) selected rows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__rows</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`slice`) selected columns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__columns</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`slice`) selected rows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`slice`) selected columns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dscolumns</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#: (:obj:`list`&lt; :obj:`str`&gt;) sardana aliases</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__aliases</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#: (:obj:`int`) ROI label length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__textlength</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">bottomplot</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">rightplot</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">rois</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">infolineedit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">infotips</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">centerlines</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1">#: (:class:`lavuelib.settings.Settings`) configuration settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">settings</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_updateApplyButton</span><span class="p">()</span>
        <span class="c1">#: (:obj:`list` &lt; [:class:`pyqtgraph.QtCore.pyqtSignal`, :obj:`str`] &gt;)</span>
        <span class="c1">#: list of [signal, slot] object to connect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signal2slot</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">applyROIPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emitApplyROIPressed</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">fetchROIPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emitFetchROIPressed</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">angleqPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setGeometry</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">angleqComboBox</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_setGSpaceIndex</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">angleqComboBox</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">mouseImageDoubleClicked</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_updateCenter</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">mouseImagePositionChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_message</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">geometryChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateGeometryTip</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">geometryChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">],</span>

            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">applyROIPressed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">applyROIs</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fetchROIPressed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">fetchROIs</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">roiInfoChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateDisplayedText</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">labelROILineEdit</span><span class="o">.</span><span class="n">textChanged</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_updateApplyButton</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">roiSpinBox</span><span class="o">.</span><span class="n">valueChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateROIs</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">roiSpinBox</span><span class="o">.</span><span class="n">valueChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">roiSpinBox</span><span class="o">.</span><span class="n">valueChanged</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeDetectorROIsAttribute</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">labelROILineEdit</span><span class="o">.</span><span class="n">textEdited</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_writeDetectorROIs</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">labelROILineEdit</span><span class="o">.</span><span class="n">textEdited</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">roiLineEditChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updateApplyButton</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">roiAliasesChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateROILineEdit</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">roiValueChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateROIDisplayText</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">roiNumberChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">setROIsNumber</span><span class="p">],</span>
            <span class="c1"># [self._mainwidget.sardanaEnabled, self.updateROIButton],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">mouseImagePositionChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_roimessage</span><span class="p">],</span>

            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">funComboBox</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_setFunction</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">rowsliceLineEdit</span><span class="o">.</span><span class="n">textChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updateRows</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">rowsliceLineEdit</span><span class="o">.</span><span class="n">textChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">columnsliceLineEdit</span><span class="o">.</span><span class="n">textChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updateColumns</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">columnsliceLineEdit</span><span class="o">.</span><span class="n">textChanged</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scalesChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updateRows</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scalesChanged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updateColumns</span><span class="p">],</span>
        <span class="p">]</span>

<div class="viewcode-block" id="QROIProjToolWidget.configure"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.QROIProjToolWidget.configure">[docs]</a>    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set configuration for the current tool</span>

<span class="sd">        :param configuration: configuration string</span>
<span class="sd">        :type configuration: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configuration</span><span class="p">:</span>
            <span class="n">cnf</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;geometry&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_updateGeometry</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="c1"># print(str(e))</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">if</span> <span class="s2">&quot;rois_number&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">roiSpinBox</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;rois_number&quot;</span><span class="p">]))</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                    <span class="c1"># print(str(e))</span>
            <span class="k">if</span> <span class="s2">&quot;rois_coords&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateROIs</span><span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;rois_coords&quot;</span><span class="p">]),</span> <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;rois_coords&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="s2">&quot;aliases&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">aliases</span> <span class="o">=</span> <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;aliases&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">aliases</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">aliases</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">aliases</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">labelROILineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">aliases</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;units&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">idxs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;angles&quot;</span><span class="p">,</span> <span class="s2">&quot;q-space&quot;</span><span class="p">]</span>
                <span class="n">xcrd</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="n">idxs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">xcrd</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">angleqComboBox</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;apply&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;apply&quot;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_emitApplyROIPressed</span><span class="p">()</span>
            <span class="k">if</span> <span class="s2">&quot;fetch&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;fetch&quot;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_emitFetchROIPressed</span><span class="p">()</span>
            <span class="k">if</span> <span class="s2">&quot;mapping&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">idxs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;sum&quot;</span><span class="p">]</span>
                <span class="n">xcrd</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;mapping&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="n">idxs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">xcrd</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">funComboBox</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;rows&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">rowsliceLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;rows&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="s2">&quot;columns&quot;</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">columnsliceLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;columns&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="QROIProjToolWidget.configuration"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.QROIProjToolWidget.configuration">[docs]</a>    <span class="k">def</span> <span class="nf">configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides configuration for the current tool</span>

<span class="sd">        :returns configuration: configuration string</span>
<span class="sd">        :rtype configuration: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cnf</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;aliases&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">labelROILineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;rois_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">roiSpinBox</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;rois_coords&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">roiCoords</span><span class="p">()</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;mapping&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">funComboBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;rows&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">rowsliceLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;columns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">columnsliceLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">angleqComboBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">cnf</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;centerx&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span><span class="p">,</span>
            <span class="s2">&quot;centery&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span><span class="p">,</span>
            <span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">energy</span><span class="p">,</span>
            <span class="s2">&quot;pixelsizex&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizex</span><span class="p">,</span>
            <span class="s2">&quot;pixelsizey&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizey</span><span class="p">,</span>
            <span class="s2">&quot;detdistance&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">cnf</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">numpyEncoder</span><span class="p">)</span></div>

<div class="viewcode-block" id="QROIProjToolWidget.activate"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.QROIProjToolWidget.activate">[docs]</a>    <span class="k">def</span> <span class="nf">activate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; activates tool widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateGeometryTip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateCenter</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">changeROIRegion</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setROIsNumber</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">roiCoords</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__aliases</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">getElementNames</span><span class="p">(</span><span class="s2">&quot;ExpChannelList&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateROILineEdit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">roilabels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__updateCompleter</span><span class="p">()</span>
        <span class="c1"># self.updateROIButton(</span>
        <span class="c1">#     self.__settings.sardana or bool(self.__settings.analysisdevice))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bottomplot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__bottomplot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">onedbarbottomplot</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rightplot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__rightplot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">onedbarrightplot</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__bottomplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__rightplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__bottomplot</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__rightplot</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_updateSlices</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plotCurves</span><span class="p">()</span></div>

<div class="viewcode-block" id="QROIProjToolWidget.deactivate"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.QROIProjToolWidget.deactivate">[docs]</a>    <span class="k">def</span> <span class="nf">deactivate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; deactivates tool widget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">roiCoordsChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bottomplot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__bottomplot</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__bottomplot</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">removebottomplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__bottomplot</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__bottomplot</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rightplot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__rightplot</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__rightplot</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">removerightplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__rightplot</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__rightplot</span> <span class="o">=</span> <span class="kc">None</span></div>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_writeDetectorROIs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; writes Detector rois and updates roi labels</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">roilabels</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">labelROILineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeDetectorROIsAttribute</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__updateslice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ds</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; create slices from the text</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="s2">&quot;ERROR&quot;</span>
        <span class="n">dsrows</span> <span class="o">=</span> <span class="s2">&quot;ERROR&quot;</span>
        <span class="k">if</span> <span class="n">text</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;:&quot;</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
                    <span class="n">slices</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
                    <span class="n">s0</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">slices</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">slices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">else</span> <span class="mi">0</span>
                    <span class="n">s1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">slices</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="n">slices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">slices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">s2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">slices</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">if</span> <span class="n">slices</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span>
                        <span class="n">rows</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">s0</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">dx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">dsrows</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">((</span><span class="n">s0</span><span class="o">-</span><span class="n">dx</span><span class="p">)</span><span class="o">/</span><span class="n">ds</span><span class="p">,</span> <span class="p">(</span><span class="n">s1</span><span class="o">-</span><span class="n">dx</span><span class="p">)</span><span class="o">/</span><span class="n">ds</span><span class="p">,</span> <span class="n">s2</span><span class="o">/</span><span class="n">ds</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">dsrows</span> <span class="o">=</span> <span class="n">rows</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">rows</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">s0</span><span class="p">,</span> <span class="n">s1</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">dx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">dsrows</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">((</span><span class="n">s0</span><span class="o">-</span><span class="n">dx</span><span class="p">)</span><span class="o">/</span><span class="n">ds</span><span class="p">,</span> <span class="p">(</span><span class="n">s1</span><span class="o">-</span><span class="n">dx</span><span class="p">)</span><span class="o">/</span><span class="n">ds</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">dsrows</span> <span class="o">=</span> <span class="n">rows</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">dx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">dsrows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">rows</span> <span class="o">-</span> <span class="n">dx</span><span class="p">)</span><span class="o">/</span><span class="n">ds</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dsrows</span> <span class="o">=</span> <span class="n">rows</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">dsrows</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">rows</span><span class="p">,</span> <span class="n">dsrows</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_updateSlices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; updates applied button&quot;&quot;&quot;</span>
        <span class="n">rtext</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">rowsliceLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">ctext</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">columnsliceLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">rwe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">rangeWindowEnabled</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">rwe</span><span class="p">:</span>
            <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">ds1</span><span class="p">,</span> <span class="n">ds2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span>
                <span class="n">useraxes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">noNone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__updateslice</span><span class="p">(</span>
                <span class="n">rtext</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">dy</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">ds2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__columns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dscolumns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__updateslice</span><span class="p">(</span>
                <span class="n">ctext</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">dx</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">ds1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__updateslice</span><span class="p">(</span><span class="n">rtext</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__columns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dscolumns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__updateslice</span><span class="p">(</span><span class="n">ctext</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rows</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateHBounds</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__rows</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateHBounds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rows</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__rows</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateHBounds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__rows</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rows</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__columns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateVBounds</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__columns</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateVBounds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__columns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__columns</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__columns</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateVBounds</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__columns</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__columns</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plotCurves</span><span class="p">()</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_updateRows</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; updates applied button&quot;&quot;&quot;</span>
        <span class="n">rtext</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">rowsliceLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">rwe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">rangeWindowEnabled</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">rwe</span><span class="p">:</span>
            <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">ds1</span><span class="p">,</span> <span class="n">ds2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span>
                <span class="n">useraxes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">noNone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__updateslice</span><span class="p">(</span>
                <span class="n">rtext</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">dy</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">ds2</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__updateslice</span><span class="p">(</span><span class="n">rtext</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rows</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateHBounds</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__rows</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateHBounds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rows</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__rows</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateHBounds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__rows</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rows</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plotCurves</span><span class="p">()</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_updateColumns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; updates applied button&quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">columnsliceLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">rwe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">rangeWindowEnabled</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">rwe</span><span class="p">:</span>
            <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">ds1</span><span class="p">,</span> <span class="n">ds2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span>
                <span class="n">useraxes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">noNone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rwe</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__columns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dscolumns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__updateslice</span><span class="p">(</span>
                <span class="n">text</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">dx</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">ds1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__columns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dscolumns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__updateslice</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__columns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateVBounds</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__columns</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateVBounds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__columns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__columns</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__columns</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateVBounds</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__columns</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__columns</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plotCurves</span><span class="p">()</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_setFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">findex</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set sum or mean function</span>

<span class="sd">        :param findex: function index, i.e. 0:mean, 1:sum</span>
<span class="sd">        :type findex: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__funindex</span> <span class="o">=</span> <span class="n">findex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plotCurves</span><span class="p">()</span>

<div class="viewcode-block" id="QROIProjToolWidget.afterplot"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.QROIProjToolWidget.afterplot">[docs]</a>    <span class="k">def</span> <span class="nf">afterplot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; command after plot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plotCurves</span><span class="p">()</span></div>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_plotCurves</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; plots the current image in 1d plots</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">currentTool</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="n">dts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">rawData</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">dts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">while</span> <span class="n">dts</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">dts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">dts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__funindex</span><span class="p">:</span>
                    <span class="n">npfun</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">npfun</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span> <span class="o">==</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">:</span>
                    <span class="n">sx</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                            <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span>
                                <span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;Mean of empty slice&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
                                <span class="n">sx</span> <span class="o">=</span> <span class="n">npfun</span><span class="p">(</span><span class="n">dts</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">sx</span> <span class="o">=</span> <span class="n">dts</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="n">sx</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                        <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span>
                            <span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;Mean of empty slice&#39;</span><span class="p">)</span>
                        <span class="n">sx</span> <span class="o">=</span> <span class="n">npfun</span><span class="p">(</span><span class="n">dts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dscolumns</span> <span class="o">==</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">:</span>
                    <span class="n">sy</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dscolumns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                            <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span>
                                <span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;Mean of empty slice&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dscolumns</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
                                <span class="n">sy</span> <span class="o">=</span> <span class="n">npfun</span><span class="p">(</span><span class="n">dts</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__dscolumns</span><span class="p">,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">sy</span> <span class="o">=</span> <span class="n">dts</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__dscolumns</span><span class="p">,</span> <span class="p">:]</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="n">sy</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                            <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span>
                                <span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;Mean of empty slice&#39;</span><span class="p">)</span>
                            <span class="n">sy</span> <span class="o">=</span> <span class="n">npfun</span><span class="p">(</span><span class="n">dts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="n">sy</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="n">rwe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">rangeWindowEnabled</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">rwe</span><span class="p">:</span>
                    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span>
                        <span class="n">useraxes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">noNone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">transformations</span><span class="p">()[</span><span class="mi">3</span><span class="p">]:</span>
                        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span>
                        <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s1</span>
                    <span class="n">xx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                        <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">sx</span><span class="p">)</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">s1</span><span class="p">)))</span>
                    <span class="n">yy</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                        <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">sy</span><span class="p">)</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">s2</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">s1</span> <span class="o">=</span> <span class="mf">1.0</span>
                    <span class="n">s2</span> <span class="o">=</span> <span class="mf">1.0</span>
                    <span class="n">xx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sx</span><span class="p">)))</span>
                    <span class="n">yy</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sy</span><span class="p">)))</span>
                <span class="n">width</span> <span class="o">=</span> <span class="p">[</span><span class="n">s1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">sx</span><span class="p">)</span>
                <span class="n">height</span> <span class="o">=</span> <span class="p">[</span><span class="n">s2</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">sy</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__bottomplot</span><span class="o">.</span><span class="n">setOpts</span><span class="p">(</span>
                    <span class="n">y0</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">sx</span><span class="p">),</span> <span class="n">y1</span><span class="o">=</span><span class="n">sx</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">xx</span><span class="p">,</span>
                    <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__bottomplot</span><span class="o">.</span><span class="n">drawPicture</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__rightplot</span><span class="o">.</span><span class="n">setOpts</span><span class="p">(</span>
                    <span class="n">x0</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">sy</span><span class="p">),</span> <span class="n">x1</span><span class="o">=</span><span class="n">sy</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">yy</span><span class="p">,</span>
                    <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__rightplot</span><span class="o">.</span><span class="n">drawPicture</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sendresults</span><span class="p">:</span>
                    <span class="n">xslice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dsrows</span>
                    <span class="n">yslice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dscolumns</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">xslice</span><span class="p">,</span> <span class="s2">&quot;start&quot;</span><span class="p">):</span>
                        <span class="n">xslice</span> <span class="o">=</span> <span class="p">[</span><span class="n">xslice</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">xslice</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="n">xslice</span><span class="o">.</span><span class="n">step</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">yslice</span><span class="p">,</span> <span class="s2">&quot;start&quot;</span><span class="p">):</span>
                        <span class="n">yslice</span> <span class="o">=</span> <span class="p">[</span><span class="n">yslice</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">yslice</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="n">yslice</span><span class="o">.</span><span class="n">step</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__sendresults</span><span class="p">(</span>
                        <span class="n">xx</span><span class="p">,</span>
                        <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">sx</span><span class="p">],</span>
                        <span class="n">s1</span><span class="p">,</span> <span class="n">xslice</span><span class="p">,</span>
                        <span class="n">yy</span><span class="p">,</span>
                        <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">sy</span><span class="p">],</span>
                        <span class="n">s2</span><span class="p">,</span> <span class="n">yslice</span><span class="p">,</span>
                        <span class="s2">&quot;sum&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__funindex</span> <span class="k">else</span> <span class="s2">&quot;mean&quot;</span>
                    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__sendresults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">sx</span><span class="p">,</span> <span class="n">xscale</span><span class="p">,</span> <span class="n">xslice</span><span class="p">,</span>
                      <span class="n">yy</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">yscale</span><span class="p">,</span> <span class="n">yslice</span><span class="p">,</span> <span class="n">fun</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; send results to LavueController</span>

<span class="sd">        :param xx:  x&#39;s coordinates</span>
<span class="sd">        :type xx:  :obj:`list` &lt;float&gt;</span>
<span class="sd">        :param sx:  projection to x coordinate</span>
<span class="sd">        :type sx:  :obj:`list` &lt;float&gt;</span>
<span class="sd">        :param xscale:  x scale</span>
<span class="sd">        :type xscale:  :obj:`float`</span>
<span class="sd">        :param xslice:  x slice</span>
<span class="sd">        :type xslice:  :obj:`list` &lt;float&gt;</span>
<span class="sd">        :param yy:  y&#39;s coordinates</span>
<span class="sd">        :type yy:  :obj:`list` &lt;float&gt;</span>
<span class="sd">        :param sy:  projection to y coordinate</span>
<span class="sd">        :type sy:  :obj:`list` &lt;float&gt;</span>
<span class="sd">        :param yscale:  y scale</span>
<span class="sd">        :type yscale:  :obj:`float`</span>
<span class="sd">        :param yslice:  y slice</span>
<span class="sd">        :type yslice:  :obj:`list` &lt;float&gt;</span>
<span class="sd">        :param fun:  projection function name</span>
<span class="sd">        :type fun:  :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tool&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">alias</span><span class="p">}</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;imagename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">imageName</span><span class="p">()</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;xx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xx</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;sx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sx</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;xscale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xscale</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;xslice&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xslice</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;yy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">yy</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;sy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sy</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;yscale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">yscale</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;yslice&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">yslice</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;function&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fun</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span>
            <span class="s2">&quot;ToolResults&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">numpyEncoder</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__updateCompleter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; updates the labelROI help</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">labelROILineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="n">sttext</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">sptext</span> <span class="o">=</span> <span class="n">sttext</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">stext</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">):</span>
            <span class="n">stext</span> <span class="o">=</span> <span class="n">sttext</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">sptext</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">stext</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sptext</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">stext</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aliases</span><span class="p">:</span>
                <span class="n">hints</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">stext</span><span class="p">,</span> <span class="n">al</span><span class="p">)</span> <span class="k">for</span> <span class="n">al</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aliases</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">hints</span> <span class="o">=</span> <span class="p">[</span><span class="n">stext</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aliases</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="n">completer</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QCompleter</span><span class="p">(</span><span class="n">hints</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">labelROILineEdit</span><span class="o">.</span><span class="n">setCompleter</span><span class="p">(</span><span class="n">completer</span><span class="p">)</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_roimessage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides roi message</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">currentROI</span><span class="p">()</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">roiCoords</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">current</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">current</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">coords</span><span class="p">[</span><span class="n">current</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__setDisplayedText</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setDisplayedText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sets displayed info text and recalculates the current roi sum</span>

<span class="sd">        :param text: text to display</span>
<span class="sd">        :type text: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sroiVal</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__lasttext</span> <span class="o">=</span> <span class="n">text</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lasttext</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showallrois</span><span class="p">:</span>
            <span class="n">currentroi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">currentROI</span><span class="p">()</span>
            <span class="n">roiVals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">calcROIsums</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">roiVals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sroiVal</span> <span class="o">=</span> <span class="s2">&quot; / &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="p">[((</span><span class="s2">&quot;</span><span class="si">%g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">roiv</span><span class="p">)</span> <span class="k">if</span> <span class="n">roiv</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;?&quot;</span><span class="p">)</span>
                     <span class="k">for</span> <span class="n">roiv</span> <span class="ow">in</span> <span class="n">roiVals</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">roiVal</span><span class="p">,</span> <span class="n">currentroi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">calcROIsum</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">roiVal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sroiVal</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.4f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">roiVal</span>
        <span class="k">if</span> <span class="n">currentroi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateROIDisplayText</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">currentroi</span><span class="p">,</span> <span class="n">sroiVal</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">roiinfoLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_emitApplyROIPressed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; emits applyROIPressed signal&quot;&quot;&quot;</span>

        <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">labelROILineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="n">roispin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">roiSpinBox</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">applyROIPressed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">roispin</span><span class="p">)</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_emitFetchROIPressed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; emits fetchROIPressed signal&quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">labelROILineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fetchROIPressed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_updateApplyButton</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; updates applied button&quot;&quot;&quot;</span>
        <span class="n">stext</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">labelROILineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">roilabels</span> <span class="o">=</span> <span class="n">stext</span>
        <span class="n">currentlength</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">stext</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">stext</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">applyROIPushButton</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__updateCompleter</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">applyROIPushButton</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">stext</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">currentlength</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__textlength</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__updateCompleter</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__textlength</span> <span class="o">=</span> <span class="n">currentlength</span>

<div class="viewcode-block" id="QROIProjToolWidget.updateROILineEdit"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.QROIProjToolWidget.updateROILineEdit">[docs]</a>    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">updateROILineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; updates ROI line edit text</span>

<span class="sd">        :param text: text to update</span>
<span class="sd">        :type text: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">labelROILineEdit</span><span class="o">.</span><span class="n">hasFocus</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">labelROILineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_updateApplyButton</span><span class="p">()</span></div>

<div class="viewcode-block" id="QROIProjToolWidget.updateROIButton"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.QROIProjToolWidget.updateROIButton">[docs]</a>    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">updateROIButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enabled</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; enables/disables ROI buttons</span>

<span class="sd">        :param enable: buttons enabled</span>
<span class="sd">        :type enable: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span></div>
        <span class="c1"># self.__ui.applyROIPushButton.setEnabled(enabled)</span>
        <span class="c1"># self.__ui.fetchROIPushButton.setEnabled(enabled)</span>

<div class="viewcode-block" id="QROIProjToolWidget.updateApplyTips"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.QROIProjToolWidget.updateApplyTips">[docs]</a>    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">updateApplyTips</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; updates apply tips</span>

<span class="sd">        :param rid: current roi id</span>
<span class="sd">        :type rid: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">rid</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">applyROIPushButton</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
                <span class="s2">&quot;remove ROI aliases from the Door environment&quot;</span>
                <span class="s2">&quot; as well as from Active MntGrp&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">applyROIPushButton</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
                <span class="s2">&quot;add ROI aliases to the Door environment &quot;</span>
                <span class="s2">&quot;as well as to Active MntGrp&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="QROIProjToolWidget.updateROIDisplayText"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.QROIProjToolWidget.updateROIDisplayText">[docs]</a>    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">updateROIDisplayText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">currentroi</span><span class="p">,</span> <span class="n">roiVal</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; updates ROI display text</span>

<span class="sd">        :param text: standard display text</span>
<span class="sd">        :type text: :obj:`str`</span>
<span class="sd">        :param currentroi: current roi label</span>
<span class="sd">        :type currentroi: :obj:`str`</span>
<span class="sd">        :param text: roi sum value</span>
<span class="sd">        :type text: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">roilabel</span> <span class="o">=</span> <span class="s2">&quot;roi [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">currentroi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">slabel</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">rlabel</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">labelROILineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">rlabel</span><span class="p">:</span>
            <span class="n">slabel</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;|,| |</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">rlabel</span><span class="p">)</span>
            <span class="n">slabel</span> <span class="o">=</span> <span class="p">[</span><span class="n">lb</span> <span class="k">for</span> <span class="n">lb</span> <span class="ow">in</span> <span class="n">slabel</span> <span class="k">if</span> <span class="n">lb</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">slabel</span><span class="p">:</span>
            <span class="n">roilabel</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">slabel</span><span class="p">[</span><span class="n">currentroi</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">currentroi</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">slabel</span><span class="p">)</span> <span class="k">else</span> <span class="n">slabel</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="p">(</span><span class="n">currentroi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">roiVal</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">roiinfoLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">; values = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">roilabel</span><span class="p">,</span> <span class="n">roiVal</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">roiinfoLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">roilabel</span><span class="p">,</span> <span class="n">roiVal</span><span class="p">))</span></div>

<div class="viewcode-block" id="QROIProjToolWidget.setROIsNumber"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.QROIProjToolWidget.setROIsNumber">[docs]</a>    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">setROIsNumber</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;sets a number of rois</span>

<span class="sd">        :param rid: number of rois</span>
<span class="sd">        :type rid: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">roiSpinBox</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">rid</span><span class="p">)</span></div>
        <span class="c1"># self._mainwidget.writeDetectorROIsAttribute()</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_updateCenter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; updates the image center</span>

<span class="sd">        :param xdata: x pixel position</span>
<span class="sd">        :type xdata: :obj:`float`</span>
<span class="sd">        :param ydata: y-pixel position</span>
<span class="sd">        :type ydata: :obj:`float`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">txdata</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">rangeWindowEnabled</span><span class="p">():</span>
            <span class="n">txdata</span><span class="p">,</span> <span class="n">tydata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scaledxy</span><span class="p">(</span>
                <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">useraxes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">txdata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">xdata</span> <span class="o">=</span> <span class="n">txdata</span>
                <span class="n">ydata</span> <span class="o">=</span> <span class="n">tydata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">xdata</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span><span class="s2">&quot;BeamCenterX&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">xdata</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span><span class="s2">&quot;BeamCenterY&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">ydata</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_message</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateGeometryTip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">()</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides geometry message</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">currentIntensity</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">intensity</span><span class="p">):</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span>
                <span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">it</span><span class="p">))</span>
                 <span class="k">else</span> <span class="n">it</span> <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">intensity</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">rangeWindowEnabled</span><span class="p">():</span>
            <span class="n">txdata</span><span class="p">,</span> <span class="n">tydata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scaledxy</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">useraxes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">txdata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">txdata</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">tydata</span>
        <span class="n">ilabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">scalingLabel</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__gspaceindex</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">thetax</span><span class="p">,</span> <span class="n">thetay</span><span class="p">,</span> <span class="n">thetatotal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pixel2theta</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">thetax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;th_x = </span><span class="si">%f</span><span class="s2"> deg, th_y = </span><span class="si">%f</span><span class="s2"> deg,&quot;</span> \
                          <span class="s2">&quot; th_tot = </span><span class="si">%f</span><span class="s2"> deg, </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%.2f</span><span class="s2">&quot;</span> \
                          <span class="o">%</span> <span class="p">(</span><span class="n">thetax</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
                             <span class="n">thetay</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
                             <span class="n">thetatotal</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
                             <span class="n">ilabel</span><span class="p">,</span> <span class="n">intensity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">qx</span><span class="p">,</span> <span class="n">qy</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pixel2q</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">qx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;q_x = </span><span class="si">%f</span><span class="s2"> 1/</span><span class="se">\u212B</span><span class="s2">, q_y = </span><span class="si">%f</span><span class="s2"> 1/</span><span class="se">\u212B</span><span class="s2">, &quot;</span> \
                          <span class="sa">u</span><span class="s2">&quot;q = </span><span class="si">%f</span><span class="s2"> 1/</span><span class="se">\u212B</span><span class="s2">, </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%.2f</span><span class="s2">&quot;</span> \
                          <span class="o">%</span> <span class="p">(</span><span class="n">qx</span><span class="p">,</span> <span class="n">qy</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">ilabel</span><span class="p">,</span> <span class="n">intensity</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateDisplayedText</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__pixel2theta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; converts coordinates from pixel positions to theta angles</span>

<span class="sd">        :param xdata: x pixel position</span>
<span class="sd">        :type xdata: :obj:`float`</span>
<span class="sd">        :param ydata: y-pixel position</span>
<span class="sd">        :type ydata: :obj:`float`</span>
<span class="sd">        :returns: x-theta, y-theta, total-theta</span>
<span class="sd">        :rtype: (:obj:`float`, :obj:`float`, :obj:`float`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">thetax</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">thetay</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">thetatotal</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">energy</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">xcentered</span> <span class="o">=</span> <span class="n">xdata</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span>
            <span class="n">ycentered</span> <span class="o">=</span> <span class="n">ydata</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span>
            <span class="n">thetax</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span>
                <span class="n">xcentered</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizex</span> <span class="o">/</span> <span class="mf">1000.</span>
                <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span><span class="p">)</span>
            <span class="n">thetay</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span>
                <span class="n">ycentered</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizey</span> <span class="o">/</span> <span class="mf">1000.</span>
                <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                <span class="p">(</span><span class="n">xcentered</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizex</span> <span class="o">/</span> <span class="mf">1000.</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">ycentered</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizey</span> <span class="o">/</span> <span class="mf">1000.</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">thetatotal</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span>
                <span class="n">r</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">thetax</span><span class="p">,</span> <span class="n">thetay</span><span class="p">,</span> <span class="n">thetatotal</span>

    <span class="k">def</span> <span class="nf">__pixel2q</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; converts coordinates from pixel positions to q-space coordinates</span>

<span class="sd">        :param xdata: x pixel position</span>
<span class="sd">        :type xdata: :obj:`float`</span>
<span class="sd">        :param ydata: y-pixel position</span>
<span class="sd">        :type ydata: :obj:`float`</span>
<span class="sd">        :returns: q_x, q_y, q_total</span>
<span class="sd">        :rtype: (:obj:`float`, :obj:`float`, :obj:`float`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">qx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">qy</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">q</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">energy</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">thetax</span><span class="p">,</span> <span class="n">thetay</span><span class="p">,</span> <span class="n">thetatotal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pixel2theta</span><span class="p">(</span>
                <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">)</span>
            <span class="n">wavelength</span> <span class="o">=</span> <span class="mf">12398.4193</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">energy</span>
            <span class="n">qx</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">wavelength</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">thetax</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
            <span class="n">qy</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">wavelength</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">thetay</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
            <span class="n">q</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">wavelength</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">thetatotal</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">qx</span><span class="p">,</span> <span class="n">qy</span><span class="p">,</span> <span class="n">q</span>

    <span class="k">def</span> <span class="nf">__tipmessage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides geometry messate</span>

<span class="sd">        :returns: geometry text</span>
<span class="sd">        :rtype: :obj:`unicode`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="sa">u</span><span class="s2">&quot;geometry:</span><span class="se">\n</span><span class="s2">&quot;</span> \
            <span class="sa">u</span><span class="s2">&quot;  center = (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">) pixels</span><span class="se">\n</span><span class="s2">&quot;</span> \
            <span class="sa">u</span><span class="s2">&quot;  pixel_size = (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">) </span><span class="se">\u00B5</span><span class="s2">m</span><span class="se">\n</span><span class="s2">&quot;</span> \
            <span class="sa">u</span><span class="s2">&quot;  detector_distance = </span><span class="si">%s</span><span class="s2"> mm</span><span class="se">\n</span><span class="s2">&quot;</span> \
            <span class="sa">u</span><span class="s2">&quot;  energy = </span><span class="si">%s</span><span class="s2"> eV&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizex</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizey</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">energy</span>
            <span class="p">)</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_setGeometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; launches geometry widget</span>

<span class="sd">        :returns: apply status</span>
<span class="sd">        :rtype: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cnfdlg</span> <span class="o">=</span> <span class="n">geometryDialog</span><span class="o">.</span><span class="n">GeometryDialog</span><span class="p">()</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">centery</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">energy</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">pixelsizex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizex</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">pixelsizey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizey</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">detdistance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">createGUI</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">exec_</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">centerx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">centery</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">energy</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">energy</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizex</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">pixelsizex</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizey</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">pixelsizey</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span> <span class="o">=</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">detdistance</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">updateAISettings</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeDetectorAttributes</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateGeometryTip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateCenter</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span><span class="p">)</span>

    <span class="c1"># @debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_updateGeometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geometry</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; update geometry widget</span>

<span class="sd">        :param geometry: geometry dictionary</span>
<span class="sd">        :type geometry: :obj:`dict` &lt; :obj:`str`, :obj:`list`&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;centerx&quot;</span> <span class="ow">in</span> <span class="n">geometry</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;centerx&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span>
                    <span class="s2">&quot;BeamCenterX&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;centery&quot;</span> <span class="ow">in</span> <span class="n">geometry</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;centery&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span>
                    <span class="s2">&quot;BeamCenterY&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;energy&quot;</span> <span class="ow">in</span> <span class="n">geometry</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">energy</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span>
                    <span class="s2">&quot;Energy&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">energy</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;pixelsizex&quot;</span> <span class="ow">in</span> <span class="n">geometry</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizex</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;pixelsizex&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;pixelsizey&quot;</span> <span class="ow">in</span> <span class="n">geometry</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">pixelsizey</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;pixelsizey&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;detdistance&quot;</span> <span class="ow">in</span> <span class="n">geometry</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;detdistance&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span>
                <span class="s2">&quot;DetectorDistance&quot;</span><span class="p">,</span>
                <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detdistance</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="n">geometry</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateGeometryTip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateCenter</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">emitTCC</span><span class="p">()</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_setGSpaceIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gindex</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set gspace index</span>

<span class="sd">        :param gspace: g-space index, i.e. angle or q-space</span>
<span class="sd">        :type gspace: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__gspaceindex</span> <span class="o">=</span> <span class="n">gindex</span>

<div class="viewcode-block" id="QROIProjToolWidget.updateGeometryTip"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.toolWidget.QROIProjToolWidget.updateGeometryTip">[docs]</a>    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">updateGeometryTip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; update geometry tips</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tipmessage</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwidget</span><span class="o">.</span><span class="n">updateDisplayedTextTip</span><span class="p">(</span>
            <span class="s2">&quot;coordinate info display for the mouse pointer</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span>
            <span class="o">%</span> <span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">angleqPushButton</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
            <span class="s2">&quot;Input physical parameters</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">angleqComboBox</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
            <span class="s2">&quot;Select the display space</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">toolLabel</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
            <span class="s2">&quot;coordinate info display for the mouse pointer</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">message</span><span class="p">)</span></div></div>


<span class="c1">#: ( :obj:`dict` &lt; :obj:`str`, any &gt; ) tool widget properties</span>
<span class="n">twproperties</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">nm</span> <span class="ow">in</span> <span class="n">__all__</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">nm</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;ToolWidget&quot;</span><span class="p">):</span>
        <span class="n">cl</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()[</span><span class="n">nm</span><span class="p">]</span>
        <span class="n">twproperties</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s1">&#39;alias&#39;</span><span class="p">:</span> <span class="n">cl</span><span class="o">.</span><span class="n">alias</span><span class="p">,</span>
                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">cl</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s1">&#39;widget&#39;</span><span class="p">:</span> <span class="n">nm</span><span class="p">,</span>
                <span class="s1">&#39;requires&#39;</span><span class="p">:</span> <span class="n">cl</span><span class="o">.</span><span class="n">requires</span><span class="p">,</span>
            <span class="p">})</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">LaVue 2.83.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">lavuelib.toolWidget</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017 DESY, Jan Kotanski &lt;jkotan@mail.desy.de&gt;, Christoph Rosemann &lt;christoph.rosemann@desy.de&gt; 

GNU GENERAL PUBLIC LICENSE, version 2.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.3.2.
    </div>
  </body>
</html>