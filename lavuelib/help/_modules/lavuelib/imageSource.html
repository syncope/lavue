

<!doctype html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>lavuelib.imageSource &#8212; LaVue 2.83.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/bizstyle.css" />
    
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">LaVue 2.83.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">lavuelib.imageSource</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for lavuelib.imageSource</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (C) 2017  DESY, Christoph Rosemann, Notkestr. 85, D-22607 Hamburg</span>
<span class="c1">#</span>
<span class="c1"># lavue is an image viewing program for photon science imaging detectors.</span>
<span class="c1"># Its usual application is as a live viewer using hidra as data source.</span>
<span class="c1">#</span>
<span class="c1"># This program is free software; you can redistribute it and/or</span>
<span class="c1"># modify it under the terms of the GNU General Public License</span>
<span class="c1"># as published by the Free Software Foundation in  version 2</span>
<span class="c1"># of the License.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with this program; if not, write to the Free Software</span>
<span class="c1"># Foundation, Inc., 51 Franklin Street, Fifth Floor,</span>
<span class="c1"># Boston, MA  02110-1301, USA.</span>
<span class="c1">#</span>
<span class="c1"># Authors:</span>
<span class="c1">#     Christoph Rosemann &lt;christoph.rosemann@desy.de&gt;</span>
<span class="c1">#     Jan Kotanski &lt;jan.kotanski@desy.de&gt;</span>
<span class="c1">#     Andre Rothkirch &lt;andre.rothkirch@desy.de&gt;</span>
<span class="c1">#</span>

<span class="sd">&quot;&quot;&quot; set of image sources &quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">pyqtgraph</span> <span class="kn">import</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtGui</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">dataFetchThread</span>
<span class="kn">from</span> <span class="nn">.sardanaUtils</span> <span class="kn">import</span> <span class="n">debugmethod</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">requests</span>
    <span class="c1">#: (:obj:`bool`) requests imported</span>
    <span class="n">REQUESTS</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="c1">#: (:obj:`bool`) requests imported</span>
    <span class="n">REQUESTS</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">hidra</span>
    <span class="c1">#: (:obj:`bool`) hidra imported</span>
    <span class="n">HIDRA</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="c1">#: (:obj:`bool`) hidra imported</span>
    <span class="n">HIDRA</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">asapo_consumer</span>
    <span class="c1">#: (:obj:`bool`) asapo imported</span>
    <span class="n">ASAPO</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="c1">#: (:obj:`bool`) asapo imported</span>
    <span class="n">ASAPO</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">try</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">tango</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">PyTango</span> <span class="k">as</span> <span class="nn">tango</span>
    <span class="c1">#: (:obj:`bool`) tango imported</span>
    <span class="n">TANGO</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="c1">#: (:obj:`bool`) tango imported</span>
    <span class="n">TANGO</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">try</span><span class="p">:</span>
    <span class="nb">__import__</span><span class="p">(</span><span class="s2">&quot;pyFAI&quot;</span><span class="p">)</span>
    <span class="c1">#: (:obj:`bool`) pyFAI imported</span>
    <span class="n">PYFAI</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="c1">#: (:obj:`bool`) pyFAI imported</span>
    <span class="n">PYFAI</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pydoocs</span>
    <span class="c1">#: (:obj:`bool`) pydoocs imported</span>
    <span class="n">PYDOOCS</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="c1">#: (:obj:`bool`) pydoocs imported</span>
    <span class="n">PYDOOCS</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">PIL</span>
    <span class="kn">import</span> <span class="nn">PIL.Image</span>
    <span class="c1">#: (:obj:`bool`) PIL imported</span>
    <span class="n">PILLOW</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="c1">#: (:obj:`bool`) PIL imported</span>
    <span class="n">PILLOW</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">zmq</span>
    <span class="c1">#: (:obj:`str`,:obj:`str`) zmq major version, zmq minor version</span>
    <span class="n">ZMQMAJOR</span><span class="p">,</span> <span class="n">ZMQMINOR</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
        <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">zmq</span><span class="o">.</span><span class="n">zmq_version</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)))[:</span><span class="mi">2</span><span class="p">])</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="c1">#: (:obj:`str`,:obj:`str`) zmq major version, zmq minor version</span>
    <span class="n">ZMQMAJOR</span><span class="p">,</span> <span class="n">ZMQMINOR</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">epics</span>
    <span class="c1">#: (:obj:`bool`) pyepics imported</span>
    <span class="n">PYEPICS</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="c1">#: (:obj:`bool`) pyepics imported</span>
    <span class="n">PYEPICS</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">PyTine</span>
    <span class="c1">#: (:obj:`bool`) PyTine imported</span>
    <span class="n">PyTine</span><span class="o">.</span><span class="n">get</span>
    <span class="n">PYTINE</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="c1">#: (:obj:`bool`) PyTine imported</span>
    <span class="n">PYTINE</span> <span class="o">=</span> <span class="kc">False</span>
<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
    <span class="c1">#: (:obj:`bool`) PyTine imported</span>
    <span class="n">PYTINE</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">fabio</span>
    <span class="c1">#: (:obj:`bool`) fabio can be imported</span>
    <span class="n">fbmj</span><span class="p">,</span> <span class="n">fbmn</span><span class="p">,</span> <span class="n">fbpa</span> <span class="o">=</span> <span class="n">fabio</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
    <span class="n">fmj</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fbmj</span><span class="p">)</span>
    <span class="n">fmn</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fbmn</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fmj</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">fmn</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">FABIO11</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">FABIO11</span> <span class="o">=</span> <span class="kc">False</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">FABIO11</span> <span class="o">=</span> <span class="kc">False</span>

<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">pytz</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">cPickle</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">_pickle</span> <span class="k">as</span> <span class="nn">cPickle</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">imageFileHandler</span>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
    <span class="n">buffer</span> <span class="o">=</span> <span class="nb">memoryview</span>
    <span class="n">unicode</span> <span class="o">=</span> <span class="nb">str</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">bytes</span> <span class="o">=</span> <span class="nb">str</span>


<span class="n">globalmutex</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutex</span><span class="p">()</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;lavue&quot;</span><span class="p">)</span>

<span class="c1">#: (:obj:`bool`) PyTango bug #213 flag related to EncodedAttributes in python3</span>
<span class="n">PYTG_BUG_213</span> <span class="o">=</span> <span class="kc">False</span>
<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">PYTGMAJOR</span><span class="p">,</span> <span class="n">PYTGMINOR</span><span class="p">,</span> <span class="n">PYTGPATCH</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">tango</span><span class="o">.</span><span class="n">__version__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[:</span><span class="mi">3</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">PYTGMAJOR</span> <span class="o">&lt;=</span> <span class="mi">9</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">PYTGMAJOR</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">PYTGMINOR</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">PYTG_BUG_213</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="n">PYTGMINOR</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">PYTGPATCH</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">PYTG_BUG_213</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">PYTG_BUG_213</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>


<div class="viewcode-block" id="getLevel"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.getLevel">[docs]</a><span class="k">def</span> <span class="nf">getLevel</span><span class="p">(</span><span class="n">elevel</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; get log level in string</span>

<span class="sd">    :param elevel: effective log level</span>
<span class="sd">    :type elevel: :obj:`int`</span>
<span class="sd">    :returns:  log level in string</span>
<span class="sd">    :rtype: :obj:`str`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">elevel</span> <span class="o">=</span> <span class="n">elevel</span> <span class="ow">or</span> <span class="n">logger</span><span class="o">.</span><span class="n">getEffectiveLevel</span><span class="p">()</span>
    <span class="n">lmap</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;debug&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
        <span class="s2">&quot;info&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span>
        <span class="s2">&quot;warning&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">21</span><span class="p">,</span> <span class="mi">30</span><span class="p">],</span>
        <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">31</span><span class="p">,</span> <span class="mi">40</span><span class="p">],</span>
        <span class="s2">&quot;critical&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">41</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
    <span class="p">}</span>
    <span class="n">dname</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">vl</span> <span class="ow">in</span> <span class="n">lmap</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">vl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">elevel</span> <span class="ow">and</span> <span class="n">elevel</span> <span class="o">&lt;=</span> <span class="n">vl</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">dname</span> <span class="o">=</span> <span class="n">name</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="n">dname</span></div>


<div class="viewcode-block" id="tobytes"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.tobytes">[docs]</a><span class="k">def</span> <span class="nf">tobytes</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; decode str to bytes</span>

<span class="sd">    :param x: string</span>
<span class="sd">    :type x: :obj:`str`</span>
<span class="sd">    :returns:  decode string in byte array</span>
<span class="sd">    :rtype: :obj:`bytes`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
        <span class="k">return</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div>


<div class="viewcode-block" id="currenttime"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.currenttime">[docs]</a><span class="k">def</span> <span class="nf">currenttime</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; provides current time in iso format</span>

<span class="sd">    :returns:  current time in iso format</span>
<span class="sd">    :rtype: :obj:`str`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># does not work on py2 and old py3</span>
    <span class="c1"># return datetime.datetime.utcnow().astimezone().isoformat()</span>
    <span class="n">tzone</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">tzname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">tz</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">tzone</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">tzlocal</span>
        <span class="n">tz</span> <span class="o">=</span> <span class="n">tzlocal</span><span class="o">.</span><span class="n">get_localzone</span><span class="p">()</span>
    <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S.</span><span class="si">%f</span><span class="s1">%z&#39;</span>
    <span class="n">starttime</span> <span class="o">=</span> <span class="n">tz</span><span class="o">.</span><span class="n">localize</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">starttime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">fmt</span><span class="p">))</span></div>


<div class="viewcode-block" id="tostr"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.tostr">[docs]</a><span class="k">def</span> <span class="nf">tostr</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; decode bytes to str</span>

<span class="sd">    :param x: string</span>
<span class="sd">    :type x: :obj:`bytes`</span>
<span class="sd">    :returns:  decode string in byte array</span>
<span class="sd">    :rtype: :obj:`str`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div>


<div class="viewcode-block" id="BaseSource"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.BaseSource">[docs]</a><span class="k">class</span> <span class="nc">BaseSource</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; source base class&quot;&quot;&quot;</span>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param timeout: timeout for setting connection in ms</span>
<span class="sd">        :type timeout: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#: (:obj:`int`) timeout in ms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span> <span class="o">=</span> <span class="n">timeout</span>
        <span class="c1">#: (:obj:`str`) configuration string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`bool`) connection initiated  flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initiated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#: (:obj:`int`) internal counter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">#: (:obj:`str`) errormessage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errormessage</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="c1">#: (:obj:`list` &lt;:obj:`numpy.ndarray`&gt;) list of test images</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__images</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#: (:obj:`int` &lt;&gt;) a number of test images</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__isize</span> <span class="o">=</span> <span class="mi">11</span>

<div class="viewcode-block" id="BaseSource.getMetaData"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.BaseSource.getMetaData">[docs]</a>    <span class="k">def</span> <span class="nf">getMetaData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; get metadata</span>

<span class="sd">        :returns: dictionary with metadata</span>
<span class="sd">        :rtype: :obj:`dict` &lt;:obj:`str`, :obj:`any`&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="BaseSource.setConfiguration"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.BaseSource.setConfiguration">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">setConfiguration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set configuration</span>

<span class="sd">        :param configuration:  configuration string</span>
<span class="sd">        :type configuration: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span> <span class="o">!=</span> <span class="n">configuration</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span> <span class="o">=</span> <span class="n">configuration</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initiated</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="BaseSource.setTimeOut"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.BaseSource.setTimeOut">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">setTimeOut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set timeout</span>

<span class="sd">        :param timeout: timeout in ms</span>
<span class="sd">        :type timeout: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span> <span class="o">=</span> <span class="n">timeout</span></div>

<div class="viewcode-block" id="BaseSource.getData"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.BaseSource.getData">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">getData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides image name, image data and metadata</span>

<span class="sd">        :returns:  image name, image data, json dictionary with metadata</span>
<span class="sd">        :rtype: (:obj:`str` , :class:`numpy.ndarray` , :obj:`str`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># if self.__counter % 20 == 0:</span>
        <span class="c1">#     return str(&quot;Test error&quot;), &quot;__ERROR__&quot;, &quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__images</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__isize</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span>
                            <span class="mi">1001</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">256</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int16&#39;</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__images</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__counter</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__isize</span><span class="p">],</span>
                <span class="s1">&#39;__random_</span><span class="si">%s</span><span class="s1">__&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__counter</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseSource.connect"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.BaseSource.connect">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; connects the source</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initiated</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__images</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="BaseSource.disconnect"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.BaseSource.disconnect">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; disconnects the source</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span></div>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">_updaterror</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; updates error  message</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">traceback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errormessage</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span></div>


<div class="viewcode-block" id="FixTestSource"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.FixTestSource">[docs]</a><span class="k">class</span> <span class="nc">FixTestSource</span><span class="p">(</span><span class="n">BaseSource</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; image source as Tango attributes describing</span>
<span class="sd">        an image file name and its directory&quot;&quot;&quot;</span>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param timeout: timeout for setting connection in ms</span>
<span class="sd">        :type timeout: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">BaseSource</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>
        <span class="c1">#: (:obj:`int`) internal counter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__counter</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1">#: ([:obj:`int`, :obj:`int`]) image shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__shape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2048</span><span class="p">,</span> <span class="mi">4096</span><span class="p">]</span>
        <span class="c1"># self.__shape = [256, 512]</span>
        <span class="c1"># self.__shape = [1024, 2048]</span>

        <span class="c1">#: (:class:`numpy,ndarray`) index object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="p">])</span>

<div class="viewcode-block" id="FixTestSource.getData"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.FixTestSource.getData">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">getData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides image name, image data and metadata</span>

<span class="sd">        :returns:  image name, image data, json dictionary with metadata</span>
<span class="sd">        :rtype: (:obj:`str` , :class:`numpy.ndarray` , :obj:`str`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__image</span><span class="p">,</span>
                <span class="s1">&#39;__random_</span><span class="si">%s</span><span class="s1">__&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__counter</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="FixTestSource.connect"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.FixTestSource.connect">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; connects the source</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initiated</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="FixTestSource.disconnect"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.FixTestSource.disconnect">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; disconnects the source</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span></div></div>


<div class="viewcode-block" id="NXSFileSource"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.NXSFileSource">[docs]</a><span class="k">class</span> <span class="nc">NXSFileSource</span><span class="p">(</span><span class="n">BaseSource</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; image source as Tango attributes describing</span>
<span class="sd">        an image file name and its directory&quot;&quot;&quot;</span>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param timeout: timeout for setting connection in ms</span>
<span class="sd">        :type timeout: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">BaseSource</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>

        <span class="c1">#: (:obj:`str`) nexus file name with the full path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__nxsfile</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`str`) nexus field path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__nxsfield</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`int`) stacking dimension</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__gdim</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">#: (:obj:`int`) the current frame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__frame</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">#: (:obj:`int`) the last frame to view</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lastframe</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="c1">#: (:class:`lavuelib.imageFileHandler.NexusFieldHandler`)</span>
        <span class="c1">#: the nexus file handler</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__handler</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:class:`lavuelib.filewriter.FTField`) field object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__node</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`bool`) nexus file source keeps the file open</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__nxsopen</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#: (:obj:`bool`) nexus file source starts from the last image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__nxslast</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="NXSFileSource.setConfiguration"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.NXSFileSource.setConfiguration">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">setConfiguration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set configuration</span>

<span class="sd">        :param configuration:  configuration string</span>
<span class="sd">        :type configuration: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span> <span class="o">!=</span> <span class="n">configuration</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span> <span class="o">=</span> <span class="n">configuration</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initiated</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">params</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="n">configuration</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__lastframe</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__lastframe</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span></div>

<div class="viewcode-block" id="NXSFileSource.getData"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.NXSFileSource.getData">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">getData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides image name, image data and metadata</span>

<span class="sd">        :returns:  image name, image data, json dictionary with metadata</span>
<span class="sd">        :rtype: (:obj:`str` , :class:`numpy.ndarray` , :obj:`str`)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__nxsfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;No file name defined&quot;</span><span class="p">,</span> <span class="s2">&quot;__ERROR__&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__handler</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__handler</span> <span class="o">=</span> <span class="n">imageFileHandler</span><span class="o">.</span><span class="n">NexusFieldHandler</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__nxsfile</span><span class="p">))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__handler</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__nxsfield</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__handler</span><span class="o">.</span><span class="n">getMetaData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__node</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                        <span class="n">metadata</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="c1"># if metadata:</span>
                    <span class="c1">#     print(&quot;IMAGE Metadata = %s&quot; % str(metadata))</span>
                <span class="n">fid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__handler</span><span class="o">.</span><span class="n">getFrameCount</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__gdim</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastframe</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">fid</span> <span class="o">&gt;</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastframe</span><span class="p">:</span>
                        <span class="n">fid</span> <span class="o">-=</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastframe</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">fid</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">fid</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">fid</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastframe</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">fid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastframe</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__nxslast</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">fid</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__frame</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__frame</span> <span class="o">=</span> <span class="n">fid</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">fid</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__frame</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__frame</span> <span class="o">=</span> <span class="n">fid</span> <span class="o">-</span> <span class="mi">1</span>

                <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__handler</span><span class="o">.</span><span class="n">getImage</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__gdim</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__nxsopen</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__handler</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__node</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__node</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__node</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__nxsfile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__nxsfield</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__frame</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__frame</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">image</span><span class="p">),</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="n">metadata</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__handler</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__node</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__node</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__node</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="c1"># print(str(e))</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="s2">&quot;__ERROR__&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="NXSFileSource.connect"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.NXSFileSource.connect">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; connects the source</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__handler</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__node</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__nxsfile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__nxsfield</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">growdim</span><span class="p">,</span> \
                <span class="n">nxsopen</span><span class="p">,</span> <span class="n">nxslast</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__lastframe</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__lastframe</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastframe</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__frame</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__gdim</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">growdim</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__gdim</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">nxsopen</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;false&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__nxsopen</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__nxsopen</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">nxslast</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;false&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__nxslast</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__nxslast</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="c1"># print(str(e))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_updaterror</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="NXSFileSource.disconnect"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.NXSFileSource.disconnect">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; disconnects the source</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__handler</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__node</span> <span class="o">=</span> <span class="kc">None</span></div></div>


<div class="viewcode-block" id="TangoFileSource"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.TangoFileSource">[docs]</a><span class="k">class</span> <span class="nc">TangoFileSource</span><span class="p">(</span><span class="n">BaseSource</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; image source as Tango attributes describing</span>
<span class="sd">        an image file name and its directory&quot;&quot;&quot;</span>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param timeout: timeout for setting connection in ms</span>
<span class="sd">        :type timeout: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">BaseSource</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>
        <span class="c1">#: (:class`tango.AttributeProxy`:)</span>
        <span class="c1">#:       device proxy for the image file name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__fproxy</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:class`tango.AttributeProxy`:)</span>
        <span class="c1">#:      device proxy for the image directory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dproxy</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:dict: &lt;:obj:`str`, :obj:`str`&gt;)</span>
        <span class="c1">#:      translation dictionary for the image directory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dirtrans</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;/ramdisk/&quot;</span><span class="p">:</span> <span class="s2">&quot;/gpfs/&quot;</span><span class="p">}</span>
        <span class="c1">#: (:obj:`str`) nexus file name with the full path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__nxsfile</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`str`) nexus field path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__nxsfield</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`int`) stacking dimension</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__gdim</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">#: (:obj:`int`) the current frame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__frame</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">#: (:obj:`int`) the last frame to view</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lastframe</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="c1">#: (:class:`lavuelib.imageFileHandler.NexusFieldHandler`)</span>
        <span class="c1">#: the nexus file handler</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__handler</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:class:`lavuelib.filewriter.FTField`) field object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__node</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`bool`) nexus file source keeps the file open</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__nxsopen</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#: (:obj:`bool`) nexus file source starts from the last image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__nxslast</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#: (:obj:`list`) list of supported scheme</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__schema</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;file:/localhost//&quot;</span><span class="p">,</span> <span class="s2">&quot;file:////&quot;</span><span class="p">,</span> <span class="s2">&quot;file:///&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;file://&quot;</span><span class="p">,</span> <span class="s2">&quot;file:/&quot;</span><span class="p">]</span>

<div class="viewcode-block" id="TangoFileSource.getData"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.TangoFileSource.getData">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">getData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides image name, image data and metadata</span>

<span class="sd">        :returns:  image name, image data, json dictionary with metadata</span>
<span class="sd">        :rtype: (:obj:`str` , :class:`numpy.ndarray` , :obj:`str`)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__fproxy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;No file attribute defined&quot;</span><span class="p">,</span> <span class="s2">&quot;__ERROR__&quot;</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">scheme</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__fproxy</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">value</span>
            <span class="k">for</span> <span class="n">sm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__schema</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">sm</span><span class="p">):</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="p">[(</span><span class="nb">len</span><span class="p">(</span><span class="n">sm</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):]</span>
                    <span class="n">scheme</span> <span class="o">=</span> <span class="s2">&quot;file&quot;</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">scheme</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">sm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__schema</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;h5&quot;</span> <span class="o">+</span> <span class="n">sm</span><span class="p">):</span>
                        <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="p">[(</span><span class="nb">len</span><span class="p">(</span><span class="n">sm</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):]</span>
                        <span class="n">scheme</span> <span class="o">=</span> <span class="s2">&quot;h5file&quot;</span>
                        <span class="k">break</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dproxy</span><span class="p">:</span>
                <span class="n">dattr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dproxy</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">value</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dattr</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">sm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__schema</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">sm</span><span class="p">):</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="p">[(</span><span class="nb">len</span><span class="p">(</span><span class="n">sm</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):]</span>
                    <span class="n">scheme</span> <span class="o">=</span> <span class="s2">&quot;file&quot;</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">scheme</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">sm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__schema</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;h5&quot;</span> <span class="o">+</span> <span class="n">sm</span><span class="p">):</span>
                        <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="p">[(</span><span class="nb">len</span><span class="p">(</span><span class="n">sm</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):]</span>
                        <span class="n">scheme</span> <span class="o">=</span> <span class="s2">&quot;h5file&quot;</span>
                        <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">scheme</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">sm</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;http://&quot;</span><span class="p">,</span> <span class="s2">&quot;https://&quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">sm</span><span class="p">):</span>
                        <span class="n">scheme</span> <span class="o">=</span> <span class="s2">&quot;httplink&quot;</span>
                        <span class="k">break</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dirtrans</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">]:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;TangoFileSource: File name not defined&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">scheme</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;h5file&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="s2">&quot;::&quot;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
                    <span class="n">nxsfile</span><span class="p">,</span> <span class="n">nxsfield</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;::&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">nxsfield</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">nxsfile</span> <span class="o">=</span> <span class="n">filename</span>
                <span class="k">if</span> <span class="n">nxsfile</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__nxsfile</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__nxsfile</span> <span class="o">=</span> <span class="n">nxsfile</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__handler</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">nxsfield</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__nxsfield</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__nxsfield</span> <span class="o">=</span> <span class="n">nxsfield</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__node</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="n">image</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">metadata</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__handler</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__handler</span> <span class="o">=</span> <span class="n">imageFileHandler</span><span class="o">.</span><span class="n">NexusFieldHandler</span><span class="p">(</span>
                            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__nxsfile</span><span class="p">))</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__handler</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__nxsfield</span><span class="p">)</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__handler</span><span class="o">.</span><span class="n">getMetaData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__node</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                            <span class="n">metadata</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                        <span class="c1"># if metadata:</span>
                        <span class="c1">#     print(&quot;IMAGE Metadata = %s&quot; % str(metadata))</span>
                    <span class="n">fid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__handler</span><span class="o">.</span><span class="n">getFrameCount</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__gdim</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastframe</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">fid</span> <span class="o">&gt;</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastframe</span><span class="p">:</span>
                            <span class="n">fid</span> <span class="o">-=</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastframe</span> <span class="o">-</span> <span class="mi">1</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">fid</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">fid</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">fid</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastframe</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">fid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastframe</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__nxslast</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">fid</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__frame</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__frame</span> <span class="o">=</span> <span class="n">fid</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">fid</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__frame</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__frame</span> <span class="o">=</span> <span class="n">fid</span> <span class="o">-</span> <span class="mi">1</span>

                    <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__handler</span><span class="o">.</span><span class="n">getImage</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__gdim</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__nxsopen</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__handler</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__node</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__node</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__node</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__nxsfile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__nxsfield</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__frame</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__frame</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">image</span><span class="p">),</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="n">metadata</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">scheme</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;httplink&quot;</span><span class="p">]:</span>
                <span class="n">httpSource</span> <span class="o">=</span> <span class="n">HTTPSource</span><span class="p">()</span>
                <span class="n">httpSource</span><span class="o">.</span><span class="n">setConfiguration</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">httpSource</span><span class="o">.</span><span class="n">getData</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__resetnexus</span><span class="p">()</span>
                <span class="n">fh</span> <span class="o">=</span> <span class="n">imageFileHandler</span><span class="o">.</span><span class="n">ImageFileHandler</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
                <span class="n">image</span> <span class="o">=</span> <span class="n">fh</span><span class="o">.</span><span class="n">getImage</span><span class="p">()</span>
                <span class="n">mdata</span> <span class="o">=</span> <span class="n">fh</span><span class="o">.</span><span class="n">getMetaData</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
                    <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">image</span><span class="p">),</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="n">mdata</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;no successful acquisition done so far&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;TangoFileSource: &quot;</span>
                               <span class="s2">&quot;no successful acquisition done so far&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="s2">&quot;no successful acquisition done&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;TangoFileSource: no acquisition done&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="c1"># print(str(e))</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="s2">&quot;__ERROR__&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span></div>

    <span class="k">def</span> <span class="nf">__resetnexus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; resets nexus variables&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__nxsfile</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__nxsfield</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__gdim</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__frame</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lastframe</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__handler</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__node</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># self.__nxsopen = False</span>
        <span class="c1"># self.__nxslast = False</span>

<div class="viewcode-block" id="TangoFileSource.connect"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.TangoFileSource.connect">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; connects the source</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__resetnexus</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fattr</span><span class="p">,</span> <span class="n">dattr</span><span class="p">,</span> <span class="n">dirtrans</span><span class="p">,</span> <span class="n">nxsopen</span><span class="p">,</span> <span class="n">nxslast</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dirtrans</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">dirtrans</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initiated</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__fproxy</span> <span class="o">=</span> <span class="n">tango</span><span class="o">.</span><span class="n">AttributeProxy</span><span class="p">(</span><span class="n">fattr</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dattr</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__dproxy</span> <span class="o">=</span> <span class="n">tango</span><span class="o">.</span><span class="n">AttributeProxy</span><span class="p">(</span><span class="n">dattr</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__dproxy</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">nxsopen</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;false&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__nxsopen</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__nxsopen</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">nxslast</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;false&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__nxslast</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__nxslast</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_updaterror</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="c1"># print(str(e))</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="TangoFileSource.disconnect"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.TangoFileSource.disconnect">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; disconnects the source</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__resetnexus</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="VDEOdecoder"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.VDEOdecoder">[docs]</a><span class="k">class</span> <span class="nc">VDEOdecoder</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; VIDEO IMAGE LIMA decoder</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :brief: It clears the local variables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#: (:obj:`str`) decoder name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;LIMA_VIDEO_IMAGE&quot;</span>
        <span class="c1">#: (:obj:`str`) decoder format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`str`) data type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#: (:class:`numpy.ndarray`) image data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: ([:obj:`str`, :obj:`str`]) header and image data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`str`) struct header format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__headerFormat</span> <span class="o">=</span> <span class="s1">&#39;!IHHqiiHHHH&#39;</span>
        <span class="c1">#: (:obj:`dict` &lt;:obj:`str`, :obj:`any` &gt; ) header data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__header</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1">#: (:obj:`dict` &lt;:obj:`int`, :obj:`str` &gt; ) format modes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__formatID</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;Q&#39;</span><span class="p">}</span>
        <span class="c1">#: (:obj:`dict` &lt;:obj:`int`, :obj:`str` &gt; ) dtype modes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dtypeID</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;uint8&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;uint16&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;uint32&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;uint64&#39;</span><span class="p">}</span>

    <span class="c1"># @debugmethod</span>
<div class="viewcode-block" id="VDEOdecoder.load"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.VDEOdecoder.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  loads encoded data</span>

<span class="sd">        :param data: encoded data</span>
<span class="sd">        :type data: [:obj:`str`, :obj:`str`]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;lavuelib.imageSource.VDEOdecoder.load:  </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loadHeader</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__headerFormat</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__value</span> <span class="o">=</span> <span class="kc">None</span></div>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">_loadHeader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">headerData</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; loads the image header</span>

<span class="sd">        :param headerData: buffer with header data</span>
<span class="sd">        :type headerData: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hdr</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__headerFormat</span><span class="p">,</span> <span class="n">headerData</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__header</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">[</span><span class="s1">&#39;magic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hdr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">[</span><span class="s1">&#39;headerVersion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hdr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">[</span><span class="s1">&#39;imageMode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hdr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">[</span><span class="s1">&#39;frameNumber&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hdr</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hdr</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hdr</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">[</span><span class="s1">&#39;endianness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hdr</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">[</span><span class="s1">&#39;headerSize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hdr</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">[</span><span class="s1">&#39;padding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hdr</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dtypeID</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">[</span><span class="s1">&#39;imageMode&#39;</span><span class="p">]]</span>

<div class="viewcode-block" id="VDEOdecoder.shape"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.VDEOdecoder.shape">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides the data shape</span>

<span class="sd">        :returns: the data shape if data was loaded</span>
<span class="sd">        :rtype: :obj:`list` &lt;:obj:`int` &gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">]]</span></div>

<div class="viewcode-block" id="VDEOdecoder.frameNumber"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.VDEOdecoder.frameNumber">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">frameNumber</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides the frame number</span>

<span class="sd">        :returns: the frame number</span>
<span class="sd">        :rtype: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;frameNumber&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">[</span><span class="s1">&#39;frameNumber&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="VDEOdecoder.decode"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.VDEOdecoder.decode">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides the decoded data</span>

<span class="sd">        :returns: the decoded data if data was loaded</span>
<span class="sd">        :rtype: :class:`numpy.ndarray`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__header</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__headerFormat</span><span class="p">):]</span>
            <span class="n">dformat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__formatID</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">[</span><span class="s1">&#39;imageMode&#39;</span><span class="p">]]</span>
            <span class="n">fSize</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="n">dformat</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">dformat</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="p">)</span> <span class="o">//</span> <span class="n">fSize</span><span class="p">),</span> <span class="n">image</span><span class="p">),</span>
                <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">())</span>
            <span class="n">fendian</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">[</span><span class="s1">&#39;endianness&#39;</span><span class="p">]</span>
            <span class="n">lendian</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;=H&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">fendian</span> <span class="o">!=</span> <span class="n">lendian</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__value</span><span class="o">.</span><span class="n">byteswap</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__value</span><span class="o">.</span><span class="n">byteswap</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__value</span></div></div>


<div class="viewcode-block" id="DATAARRAYdecoder"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.DATAARRAYdecoder">[docs]</a><span class="k">class</span> <span class="nc">DATAARRAYdecoder</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; DATA ARRAY LIMA decoder</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :brief: It clears the local variables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#: (:obj:`str`) decoder name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;DATA_ARRAY&quot;</span>
        <span class="c1">#: (:obj:`str`) decoder format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`str`) data type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#: (:class:`numpy.ndarray`) image data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: ([:obj:`str`, :obj:`str`]) header and image data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`str`) struct header format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__headerFormat</span> <span class="o">=</span> <span class="s1">&#39;&lt;IHHIIHHHHHHHHIIIIIIII&#39;</span>
        <span class="c1">#: (:obj:`dict` &lt;:obj:`str`, :obj:`any` &gt; ) header data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__header</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1">#: (:obj:`dict` &lt;:obj:`int`, :obj:`str` &gt; ) format modes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__formatID</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;Q&#39;</span><span class="p">,</span>
            <span class="mi">4</span><span class="p">:</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">:</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">:</span> <span class="s1">&#39;q&#39;</span><span class="p">,</span>
            <span class="mi">8</span><span class="p">:</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="mi">9</span><span class="p">:</span> <span class="s1">&#39;d&#39;</span>
        <span class="p">}</span>
        <span class="c1">#: (:obj:`dict` &lt;:obj:`int`, :obj:`str` &gt; ) dtype modes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dtypeID</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;uint8&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;uint16&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;uint32&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;uint64&#39;</span><span class="p">,</span>
            <span class="mi">4</span><span class="p">:</span> <span class="s1">&#39;int8&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="s1">&#39;int16&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">:</span> <span class="s1">&#39;int32&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">:</span> <span class="s1">&#39;int64&#39;</span><span class="p">,</span>
            <span class="mi">8</span><span class="p">:</span> <span class="s1">&#39;float32&#39;</span><span class="p">,</span> <span class="mi">9</span><span class="p">:</span> <span class="s1">&#39;float64&#39;</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="c1"># @debugmethod</span>
<div class="viewcode-block" id="DATAARRAYdecoder.load"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.DATAARRAYdecoder.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  loads encoded data</span>

<span class="sd">        :param data: encoded data</span>
<span class="sd">        :type data: [:obj:`str`, :obj:`str`]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;lavuelib.imageSource.DATAARRAYdecoder.load:  </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loadHeader</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__headerFormat</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__value</span> <span class="o">=</span> <span class="kc">None</span></div>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">_loadHeader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">headerData</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; loads the image header</span>

<span class="sd">        :param headerData: buffer with header data</span>
<span class="sd">        :type headerData: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hdr</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__headerFormat</span><span class="p">,</span> <span class="n">headerData</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__header</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">[</span><span class="s1">&#39;magic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hdr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">[</span><span class="s1">&#39;headerVersion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hdr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">[</span><span class="s1">&#39;headerSize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hdr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hdr</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">[</span><span class="s1">&#39;imageMode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hdr</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">[</span><span class="s1">&#39;endianness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hdr</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">[</span><span class="s1">&#39;dim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hdr</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">[</span><span class="s1">&#39;shape&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">hdr</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">hdr</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">hdr</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">hdr</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">hdr</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="n">hdr</span><span class="p">[</span><span class="mi">12</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">[</span><span class="s1">&#39;steps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">hdr</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="n">hdr</span><span class="p">[</span><span class="mi">14</span><span class="p">],</span> <span class="n">hdr</span><span class="p">[</span><span class="mi">15</span><span class="p">],</span> <span class="n">hdr</span><span class="p">[</span><span class="mi">16</span><span class="p">],</span> <span class="n">hdr</span><span class="p">[</span><span class="mi">17</span><span class="p">],</span> <span class="n">hdr</span><span class="p">[</span><span class="mi">18</span><span class="p">]]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">[</span><span class="s1">&#39;padding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hdr</span><span class="p">[</span><span class="mi">19</span><span class="p">:]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dtypeID</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">[</span><span class="s1">&#39;imageMode&#39;</span><span class="p">]]</span>

<div class="viewcode-block" id="DATAARRAYdecoder.frameNumber"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.DATAARRAYdecoder.frameNumber">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">frameNumber</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; no data &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="DATAARRAYdecoder.shape"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.DATAARRAYdecoder.shape">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides the data shape</span>

<span class="sd">        :returns: the data shape if data was loaded</span>
<span class="sd">        :rtype: :obj:`list` &lt;:obj:`int` &gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">[</span><span class="s1">&#39;shape&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                 <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">[</span><span class="s1">&#39;dim&#39;</span><span class="p">])]))</span></div>

<div class="viewcode-block" id="DATAARRAYdecoder.steps"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.DATAARRAYdecoder.steps">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">steps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides the data steps</span>

<span class="sd">        :returns: the data steps if data was loaded</span>
<span class="sd">        :rtype: :obj:`list` &lt;:obj:`int` &gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">[</span><span class="s1">&#39;steps&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                 <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">[</span><span class="s1">&#39;dim&#39;</span><span class="p">])]))</span></div>

<div class="viewcode-block" id="DATAARRAYdecoder.decode"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.DATAARRAYdecoder.decode">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides the decoded data</span>

<span class="sd">        :returns: the decoded data if data was loaded</span>
<span class="sd">        :rtype: :class:`numpy.ndarray`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__header</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__headerFormat</span><span class="p">):]</span>
            <span class="n">dformat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__formatID</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">[</span><span class="s1">&#39;imageMode&#39;</span><span class="p">]]</span>
            <span class="n">fSize</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="n">dformat</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">dformat</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="p">)</span> <span class="o">//</span> <span class="n">fSize</span><span class="p">),</span> <span class="n">image</span><span class="p">),</span>
                <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">())</span>
            <span class="n">fendian</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">[</span><span class="s1">&#39;endianness&#39;</span><span class="p">]</span>
            <span class="n">lendian</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;=H&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">fendian</span> <span class="o">!=</span> <span class="n">lendian</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__value</span><span class="o">.</span><span class="n">byteswap</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__value</span><span class="o">.</span><span class="n">byteswap</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__value</span></div></div>


<div class="viewcode-block" id="TangoAttrSource"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.TangoAttrSource">[docs]</a><span class="k">class</span> <span class="nc">TangoAttrSource</span><span class="p">(</span><span class="n">BaseSource</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; image source as IMAGE Tango attribute</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param timeout: timeout for setting connection in ms</span>
<span class="sd">        :type timeout: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">BaseSource</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>
        <span class="c1">#: (:class`tango.AttributeProxy`:)</span>
        <span class="c1">#:      device proxy for the image attribute</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__aproxy</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:dict: &lt;:obj:`str`, :obj:`any`&gt;)</span>
        <span class="c1">#:      dictionary of external decorders</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__decoders</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;LIMA_VIDEO_IMAGE&quot;</span><span class="p">:</span> <span class="n">VDEOdecoder</span><span class="p">(),</span>
            <span class="s2">&quot;VIDEO_IMAGE&quot;</span><span class="p">:</span> <span class="n">VDEOdecoder</span><span class="p">(),</span>
            <span class="s2">&quot;DATA_ARRAY&quot;</span><span class="p">:</span> <span class="n">DATAARRAYdecoder</span><span class="p">(),</span>
        <span class="p">}</span>
        <span class="c1">#: (:dict: &lt;:obj:`str`, :obj:`str`&gt;)</span>
        <span class="c1">#:      dictionary of tango decorders</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__tangodecoders</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;GRAY16&quot;</span><span class="p">:</span> <span class="s2">&quot;decode_gray16&quot;</span><span class="p">,</span>
            <span class="s2">&quot;GRAY8&quot;</span><span class="p">:</span> <span class="s2">&quot;decode_gray8&quot;</span><span class="p">,</span>
            <span class="s2">&quot;JPEG_GRAY8&quot;</span><span class="p">:</span> <span class="s2">&quot;decode_gray8&quot;</span><span class="p">,</span>
            <span class="s2">&quot;JPEG_RGB&quot;</span><span class="p">:</span> <span class="s2">&quot;decode_rgb32&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RGB24&quot;</span><span class="p">:</span> <span class="s2">&quot;decode_rgb32&quot;</span>
        <span class="p">}</span>
        <span class="c1">#: (:obj:`bool`) bytearray flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__bytearray</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="TangoAttrSource.getData"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.TangoAttrSource.getData">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">getData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides image name, image data and metadata</span>

<span class="sd">        :returns:  image name, image data, json dictionary with metadata</span>
<span class="sd">        :rtype: (:obj:`str` , :class:`numpy.ndarray` , :obj:`str`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aproxy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;No attribute name defined&quot;</span><span class="p">,</span> <span class="s2">&quot;__ERROR__&quot;</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bytearray</span><span class="p">:</span>
                    <span class="n">attr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aproxy</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">attr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aproxy</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
                        <span class="n">extract_as</span><span class="o">=</span><span class="n">tango</span><span class="o">.</span><span class="n">ExtractAs</span><span class="o">.</span><span class="n">ByteArray</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
                    <span class="n">attr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aproxy</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
                        <span class="n">extract_as</span><span class="o">=</span><span class="n">tango</span><span class="o">.</span><span class="n">ExtractAs</span><span class="o">.</span><span class="n">ByteArray</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">type</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;DevEncoded&quot;</span><span class="p">:</span>
                        <span class="n">attr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aproxy</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__bytearray</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">attr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aproxy</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">type</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;DevEncoded&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">PYTG_BUG_213</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                        <span class="s2">&quot;Reading Encoded Attributes for python3 and &quot;</span>
                        <span class="s2">&quot;PyTango &lt; 9.2.5 is not supported&quot;</span><span class="p">)</span>

                <span class="n">avalue</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">value</span>
                <span class="k">if</span> <span class="n">avalue</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;RGB24&quot;</span><span class="p">,</span> <span class="s2">&quot;JPEG_RGB&quot;</span><span class="p">]:</span>
                    <span class="n">image</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QImage</span><span class="o">.</span><span class="n">fromData</span><span class="p">(</span><span class="n">avalue</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">width</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">width</span><span class="p">()</span>
                    <span class="n">height</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">height</span><span class="p">()</span>
                    <span class="n">st</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">bits</span><span class="p">()</span><span class="o">.</span><span class="n">asstring</span><span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="n">height</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
                    <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
                            <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">  (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">time</span><span class="p">)),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">avalue</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tangodecoders</span><span class="p">:</span>
                    <span class="n">da</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aproxy</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
                        <span class="n">extract_as</span><span class="o">=</span><span class="n">tango</span><span class="o">.</span><span class="n">ExtractAs</span><span class="o">.</span><span class="n">Nothing</span><span class="p">)</span>
                    <span class="n">enc</span> <span class="o">=</span> <span class="n">tango</span><span class="o">.</span><span class="n">EncodedAttribute</span><span class="p">()</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">enc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tangodecoders</span><span class="p">[</span><span class="n">avalue</span><span class="p">[</span><span class="mi">0</span><span class="p">]])(</span><span class="n">da</span><span class="p">)</span>
                    <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
                            <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">  (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">time</span><span class="p">)),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__decoders</span><span class="p">[</span><span class="n">avalue</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="n">dec</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">avalue</span><span class="p">)</span>
                    <span class="n">fnumber</span> <span class="o">=</span> <span class="n">dec</span><span class="o">.</span><span class="n">frameNumber</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
                    <span class="n">shape</span> <span class="o">=</span> <span class="n">dec</span><span class="o">.</span><span class="n">shape</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">shape</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
                    <span class="k">return</span> <span class="p">(</span><span class="n">dec</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                            <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">,</span>
                                <span class="n">fnumber</span><span class="p">,</span>
                                <span class="nb">str</span><span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">time</span><span class="p">)),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
                    <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
                            <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">  (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">time</span><span class="p">)),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">tango</span><span class="o">.</span><span class="n">DevFailed</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;Frame(s) not available yet&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">((</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">desc</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;TangoAttrSource: Frame(s) not available yet&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="c1"># print(str(e))</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="s2">&quot;__ERROR__&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="c1"># print(str(e))</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="s2">&quot;__ERROR__&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="TangoAttrSource.connect"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.TangoAttrSource.connect">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; connects the source</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__bytearray</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initiated</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__aproxy</span> <span class="o">=</span> <span class="n">tango</span><span class="o">.</span><span class="n">AttributeProxy</span><span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="c1"># print(str(e))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_updaterror</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">False</span></div></div>


<div class="viewcode-block" id="TangoEventsCB"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.TangoEventsCB">[docs]</a><span class="k">class</span> <span class="nc">TangoEventsCB</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; tango attribute callback class&quot;&quot;&quot;</span>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">mutex</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param client: tango controller client</span>
<span class="sd">        :type client: :class:`str`</span>
<span class="sd">        :param name: attribute name</span>
<span class="sd">        :type name: :obj:`str`</span>
<span class="sd">        :param mutex: mutex lock for CB</span>
<span class="sd">        :type type: :class:`pyqtgraph.QtCore.QMutex`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__client</span> <span class="o">=</span> <span class="n">client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__mutex</span> <span class="o">=</span> <span class="n">mutex</span>

    <span class="c1"># @debugmethod</span>
<div class="viewcode-block" id="TangoEventsCB.push_event"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.TangoEventsCB.push_event">[docs]</a>    <span class="k">def</span> <span class="nf">push_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;callback method receiving the event</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">logger</span><span class="o">.</span><span class="n">getEffectiveLevel</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">trunk</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">event_data</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trunk</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1300</span><span class="p">:</span>
                <span class="n">trunk</span> <span class="o">=</span> <span class="n">trunk</span><span class="p">[:</span><span class="mi">800</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; ... &quot;</span> <span class="o">+</span> <span class="n">trunk</span><span class="p">[</span><span class="o">-</span><span class="mi">500</span><span class="p">:]</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;lavuelib.imageSource.TangoEventCB.push_event: </span><span class="si">%s</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="n">trunk</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">event_data</span><span class="o">.</span><span class="n">err</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">event_data</span><span class="o">.</span><span class="n">errors</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
            <span class="c1"># print(str(result))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__client</span><span class="o">.</span><span class="n">reading</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__mutex</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__client</span><span class="o">.</span><span class="n">reading</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__client</span><span class="o">.</span><span class="n">attr</span> <span class="o">=</span> <span class="n">event_data</span><span class="o">.</span><span class="n">attr_value</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__client</span><span class="o">.</span><span class="n">fresh</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">finally</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__client</span><span class="o">.</span><span class="n">reading</span> <span class="o">=</span> <span class="kc">False</span></div></div>


<div class="viewcode-block" id="TangoReadyEventsCB"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.TangoReadyEventsCB">[docs]</a><span class="k">class</span> <span class="nc">TangoReadyEventsCB</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; tango attribute callback class&quot;&quot;&quot;</span>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">mutex</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param client: tango controller client</span>
<span class="sd">        :type client: :class:`str`</span>
<span class="sd">        :param name: attribute name</span>
<span class="sd">        :type name: :obj:`str`</span>
<span class="sd">        :param mutex: mutex lock for CB</span>
<span class="sd">        :type type: :class:`pyqtgraph.QtCore.QMutex`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__client</span> <span class="o">=</span> <span class="n">client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__mutex</span> <span class="o">=</span> <span class="n">mutex</span>

    <span class="c1"># @debugmethod</span>
<div class="viewcode-block" id="TangoReadyEventsCB.push_event"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.TangoReadyEventsCB.push_event">[docs]</a>    <span class="k">def</span> <span class="nf">push_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;callback method receiving the event</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">logger</span><span class="o">.</span><span class="n">getEffectiveLevel</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">trunk</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">event_data</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trunk</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1300</span><span class="p">:</span>
                <span class="n">trunk</span> <span class="o">=</span> <span class="n">trunk</span><span class="p">[:</span><span class="mi">800</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; ... &quot;</span> <span class="o">+</span> <span class="n">trunk</span><span class="p">[</span><span class="o">-</span><span class="mi">500</span><span class="p">:]</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;lavuelib.imageSource.TangoEventCB.push_event: </span><span class="si">%s</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="n">trunk</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">event_data</span><span class="o">.</span><span class="n">err</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">event_data</span><span class="o">.</span><span class="n">errors</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
            <span class="c1"># print(str(result))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__client</span><span class="o">.</span><span class="n">reading</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__mutex</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__client</span><span class="o">.</span><span class="n">reading</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">_</span><span class="p">,</span> <span class="n">attrnm</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">event_data</span><span class="o">.</span><span class="n">attr_name</span><span class="p">)</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__client</span><span class="o">.</span><span class="n">attr</span> <span class="o">=</span> <span class="n">event_data</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">read_attribute</span><span class="p">(</span>
                            <span class="n">attrnm</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__client</span><span class="o">.</span><span class="n">fresh</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">finally</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__client</span><span class="o">.</span><span class="n">reading</span> <span class="o">=</span> <span class="kc">False</span></div></div>


<div class="viewcode-block" id="TangoEventsSource"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.TangoEventsSource">[docs]</a><span class="k">class</span> <span class="nc">TangoEventsSource</span><span class="p">(</span><span class="n">BaseSource</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; image source as IMAGE Tango attribute</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param timeout: timeout for setting connection in ms</span>
<span class="sd">        :type timeout: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">BaseSource</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>
        <span class="c1">#: (:obj:`bool`) reading flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reading</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#: (:obj:`bool`) fresh attribute flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fresh</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#: (:class:`pyqtgraph.QtCore.QMutex`) mutex lock for CB</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__mutex</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutex</span><span class="p">()</span>
        <span class="c1">#: (:class`tango.DeviceProxy`:)</span>
        <span class="c1">#:      device proxy for the image attribute</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__proxy</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__attrid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__rattrid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attr</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:dict: &lt;:obj:`str`, :obj:`any`&gt;)</span>
        <span class="c1">#:      dictionary of external decorders</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__decoders</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;LIMA_VIDEO_IMAGE&quot;</span><span class="p">:</span> <span class="n">VDEOdecoder</span><span class="p">(),</span>
            <span class="s2">&quot;VIDEO_IMAGE&quot;</span><span class="p">:</span> <span class="n">VDEOdecoder</span><span class="p">(),</span>
            <span class="s2">&quot;DATA_ARRAY&quot;</span><span class="p">:</span> <span class="n">DATAARRAYdecoder</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="c1">#: (:dict: &lt;:obj:`str`, :obj:`str`&gt;)</span>
        <span class="c1">#:      dictionary of tango decorders</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__tangodecoders</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;GRAY16&quot;</span><span class="p">:</span> <span class="s2">&quot;decode_gray16&quot;</span><span class="p">,</span>
            <span class="s2">&quot;GRAY8&quot;</span><span class="p">:</span> <span class="s2">&quot;decode_gray8&quot;</span><span class="p">,</span>
            <span class="s2">&quot;JPEG_GRAY8&quot;</span><span class="p">:</span> <span class="s2">&quot;decode_gray8&quot;</span><span class="p">,</span>
            <span class="s2">&quot;JPEG_RGB&quot;</span><span class="p">:</span> <span class="s2">&quot;decode_rgb32&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RGB24&quot;</span><span class="p">:</span> <span class="s2">&quot;decode_rgb32&quot;</span>
        <span class="p">}</span>

<div class="viewcode-block" id="TangoEventsSource.getData"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.TangoEventsSource.getData">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">getData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides image name, image data and metadata</span>

<span class="sd">        :returns:  image name, image data, json dictionary with metadata</span>
<span class="sd">        :rtype: (:obj:`str` , :class:`numpy.ndarray` , :obj:`str`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__proxy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;No attribute name defined&quot;</span><span class="p">,</span> <span class="s2">&quot;__ERROR__&quot;</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__mutex</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">attr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fresh</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fresh</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">type</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;DevEncoded&quot;</span><span class="p">:</span>
                    <span class="n">avalue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">value</span>
                    <span class="k">if</span> <span class="n">avalue</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;RGB24&quot;</span><span class="p">,</span> <span class="s2">&quot;JPEG_RGB&quot;</span><span class="p">]:</span>
                        <span class="n">image</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QImage</span><span class="o">.</span><span class="n">fromData</span><span class="p">(</span><span class="n">avalue</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">width</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">width</span><span class="p">()</span>
                        <span class="n">height</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">height</span><span class="p">()</span>
                        <span class="n">st</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">bits</span><span class="p">()</span><span class="o">.</span><span class="n">asstring</span><span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="n">height</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                                <span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
                        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                                <span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
                        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
                                <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">  (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">time</span><span class="p">)),</span>
                                <span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">avalue</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tangodecoders</span><span class="p">:</span>
                        <span class="c1"># da = self.__aproxy.read(</span>
                        <span class="c1">#     extract_as=tango.ExtractAs.Nothing)</span>
                        <span class="n">enc</span> <span class="o">=</span> <span class="n">tango</span><span class="o">.</span><span class="n">EncodedAttribute</span><span class="p">()</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span>
                            <span class="n">enc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tangodecoders</span><span class="p">[</span><span class="n">avalue</span><span class="p">[</span><span class="mi">0</span><span class="p">]])(</span><span class="bp">self</span><span class="o">.</span><span class="n">attr</span><span class="p">)</span>
                        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
                                <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">  (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">,</span>
                                    <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">time</span><span class="p">)),</span>
                                <span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__decoders</span><span class="p">[</span><span class="n">avalue</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                        <span class="n">dec</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">avalue</span><span class="p">)</span>
                        <span class="n">shape</span> <span class="o">=</span> <span class="n">dec</span><span class="o">.</span><span class="n">shape</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">shape</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
                        <span class="k">return</span> <span class="p">(</span><span class="n">dec</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                                <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">  (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">time</span><span class="p">)),</span>
                                <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">):</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
                        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
                                <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">  (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">time</span><span class="p">)),</span>
                                <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="c1"># print(str(e))</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="s2">&quot;__ERROR__&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="TangoEventsSource.connect"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.TangoEventsSource.connect">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; connects the source</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initiated</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
                <span class="c1"># with QtCore.QMutexLocker(self.__mutex):</span>
                <span class="n">dvname</span><span class="p">,</span> <span class="n">atname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">)</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">attr_cb</span> <span class="o">=</span> <span class="n">TangoEventsCB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__mutex</span><span class="p">)</span>
                <span class="n">rattr_cb</span> <span class="o">=</span> <span class="n">TangoReadyEventsCB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__mutex</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__proxy</span> <span class="o">=</span> <span class="n">tango</span><span class="o">.</span><span class="n">DeviceProxy</span><span class="p">(</span><span class="n">dvname</span><span class="p">)</span>
                <span class="n">exc</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__attrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__proxy</span><span class="o">.</span><span class="n">subscribe_event</span><span class="p">(</span>
                        <span class="n">atname</span><span class="p">,</span>
                        <span class="n">tango</span><span class="o">.</span><span class="n">EventType</span><span class="o">.</span><span class="n">CHANGE_EVENT</span><span class="p">,</span>
                        <span class="n">attr_cb</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__attrid</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">exc</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__rattrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__proxy</span><span class="o">.</span><span class="n">subscribe_event</span><span class="p">(</span>
                            <span class="n">atname</span><span class="p">,</span>
                            <span class="n">tango</span><span class="o">.</span><span class="n">EventType</span><span class="o">.</span><span class="n">DATA_READY_EVENT</span><span class="p">,</span>
                            <span class="n">rattr_cb</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__rattrid</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="n">exc</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_initiated</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="c1"># print(str(e))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_updaterror</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="TangoEventsSource.disconnect"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.TangoEventsSource.disconnect">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; disconnects the source</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initiated</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__mutex</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_initiated</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__proxy</span>
                <span class="k">if</span> <span class="n">proxy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__attrid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__proxy</span><span class="o">.</span><span class="n">unsubscribe_event</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__attrid</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__attrid</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rattrid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__proxy</span><span class="o">.</span><span class="n">unsubscribe_event</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__rattrid</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__rattrid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_updaterror</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="HTTPSource"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.HTTPSource">[docs]</a><span class="k">class</span> <span class="nc">HTTPSource</span><span class="p">(</span><span class="n">BaseSource</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; image source as HTTP request response</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param timeout: timeout for setting connection in ms</span>
<span class="sd">        :type timeout: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">BaseSource</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>
        <span class="c1">#: (:obj:`bool`) use tiff loader</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__tiffloader</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1">#: (:obj:`dict` &lt;:obj:`str`, :obj:`any` &gt; ) HTTP header data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__header</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="HTTPSource.getData"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.HTTPSource.getData">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">getData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides image name, image data and metadata</span>

<span class="sd">        :returns:  image name, image data, json dictionary with metadata</span>
<span class="sd">        :rtype: (:obj:`str` , :class:`numpy.ndarray` , :obj:`str`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
                    <span class="n">mdata</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>
                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;###CBF: VE&quot;</span><span class="p">,</span> <span class="s2">&quot;b&#39;###CBF: VE&#39;&quot;</span><span class="p">]:</span>
                        <span class="c1"># print(&quot;[cbf source module]::metadata&quot;, name)</span>
                        <span class="n">img</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="k">if</span> <span class="n">FABIO11</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">fimg</span> <span class="o">=</span> <span class="n">fabio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
                                <span class="n">img</span> <span class="o">=</span> <span class="n">fimg</span><span class="o">.</span><span class="n">data</span>
                                <span class="n">mdata</span> <span class="o">=</span> <span class="n">imageFileHandler</span><span class="o">.</span><span class="n">CBFLoader</span><span class="p">()</span><span class="o">.</span><span class="n">metadata</span><span class="p">(</span>
                                    <span class="n">fimg</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                                        <span class="s2">&quot;_array_data.header_contents&quot;</span><span class="p">))</span>
                            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                                <span class="c1"># print(str(e))</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                                <span class="n">img</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="k">if</span> <span class="n">img</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">nimg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">[:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                                <span class="n">nimg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">data</span><span class="p">[:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
                            <span class="n">img</span> <span class="o">=</span> <span class="n">imageFileHandler</span><span class="o">.</span><span class="n">CBFLoader</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">nimg</span><span class="p">)</span>
                            <span class="n">mdata</span> <span class="o">=</span> <span class="n">imageFileHandler</span><span class="o">.</span><span class="n">CBFLoader</span><span class="p">()</span><span class="o">.</span><span class="n">metadata</span><span class="p">(</span><span class="n">nimg</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">img</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
                        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">img</span><span class="p">),</span>
                                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">currenttime</span><span class="p">()),</span> <span class="n">mdata</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># print(&quot;[tif source module]::metadata&quot;, name)</span>
                        <span class="k">if</span> <span class="n">PILLOW</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tiffloader</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                                    <span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">data</span><span class="p">))))</span>
                            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                                <span class="k">try</span><span class="p">:</span>
                                    <span class="n">img</span> <span class="o">=</span> <span class="n">imageFileHandler</span><span class="o">.</span><span class="n">TIFLoader</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
                                        <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">[:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">))</span>
                                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                                    <span class="n">img</span> <span class="o">=</span> <span class="n">imageFileHandler</span><span class="o">.</span><span class="n">TIFLoader</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
                                        <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">data</span><span class="p">[:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">))</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">__tiffloader</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">if</span> <span class="n">img</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
                            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
                            <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">img</span><span class="p">),</span>
                                    <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">currenttime</span><span class="p">()),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">img</span> <span class="o">=</span> <span class="n">imageFileHandler</span><span class="o">.</span><span class="n">TIFLoader</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
                                    <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">[:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">))</span>
                            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                                <span class="n">img</span> <span class="o">=</span> <span class="n">imageFileHandler</span><span class="o">.</span><span class="n">TIFLoader</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
                                    <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">data</span><span class="p">[:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">))</span>
                            <span class="k">if</span> <span class="n">img</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
                            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
                            <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">img</span><span class="p">),</span>
                                    <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">currenttime</span><span class="p">()),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="s2">&quot;HTTPSource.getData: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># print(str(e))</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="s2">&quot;__ERROR__&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Image not available&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">),</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="s2">&quot;File not found&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">):</span>
                    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">),</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">),</span> <span class="s2">&quot;__ERROR__&quot;</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="s2">&quot;No url defined&quot;</span><span class="p">,</span> <span class="s2">&quot;__ERROR__&quot;</span><span class="p">,</span> <span class="kc">None</span></div>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">__get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; get response</span>

<span class="sd">        :returns: response object</span>
<span class="sd">        :rtype: :class:`requests.Response`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">,</span>
                    <span class="n">timeout</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span><span class="o">/</span><span class="mf">1000.</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span> <span class="k">else</span> <span class="kc">None</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__header</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">,</span>
                    <span class="n">timeout</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span><span class="o">/</span><span class="mf">1000.</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span> <span class="k">else</span> <span class="kc">None</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">)</span>

<div class="viewcode-block" id="HTTPSource.connect"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.HTTPSource.connect">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; connects the source</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__tiffloader</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__header</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;/images/monitor&quot;</span><span class="p">):</span>
                    <span class="n">sconf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sconf</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="n">version</span> <span class="o">=</span> <span class="n">sconf</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
                        <span class="n">lst</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)]</span>
                        <span class="n">lst</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
                        <span class="n">lversion</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                            <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mi">100</span> <span class="o">**</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lst</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">lversion</span> <span class="o">&gt;=</span> <span class="mi">10800</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__header</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Accept&#39;</span><span class="p">:</span> <span class="s1">&#39;application/tiff&#39;</span><span class="p">}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__get</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="c1"># print(str(e))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_updaterror</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">False</span></div></div>


<div class="viewcode-block" id="ZMQSource"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.ZMQSource">[docs]</a><span class="k">class</span> <span class="nc">ZMQSource</span><span class="p">(</span><span class="n">BaseSource</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; image source as ZMQ stream&quot;&quot;&quot;</span>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param timeout: timeout for setting connection in ms</span>
<span class="sd">        :type timeout: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">BaseSource</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>

        <span class="c1">#: (:class:`zmq.Context`) zmq context</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__context</span> <span class="o">=</span> <span class="n">zmq</span><span class="o">.</span><span class="n">Context</span><span class="p">()</span>
        <span class="c1">#: (:class:`zmq.Socket`) zmq socket</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__socket</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`int`) internal counter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">#: (:obj:`bytes`) zmq topic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__topic</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;10001&quot;</span>
        <span class="c1">#: (:obj:`str`) zmq bind address</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__bindaddress</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:class:`pyqtgraph.QtCore.QMutex`) mutex lock for zmq source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__mutex</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutex</span><span class="p">()</span>

<div class="viewcode-block" id="ZMQSource.setConfiguration"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.ZMQSource.setConfiguration">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">setConfiguration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set configuration</span>

<span class="sd">        :param configuration:  configuration string</span>
<span class="sd">        :type configuration: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span> <span class="o">!=</span> <span class="n">configuration</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span> <span class="o">=</span> <span class="n">configuration</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initiated</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__mutex</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__socket</span><span class="p">:</span>
                    <span class="n">conf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">shost</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
                        <span class="n">topic</span> <span class="o">=</span> <span class="n">shost</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shost</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">shost</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">conf</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">topic</span> <span class="o">=</span> <span class="n">tobytes</span><span class="p">(</span><span class="n">conf</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">topic</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__socket</span><span class="o">.</span><span class="n">unbind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__bindaddress</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__socket</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span>
                        <span class="n">zmq</span><span class="o">.</span><span class="n">UNSUBSCRIBE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__topic</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__socket</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span>
                        <span class="n">zmq</span><span class="o">.</span><span class="n">UNSUBSCRIBE</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;datasources&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__socket</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span>
                        <span class="n">zmq</span><span class="o">.</span><span class="n">SUBSCRIBE</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;datasources&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__socket</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span>
                        <span class="n">zmq</span><span class="o">.</span><span class="n">SUBSCRIBE</span><span class="p">,</span> <span class="n">tobytes</span><span class="p">(</span><span class="n">topic</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__topic</span> <span class="o">=</span> <span class="n">tobytes</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__socket</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__bindaddress</span><span class="p">)</span></div>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">__loads</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; loads json or pickle string</span>

<span class="sd">        :param message: message to encode</span>
<span class="sd">        :type message: :obj:`str`</span>
<span class="sd">        :param encoding: JSON or PICKLE</span>
<span class="sd">        :type encoding: :obj:`str`</span>
<span class="sd">        :returns: encoded message object</span>
<span class="sd">        :rtype: :obj:`any`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">encoding</span> <span class="o">==</span> <span class="s2">&quot;JSON&quot;</span><span class="p">:</span>
            <span class="n">smessage</span> <span class="o">=</span> <span class="n">tostr</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">smessage</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">metadata</span> <span class="o">=</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">smessage</span> <span class="o">=</span> <span class="n">tostr</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
                <span class="n">metadata</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">smessage</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">metadata</span>

<div class="viewcode-block" id="ZMQSource.getData"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.ZMQSource.getData">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">getData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides image name, image data and metadata</span>

<span class="sd">        :returns:  image name, image data, json dictionary with metadata</span>
<span class="sd">        :rtype: (:obj:`str` , :class:`numpy.ndarray` , :obj:`str`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">encoding</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__socket</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;No socket defined&quot;</span><span class="p">,</span> <span class="s2">&quot;__ERROR__&quot;</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__mutex</span><span class="p">):</span>
                <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__socket</span><span class="o">.</span><span class="n">recv_multipart</span><span class="p">(</span><span class="n">flags</span><span class="o">=</span><span class="n">zmq</span><span class="o">.</span><span class="n">NOBLOCK</span><span class="p">)</span>
            <span class="n">topic</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">_array</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">lmsg</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">lmsg</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
                <span class="n">topic</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">message</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;JSON&quot;</span><span class="p">:</span>
                <span class="n">encoding</span> <span class="o">=</span> <span class="s2">&quot;JSON&quot;</span>
                <span class="n">lmsg</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">message</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">message</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;PICKLE&quot;</span><span class="p">:</span>
                <span class="n">encoding</span> <span class="o">=</span> <span class="s2">&quot;PICKLE&quot;</span>
                <span class="n">lmsg</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">message</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

            <span class="c1"># print(&quot;topic %s %s&quot; % (topic, self.__topic))</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;datasources&quot;</span> <span class="ow">and</span> <span class="n">lmsg</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="n">_metadata</span><span class="p">)</span> <span class="o">=</span> <span class="n">message</span>
                <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__loads</span><span class="p">(</span><span class="n">_metadata</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;shape&quot;</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">:</span>
                    <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;shape&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;dtype&quot;</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">:</span>
                    <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
                <span class="n">jmetadata</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">if</span> <span class="n">metadata</span><span class="p">:</span>
                    <span class="n">jmetadata</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">jmetadata</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">topic</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;datasources&quot;</span> <span class="ow">and</span> <span class="n">lmsg</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_metadata</span><span class="p">)</span> <span class="o">=</span> <span class="n">message</span>
                <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__loads</span><span class="p">(</span><span class="n">_metadata</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;shape&quot;</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">:</span>
                    <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;shape&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;dtype&quot;</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">:</span>
                    <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
                <span class="n">jmetadata</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">if</span> <span class="n">metadata</span><span class="p">:</span>
                    <span class="n">jmetadata</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">jmetadata</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__topic</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span> <span class="ow">or</span> <span class="n">tobytes</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__topic</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">lmsg</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="n">_array</span><span class="p">,</span> <span class="n">_metadata</span><span class="p">)</span> <span class="o">=</span> <span class="n">message</span>
                    <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__loads</span><span class="p">(</span><span class="n">_metadata</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
                    <span class="n">shape</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;shape&quot;</span><span class="p">]</span>
                    <span class="n">dtype</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;dtype&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="s2">&quot;name&quot;</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">:</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__bindaddress</span><span class="p">,</span> <span class="n">tostr</span><span class="p">(</span><span class="n">topic</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">__counter</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">lmsg</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="n">_array</span><span class="p">,</span> <span class="n">_shape</span><span class="p">,</span> <span class="n">_dtype</span><span class="p">)</span> <span class="o">=</span> <span class="n">message</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__bindaddress</span><span class="p">,</span> <span class="n">tostr</span><span class="p">(</span><span class="n">topic</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">__counter</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">lmsg</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                        <span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="n">_array</span><span class="p">,</span> <span class="n">_shape</span><span class="p">,</span> <span class="n">_dtype</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="o">=</span> <span class="n">message</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                            <span class="n">name</span> <span class="o">=</span> <span class="n">tostr</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__loads</span><span class="p">(</span><span class="n">_dtype</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
                    <span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__loads</span><span class="p">(</span><span class="n">_shape</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">buffer</span><span class="p">(</span><span class="n">_array</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
                <span class="n">array</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
                <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__counter</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">jmetadata</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">if</span> <span class="n">metadata</span><span class="p">:</span>
                    <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;shape&quot;</span><span class="p">)</span>
                    <span class="n">metadata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">jmetadata</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">array</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">jmetadata</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">array</span><span class="p">),</span> <span class="n">name</span><span class="p">,</span> <span class="n">jmetadata</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">zmq</span><span class="o">.</span><span class="n">Again</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># print(str(e))</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="s2">&quot;__ERROR__&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ZMQSource.connect"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.ZMQSource.connect">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; connects the source</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">conf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">shost</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
                <span class="n">host</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">shost</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__topic</span> <span class="o">=</span> <span class="n">tobytes</span><span class="p">(</span><span class="n">shost</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shost</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">hwm</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">shost</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shost</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">shost</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">else</span> <span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">host</span> <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">port</span> <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__topic</span> <span class="o">=</span> <span class="n">tobytes</span><span class="p">(</span><span class="n">conf</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__topic</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">hwm</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">conf</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">hwm</span> <span class="o">=</span> <span class="mi">2</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initiated</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__socket</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
                <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__mutex</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__context</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">zmq</span><span class="o">.</span><span class="n">SUB</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">hwm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__socket</span><span class="o">.</span><span class="n">set_hwm</span><span class="p">(</span><span class="n">hwm</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__bindaddress</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="s1">&#39;tcp://&#39;</span>
                        <span class="o">+</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname</span><span class="p">(</span><span class="n">host</span><span class="p">)</span>
                        <span class="o">+</span> <span class="s1">&#39;:&#39;</span>
                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__socket</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">zmq</span><span class="o">.</span><span class="n">SUBSCRIBE</span><span class="p">,</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">__topic</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__socket</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">zmq</span><span class="o">.</span><span class="n">SUBSCRIBE</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;datasources&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__socket</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__bindaddress</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="c1"># print(str(e))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_updaterror</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="ZMQSource.disconnect"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.ZMQSource.disconnect">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; disconnects the source</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__mutex</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__socket</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bindaddress</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__socket</span><span class="o">.</span><span class="n">unbind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__bindaddress</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__socket</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">linger</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__socket</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="c1"># print(str(e))</span>
        <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__mutex</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__bindaddress</span> <span class="o">=</span> <span class="kc">None</span></div>

    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; destructor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__context</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span></div>


<div class="viewcode-block" id="ASAPOSource"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.ASAPOSource">[docs]</a><span class="k">class</span> <span class="nc">ASAPOSource</span><span class="p">(</span><span class="n">BaseSource</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; asapo image source&quot;&quot;&quot;</span>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param timeout: timeout for setting connection in ms</span>
<span class="sd">        :type timeout: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">BaseSource</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>
        <span class="c1">#: (:obj:`str`) asapo token</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__token</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="c1">#: (:obj:`str`) beamtime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__beamtime</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="c1">#: (:obj:`str`) sourcepath</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sourcepath</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="c1">#: (:obj:`str`) asapo server</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__server</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="c1">#: (:obj:`str`) stream</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__datasource</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="c1">#: (:obj:`str`) stream</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__stream</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="c1">#: (:obj:`str`) stream</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__streams</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#: (:obj:`str`) last name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lastname</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="c1">#: (:obj:`str`) last name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lastid</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="c1">#: (:obj:`str`) asapo client server</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__targetname</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">getfqdn</span><span class="p">()</span>
        <span class="c1">#: (:obj:`asapo_consumer.broker`) asapo consumer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__broker</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`int`) group id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__group_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:class:`pyqtgraph.QtCore.QMutex`) mutex lock for asapo source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__mutex</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutex</span><span class="p">()</span>
        <span class="c1">#: (:obj:`bool`) use tiff loader</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__tiffloader</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#: (:obj:`int`) counter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__subcounter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">#: (:obj:`int`) counter max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__subcntmax</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="c1">#: (:obj:`str`) counter max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lastjsubmeta</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__asapoversion</span> <span class="o">=</span> <span class="s1">&#39;last&#39;</span>

<div class="viewcode-block" id="ASAPOSource.setConfiguration"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.ASAPOSource.setConfiguration">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">setConfiguration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set configuration</span>

<span class="sd">        :param configuration:  configuration string</span>
<span class="sd">        :type configuration: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span> <span class="o">!=</span> <span class="n">configuration</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__server</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__datasource</span><span class="p">,</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">__stream</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__beamtime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sourcepath</span><span class="p">,</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">__token</span><span class="p">)</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__lastname</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__lastid</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__subcounter</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__lastjsubmeta</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span> <span class="o">=</span> <span class="n">configuration</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="c1"># print(str(e))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_initiated</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initiated</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="ASAPOSource.getMetaData"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.ASAPOSource.getMetaData">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">getMetaData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; get metadata</span>

<span class="sd">        :returns: dictionary with metadata</span>
<span class="sd">        :rtype: :obj:`dict` &lt;:obj:`str`, :obj:`any`&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">streams</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__broker</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
            <span class="n">connected</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__broker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__asapoversion</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;old&#39;</span><span class="p">]:</span>
                    <span class="n">streams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__broker</span><span class="o">.</span><span class="n">get_substream_list</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">streams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__broker</span><span class="o">.</span><span class="n">get_stream_list</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">streams</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__streams</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">subs</span> <span class="ow">in</span> <span class="n">streams</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;name&quot;</span> <span class="ow">in</span> <span class="n">subs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__streams</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subs</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__streams</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">connected</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">streams</span><span class="p">:</span>
            <span class="n">meta</span><span class="p">[</span><span class="s2">&quot;asapostreams&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__streams</span>
        <span class="k">return</span> <span class="n">meta</span></div>

<div class="viewcode-block" id="ASAPOSource.connect"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.ASAPOSource.connect">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; connects the source</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__tiffloader</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>

            <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__mutex</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__server</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__beamtime</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__token</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sourcepath</span><span class="p">:</span>
                        <span class="n">sourcepath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sourcepath</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">sourcepath</span><span class="p">)</span> <span class="ow">or</span> \
                           <span class="n">sourcepath</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;/asap3/&quot;</span><span class="p">)</span> <span class="ow">or</span> \
                           <span class="n">sourcepath</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;/beamline/&quot;</span><span class="p">):</span>
                            <span class="n">hasfs</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">hasfs</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">hasfs</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="n">sourcepath</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">asapo_consumer</span><span class="p">,</span> <span class="s2">&quot;create_server_broker&quot;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__broker</span> <span class="o">=</span> <span class="n">asapo_consumer</span><span class="o">.</span><span class="n">create_server_broker</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__server</span><span class="p">,</span> <span class="n">sourcepath</span><span class="p">,</span> <span class="n">hasfs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__beamtime</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__datasource</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__token</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span> <span class="ow">or</span> <span class="mi">3000</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__asapoversion</span> <span class="o">=</span> <span class="s1">&#39;old&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__broker</span> <span class="o">=</span> <span class="n">asapo_consumer</span><span class="o">.</span><span class="n">create_consumer</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__server</span><span class="p">,</span> <span class="n">sourcepath</span><span class="p">,</span> <span class="n">hasfs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__beamtime</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__datasource</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__token</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span> <span class="ow">or</span> <span class="mi">3000</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__asapoversion</span> <span class="o">=</span> <span class="s1">&#39;last&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__group_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__broker</span><span class="o">.</span><span class="n">generate_group_id</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_initiated</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__lastname</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__lastid</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__lastjsubmeta</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__subcounter</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># print(&quot;BORKER %s&quot; % self.__broker)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;ASAPOSource.connect: ENDPOINT </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__server</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="c1"># print(str(e))</span>
            <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__mutex</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__broker</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__group_id</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_updaterror</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="ASAPOSource.disconnect"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.ASAPOSource.disconnect">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; disconnects the source</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__broker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__mutex</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__broker</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__group_id</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initiated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_updaterror</span><span class="p">()</span></div>

<div class="viewcode-block" id="ASAPOSource.getData"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.ASAPOSource.getData">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">getData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides image name, image data and metadata</span>

<span class="sd">        :returns:  image name, image data, json dictionary with metadata</span>
<span class="sd">        :rtype: (:obj:`str` , :class:`numpy.ndarray` , :obj:`str`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__broker</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;No server defined&quot;</span><span class="p">,</span> <span class="s2">&quot;__ERROR__&quot;</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__group_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;No group_id defined&quot;</span><span class="p">,</span> <span class="s2">&quot;__ERROR__&quot;</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initiated</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="n">imagename</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">submeta</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">jsubmeta</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__mutex</span><span class="p">):</span>
                <span class="n">check</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__subcounter</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">submeta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMetaData</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">submeta</span><span class="p">:</span>
                        <span class="n">jsubmeta</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">submeta</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">jsubmeta</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastjsubmeta</span><span class="p">:</span>
                            <span class="n">jsubmeta</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__lastjsubmeta</span> <span class="o">=</span> <span class="n">jsubmeta</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__subcounter</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__subcntmax</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__subcounter</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__subcounter</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="n">stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__stream</span> <span class="ow">or</span> <span class="s2">&quot;default&quot;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__stream</span> <span class="o">==</span> <span class="s2">&quot;**ALL**&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__streams</span><span class="p">:</span>
                    <span class="n">stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__streams</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastid</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastname</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__asapoversion</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;old&#39;</span><span class="p">]:</span>
                        <span class="n">_</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__broker</span><span class="o">.</span><span class="n">get_last</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__group_id</span><span class="p">,</span>
                            <span class="n">substream</span><span class="o">=</span><span class="n">stream</span><span class="p">,</span> <span class="n">meta_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">_</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__broker</span><span class="o">.</span><span class="n">get_last</span><span class="p">(</span>
                            <span class="n">meta_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">stream</span><span class="p">)</span>
                    <span class="n">curname</span><span class="p">,</span> <span class="n">curid</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">curname</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastname</span> <span class="ow">and</span> <span class="n">curid</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastid</span><span class="p">:</span>
                        <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">check</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">jsubmeta</span><span class="p">:</span>
                        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">jsubmeta</span>
                    <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__asapoversion</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;old&#39;</span><span class="p">]:</span>
                    <span class="n">data</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__broker</span><span class="o">.</span><span class="n">get_last</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__group_id</span><span class="p">,</span>
                        <span class="n">substream</span><span class="o">=</span><span class="n">stream</span><span class="p">,</span>
                        <span class="n">meta_only</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__broker</span><span class="o">.</span><span class="n">get_last</span><span class="p">(</span>
                        <span class="n">meta_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">stream</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__lastname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__lastid</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">]</span>
                <span class="n">imagename</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__lastname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastid</span><span class="p">)</span>
                <span class="c1"># print (&#39;id:&#39;, metadata[&#39;_id&#39;])</span>
                <span class="c1"># print (&#39;file name:&#39;, metadata[&#39;name&#39;])</span>
                <span class="c1"># print (&#39;file content:&#39;, data.tostring().decode(&quot;utf-8&quot;))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># print(&quot;data&quot;, str(data)[:10])</span>
            <span class="n">nameext</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastname</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">nameext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__lastname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nameext</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.nxs&quot;</span><span class="p">,</span> <span class="s2">&quot;.h5&quot;</span><span class="p">,</span> <span class="s2">&quot;nx&quot;</span><span class="p">,</span> <span class="s2">&quot;ndf&quot;</span><span class="p">,</span> <span class="s2">&quot;hdf&quot;</span><span class="p">]:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">handler</span> <span class="o">=</span> <span class="n">imageFileHandler</span><span class="o">.</span><span class="n">NexusFieldHandler</span><span class="p">()</span>
                    <span class="n">handler</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">[:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lastname</span><span class="p">)</span>
                    <span class="n">nexus_path</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="s2">&quot;meta&quot;</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> \
                       <span class="s2">&quot;nexus_path&quot;</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;meta&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">nexus_path</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;meta&quot;</span><span class="p">][</span><span class="s2">&quot;nexus_path&quot;</span><span class="p">]</span>
                    <span class="n">frame</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="s2">&quot;meta&quot;</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> \
                       <span class="s2">&quot;nexus_image_frame&quot;</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;meta&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">frame</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                                <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;meta&quot;</span><span class="p">][</span><span class="s2">&quot;nexus_image_frame&quot;</span><span class="p">])</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                    <span class="n">node</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="n">nexus_path</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">mdata</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">getMetaData</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">submeta</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                    <span class="n">image</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">getImage</span><span class="p">(</span>
                        <span class="n">node</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">jsubmeta</span><span class="p">:</span>
                            <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">jsubmeta</span>
                        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="s2">&quot;shape&quot;</span><span class="p">)</span> <span class="ow">and</span> \
                       <span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span> <span class="n">imagename</span><span class="p">,</span> <span class="n">mdata</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="n">frame</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="s2">&quot;shape&quot;</span><span class="p">)</span> <span class="ow">and</span>
                          <span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">):</span>
                        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">imagename</span><span class="p">,</span> <span class="n">mdata</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">image</span><span class="p">),</span> <span class="n">imagename</span><span class="p">,</span> <span class="n">mdata</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="p">(((</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;ndarray&quot;</span><span class="p">)</span> <span class="ow">and</span>
                   <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span>
                       <span class="sa">b</span><span class="s2">&quot;###CBF: VE&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)))</span> <span class="ow">or</span>
                  <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span> <span class="o">==</span> <span class="s2">&quot;###CBF: VE&quot;</span><span class="p">):</span>
                <span class="c1"># print(&quot;[cbf source module]::metadata&quot;, metadata[&quot;filename&quot;])</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;ASAPOSource.getData: &quot;</span>
                    <span class="s2">&quot;[cbf source module]::metadata </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
                <span class="n">img</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">FABIO11</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">fimg</span> <span class="o">=</span> <span class="n">fabio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
                        <span class="n">img</span> <span class="o">=</span> <span class="n">fimg</span><span class="o">.</span><span class="n">data</span>
                        <span class="n">mdata</span> <span class="o">=</span> <span class="n">imageFileHandler</span><span class="o">.</span><span class="n">CBFLoader</span><span class="p">()</span><span class="o">.</span><span class="n">metadata</span><span class="p">(</span>
                            <span class="n">fimg</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                                <span class="s2">&quot;_array_data.header_contents&quot;</span><span class="p">),</span> <span class="n">submeta</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="c1"># print(str(e))</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                        <span class="n">img</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">img</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;ndarray&quot;</span><span class="p">:</span>
                        <span class="n">npdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[:],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">npdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">[:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                            <span class="n">npdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">data</span><span class="p">[:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
                    <span class="n">img</span> <span class="o">=</span> <span class="n">imageFileHandler</span><span class="o">.</span><span class="n">CBFLoader</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">npdata</span><span class="p">)</span>
                    <span class="n">mdata</span> <span class="o">=</span> <span class="n">imageFileHandler</span><span class="o">.</span><span class="n">CBFLoader</span><span class="p">()</span><span class="o">.</span><span class="n">metadata</span><span class="p">(</span>
                        <span class="n">npdata</span><span class="p">,</span> <span class="n">submeta</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">jsubmeta</span><span class="p">:</span>
                        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">jsubmeta</span>
                    <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">img</span><span class="p">),</span> <span class="n">imagename</span><span class="p">,</span> <span class="n">mdata</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># elif data[:2] in [&quot;II\x2A\x00&quot;, &quot;MM\x00\x2A&quot;]:</span>
                <span class="c1"># print(&quot;[tif source module]::metadata&quot;, metadata[&quot;name&quot;])</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;ASAPOSource.getData:&quot;</span>
                    <span class="s2">&quot;[tif source module]::metadata </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">PILLOW</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tiffloader</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">data</span><span class="p">))))</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="n">img</span> <span class="o">=</span> <span class="n">imageFileHandler</span><span class="o">.</span><span class="n">TIFLoader</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">[:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__tiffloader</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">jsubmeta</span><span class="p">:</span>
                            <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">jsubmeta</span>
                        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">img</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">img</span><span class="p">),</span> <span class="n">imagename</span><span class="p">,</span> <span class="n">jsubmeta</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">img</span> <span class="o">=</span> <span class="n">imageFileHandler</span><span class="o">.</span><span class="n">TIFLoader</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">[:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">))</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">jsubmeta</span><span class="p">:</span>
                            <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">jsubmeta</span>
                        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">img</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">img</span><span class="p">),</span> <span class="n">imagename</span><span class="p">,</span> <span class="n">jsubmeta</span>

            <span class="c1">#     print(</span>
            <span class="c1">#       &quot;[unknown source module]::metadata&quot;, metadata[&quot;name&quot;])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">jsubmeta</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">jsubmeta</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span></div></div>


<div class="viewcode-block" id="HiDRASource"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.HiDRASource">[docs]</a><span class="k">class</span> <span class="nc">HiDRASource</span><span class="p">(</span><span class="n">BaseSource</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; hidra image source&quot;&quot;&quot;</span>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param timeout: timeout for setting connection in ms</span>
<span class="sd">        :type timeout: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">BaseSource</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>
        <span class="c1">#: (:obj:`str`) hidra port number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__portnumber</span> <span class="o">=</span> <span class="s2">&quot;50001&quot;</span>
        <span class="c1">#: (:obj:`str`) hidra client server</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__targetname</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">getfqdn</span><span class="p">()</span>
        <span class="c1">#: (:obj:`str`) server host</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__shost</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`list` &lt; :obj:`str`, :obj:`str`,</span>
        <span class="c1">#:   :obj:`int` :obj:`list` &lt; :obj:`str`&gt; &gt;) hidra target:</span>
        <span class="c1">#:   [host name, portnumber, priority, a list of extensions]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__target</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__targetname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__portnumber</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span>
                         <span class="p">[</span><span class="s2">&quot;.cbf&quot;</span><span class="p">,</span> <span class="s2">&quot;.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;.tiff&quot;</span><span class="p">]]</span>
        <span class="c1">#: (:class:`hidra.transfer.Transfer`) hidra query</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__query</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:class:`pyqtgraph.QtCore.QMutex`) mutex lock for hidra source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__mutex</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutex</span><span class="p">()</span>
        <span class="c1">#: (:obj:`bool`) use tiff loader</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__tiffloader</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#: (:obj:`list`) list of supported scheme</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__schema</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;file:/localhost//&quot;</span><span class="p">,</span> <span class="s2">&quot;file:////&quot;</span><span class="p">,</span> <span class="s2">&quot;file:///&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;file://&quot;</span><span class="p">,</span> <span class="s2">&quot;file:/&quot;</span><span class="p">]</span>

    <span class="c1"># @debugmethod</span>
<div class="viewcode-block" id="HiDRASource.setConfiguration"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.HiDRASource.setConfiguration">[docs]</a>    <span class="k">def</span> <span class="nf">setConfiguration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set configuration</span>

<span class="sd">        :param configuration:  configuration string</span>
<span class="sd">        :type configuration: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span> <span class="o">!=</span> <span class="n">configuration</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__shost</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__targetname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__portnumber</span> \
                    <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_initiated</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">connect_ex</span><span class="p">(</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__targetname</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__portnumber</span><span class="p">)))</span>
            <span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span> <span class="o">=</span> <span class="n">configuration</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__target</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__targetname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__portnumber</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span>
                    <span class="p">[</span><span class="s2">&quot;.cbf&quot;</span><span class="p">,</span> <span class="s2">&quot;.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;.tiff&quot;</span><span class="p">]]</span>
                <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__mutex</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__query</span> <span class="o">=</span> <span class="n">hidra</span><span class="o">.</span><span class="n">Transfer</span><span class="p">(</span>
                            <span class="s2">&quot;QUERY_NEXT&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__shost</span><span class="p">,</span>
                            <span class="n">use_log</span><span class="o">=</span><span class="n">getLevel</span><span class="p">())</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="c1"># support for older hidra versions</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__query</span> <span class="o">=</span> <span class="n">hidra</span><span class="o">.</span><span class="n">Transfer</span><span class="p">(</span>
                            <span class="s2">&quot;QUERY_NEXT&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__shost</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__query</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initiated</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="HiDRASource.connect"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.HiDRASource.connect">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; connects the source</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__tiffloader</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__query</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="s2"> is busy. Please change the port&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__targetname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__portnumber</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initiated</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__mutex</span><span class="p">):</span>
                    <span class="c1"># print(&quot;TARGET %s&quot; % self.__target)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="s2">&quot;HiDRASource.connect: TARGET </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__target</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__query</span><span class="o">.</span><span class="n">initiate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__target</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_initiated</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__mutex</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__query</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="c1"># print(str(e))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__query</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__mutex</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__query</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_updaterror</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="HiDRASource.disconnect"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.HiDRASource.disconnect">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; disconnects the source</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__query</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__mutex</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__query</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initiated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_updaterror</span><span class="p">()</span></div>

<div class="viewcode-block" id="HiDRASource.getData"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.HiDRASource.getData">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">getData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides image name, image data and metadata</span>

<span class="sd">        :returns:  image name, image data, json dictionary with metadata</span>
<span class="sd">        :rtype: (:obj:`str` , :class:`numpy.ndarray` , :obj:`str`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__query</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;No server defined&quot;</span><span class="p">,</span> <span class="s2">&quot;__ERROR__&quot;</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initiated</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__mutex</span><span class="p">):</span>
                <span class="c1"># [metadata, data] = self.__query.get()</span>
                <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="p">[</span><span class="n">metadata</span><span class="p">,</span> <span class="n">data</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span> \
               <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t1</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span><span class="o">/</span><span class="mf">2000.</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__mutex</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__query</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__query</span> <span class="o">=</span> <span class="n">hidra</span><span class="o">.</span><span class="n">Transfer</span><span class="p">(</span>
                            <span class="s2">&quot;QUERY_NEXT&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__shost</span><span class="p">,</span>
                            <span class="n">use_log</span><span class="o">=</span><span class="n">getLevel</span><span class="p">())</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="c1"># support for older hidra versions</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__query</span> <span class="o">=</span> <span class="n">hidra</span><span class="o">.</span><span class="n">Transfer</span><span class="p">(</span>
                            <span class="s2">&quot;QUERY_NEXT&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__shost</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__query</span><span class="o">.</span><span class="n">initiate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__target</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_initiated</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__query</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
                    <span class="p">[</span><span class="n">metadata</span><span class="p">,</span> <span class="n">data</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="c1"># print(str(e))</span>

        <span class="k">if</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># print(&quot;data&quot;, str(data)[:10])</span>

            <span class="n">nameext</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span>
            <span class="n">imagename</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
            <span class="n">scheme</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">sm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__schema</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">sm</span><span class="p">):</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="p">[(</span><span class="nb">len</span><span class="p">(</span><span class="n">sm</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):]</span>
                    <span class="n">scheme</span> <span class="o">=</span> <span class="s2">&quot;file&quot;</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">scheme</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">sm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__schema</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;h5&quot;</span> <span class="o">+</span> <span class="n">sm</span><span class="p">):</span>
                        <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="p">[(</span><span class="nb">len</span><span class="p">(</span><span class="n">sm</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):]</span>
                        <span class="n">scheme</span> <span class="o">=</span> <span class="s2">&quot;h5file&quot;</span>
                        <span class="k">break</span>
            <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">nameext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">scheme</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;h5file&quot;</span><span class="p">]</span> <span class="ow">or</span> \
               <span class="n">nameext</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.nxs&quot;</span><span class="p">,</span> <span class="s2">&quot;.h5&quot;</span><span class="p">,</span> <span class="s2">&quot;nx&quot;</span><span class="p">,</span> <span class="s2">&quot;ndf&quot;</span><span class="p">,</span> <span class="s2">&quot;hdf&quot;</span><span class="p">]:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">nexus_path</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">scheme</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;h5file&quot;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="s2">&quot;::&quot;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
                            <span class="n">filename</span><span class="p">,</span> <span class="n">nexus_path</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;::&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">handler</span> <span class="o">=</span> <span class="n">imageFileHandler</span><span class="o">.</span><span class="n">NexusFieldHandler</span><span class="p">()</span>
                    <span class="n">handler</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">[:],</span> <span class="n">filename</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">nexus_path</span> <span class="ow">and</span> <span class="s2">&quot;nexus_path&quot;</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">nexus_path</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;nexus_path&quot;</span><span class="p">]</span>
                    <span class="n">frame</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="s2">&quot;nexus_image_frame&quot;</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">frame</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                                <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;nexus_image_frame&quot;</span><span class="p">])</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                    <span class="n">node</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="n">nexus_path</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">mdata</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">getMetaData</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                    <span class="n">image</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">getImage</span><span class="p">(</span>
                        <span class="n">node</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="s2">&quot;shape&quot;</span><span class="p">)</span> <span class="ow">and</span> \
                       <span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
                                <span class="n">imagename</span><span class="p">,</span> <span class="n">mdata</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="n">frame</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="s2">&quot;shape&quot;</span><span class="p">)</span> <span class="ow">and</span>
                          <span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">):</span>
                        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">imagename</span><span class="p">,</span> <span class="n">mdata</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">image</span><span class="p">),</span> <span class="n">imagename</span><span class="p">,</span> <span class="n">mdata</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;###CBF: VE&quot;</span><span class="p">,</span> <span class="s2">&quot;b&#39;###CBF: VE&#39;&quot;</span><span class="p">]:</span>
                <span class="c1"># print(&quot;[cbf source module]::metadata&quot;, metadata[&quot;filename&quot;])</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;HiDRASource.getData: &quot;</span>
                    <span class="s2">&quot;[cbf source module]::metadata </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">])</span>
                <span class="n">img</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">FABIO11</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">fimg</span> <span class="o">=</span> <span class="n">fabio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
                        <span class="n">img</span> <span class="o">=</span> <span class="n">fimg</span><span class="o">.</span><span class="n">data</span>
                        <span class="n">mdata</span> <span class="o">=</span> <span class="n">imageFileHandler</span><span class="o">.</span><span class="n">CBFLoader</span><span class="p">()</span><span class="o">.</span><span class="n">metadata</span><span class="p">(</span>
                            <span class="n">fimg</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_array_data.header_contents&quot;</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="c1"># print(str(e))</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                        <span class="n">img</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">img</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;ndarray&quot;</span><span class="p">:</span>
                        <span class="n">npdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[:],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">npdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">[:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                            <span class="n">npdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">data</span><span class="p">[:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
                    <span class="n">img</span> <span class="o">=</span> <span class="n">imageFileHandler</span><span class="o">.</span><span class="n">CBFLoader</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">npdata</span><span class="p">)</span>
                    <span class="n">mdata</span> <span class="o">=</span> <span class="n">imageFileHandler</span><span class="o">.</span><span class="n">CBFLoader</span><span class="p">()</span><span class="o">.</span><span class="n">metadata</span><span class="p">(</span><span class="n">npdata</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">img</span><span class="p">),</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">],</span> <span class="n">mdata</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># elif data[:2] in [&quot;II\x2A\x00&quot;, &quot;MM\x00\x2A&quot;]:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;HiDRASource.getData:&quot;</span>
                    <span class="s2">&quot;[tif source module]::metadata </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">])</span>
                <span class="c1"># print(&quot;[tif source module]::metadata&quot;, metadata[&quot;filename&quot;])</span>
                <span class="k">if</span> <span class="n">PILLOW</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tiffloader</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">data</span><span class="p">))))</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">img</span> <span class="o">=</span> <span class="n">imageFileHandler</span><span class="o">.</span><span class="n">TIFLoader</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">[:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">))</span>
                        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                            <span class="n">img</span> <span class="o">=</span> <span class="n">imageFileHandler</span><span class="o">.</span><span class="n">TIFLoader</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">data</span><span class="p">[:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__tiffloader</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">img</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">img</span><span class="p">),</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">],</span> <span class="s2">&quot;&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">img</span> <span class="o">=</span> <span class="n">imageFileHandler</span><span class="o">.</span><span class="n">TIFLoader</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">[:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="n">img</span> <span class="o">=</span> <span class="n">imageFileHandler</span><span class="o">.</span><span class="n">TIFLoader</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">data</span><span class="p">[:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">))</span>

                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">img</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">img</span><span class="p">),</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">],</span> <span class="s2">&quot;&quot;</span>
            <span class="c1"># else:</span>
            <span class="c1">#     print(</span>
            <span class="c1">#       &quot;[unknown source module]::metadata&quot;, metadata[&quot;filename&quot;])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span></div></div>


<div class="viewcode-block" id="DOOCSPropSource"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.DOOCSPropSource">[docs]</a><span class="k">class</span> <span class="nc">DOOCSPropSource</span><span class="p">(</span><span class="n">BaseSource</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; image source as IMAGE DOOCS property</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param timeout: timeout for setting connection in ms</span>
<span class="sd">        :type timeout: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">BaseSource</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>

<div class="viewcode-block" id="DOOCSPropSource.getData"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.DOOCSPropSource.getData">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">getData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides image name, image data and metadata</span>

<span class="sd">        :returns:  image name, image data, json dictionary with metadata</span>
<span class="sd">        :rtype: (:obj:`str` , :class:`numpy.ndarray` , :obj:`str`)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">pydoocs</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">)</span>
            <span class="n">npdata</span> <span class="o">=</span> <span class="n">dt</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
            <span class="n">tstamp</span> <span class="o">=</span> <span class="n">dt</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">npdata</span><span class="p">),</span>
                    <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">  (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">tstamp</span><span class="p">)),</span>
                    <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="c1"># print(str(e))</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="s2">&quot;__ERROR__&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="DOOCSPropSource.connect"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.DOOCSPropSource.connect">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; connects the source</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span></div></div>


<div class="viewcode-block" id="EpicsPVSource"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.EpicsPVSource">[docs]</a><span class="k">class</span> <span class="nc">EpicsPVSource</span><span class="p">(</span><span class="n">BaseSource</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; image source as Epics Process variable&quot;&quot;&quot;</span>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param timeout: timeout for setting connection in ms</span>
<span class="sd">        :type timeout: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">BaseSource</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>
        <span class="c1">#: (:class:`epics.PV`)</span>
        <span class="c1">#:       epics process variable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__pv</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`list` &lt; :obj:`int` &gt;)</span>
        <span class="c1">#:      process variable shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__shape</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`list` &lt; :obj:`int` &gt;)</span>
        <span class="c1">#:      process variable size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__size</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="EpicsPVSource.getData"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.EpicsPVSource.getData">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">getData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides image name, image data and metadata</span>

<span class="sd">        :returns:  image name, image data, json dictionary with metadata</span>
<span class="sd">        :rtype: (:obj:`str` , :class:`numpy.ndarray` , :obj:`str`)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;No PV defined&quot;</span><span class="p">,</span> <span class="s2">&quot;__ERROR__&quot;</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">rawdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pv</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">as_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                    <span class="n">timeout</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span><span class="o">/</span><span class="mf">1000.</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">rawdata</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__shape</span> <span class="ow">and</span> <span class="n">rawdata</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__size</span><span class="p">:</span>
                    <span class="n">image</span> <span class="o">=</span> <span class="n">rawdata</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">__size</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__shape</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">image</span> <span class="o">=</span> <span class="n">rawdata</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">image</span><span class="p">),</span>
                        <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">,</span> <span class="n">currenttime</span><span class="p">()),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="c1"># print(str(e))</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="s2">&quot;__ERROR__&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="EpicsPVSource.connect"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.EpicsPVSource.connect">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; connects the source</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pvnm</span><span class="p">,</span> <span class="n">pvsh</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initiated</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__pv</span> <span class="o">=</span> <span class="n">epics</span><span class="o">.</span><span class="n">PV</span><span class="p">(</span><span class="n">pvnm</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">shape</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">pvsh</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__shape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">shape</span><span class="p">]))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__shape</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__size</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__shape</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_updaterror</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="c1"># print(str(e))</span>
            <span class="k">return</span> <span class="kc">False</span></div></div>


<div class="viewcode-block" id="TinePropSource"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.TinePropSource">[docs]</a><span class="k">class</span> <span class="nc">TinePropSource</span><span class="p">(</span><span class="n">BaseSource</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; image source as Tine Property &quot;&quot;&quot;</span>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param timeout: timeout for setting connection in ms</span>
<span class="sd">        :type timeout: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">BaseSource</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>
        <span class="c1">#: (:obj:`str`)</span>
        <span class="c1">#:       tine device address name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__address</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`str`)</span>
        <span class="c1">#:       tine property name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__prop</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__dtype</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">header</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides dtype of tine property</span>

<span class="sd">        :param header: tine frameHeader</span>
<span class="sd">        :type header: :obj:`dict` &lt;:obj:`str`, `any`&gt;</span>
<span class="sd">        :returns: numpy dtype</span>
<span class="sd">        :rtype: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">header</span> <span class="ow">or</span> <span class="s2">&quot;bytesPerPixel&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;bytesPerPixel not defined in the header&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">header</span><span class="p">[</span><span class="s2">&quot;bytesPerPixel&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="s2">&quot;u1&quot;</span>
        <span class="k">elif</span> <span class="n">header</span><span class="p">[</span><span class="s2">&quot;bytesPerPixel&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="s2">&quot;u2&quot;</span>
        <span class="k">elif</span> <span class="n">header</span><span class="p">[</span><span class="s2">&quot;bytesPerPixel&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="s2">&quot;u4&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid bytesPerPixel: </span><span class="si">%s</span><span class="s2">&quot;</span>
                             <span class="o">%</span> <span class="n">header</span><span class="p">[</span><span class="s2">&quot;bytesPerPixel&quot;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">dtype</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__height</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">header</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides height of tine property</span>

<span class="sd">        :param header: tine frameHeader</span>
<span class="sd">        :type header: :obj:`dict` &lt;:obj:`str`, `any`&gt;</span>
<span class="sd">        :returns: numpy dtype</span>
<span class="sd">        :rtype: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">height</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="s2">&quot;aoiHeight&quot;</span> <span class="ow">in</span> <span class="n">header</span> <span class="ow">and</span> <span class="n">header</span><span class="p">[</span><span class="s2">&quot;aoiHeight&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="s2">&quot;aoiHeight&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s2">&quot;sourceHeight&quot;</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="s2">&quot;sourceHeight&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">height</span> <span class="o">&lt;=</span> <span class="mi">65535</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid height: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">height</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">height</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__width</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">header</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides width of tine property</span>

<span class="sd">        :param header: tine frameHeader</span>
<span class="sd">        :type header: :obj:`dict` &lt;:obj:`str`, `any`&gt;</span>
<span class="sd">        :returns: numpy dtype</span>
<span class="sd">        :rtype: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">width</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="s2">&quot;aoiWidth&quot;</span> <span class="ow">in</span> <span class="n">header</span> <span class="ow">and</span> <span class="n">header</span><span class="p">[</span><span class="s2">&quot;aoiWidth&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">width</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="s2">&quot;aoiWidth&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s2">&quot;sourceWidth&quot;</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
            <span class="n">width</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="s2">&quot;sourceWidth&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">width</span> <span class="o">&lt;=</span> <span class="mi">65535</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid width: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">width</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">width</span>

<div class="viewcode-block" id="TinePropSource.getData"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.TinePropSource.getData">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">getData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides image name, image data and metadata</span>

<span class="sd">        :returns:  image name, image data, json dictionary with metadata</span>
<span class="sd">        :rtype: (:obj:`str` , :class:`numpy.ndarray` , :obj:`str`)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__address</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__prop</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;No Tine Property defined&quot;</span><span class="p">,</span> <span class="s2">&quot;__ERROR__&quot;</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">interval</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dataFetchThread</span><span class="o">.</span><span class="n">GLOBALREFRESHTIME</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QMutexLocker</span><span class="p">(</span><span class="n">globalmutex</span><span class="p">):</span>
                <span class="n">prop</span> <span class="o">=</span> <span class="n">PyTine</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__address</span><span class="p">,</span>
                                  <span class="nb">property</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__prop</span><span class="p">,</span>
                                  <span class="n">timeout</span><span class="o">=</span><span class="n">interval</span><span class="p">)</span>
            <span class="n">rawdata</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="s2">&quot;imageMatrix&quot;</span> <span class="ow">in</span> <span class="n">rawdata</span><span class="p">:</span>
                <span class="n">image</span> <span class="o">=</span> <span class="n">rawdata</span><span class="p">[</span><span class="s2">&quot;imageMatrix&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">header</span> <span class="o">=</span> <span class="n">rawdata</span><span class="p">[</span><span class="s2">&quot;frameHeader&quot;</span><span class="p">]</span>
                <span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dtype</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
                <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__height</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
                <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__width</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
                <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">rawdata</span><span class="p">[</span><span class="s2">&quot;imageBytes&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="p">)</span> <span class="o">!=</span> <span class="n">height</span> <span class="o">*</span> <span class="n">width</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;Dimension mismatch: size: </span><span class="si">%s</span><span class="s2"> != </span><span class="si">%s</span><span class="s2">&quot;</span>
                        <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="p">),</span> <span class="n">height</span> <span class="o">*</span> <span class="n">width</span><span class="p">))</span>
                <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">))</span>

            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">image</span><span class="p">),</span>
                    <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="c1"># print(str(e))</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="s2">&quot;__ERROR__&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="TinePropSource.setConfiguration"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.imageSource.TinePropSource.setConfiguration">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">setConfiguration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set configuration</span>

<span class="sd">        :param configuration:  configuration string</span>
<span class="sd">        :type configuration: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">configuration</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span> <span class="o">!=</span> <span class="n">configuration</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__prop</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="n">configuration</span><span class="p">)</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span> <span class="o">=</span> <span class="n">configuration</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># print(str(e))</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">LaVue 2.83.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">lavuelib.imageSource</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017 DESY, Jan Kotanski &lt;jkotan@mail.desy.de&gt;, Christoph Rosemann &lt;christoph.rosemann@desy.de&gt; 

GNU GENERAL PUBLIC LICENSE, version 2.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.3.2.
    </div>
  </body>
</html>