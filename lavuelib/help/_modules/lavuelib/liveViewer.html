

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>lavuelib.liveViewer &#8212; LaVue 2.78.0 documentation</title>
    <link rel="stylesheet" href="../../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">LaVue 2.78.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for lavuelib.liveViewer</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (C) 2017  DESY, Christoph Rosemann, Notkestr. 85, D-22607 Hamburg</span>
<span class="c1">#</span>
<span class="c1"># lavue is an image viewing program for photon science imaging detectors.</span>
<span class="c1"># Its usual application is as a live viewer using hidra as data source.</span>
<span class="c1">#</span>
<span class="c1"># This program is free software; you can redistribute it and/or</span>
<span class="c1"># modify it under the terms of the GNU General Public License</span>
<span class="c1"># as published by the Free Software Foundation in  version 2</span>
<span class="c1"># of the License.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with this program; if not, write to the Free Software</span>
<span class="c1"># Foundation, Inc., 51 Franklin Street, Fifth Floor,</span>
<span class="c1"># Boston, MA  02110-1301, USA.</span>
<span class="c1">#</span>
<span class="c1"># Authors:</span>
<span class="c1">#     Christoph Rosemann &lt;christoph.rosemann@desy.de&gt;</span>
<span class="c1">#     Jan Kotanski &lt;jan.kotanski@desy.de&gt;</span>
<span class="c1">#</span>


<span class="sd">&quot;&quot;&quot; live viewer settings &quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">unicode_literals</span>


<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">.qtuic</span> <span class="k">import</span> <span class="n">uic</span>
<span class="kn">from</span> <span class="nn">.qtuic</span> <span class="k">import</span> <span class="n">QWebView</span>
<span class="kn">from</span> <span class="nn">.qtuic</span> <span class="k">import</span> <span class="n">qwebview_error</span>
<span class="kn">from</span> <span class="nn">.qtuic</span> <span class="k">import</span> <span class="n">qwebview_traceback</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pyqtgraph</span> <span class="k">as</span> <span class="nn">_pg</span>
<span class="kn">from</span> <span class="nn">pyqtgraph</span> <span class="k">import</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtGui</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">zmq</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">ntpath</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">scipy.ndimage</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">pyqtgraph</span> <span class="k">import</span> <span class="n">QtWidgets</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">pyqtgraph</span> <span class="k">import</span> <span class="n">QtGui</span> <span class="k">as</span> <span class="n">QtWidgets</span>


<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">imageSource</span> <span class="k">as</span> <span class="n">isr</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">messageBox</span>

<span class="c1"># from . import sourceGroupBox</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">sourceTabWidget</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">toolWidget</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">sourceWidget</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">preparationGroupBox</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">memoryBufferGroupBox</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">scalingGroupBox</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">levelsGroupBox</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">channelGroupBox</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">statisticsGroupBox</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">imageWidget</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">imageField</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">configDialog</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">release</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">edDictDialog</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">filters</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">rangeWindowGroupBox</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">filtersGroupBox</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">helpForm</span>
<span class="kn">from</span> <span class="nn">.sardanaUtils</span> <span class="k">import</span> <span class="n">debugmethod</span>
<span class="c1"># from . import imageNexusExporter</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">controllerClient</span>
    <span class="n">TANGOCLIENT</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="n">TANGOCLIENT</span> <span class="o">=</span> <span class="kc">False</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">imageFileHandler</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">sardanaUtils</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">dataFetchThread</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">settings</span>

<span class="kn">from</span> <span class="nn">.hidraServerList</span> <span class="k">import</span> <span class="n">HIDRASERVERLIST</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">numpy.lib.nanfunctions</span> <span class="k">import</span> <span class="n">_replace_nan</span>
    <span class="kn">from</span> <span class="nn">numpy.lib.nanfunctions</span> <span class="k">import</span> <span class="n">_copyto</span>
    <span class="n">NPNAN</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="n">NPNAN</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;lavue&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
    <span class="n">basestring</span> <span class="o">=</span> <span class="nb">str</span>
    <span class="n">unicode</span> <span class="o">=</span> <span class="nb">str</span>

<span class="nb">__import__</span><span class="p">(</span><span class="s2">&quot;lavuelib.imageNexusExporter&quot;</span><span class="p">)</span>

<span class="c1">#: ( (:obj:`str`,:obj:`str`,:obj:`str`) )</span>
<span class="c1">#:         pg major version, pg minor verion, pg patch version</span>
<span class="n">_VMAJOR</span><span class="p">,</span> <span class="n">_VMINOR</span><span class="p">,</span> <span class="n">_VPATCH</span> <span class="o">=</span> <span class="n">_pg</span><span class="o">.</span><span class="n">__version__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[:</span><span class="mi">3</span><span class="p">]</span> \
    <span class="k">if</span> <span class="n">_pg</span><span class="o">.</span><span class="n">__version__</span> <span class="k">else</span> <span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;9&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span>

<span class="n">_formclass</span><span class="p">,</span> <span class="n">_baseclass</span> <span class="o">=</span> <span class="n">uic</span><span class="o">.</span><span class="n">loadUiType</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span>
                 <span class="s2">&quot;ui&quot;</span><span class="p">,</span> <span class="s2">&quot;MainDialog.ui&quot;</span><span class="p">))</span>


<span class="n">_logginglevel</span> <span class="o">=</span> <span class="s1">&#39;info&#39;</span>


<div class="viewcode-block" id="setLoggerLevel"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.liveViewer.setLoggerLevel">[docs]</a><span class="k">def</span> <span class="nf">setLoggerLevel</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">_logginglevel</span>
    <span class="sd">&quot;&quot;&quot; sets logging level from string</span>
<span class="sd">    :param logger: logger</span>
<span class="sd">    :type logger: :obj:`logging.logger`</span>
<span class="sd">    :param level: logging level</span>
<span class="sd">    :type level: :obj:`str`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">levels</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;debug&#39;</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
              <span class="s1">&#39;info&#39;</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
              <span class="s1">&#39;warning&#39;</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span>
              <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span>
              <span class="s1">&#39;critical&#39;</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">}</span>
    <span class="n">_logginglevel</span> <span class="o">=</span> <span class="n">level</span> <span class="k">if</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">levels</span> <span class="k">else</span> <span class="s2">&quot;info&quot;</span>
    <span class="n">dlevel</span> <span class="o">=</span> <span class="n">levels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">dlevel</span><span class="p">)</span></div>


<div class="viewcode-block" id="MainWindow"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.liveViewer.MainWindow">[docs]</a><span class="k">class</span> <span class="nc">MainWindow</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMainWindow</span><span class="p">):</span>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param options: commandline options</span>
<span class="sd">        :type options: :class:`argparse.Namespace`</span>
<span class="sd">        :param parent: parent object</span>
<span class="sd">        :type parent: :class:`pyqtgraph.QtCore.QObject`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMainWindow</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lavue</span> <span class="o">=</span> <span class="n">LiveViewer</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">centralwidget</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gridLayout</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centralwidget</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gridLayout</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gridLayout</span><span class="o">.</span><span class="n">setMargin</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gridLayout</span><span class="o">.</span><span class="n">setSpacing</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gridLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__lavue</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setCentralWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centralwidget</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;instance&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">instance</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span>
                <span class="s2">&quot;laVue: Live Image Viewer (v</span><span class="si">%s</span><span class="s2">) [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span>
                <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">release</span><span class="o">.</span><span class="n">__version__</span><span class="p">),</span> <span class="n">options</span><span class="o">.</span><span class="n">instance</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span>
                <span class="s2">&quot;laVue: Live Image Viewer (v</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">release</span><span class="o">.</span><span class="n">__version__</span><span class="p">))</span>

<div class="viewcode-block" id="MainWindow.closeEvent"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.liveViewer.MainWindow.closeEvent">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">closeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; stores the setting before finishing the application</span>

<span class="sd">        :param event: close event</span>
<span class="sd">        :type event:  :class:`pyqtgraph.QtCore.QEvent`:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lavue</span><span class="o">.</span><span class="n">closeEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMainWindow</span><span class="o">.</span><span class="n">closeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="LavueState"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.liveViewer.LavueState">[docs]</a><span class="k">class</span> <span class="nc">LavueState</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; lavue state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  constructor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#: (:obj:`dict` &lt; :obj:`str`, :obj:`any`&gt;) lavue state dictionary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__state</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="LavueState.updateState"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.liveViewer.LavueState.updateState">[docs]</a>    <span class="k">def</span> <span class="nf">updateState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dct</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;update lavue state dictonary</span>

<span class="sd">        :param dct: lavue state dictionary</span>
<span class="sd">        :type dct: :obj:`dict` &lt; :obj:`str`, :obj:`any`&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dct</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__state</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dct</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__state</span><span class="p">[</span><span class="s2">&quot;__timestamp__&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span></div>

<div class="viewcode-block" id="LavueState.dump"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.liveViewer.LavueState.dump">[docs]</a>    <span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns string representation</span>

<span class="sd">        :returns: string representation</span>
<span class="sd">        :rtype: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__state</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="PartialData"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.liveViewer.PartialData">[docs]</a><span class="k">class</span> <span class="nc">PartialData</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; partial data</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#: ( :obj:`dict &lt; :obj:`str`, :obj:&#39;bool`&gt; `)</span>
    <span class="c1">#    transformation transpose map</span>
    <span class="n">tpose</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;none&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;fup&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;flr&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;r90&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;r180&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;r270&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;r180t&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">rawdata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">tr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param name: data name</span>
<span class="sd">        :type name: :obj:`str`</span>
<span class="sd">        :param rawdata: raw data</span>
<span class="sd">        :type rawdata: :obj:`numpy.ndarray`</span>
<span class="sd">        :param metadata:  json dictionary with metadata</span>
<span class="sd">        :type metadata: :obj:`str`</span>
<span class="sd">        :param x: x translation</span>
<span class="sd">        :type x: :obj:`int`</span>
<span class="sd">        :param y: y translation</span>
<span class="sd">        :type y: :obj:`int`</span>
<span class="sd">        :param tr: transformation, e.g. fup, flr, t, r90, r180, r270, r180t</span>
<span class="sd">        :type tr: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#: (:obj:`str`) data name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="c1">#: (:class:`numpy.ndarray`) raw data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__rawdata</span> <span class="o">=</span> <span class="n">rawdata</span>
        <span class="c1">#: (:class:`numpy.ndarray`) transformed data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`str`) json dictionary with metadata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span>
        <span class="c1">#: (:obj:`int`) x translation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="c1">#: (:obj:`int`) y translation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
        <span class="c1">#: (:obj:`int`) x size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sx</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1">#: (:obj:`int`) y size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sy</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1">#: (:obj:`int`) color channel size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scc</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1">#: (:obj:`str`) transformation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tr</span> <span class="o">=</span> <span class="n">tr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">,</span> <span class="s2">&quot;shape&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<div class="viewcode-block" id="PartialData.dtype"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.liveViewer.PartialData.dtype">[docs]</a>    <span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides data type</span>

<span class="sd">        :returns: numpy data type</span>
<span class="sd">        :rtype: :obj:`numpy.dtype`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">dtype</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="PartialData.intmaxvalue"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.liveViewer.PartialData.intmaxvalue">[docs]</a>    <span class="k">def</span> <span class="nf">intmaxvalue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides data type maximal value</span>

<span class="sd">        :returns: integer data type maximal value</span>
<span class="sd">        :rtype: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">maxval</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> \
           <span class="nb">issubclass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">()</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">maxval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">())</span><span class="o">.</span><span class="n">max</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">maxval</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">maxval</span></div>

<div class="viewcode-block" id="PartialData.data"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.liveViewer.PartialData.data">[docs]</a>    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provides transformed data</span>

<span class="sd">        :returns: transformed data</span>
<span class="sd">        :rtype: :obj:`numpy.ndarray`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__rawdata</span><span class="p">,</span> <span class="s2">&quot;shape&quot;</span><span class="p">)</span> <span class="ow">and</span> \
               <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__rawdata</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">nshape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__rawdata</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">nshape</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">nshape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">rawdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rawdata</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nshape</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rawdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rawdata</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span> <span class="o">==</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__data</span> <span class="o">=</span> <span class="n">rawdata</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span> <span class="o">==</span> <span class="s1">&#39;fud&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="n">rawdata</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span> <span class="o">==</span> <span class="s1">&#39;flr&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">rawdata</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span> <span class="o">==</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">rawdata</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span> <span class="o">==</span> <span class="s1">&#39;r90&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">rawdata</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span> <span class="o">==</span> <span class="s1">&#39;r180&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="n">rawdata</span><span class="p">))</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span> <span class="o">==</span> <span class="s1">&#39;r270&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="n">rawdata</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span> <span class="o">==</span> <span class="s1">&#39;r180t&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">rawdata</span><span class="p">)),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;rot&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">):</span>
                        <span class="n">rot</span> <span class="o">=</span> <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__data</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span>
                            <span class="n">rawdata</span><span class="p">,</span> <span class="n">rot</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;rot&quot;</span><span class="p">):</span>
                        <span class="n">rot</span> <span class="o">=</span> <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__data</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">rawdata</span><span class="p">,</span> <span class="n">rot</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">):</span>
                        <span class="n">rot</span> <span class="o">=</span> <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__data</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span>
                            <span class="n">rawdata</span><span class="p">,</span> <span class="n">rot</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">):</span>
                        <span class="n">rot</span> <span class="o">=</span> <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__data</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">rawdata</span><span class="p">,</span> <span class="n">rot</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__data</span> <span class="o">=</span> <span class="n">rawdata</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__data</span> <span class="o">=</span> <span class="n">rawdata</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span></div>

<div class="viewcode-block" id="PartialData.tolist"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.liveViewer.PartialData.tolist">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">tolist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; converts partial data to a list</span>

<span class="sd">        :returns: a list: [name, rawdata, metadata, x, y, sx, sy, tr]</span>
<span class="sd">        :rtype: [:obj:`str`, :obj:`numpy.ndarray&#39;, :obj:`str`, :obj:`int`,</span>
<span class="sd">                 :obj:`int`, :obj:`int`, :obj:`int`, :obj:`str`]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rawdata</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">]</span></div></div>


<span class="k">def</span> <span class="nf">_nansum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; old the numpy nansum</span>

<span class="sd">    :param axis: axis to sum up</span>
<span class="sd">    :type axis: :obj:`int`</span>
<span class="sd">    :returns: numpy array with the sum</span>
<span class="sd">    :rtype: :class:`numpy.ndarray`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">NPNAN</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">_replace_nan</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
    <span class="n">tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span>
        <span class="n">tot</span> <span class="o">=</span> <span class="n">_copyto</span><span class="p">(</span><span class="n">tot</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tot</span>


<div class="viewcode-block" id="LiveViewer"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.liveViewer.LiveViewer">[docs]</a><span class="k">class</span> <span class="nc">LiveViewer</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QDialog</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;The master class for the dialog, contains all other</span>
<span class="sd">    widget and handles communication.&#39;&#39;&#39;</span>

    <span class="c1">#: (:class:`pyqtgraph.QtCore.pyqtSignal`) state updated signal</span>
    <span class="n">_stateUpdated</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; constructor</span>

<span class="sd">        :param options: commandline options</span>
<span class="sd">        :type options: :class:`argparse.Namespace`</span>
<span class="sd">        :param parent: parent object</span>
<span class="sd">        :type parent: :class:`pyqtgraph.QtCore.QObject`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QDialog</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="c1"># self.setAttribute(QtCore.Qt.WA_DeleteOnClose)</span>

        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">mode</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;expert&quot;</span><span class="p">]:</span>
            <span class="c1">#: (:obj:`str`) execution mode: expert or user</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__umode</span> <span class="o">=</span> <span class="s2">&quot;expert&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#: (:obj:`str`) execution mode: expert or user</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__umode</span> <span class="o">=</span> <span class="s2">&quot;user&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;configpath&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">configpath</span><span class="p">:</span>
            <span class="n">QtCore</span><span class="o">.</span><span class="n">QSettings</span><span class="o">.</span><span class="n">setPath</span><span class="p">(</span>
                <span class="n">QtCore</span><span class="o">.</span><span class="n">QSettings</span><span class="o">.</span><span class="n">NativeFormat</span><span class="p">,</span>
                <span class="n">QtCore</span><span class="o">.</span><span class="n">QSettings</span><span class="o">.</span><span class="n">UserScope</span><span class="p">,</span>
                <span class="n">options</span><span class="o">.</span><span class="n">configpath</span>
            <span class="p">)</span>
        <span class="c1">#: (:obj:`str`) instance name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__instance</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">instance</span>
        <span class="c1">#: (:obj:`bool`) histogram should be updated</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__updatehisto</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#: (:obj:`int`) program pid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__apppid</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()</span>
        <span class="c1">#: (:obj:`str`) host name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__targetname</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">getfqdn</span><span class="p">()</span>

        <span class="c1">#: (:obj:`list` &lt; :obj:`str` &gt; ) allowed source metadata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__allowedmdata</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;datasources&quot;</span><span class="p">,</span> <span class="s2">&quot;asapostreams&quot;</span><span class="p">]</span>
        <span class="c1">#: (:obj:`list` &lt; :obj:`str` &gt; ) allowed widget metadata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__allowedwgdata</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;axisscales&quot;</span><span class="p">,</span> <span class="s2">&quot;axislabels&quot;</span><span class="p">]</span>

        <span class="c1">#: (:class:`lavuelib.sardanaUtils.SardanaUtils`)</span>
        <span class="c1">#:  sardana utils</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sardana</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#: (:class:`lavuelib.settings.Settings`) settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">Settings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QSettings</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__lavuestate</span> <span class="o">=</span> <span class="n">LavueState</span><span class="p">()</span>

        <span class="c1"># (:class:`lavuelib.imageSource.BaseSource`) data source object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__datasources</span> <span class="o">=</span> <span class="p">[</span><span class="n">isr</span><span class="o">.</span><span class="n">BaseSource</span><span class="p">()</span>
                              <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">nrsources</span><span class="p">)]</span>

        <span class="c1">#: (:obj:`list` &lt; :obj:`str` &gt; ) source class names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sourcetypes</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1">#: (:obj:`list` &lt; :obj:`str` &gt; ) all source aliases</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__allsourcealiases</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#: (:obj:`dict` &lt; :obj:`str`, :obj:`str` &gt; ) source alias names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__srcaliasnames</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1">#: (:obj:`list` &lt; :obj:`str` &gt; ) tool class names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__tooltypes</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1">#: (:obj:`list` &lt; :obj:`str` &gt; ) all tool aliases</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__alltoolaliases</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#: (:obj:`dict` &lt; :obj:`str`, :obj:`str` &gt; ) tool alias names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__tlaliasnames</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__updateTypeList</span><span class="p">(</span>
            <span class="n">sourceWidget</span><span class="o">.</span><span class="n">swproperties</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sourcetypes</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__allsourcealiases</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__srcaliasnames</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__updateTypeList</span><span class="p">(</span>
            <span class="n">toolWidget</span><span class="o">.</span><span class="n">twproperties</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tooltypes</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__alltoolaliases</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tlaliasnames</span>
        <span class="p">)</span>

        <span class="c1">#: (:class:`lavuelib.controllerClient.ControllerClient`)</span>
        <span class="c1">#:   tango controller client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__tangoclient</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#: (:obj:`int`) stacking dimension</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__growing</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`int`) current frame id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__frame</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`str`) nexus field path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__fieldpath</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`bool`) closing flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__closing</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#: (:obj:`bool`) ploting flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ploting</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1">#: (:class:`filters.FilterList` ) user filters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__filters</span> <span class="o">=</span> <span class="n">filters</span><span class="o">.</span><span class="n">FilterList</span><span class="p">()</span>

        <span class="c1">#: (:obj:`int`) filter state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__filterstate</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1">#: (:obj:`float`) last time read</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lasttime</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">#: (:obj:`float`) current time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__currentime</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># WIDGET DEFINITIONS</span>
        <span class="c1">#: (:class:`lavuelib.sourceTabWidget.SourceTabWidget`) source groupbox</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span> <span class="o">=</span> <span class="n">sourceTabWidget</span><span class="o">.</span><span class="n">SourceTabWidget</span><span class="p">(</span>
            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourcetypes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__sourcetypes</span><span class="p">,</span>
            <span class="n">expertmode</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__umode</span> <span class="o">==</span> <span class="s1">&#39;expert&#39;</span><span class="p">),</span>
            <span class="n">nrsources</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">nrsources</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">updateSourceComboBox</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__srcaliasnames</span><span class="p">[</span><span class="n">twn</span><span class="p">]</span>
             <span class="k">for</span> <span class="n">twn</span> <span class="ow">in</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">imagesources</span><span class="p">))</span>
             <span class="k">if</span> <span class="n">twn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__srcaliasnames</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="p">)</span>

        <span class="c1">#: (:class:`lavuelib.rangeWindowGroupBox.RangeWindowGroupBox`)</span>
        <span class="c1">#: memory buffer groupbox</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__rangewg</span> <span class="o">=</span> <span class="n">rangeWindowGroupBox</span><span class="o">.</span><span class="n">RangeWindowGroupBox</span><span class="p">(</span>
            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__rangewg</span><span class="o">.</span><span class="n">factorChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_resizePlot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__rangewg</span><span class="o">.</span><span class="n">rangeWindowChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_resizePlot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__rangewg</span><span class="o">.</span><span class="n">functionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_resizePlot</span><span class="p">)</span>
        <span class="c1">#: (:class:`lavuelib.memoryBufferGroupBox.MemoryBufferGroupBox`)</span>
        <span class="c1">#: memory buffer groupbox</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__mbufferwg</span> <span class="o">=</span> <span class="n">memoryBufferGroupBox</span><span class="o">.</span><span class="n">MemoryBufferGroupBox</span><span class="p">(</span>
            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__mbufferwg</span><span class="o">.</span><span class="n">setMaxBufferSize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">maxmbuffersize</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__mbufferwg</span><span class="o">.</span><span class="n">setComputeSum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">accelbuffersum</span><span class="p">)</span>
        <span class="c1">#: (:class:`lavuelib.filtersGroupBox.FiltersGroupBox`)</span>
        <span class="c1">#  filters widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__filterswg</span> <span class="o">=</span> <span class="n">filtersGroupBox</span><span class="o">.</span><span class="n">FiltersGroupBox</span><span class="p">(</span>
            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1">#: (:class:`lavuelib.preparationGroupBox.PreparationGroupBox`)</span>
        <span class="c1">#: preparation groupbox</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__prepwg</span> <span class="o">=</span> <span class="n">preparationGroupBox</span><span class="o">.</span><span class="n">PreparationGroupBox</span><span class="p">(</span>
            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="p">)</span>
        <span class="c1">#: (:class:`lavuelib.scalingGroupBox.ScalingGroupBox`) scaling groupbox</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__scalingwg</span> <span class="o">=</span> <span class="n">scalingGroupBox</span><span class="o">.</span><span class="n">ScalingGroupBox</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1">#: (:class:`lavuelib.levelsGroupBox.LevelsGroupBox`) level groupbox</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span> <span class="o">=</span> <span class="n">levelsGroupBox</span><span class="o">.</span><span class="n">LevelsGroupBox</span><span class="p">(</span>
            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="p">,</span>
            <span class="n">expertmode</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__umode</span> <span class="o">==</span> <span class="s1">&#39;expert&#39;</span><span class="p">))</span>
        <span class="c1">#: (:class:`lavuelib.levelsGroupBox.LevelsGroupBox`) channel groupbox</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__channelwg</span> <span class="o">=</span> <span class="n">channelGroupBox</span><span class="o">.</span><span class="n">ChannelGroupBox</span><span class="p">(</span>
            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="p">,</span>
            <span class="n">expertmode</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__umode</span> <span class="o">==</span> <span class="s1">&#39;expert&#39;</span><span class="p">))</span>
        <span class="c1">#: (:class:`lavuelib.statisticsGroupBox.StatisticsGroupBox`)</span>
        <span class="c1">#:     statistic groupbox</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__statswg</span> <span class="o">=</span> <span class="n">statisticsGroupBox</span><span class="o">.</span><span class="n">StatisticsGroupBox</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1">#: (:class:`lavuelib.imageWidget.ImageWidget`) image widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span> <span class="o">=</span> <span class="n">imageWidget</span><span class="o">.</span><span class="n">ImageWidget</span><span class="p">(</span>
            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">tooltypes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__tooltypes</span><span class="p">,</span>
            <span class="n">settings</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">updateToolComboBox</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__tlaliasnames</span><span class="p">[</span><span class="n">twn</span><span class="p">]</span>
             <span class="k">for</span> <span class="n">twn</span> <span class="ow">in</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">toolwidgets</span><span class="p">))</span>
             <span class="k">if</span> <span class="n">twn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tlaliasnames</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">iid</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">setImageItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">iid</span><span class="p">),</span> <span class="n">iid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">showGradient</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">showChannels</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__channelwg</span><span class="o">.</span><span class="n">showGradient</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">updateHistoImage</span><span class="p">(</span><span class="n">autoLevel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1">#: (:class:`lavuelib.maskWidget.MaskWidget`) mask widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__maskwg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__prepwg</span><span class="o">.</span><span class="n">maskWidget</span>
        <span class="c1">#: (:class:`lavuelib.highValueMaskWidget.HighValueMaskWidget`)</span>
        <span class="c1">#               high value mask widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__highvaluemaskwg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__prepwg</span><span class="o">.</span><span class="n">highValueMaskWidget</span>
        <span class="c1">#: (:class:`lavuelib.bkgSubtractionWidget.BkgSubtractionWidget`)</span>
        <span class="c1">#:    background subtraction widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__bkgsubwg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__prepwg</span><span class="o">.</span><span class="n">bkgSubWidget</span>
        <span class="c1">#: (:class:`lavuelib.normalizationWidget.NormalizationWidget`)</span>
        <span class="c1">#:    background subtraction widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__normwg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__prepwg</span><span class="o">.</span><span class="n">normWidget</span>
        <span class="c1">#: (:class:`lavuelib.transformationsWidget.TransformationsWidget`)</span>
        <span class="c1">#:    transformations widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__trafowg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__prepwg</span><span class="o">.</span><span class="n">trafoWidget</span>

        <span class="c1"># keep a reference to the &quot;raw&quot; image and the current filename</span>
        <span class="c1">#: (:class:`numpy.ndarray`) raw image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__rawimage</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:class:`numpy.ndarray`) raw image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:class:`numpy.ndarray`) raw gray image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`str`) image name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__imagename</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`str`) last image name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lastimagename</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`int`) integer max value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__intmaxvalue</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`str`) metadata JSON dictionary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__metadata</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="c1">#: (:obj:`str`) metadata dictionary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__mdata</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1">#: (:class:`numpy.ndarray`) displayed image after preparation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:class:`numpy.ndarray`) scaled displayed image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__scaledimage</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#: (:class:`numpy.ndarray`) background image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__backgroundimage</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:class:`numpy.ndarray`) scaled background image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__scbackgroundimage</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:class:`numpy.ndarray`) scaled background scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__backgroundscale</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:class:`numpy.ndarray`) brightfield image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__brightfieldimage</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:class:`numpy.ndarray`) scaled brightfield image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__scbrightfieldimage</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:class:`numpy.ndarray`) scaled brightfield scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__brightfieldscale</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`bool`) apply brightfield - darkfield image subtraction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__bfmdfimage</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: (:obj:`bool`) apply background image subtraction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dobkgsubtraction</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#: (:obj:`bool`) apply brightfield image subtraction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dobfsubtraction</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1">#: (:class:`numpy.ndarray`) mask image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__maskimage</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#: (:obj:`str`) source configuration string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sourceconfiguration</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#: (:obj:`str`) source label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sourcelabel</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#: (:obj:`list`&lt; ( :obj:`int`,:obj:`int` ) &gt; )</span>
        <span class="c1">#        image module translations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__translations</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>

        <span class="c1">#: (:obj:`list`&lt; (:obj:`str`) &gt; ) image module transformations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__transformations</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
        <span class="c1">#: (:obj:`list`&lt; (:obj:`str`) &gt;) image module</span>
        <span class="c1">#                translations and transformations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__trans</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>

        <span class="c1">#: (:obj:`dict`&lt;  (:obj:`str`, :obj:`str`)) transformation names map</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__transmap</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;flipud&quot;</span><span class="p">:</span> <span class="s2">&quot;fud&quot;</span><span class="p">,</span>
            <span class="s2">&quot;flip-up-down&quot;</span><span class="p">:</span> <span class="s2">&quot;fud&quot;</span><span class="p">,</span>
            <span class="s2">&quot;r90t&quot;</span><span class="p">:</span> <span class="s2">&quot;fud&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rot90t&quot;</span><span class="p">:</span> <span class="s2">&quot;fud&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rot90+transpose&quot;</span><span class="p">:</span> <span class="s2">&quot;fud&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fliplr&quot;</span><span class="p">:</span> <span class="s2">&quot;flr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;flip-left-right&quot;</span><span class="p">:</span> <span class="s2">&quot;flr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;r270t&quot;</span><span class="p">:</span> <span class="s2">&quot;flr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rot270t&quot;</span><span class="p">:</span> <span class="s2">&quot;flr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rot270+transpose&quot;</span><span class="p">:</span> <span class="s2">&quot;flr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;transpose&quot;</span><span class="p">:</span> <span class="s2">&quot;t&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rot90&quot;</span><span class="p">:</span> <span class="s2">&quot;r90&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rot180&quot;</span><span class="p">:</span> <span class="s2">&quot;r180&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rot270&quot;</span><span class="p">:</span> <span class="s2">&quot;r270&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rot180t&quot;</span><span class="p">:</span> <span class="s2">&quot;r180t&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rot180+transpose&quot;</span><span class="p">:</span> <span class="s2">&quot;r180t&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1">#: (:obj:`str`) reload flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__reloadflag</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1">#: (:obj:`str`) transformation name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__trafoname</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span>

        <span class="c1">#: (:obj:`bool`) lazy image slider</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lazyimageslider</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1">#: (:obj: dict &lt; :obj:`str` , :obj:`str` &gt;) unsigned/signed int map</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__unsignedmap</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;uint8&quot;</span><span class="p">:</span> <span class="s2">&quot;int16&quot;</span><span class="p">,</span>
            <span class="s2">&quot;uint16&quot;</span><span class="p">:</span> <span class="s2">&quot;int32&quot;</span><span class="p">,</span>
            <span class="s2">&quot;uint32&quot;</span><span class="p">:</span> <span class="s2">&quot;int64&quot;</span><span class="p">,</span>
            <span class="s2">&quot;uint64&quot;</span><span class="p">:</span> <span class="s2">&quot;int64&quot;</span>
            <span class="c1"># &quot;uint64&quot;: &quot;float64&quot;</span>
        <span class="p">}</span>
        <span class="c1">#: (:class:`Ui_LevelsGroupBox&#39;) ui_groupbox object from qtdesigner</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span> <span class="o">=</span> <span class="n">_formclass</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># # LAYOUT DEFINITIONS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">confVerticalLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scroll</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QScrollArea</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scroll</span><span class="o">.</span><span class="n">setSizeAdjustPolicy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scroll</span><span class="o">.</span><span class="n">AdjustToContents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scrollWidget</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scrollVerticalLayout</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scroll</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scroll</span><span class="o">.</span><span class="n">setFrameStyle</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFrame</span><span class="o">.</span><span class="n">NoFrame</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scrollWidget</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scrollVerticalLayout</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">confVerticalLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scroll</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scrollVerticalLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__rangewg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scrollVerticalLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__filterswg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scrollVerticalLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__mbufferwg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scrollVerticalLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__channelwg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scrollVerticalLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__prepwg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scrollVerticalLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__scalingwg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scrollVerticalLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scrollVerticalLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__statswg</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scrollWidget</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scrollVerticalLayout</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scroll</span><span class="o">.</span><span class="n">setHorizontalScrollBarPolicy</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ScrollBarAlwaysOff</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scroll</span><span class="o">.</span><span class="n">setVerticalScrollBarPolicy</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ScrollBarAsNeeded</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scroll</span><span class="o">.</span><span class="n">setWidgetResizable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scroll</span><span class="o">.</span><span class="n">setWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scrollWidget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scroll</span><span class="o">.</span><span class="n">setMinimumWidth</span><span class="p">(</span><span class="mi">380</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">imageVerticalLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="p">)</span>

        <span class="n">spacer</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QSpacerItem</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Minimum</span><span class="p">,</span>
            <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scrollVerticalLayout</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">spacer</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">splitter</span><span class="o">.</span><span class="n">setStretchFactor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">splitter</span><span class="o">.</span><span class="n">setStretchFactor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

        <span class="c1"># SIGNAL LOGIC::</span>

        <span class="c1"># signal from intensity scaling widget:</span>
        <span class="c1"># self.__scalingwg.scalingChanged.connect(self.scale)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__scalingwg</span><span class="o">.</span><span class="n">simpleScalingChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_plot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__scalingwg</span><span class="o">.</span><span class="n">scalingChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setScalingState</span><span class="p">)</span>
        <span class="c1"># signal from limit setting widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">minLevelChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setMinLevelState</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">maxLevelChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setMaxLevelState</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">channelLevelsChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setChannelLevelState</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">autoLevelsChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setAutoLevelsState</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">levelsChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setLevelState</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">gradientChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setGradientState</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">cnfPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">quitPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">loadPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_clickloadfile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">reloadPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pushreloadfile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">helpPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_showhelp</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__umode</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">cnfPushButton</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">hasThemeIcon</span><span class="p">(</span><span class="s2">&quot;applications-system&quot;</span><span class="p">):</span>
            <span class="n">icon</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">fromTheme</span><span class="p">(</span><span class="s2">&quot;applications-system&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">cnfPushButton</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">icon</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">cnfPushButton</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">hasThemeIcon</span><span class="p">(</span><span class="s2">&quot;document-open-recent&quot;</span><span class="p">):</span>
            <span class="n">icon</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">fromTheme</span><span class="p">(</span><span class="s2">&quot;document-open-recent&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">reloadPushButton</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">icon</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">reloadPushButton</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">hasThemeIcon</span><span class="p">(</span><span class="s2">&quot;document-open&quot;</span><span class="p">):</span>
            <span class="n">icon</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">fromTheme</span><span class="p">(</span><span class="s2">&quot;document-open&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">loadPushButton</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">icon</span><span class="p">)</span>
            <span class="c1"># self.__ui.loadPushButton.setText(&quot;&quot;)</span>
        <span class="k">if</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">hasThemeIcon</span><span class="p">(</span><span class="s2">&quot;application-exit&quot;</span><span class="p">):</span>
            <span class="n">icon</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">fromTheme</span><span class="p">(</span><span class="s2">&quot;application-exit&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">quitPushButton</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">icon</span><span class="p">)</span>
            <span class="c1"># self.__ui.quitPushButton.setText(&quot;&quot;)</span>
        <span class="k">if</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">hasThemeIcon</span><span class="p">(</span><span class="s2">&quot;help-browser&quot;</span><span class="p">):</span>
            <span class="n">icon</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">fromTheme</span><span class="p">(</span><span class="s2">&quot;help-browser&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">helpPushButton</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">icon</span><span class="p">)</span>
            <span class="c1"># self.__ui.helpPushButton.setText(&quot;&quot;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">roiCoordsChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_calcUpdateStatsSec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">currentToolChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setToolState</span><span class="p">)</span>
        <span class="c1"># connecting signals from source widget:</span>

        <span class="c1"># gradient selector</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__channelwg</span><span class="o">.</span><span class="n">rgbChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setRGBState</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__channelwg</span><span class="o">.</span><span class="n">channelChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setChannelState</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">aspectLockedToggled</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setAspectLocked</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">storeSettingsRequested</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_storeSettings</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">replotImage</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_replot</span><span class="p">)</span>
        <span class="c1"># simple mutable caching object for data exchange with thread</span>
        <span class="c1">#: (:class:`lavuelib.dataFetchTread.ExchangeList`)</span>
        <span class="c1">#:    exchange list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__exchangelists</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__datasources</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__exchangelists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataFetchThread</span><span class="o">.</span><span class="n">ExchangeList</span><span class="p">())</span>

        <span class="c1">#: (:class:`lavuelib.dataFetchTread.DataFetchThread`)</span>
        <span class="c1">#:    data fetch thread</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dataFetchers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ds</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__datasources</span><span class="p">):</span>
            <span class="n">dft</span> <span class="o">=</span> <span class="n">dataFetchThread</span><span class="o">.</span><span class="n">DataFetchThread</span><span class="p">(</span>
                <span class="n">ds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__exchangelists</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dataFetchers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dft</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_stateUpdated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">dft</span><span class="o">.</span><span class="n">changeStatus</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dataFetchers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">newDataNameFetched</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getNewData</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">sourceStateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_updateSource</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">sourceChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_onSourceChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">sourceConnected</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_connectSource</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">sourceDisconnected</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_disconnectSource</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__bkgsubwg</span><span class="o">.</span><span class="n">bkgFileSelected</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_prepareBkgSubtraction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__bkgsubwg</span><span class="o">.</span><span class="n">useCurrentImageAsBkg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setCurrentImageAsBkg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__bkgsubwg</span><span class="o">.</span><span class="n">applyStateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_checkBkgSubtraction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__bkgsubwg</span><span class="o">.</span><span class="n">bkgScalingFactorChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_updateBkgScale</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__normwg</span><span class="o">.</span><span class="n">bfFileSelected</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_prepareBFSubtraction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__normwg</span><span class="o">.</span><span class="n">useCurrentImageAsBF</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setCurrentImageAsBF</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__normwg</span><span class="o">.</span><span class="n">applyBFStateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_checkBFSubtraction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__normwg</span><span class="o">.</span><span class="n">bfScalingFactorChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_updateBFScale</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__maskwg</span><span class="o">.</span><span class="n">maskFileSelected</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_prepareMasking</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__maskwg</span><span class="o">.</span><span class="n">applyStateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_checkMasking</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__highvaluemaskwg</span><span class="o">.</span><span class="n">maskHighValueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_checkHighMasking</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__highvaluemaskwg</span><span class="o">.</span><span class="n">applyStateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_checkHighMasking</span><span class="p">)</span>

        <span class="c1"># signals from transformation widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__trafowg</span><span class="o">.</span><span class="n">transformationChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_assessTransformation</span><span class="p">)</span>

        <span class="c1"># signals from transformation widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__filterswg</span><span class="o">.</span><span class="n">filtersChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_assessFilters</span><span class="p">)</span>

        <span class="c1"># signals from transformation widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__mbufferwg</span><span class="o">.</span><span class="n">bufferSizeChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setBufferSizeState</span><span class="p">)</span>

        <span class="c1"># set the right target name for the source display at initialization</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">sourceLabelChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_switchSourceDisplay</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">addIconClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_addLabel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">removeIconClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_removeLabel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">translationChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setTranslation</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameLineEdit</span><span class="o">.</span><span class="n">textChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_spinreloadfile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">lowerframePushButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lowerframepushed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">higherframePushButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_higherframepushed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameHorizontalSlider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sliderreloadfilelazy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__connectslider</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">updateLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">emitSourceChanged</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">showCurrentTool</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__loadSettings</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__resetFilters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">filters</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__updateframeview</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__updateframeratetip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">refreshrate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setExtensionsRefreshTime</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">toolrefreshtime</span><span class="p">)</span>

        <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__applyoptions</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setState</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">start</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__updateTool</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">tool</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">toolConfigurationChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_onToolConfigurationChanged</span><span class="p">)</span>

<div class="viewcode-block" id="LiveViewer.setState"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.liveViewer.LiveViewer.setState">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">setState</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set current state &quot;&quot;&quot;</span>

        <span class="n">dssa</span> <span class="o">=</span> <span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">currentDataSourceAlias</span><span class="p">())</span>
        <span class="n">configuration</span> <span class="o">=</span> <span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">configuration</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">isAutoLevel</span><span class="p">():</span>
            <span class="n">levels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">levels</span><span class="p">()</span>
            <span class="n">autofactor</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">autofactor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">autoFactor</span><span class="p">()</span>
            <span class="n">levels</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">bkgfile</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bkgsubwg</span><span class="o">.</span><span class="n">isBkgSubApplied</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">bkgimagename</span><span class="p">:</span>
                <span class="n">bkgfile</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">bkgimagename</span><span class="p">)</span>
        <span class="n">bffile</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__normwg</span><span class="o">.</span><span class="n">isBFSubApplied</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">bfimagename</span><span class="p">:</span>
                <span class="n">bffile</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">bfimagename</span><span class="p">)</span>
        <span class="n">maskfile</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__maskwg</span><span class="o">.</span><span class="n">isMaskApplied</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">maskimagename</span><span class="p">:</span>
                <span class="n">maskfile</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">maskimagename</span><span class="p">)</span>
        <span class="n">maskhighvalue</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showhighvaluemask</span><span class="p">:</span>
            <span class="n">maskhighvalue</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__highvaluemaskwg</span><span class="o">.</span><span class="n">mask</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">bkgscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__backgroundscale</span> \
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showsubsf</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">bfscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__brightfieldscale</span> \
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">shownormsf</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLavueState</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;connected&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">isConnected</span><span class="p">(),</span>
                <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">dssa</span><span class="p">,</span>
                <span class="s2">&quot;configuration&quot;</span><span class="p">:</span> <span class="n">configuration</span><span class="p">,</span>
                <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translations</span><span class="p">(),</span>
                <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__umode</span><span class="p">,</span>
                <span class="s2">&quot;instance&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__instance</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;scaling&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__scalingwg</span><span class="o">.</span><span class="n">currentScaling</span><span class="p">()),</span>
                <span class="s2">&quot;transformation&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__trafowg</span><span class="o">.</span><span class="n">transformation</span><span class="p">()),</span>
                <span class="s2">&quot;tool&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">tool</span><span class="p">()),</span>
                <span class="s2">&quot;toolconfig&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">toolConfiguration</span><span class="p">(),</span>
                <span class="s2">&quot;levels&quot;</span><span class="p">:</span> <span class="n">levels</span><span class="p">,</span>
                <span class="s2">&quot;autofactor&quot;</span><span class="p">:</span> <span class="n">autofactor</span><span class="p">,</span>
                <span class="s2">&quot;gradient&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">gradient</span><span class="p">(),</span>
                <span class="s2">&quot;maskhighvalue&quot;</span><span class="p">:</span> <span class="n">maskhighvalue</span><span class="p">,</span>
                <span class="s2">&quot;maskfile&quot;</span><span class="p">:</span> <span class="n">maskfile</span><span class="p">,</span>
                <span class="s2">&quot;bkgfile&quot;</span><span class="p">:</span> <span class="n">bkgfile</span><span class="p">,</span>
                <span class="s2">&quot;bkgscale&quot;</span><span class="p">:</span> <span class="n">bkgscale</span><span class="p">,</span>
                <span class="s2">&quot;brightfieldfile&quot;</span><span class="p">:</span> <span class="n">bffile</span><span class="p">,</span>
                <span class="s2">&quot;brightfieldscale&quot;</span><span class="p">:</span> <span class="n">bfscale</span><span class="p">,</span>
                <span class="s2">&quot;channel&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__channelwg</span><span class="o">.</span><span class="n">channelLabel</span><span class="p">(),</span>
                <span class="s2">&quot;mbuffer&quot;</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__mbufferwg</span><span class="o">.</span><span class="n">bufferSize</span><span class="p">()</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">),</span>
                <span class="s2">&quot;doordevice&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">doorname</span><span class="p">,</span>
                <span class="s2">&quot;tangodevice&quot;</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__tangoclient</span><span class="o">.</span><span class="n">device</span><span class="p">()</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tangoclient</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="s2">&quot;analysisdevice&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">analysisdevice</span><span class="p">,</span>
                <span class="s2">&quot;rangewindow&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rangewg</span><span class="o">.</span><span class="n">rangeWindow</span><span class="p">(),</span>
                <span class="s2">&quot;dsfactor&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rangewg</span><span class="o">.</span><span class="n">factor</span><span class="p">(),</span>
                <span class="s2">&quot;dsreduction&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__rangewg</span><span class="o">.</span><span class="n">function</span><span class="p">()),</span>
                <span class="s2">&quot;filters&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__filterstate</span><span class="p">,</span>
                <span class="s2">&quot;imagefile&quot;</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">imagename</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">release</span><span class="o">.</span><span class="n">__version__</span><span class="p">),</span>
            <span class="p">})</span></div>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_setScalingState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scaling</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sets scaling state</span>

<span class="sd">        :param scalingtype: scaling type, i.e. log, linear, sqrt</span>
<span class="sd">        :type scalingtype: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">setScalingLabel</span><span class="p">(</span><span class="n">scaling</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLavueState</span><span class="p">({</span><span class="s2">&quot;scaling&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">scaling</span><span class="p">)})</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_setChannelState</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sets gradient state</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># eself.__levelswg.setScalingLabel(scaling)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">setRGBChannels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__channelwg</span><span class="o">.</span><span class="n">rgbchannels</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLavueState</span><span class="p">({</span><span class="s2">&quot;channel&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__channelwg</span><span class="o">.</span><span class="n">channelLabel</span><span class="p">()})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span><span class="p">()</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_setGradientState</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sets gradient state</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLavueState</span><span class="p">({</span><span class="s2">&quot;gradient&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">gradient</span><span class="p">()})</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_setToolState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sets tool state</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLavueState</span><span class="p">({</span><span class="s2">&quot;tool&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">tool</span><span class="p">()})</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_setBufferSizeState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sets buffer size state</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLavueState</span><span class="p">({</span><span class="s2">&quot;mbuffer&quot;</span><span class="p">:</span> <span class="n">size</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;channellabels&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__mdata</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__mdata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;channellabels&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;suminthelast&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__mdata</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__mdata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;suminthelast&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;skipfirst&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__mdata</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__mdata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;skipfirst&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__channelwg</span><span class="o">.</span><span class="n">updateChannelLabels</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__setLevelState</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sets intensity level state</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">isAutoLevel</span><span class="p">():</span>
            <span class="n">levels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">levels</span><span class="p">()</span>
            <span class="n">autofactor</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">autofactor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">autoFactor</span><span class="p">()</span>
            <span class="n">levels</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLavueState</span><span class="p">({</span><span class="s2">&quot;levels&quot;</span><span class="p">:</span> <span class="n">levels</span><span class="p">,</span> <span class="s2">&quot;autofactor&quot;</span><span class="p">:</span> <span class="n">autofactor</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">_setLevelState</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sets intensity level state and plot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__setLevelState</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span><span class="p">()</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_setMinLevelState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sets minimum intensity level</span>

<span class="sd">        :param level: minimum intensity</span>
<span class="sd">        :type level: :obj:`float`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setMinLevel</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setLevelMode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">levelMode</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setLevelState</span><span class="p">()</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_setMaxLevelState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sets maximum intensity level</span>

<span class="sd">        :param level: maximum intensity</span>
<span class="sd">        :type level: :obj:`float`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setMaxLevel</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setLevelMode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">levelMode</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setLevelState</span><span class="p">()</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_setChannelLevelState</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sets maximum intensity level</span>

<span class="sd">        :param level: json with channel levels</span>
<span class="sd">        :type level: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">levels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">channelLevels</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">levels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setLevelMode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">levelMode</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setChannelLevels</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setLevelState</span><span class="p">()</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_setAutoLevelsState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">autolevels</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sets auto levels</span>

<span class="sd">        :param autolevels: 2: auto levels enabled 1: with autofactor</span>
<span class="sd">        :type autolevels: :obj:&#39;int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setAutoLevels</span><span class="p">(</span><span class="n">autolevels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setLevelState</span><span class="p">()</span>

<div class="viewcode-block" id="LiveViewer.setLavueState"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.liveViewer.LiveViewer.setLavueState">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">setLavueState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dct</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; update LavueState of LavueController</span>

<span class="sd">        :param dct: lavue state dictionary</span>
<span class="sd">        :type dct: :obj:`dict` &lt; :obj:`str`, :obj:`any`&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dct</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__lavuestate</span><span class="o">.</span><span class="n">updateState</span><span class="p">(</span><span class="n">dct</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lavuestate</span><span class="o">.</span><span class="n">updateState</span><span class="p">({</span>
            <span class="s2">&quot;viewrange&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">viewRange</span><span class="p">()</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">writeAttribute</span><span class="p">(</span>
            <span class="s2">&quot;LavueState&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lavuestate</span><span class="o">.</span><span class="n">dump</span><span class="p">())</span></div>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_showhelp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; shows the detail help</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">QWebView</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">messageBox</span><span class="o">.</span><span class="n">MessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;lavue: &quot;</span>
                <span class="s2">&quot;Help cannot be display because &quot;</span>
                <span class="s2">&quot;QtWebKitWigets or QtWebKit module is not installed&quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">qwebview_error</span><span class="p">),</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">qwebview_traceback</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">helpForm</span><span class="o">.</span><span class="n">HelpForm</span><span class="p">(</span><span class="s2">&quot;qrc:/help/index.html&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="n">form</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">_translations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; povides translations and optional transformations</span>
<span class="sd">            of the given sources</span>

<span class="sd">        :returns: x,y tranlation or x,y,transformations, e.g. 2345,354,r90</span>
<span class="sd">        :rtype: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nrsources</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__datasources</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__trans</span><span class="p">))</span>
        <span class="k">return</span> <span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__trans</span><span class="p">[:</span><span class="n">nrsources</span><span class="p">])</span>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_setTranslation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trans</span><span class="p">,</span> <span class="n">sid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sets translation and optional transfromation of the given source</span>

<span class="sd">        :param trans: x,y tranlation or x,y,transformations, e.g. 2345,354</span>
<span class="sd">        :type trans: :obj:`str`</span>
<span class="sd">        :param sid: source id</span>
<span class="sd">        :type sid: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">y</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">tr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">strans</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">strans</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">strans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">strans</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">strans</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">strans</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">tr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">strans</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__translations</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">sid</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__translations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__transformations</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">sid</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__transformations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__trans</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">sid</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__trans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__translations</span><span class="p">[</span><span class="n">sid</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__transformations</span><span class="p">[</span><span class="n">sid</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__transmap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">tr</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__trans</span><span class="p">[</span><span class="n">sid</span><span class="p">]</span> <span class="o">=</span> <span class="n">trans</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translations</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLavueState</span><span class="p">({</span><span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="n">offset</span><span class="p">})</span>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">__updateTypeList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">properties</span><span class="p">,</span> <span class="n">typelist</span><span class="p">,</span>
                         <span class="n">allaliases</span><span class="p">,</span> <span class="n">snametoname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; updates type list, i.e. typelist, allaliases and snametoname</span>

<span class="sd">        :param properties: dictionary with properies, i.e.</span>
<span class="sd">                            {&quot;requires&quot;: (&quot;&lt;PACKAGE1&gt;&quot;,&quot;&lt;PACKAGE2&gt;&quot;),</span>
<span class="sd">                             &quot;alias&quot;: &quot;&lt;alias&gt;&quot;,</span>
<span class="sd">                             &quot;widget&quot;: &quot;&lt;widgettype&gt;&quot;,</span>
<span class="sd">                             &quot;name&quot;: &quot;&lt;name&gt;&quot;}</span>
<span class="sd">        :type properties: :obj:`dict` &lt; :obj:`str`, :obj:`str`&gt;</span>
<span class="sd">        :param typelist: type list</span>
<span class="sd">        :type typelist: :obj:`list` &lt; :obj:`str`&gt;</span>
<span class="sd">        :param allaliases: a list of aliases</span>
<span class="sd">        :type allaliases: :obj:`list` &lt; :obj:`str`&gt;</span>
<span class="sd">        :param snametoname: alias to name dictionary</span>
<span class="sd">        :type snametoname: :obj:`dict` &lt; :obj:`str`, :obj:`str`&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">typelist</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">allaliases</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">wp</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">:</span>
            <span class="n">avail</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">req</span> <span class="ow">in</span> <span class="n">wp</span><span class="p">[</span><span class="s2">&quot;requires&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">isr</span><span class="p">,</span> <span class="n">req</span><span class="p">):</span>
                    <span class="n">avail</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="n">avail</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">wp</span><span class="p">[</span><span class="s2">&quot;alias&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">typelist</span><span class="p">:</span>
                    <span class="n">typelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wp</span><span class="p">[</span><span class="s2">&quot;widget&quot;</span><span class="p">])</span>
            <span class="n">allaliases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wp</span><span class="p">[</span><span class="s2">&quot;alias&quot;</span><span class="p">])</span>
            <span class="n">snametoname</span><span class="p">[</span><span class="n">wp</span><span class="p">[</span><span class="s2">&quot;alias&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">wp</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">__switchlazysignals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;switch lazy signals</span>

<span class="sd">        :param lazy: lazy image slider flag</span>
<span class="sd">        :type lazy: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">lazy</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameHorizontalSlider</span><span class="o">.</span><span class="n">sliderReleased</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sliderreloadfile</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__lazyimageslider</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameHorizontalSlider</span><span class="o">.</span><span class="n">sliderReleased</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sliderreloadfile</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__lazyimageslider</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">__disconnectslider</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;switch lazy signals</span>

<span class="sd">        :param lazy: lazy image slider flag</span>
<span class="sd">        :type lazy: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lazyimageslider</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameHorizontalSlider</span><span class="o">.</span><span class="n">sliderReleased</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sliderreloadfile</span><span class="p">)</span>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">__connectslider</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;switch lazy signals</span>

<span class="sd">        :param lazy: lazy image slider flag</span>
<span class="sd">        :type lazy: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lazyimageslider</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameHorizontalSlider</span><span class="o">.</span><span class="n">sliderReleased</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sliderreloadfile</span><span class="p">)</span>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">__resetFilters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; resets filters</span>

<span class="sd">        :param filters: filters settings</span>
<span class="sd">        :type filters: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fsettings</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__filters</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">fsettings</span><span class="p">)</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot; | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">flt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                                <span class="k">for</span> <span class="n">flt</span> <span class="ow">in</span> <span class="n">fsettings</span> <span class="k">if</span> <span class="n">flt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">32</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="p">[:</span><span class="mi">32</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; ...&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__filterswg</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__filterswg</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span>
                     <span class="p">(</span><span class="n">flt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                      <span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">flt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="n">flt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                     <span class="k">for</span> <span class="n">flt</span> <span class="ow">in</span> <span class="n">fsettings</span> <span class="k">if</span> <span class="n">flt</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">filters</span> <span class="o">!=</span> <span class="n">filters</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">filters</span> <span class="o">=</span> <span class="n">filters</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__filterswg</span><span class="o">.</span><span class="n">setState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="kn">import</span> <span class="nn">traceback</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>
            <span class="n">messageBox</span><span class="o">.</span><span class="n">MessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;lavue: problems in setting filters&quot;</span><span class="p">,</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span>
            <span class="c1"># print(str(e))</span>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_addLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; emits addIconClicked signal</span>

<span class="sd">        :param name: object name</span>
<span class="sd">        :type name: :obj:`str`</span>
<span class="sd">        :param value: text value</span>
<span class="sd">        :type value: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">labelvalues</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">dform</span> <span class="o">=</span> <span class="n">edDictDialog</span><span class="o">.</span><span class="n">EdDictDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">dform</span><span class="o">.</span><span class="n">record</span> <span class="o">=</span> <span class="n">labelvalues</span>
        <span class="n">dform</span><span class="o">.</span><span class="n">newvalues</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
        <span class="c1"># dform.title = self.__objtitles[repr(obj)]</span>
        <span class="n">dform</span><span class="o">.</span><span class="n">createGUI</span><span class="p">()</span>
        <span class="n">dform</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">dform</span><span class="o">.</span><span class="n">dirty</span><span class="p">:</span>
            <span class="n">labelvalues</span> <span class="o">=</span> <span class="n">dform</span><span class="o">.</span><span class="n">record</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">labelvalues</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                    <span class="n">labelvalues</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">labelvalues</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__updateSource</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_storeSettings</span><span class="p">()</span>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_removeLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; emits addIconClicked signal</span>

<span class="sd">        :param name: object name</span>
<span class="sd">        :type name: :obj:`str`</span>
<span class="sd">        :param value: text value label to remove</span>
<span class="sd">        :type value: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="n">labelvalues</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labelvalues</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">labelvalues</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">labelvalues</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__updateSource</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_storeSettings</span><span class="p">()</span>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">__updateSource</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">detservers</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detservers</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">detservers</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">defdetservers</span><span class="p">:</span>
                <span class="n">serverdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">HIDRASERVERLIST</span><span class="p">)</span>
                <span class="n">defpool</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">serverdict</span><span class="p">[</span><span class="s2">&quot;pool&quot;</span><span class="p">])</span>
                <span class="n">defpool</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">detservers</span><span class="p">)</span>
                <span class="n">serverdict</span><span class="p">[</span><span class="s2">&quot;pool&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">defpool</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">serverdict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;pool&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">detservers</span><span class="p">)}</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">defdetservers</span><span class="p">:</span>
            <span class="n">serverdict</span> <span class="o">=</span> <span class="n">HIDRASERVERLIST</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">serverdict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;pool&quot;</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">updateMetaData</span><span class="p">(</span>
            <span class="n">zmqtopics</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">zmqtopics</span><span class="p">,</span>
            <span class="n">dirtrans</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">dirtrans</span><span class="p">,</span>
            <span class="n">tangoattrs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">tangoattrs</span><span class="p">,</span>
            <span class="n">tangoevattrs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">tangoevattrs</span><span class="p">,</span>
            <span class="n">tangofileattrs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">tangofileattrs</span><span class="p">,</span>
            <span class="n">tangodirattrs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">tangodirattrs</span><span class="p">,</span>
            <span class="n">zmqservers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">zmqservers</span><span class="p">,</span>
            <span class="n">httpurls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">httpurls</span><span class="p">,</span>
            <span class="n">autozmqtopics</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">autozmqtopics</span><span class="p">,</span>
            <span class="n">nxslast</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">nxslast</span><span class="p">,</span>
            <span class="n">nxsopen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">nxsopen</span><span class="p">,</span>
            <span class="n">serverdict</span><span class="o">=</span><span class="n">serverdict</span><span class="p">,</span>
            <span class="n">hidraport</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">hidraport</span><span class="p">,</span>
            <span class="n">doocsprops</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">doocsprops</span><span class="p">,</span>
            <span class="n">tineprops</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">tineprops</span><span class="p">,</span>
            <span class="n">epicspvnames</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">epicspvnames</span><span class="p">,</span>
            <span class="n">epicspvshapes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">epicspvshapes</span><span class="p">,</span>
            <span class="n">asaposerver</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">asaposerver</span><span class="p">,</span>
            <span class="n">asapotoken</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">asapotoken</span><span class="p">,</span>
            <span class="n">asapodatasources</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">asapodatasources</span><span class="p">,</span>
            <span class="n">asapobeamtime</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">asapobeamtime</span><span class="p">,</span>
            <span class="n">asaposourcepath</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">asaposourcepath</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_updateSource</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_updateLavueState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; updates lavue state configuration</span>

<span class="sd">        :param state: json dictionary with configuration</span>
<span class="sd">        :type state: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">state</span><span class="p">:</span>
            <span class="n">dctcnf</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">state</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">dctcnf</span><span class="p">:</span>
                <span class="n">srccnf</span> <span class="o">=</span> <span class="s2">&quot;source&quot;</span> <span class="ow">in</span> <span class="n">dctcnf</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">or</span> \
                    <span class="s2">&quot;configuration&quot;</span> <span class="ow">in</span> <span class="n">dctcnf</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">dctcnf</span><span class="p">[</span><span class="s2">&quot;stop&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;stop&quot;</span> <span class="ow">in</span> <span class="n">dctcnf</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">dctcnf</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;start&quot;</span> <span class="ow">in</span> <span class="n">dctcnf</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="n">tool</span> <span class="o">=</span> <span class="n">dctcnf</span><span class="p">[</span><span class="s2">&quot;tool&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;tool&quot;</span> <span class="ow">in</span> <span class="n">dctcnf</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="s2">&quot;connected&quot;</span> <span class="ow">in</span> <span class="n">dctcnf</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> \
                   <span class="n">stop</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">dctcnf</span><span class="p">[</span><span class="s2">&quot;connected&quot;</span><span class="p">]:</span>
                        <span class="n">start</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">stop</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">running</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">isConnected</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">srccnf</span> <span class="ow">or</span> <span class="n">stop</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">isConnected</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">toggleServerConnection</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__applyoptionsfromdict</span><span class="p">(</span><span class="n">dctcnf</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">isConnected</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">toggleServerConnection</span><span class="p">()</span>
                    <span class="k">elif</span> <span class="n">running</span> <span class="ow">and</span> <span class="n">srccnf</span> <span class="ow">and</span> <span class="n">stop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">toggleServerConnection</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__updateTool</span><span class="p">(</span><span class="n">tool</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setState</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">dctcnf</span> <span class="ow">or</span> \
               <span class="p">(</span><span class="s2">&quot;__update__&quot;</span> <span class="ow">in</span> <span class="n">dctcnf</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">dctcnf</span><span class="p">[</span><span class="s2">&quot;__update__&quot;</span><span class="p">]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setLavueState</span><span class="p">()</span>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">__updateTool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; update current tool</span>

<span class="sd">        :param tool: alias tool name</span>
<span class="sd">        :type tool: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">tool</span> <span class="ow">and</span> <span class="n">tool</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">tool</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">showCurrentTool</span><span class="p">()</span>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">__applyoptionsfromdict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dctcnf</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; apply options</span>

<span class="sd">        :param dctcnf: commandline options</span>
<span class="sd">        :type dctcnf: :obj:`dict` &lt;:obj:`str`, any &gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dctcnf</span><span class="p">:</span>
            <span class="n">options</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">vl</span> <span class="ow">in</span> <span class="n">dctcnf</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">vl</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__applyoptions</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">__applyoptions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; apply options</span>

<span class="sd">        :param options: commandline options</span>
<span class="sd">        :type options: :class:`argparse.Namespace`</span>
<span class="sd">        :returns: start flag</span>
<span class="sd">        :rtype: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;log&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">log</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">setLoggerLevel</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">log</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setLavueState</span><span class="p">({</span><span class="s2">&quot;log&quot;</span><span class="p">:</span> <span class="n">_logginglevel</span><span class="p">})</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;doordevice&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">doordevice</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">doorname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">doordevice</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setLavueState</span><span class="p">({</span><span class="s2">&quot;doordevice&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">doorname</span><span class="p">})</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;analysisdevice&quot;</span><span class="p">)</span> <span class="ow">and</span> \
           <span class="n">options</span><span class="o">.</span><span class="n">analysisdevice</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">analysisdevice</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">analysisdevice</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setLavueState</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;analysisdevice&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">analysisdevice</span><span class="p">})</span>

        <span class="c1"># load image file</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;imagefile&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">imagefile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">oldname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">imagename</span>
            <span class="n">oldpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__fieldpath</span>
            <span class="n">oldgrowing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__growing</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">sfid</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__growing</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">newname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">imagefile</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;,&quot;</span> <span class="ow">in</span> <span class="n">newname</span><span class="p">:</span>
                    <span class="n">splname</span> <span class="o">=</span> <span class="n">newname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                    <span class="n">newname</span> <span class="o">=</span> <span class="n">splname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">splname</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__growing</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">splname</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                            <span class="k">pass</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">splname</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">sfid</span> <span class="o">=</span> <span class="n">splname</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">imagename</span> <span class="o">=</span> <span class="n">newname</span>
                <span class="k">if</span> <span class="s2">&quot;:/&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">imagename</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">imagename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__fieldpath</span> <span class="o">=</span>  \
                        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">imagename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:/&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__fieldpath</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">imagename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">imagename</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">imagename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.nxs&quot;</span><span class="p">)</span> \
                   <span class="ow">and</span> <span class="ow">not</span> <span class="n">imagename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.h5&quot;</span><span class="p">)</span> \
                   <span class="ow">and</span> <span class="ow">not</span> <span class="n">imagename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.nx&quot;</span><span class="p">)</span> \
                   <span class="ow">and</span> <span class="ow">not</span> <span class="n">imagename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.ndf&quot;</span><span class="p">)</span> \
                   <span class="ow">and</span> <span class="ow">not</span> <span class="n">imagename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.hdf&quot;</span><span class="p">):</span>
                    <span class="n">fid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__findfid</span><span class="p">(</span><span class="n">imagename</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">fid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sfid</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="n">fid</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_loadfile</span><span class="p">(</span><span class="n">fid</span><span class="o">=</span><span class="n">fid</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">imagename</span> <span class="o">=</span> <span class="n">oldname</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__fieldpath</span> <span class="o">=</span> <span class="n">oldpath</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__growing</span> <span class="o">=</span> <span class="n">oldgrowing</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setLavueState</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;imagefile&quot;</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">imagename</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)})</span>

        <span class="c1"># set image source</span>
        <span class="n">sourcechanged</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;source&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">srcnames</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">source</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__setNumberOfSources</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">srcnames</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">srcname</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">srcnames</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">srcname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__srcaliasnames</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">setSourceComboBoxByName</span><span class="p">(</span>
                        <span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__srcaliasnames</span><span class="p">[</span><span class="n">srcname</span><span class="p">])</span>
            <span class="n">sourcechanged</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">sourcechanged</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__updateSource</span><span class="p">()</span>

        <span class="n">QtCore</span><span class="o">.</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;configuration&quot;</span><span class="p">)</span> <span class="ow">and</span> \
           <span class="n">options</span><span class="o">.</span><span class="n">configuration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cnfs</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">configuration</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cnf</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cnfs</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">cnf</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">sourcechanged</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setSourceConfiguration</span><span class="p">()</span>

        <span class="n">QtCore</span><span class="o">.</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">offs</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">offset</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">offs</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_setTranslation</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">offset</span><span class="p">),</span> <span class="n">i</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">setTranslation</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">offset</span><span class="p">),</span> <span class="n">i</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;rangewindow&quot;</span><span class="p">)</span> <span class="ow">and</span> \
           <span class="n">options</span><span class="o">.</span><span class="n">rangewindow</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showrange</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showrange</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__rangewg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_resizePlot</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__rangewg</span><span class="o">.</span><span class="n">setFactor</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">dsfactor</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__rangewg</span><span class="o">.</span><span class="n">setRangeWindow</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">rangewindow</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;dsfactor&quot;</span><span class="p">)</span> <span class="ow">and</span> \
           <span class="n">options</span><span class="o">.</span><span class="n">dsfactor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showrange</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">dsf</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">dsfactor</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">dsf</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">dsf</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showrange</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__rangewg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_resizePlot</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__rangewg</span><span class="o">.</span><span class="n">setFactor</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">dsfactor</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;dsreduction&quot;</span><span class="p">)</span> <span class="ow">and</span> \
           <span class="n">options</span><span class="o">.</span><span class="n">dsreduction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showrange</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">dsf</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">dsfactor</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">dsf</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">dsf</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showrange</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__rangewg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_resizePlot</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__rangewg</span><span class="o">.</span><span class="n">setFunction</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">dsreduction</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;mbuffer&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">mbuffer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showmbuffer</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showmbuffer</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__mbufferwg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__mbufferwg</span><span class="o">.</span><span class="n">onOff</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__mbufferwg</span><span class="o">.</span><span class="n">setBufferSize</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">mbuffer</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;bkgfile&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">bkgfile</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showsub</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showsub</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__prepwg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="n">showsub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__bkgsubwg</span><span class="o">.</span><span class="n">setBackground</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">bkgfile</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;bkgfile&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__bkgsubwg</span><span class="o">.</span><span class="n">checkBkgSubtraction</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">bkgimagename</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dobkgsubtraction</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__backgroundimage</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__scbackgroundimage</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;bkgscale&quot;</span><span class="p">)</span> <span class="ow">and</span> \
           <span class="n">options</span><span class="o">.</span><span class="n">bkgscale</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showsubsf</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showsub</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showsubsf</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__prepwg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="n">showsub</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">showsubsf</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__bkgsubwg</span><span class="o">.</span><span class="n">setBkgScalingFactor</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">bkgscale</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_updateBkgScale</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;bkgscale&quot;</span><span class="p">)</span> <span class="ow">and</span> \
                <span class="n">options</span><span class="o">.</span><span class="n">bkgscale</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__bkgsubwg</span><span class="o">.</span><span class="n">setBkgScalingFactor</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_updateBkgScale</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;brightfieldfile&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">brightfieldfile</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">shownorm</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">shownorm</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__prepwg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="n">shownorm</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__normwg</span><span class="o">.</span><span class="n">setBrightField</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">brightfieldfile</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;brightfieldfile&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__normwg</span><span class="o">.</span><span class="n">checkBFSubtraction</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dobfsubtraction</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">bfimagename</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__bfmdfimage</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__brightfieldimage</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__scbrightfieldimage</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;brightfieldscale&quot;</span><span class="p">)</span> <span class="ow">and</span> \
           <span class="n">options</span><span class="o">.</span><span class="n">brightfieldscale</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">shownormsf</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">shownorm</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">shownormsf</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__prepwg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="n">shownorm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shownormsf</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__normwg</span><span class="o">.</span><span class="n">setBFScalingFactor</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">brightfieldscale</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_updateBFScale</span><span class="p">()</span>

        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;brightfieldscale&quot;</span><span class="p">)</span> <span class="ow">and</span> \
                <span class="n">options</span><span class="o">.</span><span class="n">brightfieldscale</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__normwg</span><span class="o">.</span><span class="n">setBFScalingFactor</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_updateBFScale</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;channel&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">channel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ich</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">channel</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">channel</span> <span class="o">==</span> <span class="s2">&quot;mean&quot;</span><span class="p">:</span>
                    <span class="n">ich</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
                <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">channel</span> <span class="o">==</span> <span class="s2">&quot;rgb&quot;</span><span class="p">:</span>
                    <span class="n">ich</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="k">elif</span> <span class="s2">&quot;,&quot;</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">channel</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">ich</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="n">ich</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ich</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__channelwg</span><span class="o">.</span><span class="n">setDefaultColorChannel</span><span class="p">(</span><span class="n">ich</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;maskfile&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">maskfile</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showmask</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showmask</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__prepwg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__maskwg</span><span class="o">.</span><span class="n">setMask</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">maskfile</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;maskfile&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__maskwg</span><span class="o">.</span><span class="n">noImage</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setApplyMask</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;maskhighvalue&quot;</span><span class="p">)</span> <span class="ow">and</span> \
           <span class="n">options</span><span class="o">.</span><span class="n">maskhighvalue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showhighvaluemask</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showhighvaluemask</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__prepwg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="n">showhighvaluemask</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__highvaluemaskwg</span><span class="o">.</span><span class="n">setMask</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">maskhighvalue</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_checkHighMasking</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;transformation&quot;</span><span class="p">)</span> <span class="ow">and</span> \
           <span class="n">options</span><span class="o">.</span><span class="n">transformation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showtrans</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showtrans</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__prepwg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="n">showtrans</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__trafowg</span><span class="o">.</span><span class="n">setTransformation</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">transformation</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;filters&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">filters</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showfilters</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showfilters</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__filterswg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span>
                        <span class="n">showfilters</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__filterswg</span><span class="o">.</span><span class="n">setState</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">filters</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__filterswg</span><span class="o">.</span><span class="n">setState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;scaling&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">scaling</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showscale</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showscale</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__scalingwg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__scalingwg</span><span class="o">.</span><span class="n">setScaling</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">scaling</span><span class="p">))</span>

        <span class="n">QtCore</span><span class="o">.</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;gradient&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">gradient</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showlevels</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showslevels</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="n">showlevels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__channelwg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="n">showlevels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">setGradient</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">gradient</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;autofactor&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">autofactor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showlevels</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showslevels</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="n">showlevels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__channelwg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="n">showlevels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">setAutoFactor</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">autofactor</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;levels&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">levels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showlevels</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showslevels</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="n">showlevels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__channelwg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="n">showlevels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">setLevels</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">levels</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;tool&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">tool</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tlname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">tool</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tlname</span> <span class="o">==</span> <span class="s1">&#39;rgbintensity&#39;</span><span class="p">:</span>
                <span class="n">tlname</span> <span class="o">=</span> <span class="s1">&#39;intensity&#39;</span>
            <span class="k">if</span> <span class="n">tlname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tlaliasnames</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setTool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__tlaliasnames</span><span class="p">[</span><span class="n">tlname</span><span class="p">])</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;toolconfig&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">toolconfig</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">toolconfig</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">tlconfig</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">toolconfig</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                    <span class="n">tlconfig</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">toolconfig</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tlconfig</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">toolconfig</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setToolConfiguration</span><span class="p">(</span><span class="n">tlconfig</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;tangodevice&quot;</span><span class="p">)</span> <span class="ow">and</span> \
           <span class="n">TANGOCLIENT</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">tangodevice</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tangoclient</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__tangoclient</span><span class="o">.</span><span class="n">unsubscribe</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__tangoclient</span> <span class="o">=</span> <span class="n">controllerClient</span><span class="o">.</span><span class="n">ControllerClient</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">tangodevice</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__tangoclient</span><span class="o">.</span><span class="n">energyChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">updateEnergy</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__tangoclient</span><span class="o">.</span><span class="n">detectorDistanceChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">updateDetectorDistance</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__tangoclient</span><span class="o">.</span><span class="n">beamCenterXChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">updateBeamCenterX</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__tangoclient</span><span class="o">.</span><span class="n">beamCenterYChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">updateBeamCenterY</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__tangoclient</span><span class="o">.</span><span class="n">pixelSizeXChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">updatePixelSizeX</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__tangoclient</span><span class="o">.</span><span class="n">pixelSizeYChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">updatePixelSizeY</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__tangoclient</span><span class="o">.</span><span class="n">detectorROIsChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">updateDetectorROIs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setTangoClient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__tangoclient</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__tangoclient</span><span class="o">.</span><span class="n">subscribe</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__tangoclient</span><span class="o">.</span><span class="n">lavueStateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_updateLavueState</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setLavueState</span><span class="p">({</span><span class="s2">&quot;tangodevice&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tangoclient</span><span class="o">.</span><span class="n">device</span><span class="p">()})</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">TANGOCLIENT</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;tangodevice&quot;</span><span class="p">)</span> <span class="ow">and</span>
                <span class="ow">not</span> <span class="n">options</span><span class="o">.</span><span class="n">tangodevice</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__tangoclient</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setLavueState</span><span class="p">({</span><span class="s2">&quot;tangodevice&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">})</span>

        <span class="n">QtCore</span><span class="o">.</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;viewrange&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">viewrange</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setViewRange</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">viewrange</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">updateLayout</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;start&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">options</span><span class="o">.</span><span class="n">start</span> <span class="ow">is</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__loadSettings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; loads settings from QSettings object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QSettings</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">restoreGeometry</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">value</span><span class="p">(</span>
                <span class="s2">&quot;Layout/Geometry&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QByteArray</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restoreGeometry</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">value</span><span class="p">(</span>
            <span class="s2">&quot;Layout/DialogGeometry&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QByteArray</span><span class="p">))</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;lavuelib.liveViewer.LiveViewer.__loadSettings </span><span class="si">%s</span><span class="s2">&quot;</span>
                     <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">updateCustomGradients</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">customGradients</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">topic</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">status</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">messageBox</span><span class="o">.</span><span class="n">MessageBox</span><span class="o">.</span><span class="n">getText</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span>
            <span class="n">messageBox</span><span class="o">.</span><span class="n">MessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__setSardana</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sardana</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setAspectLocked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">aspectlocked</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setAutoDownSample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">autodownsample</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assessTransformation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__trafoname</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ds</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__datasources</span><span class="p">):</span>
            <span class="n">ds</span><span class="o">.</span><span class="n">setTimeOut</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">timeout</span><span class="p">)</span>
        <span class="n">dataFetchThread</span><span class="o">.</span><span class="n">GLOBALREFRESHRATE</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">refreshrate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setStatsWOScaling</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">statswoscaling</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setColors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">roiscolors</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__updateSource</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__statswg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showstats</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">calcvariance</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__viewFrameRate</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showhisto</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showlevels</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showaddhisto</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__channelwg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showlevels</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__prepwg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showmask</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showsub</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showtrans</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showhighvaluemask</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showsubsf</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">shownorm</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">shownormsf</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_updateBkgScale</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_updateBFScale</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__rangewg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showrange</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resizePlot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showrange</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__filterswg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showfilters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__mbufferwg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showmbuffer</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__scalingwg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showscale</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setGradientColors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">gradientcolors</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">setGradientColors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">gradientcolors</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">changeView</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__channelwg</span><span class="o">.</span><span class="n">changeView</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lazyimageslider</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">lazyimageslider</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__switchlazysignals</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">lazyimageslider</span><span class="p">)</span>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">__viewFrameRate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show/hide frame rate</span>
<span class="sd">        :param status: True for show and False for hide</span>
<span class="sd">        :type status: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">framerateLineEdit</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">framerateLineEdit</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_storeSettings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; stores settings in QSettings object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QSettings</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span>
                <span class="s2">&quot;Layout/Geometry&quot;</span><span class="p">,</span>
                <span class="n">QtCore</span><span class="o">.</span><span class="n">QByteArray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">saveGeometry</span><span class="p">()))</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span>
            <span class="s2">&quot;Layout/DialogGeometry&quot;</span><span class="p">,</span>
            <span class="n">QtCore</span><span class="o">.</span><span class="n">QByteArray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saveGeometry</span><span class="p">()))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">refreshrate</span> <span class="o">=</span> <span class="n">dataFetchThread</span><span class="o">.</span><span class="n">GLOBALREFRESHRATE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sardana</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sardana</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_setAspectLocked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">aspectlocked</span> <span class="o">=</span> <span class="n">status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setAspectLocked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">aspectlocked</span><span class="p">)</span>

<div class="viewcode-block" id="LiveViewer.closeEvent"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.liveViewer.LiveViewer.closeEvent">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">closeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; stores the setting before finishing the application</span>

<span class="sd">        :param event: close event</span>
<span class="sd">        :type event:  :class:`pyqtgraph.QtCore.QEvent`:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__closing</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">sourceStateChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_updateSource</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">sourceChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_onSourceChanged</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">sourceConnected</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_connectSource</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">sourceDisconnected</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_disconnectSource</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">disconnecttool</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__tangoclient</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__tangoclient</span><span class="o">.</span><span class="n">unsubscribe</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_storeSettings</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">secstream</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">dft</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dataFetchers</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">dft</span><span class="o">.</span><span class="n">newDataNameFetched</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getNewData</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="c1"># except Exception as e:</span>
            <span class="c1">#     print (str(e))</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">isConnected</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">toggleServerConnection</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__disconnectSource</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dataFetchers</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
                <span class="n">df</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">seccontext</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__closing</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">closeAllWindows</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span></div>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_clickloadfile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; reloads the image file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loadfile</span><span class="p">()</span>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">_loadfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fid</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; reloads the image file</span>

<span class="sd">        :param fid: frame id</span>
<span class="sd">        :type fid: :obj:`int`</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reloadfile</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span> <span class="n">showmessage</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_spinreloadfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">showmessage</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; reloads the image file</span>

<span class="sd">        :param fid: frame id</span>
<span class="sd">        :type fid: :obj:`int` or :obj:`str`</span>
<span class="sd">        :param showmessage: no image message</span>
<span class="sd">        :type showmessage: :obj:`bool`</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__reloadflag</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__reloadflag</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">fid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">fid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">fid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fid</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_reloadfile</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span> <span class="n">showmessage</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__reloadflag</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_pushreloadfile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; reloads the image file</span>

<span class="sd">        :param fid: frame id</span>
<span class="sd">        :type fid: :obj:`int` or :obj:`str`</span>
<span class="sd">        :param showmessage: no image message</span>
<span class="sd">        :type showmessage: :obj:`bool`</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__reloadflag</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">fid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">fid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fid</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_reloadfile</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__reloadflag</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_lowerframepushed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">framestepSpinBox</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">frame</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__frame</span> <span class="ow">or</span> <span class="mi">0</span>
        <span class="n">nframe</span> <span class="o">=</span> <span class="n">frame</span> <span class="o">-</span> <span class="n">step</span>
        <span class="k">if</span> <span class="n">frame</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">nframe</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">nframe</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nframe</span><span class="p">))</span>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_higherframepushed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">framestepSpinBox</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">frame</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__frame</span> <span class="ow">or</span> <span class="mi">0</span>
        <span class="n">nframe</span> <span class="o">=</span> <span class="n">frame</span> <span class="o">+</span> <span class="n">step</span>
        <span class="k">if</span> <span class="n">frame</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">nframe</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">nframe</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nframe</span><span class="p">))</span>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_sliderreloadfilelazy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; reloads the image file or</span>
<span class="sd">        if lazy flag it displays only splider value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lazyimageslider</span><span class="p">:</span>
            <span class="n">fid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameHorizontalSlider</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameLineEdit</span><span class="o">.</span><span class="n">textChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_spinreloadfile</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fid</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameLineEdit</span><span class="o">.</span><span class="n">textChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_spinreloadfile</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sliderreloadfile</span><span class="p">()</span>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_sliderreloadfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">showmessage</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; reloads the image file</span>

<span class="sd">        :param fid: frame id</span>
<span class="sd">        :type fid: :obj:`int`</span>
<span class="sd">        :param showmessage: no image message</span>
<span class="sd">        :type showmessage: :obj:`bool`</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__reloadflag</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__reloadflag</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">fid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">fid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameHorizontalSlider</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_reloadfile</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span> <span class="n">showmessage</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__reloadflag</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__findfid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imagename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; find file id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ipath</span><span class="p">,</span> <span class="n">iname</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">imagename</span><span class="p">)</span>
            <span class="n">basename</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">iname</span><span class="p">)</span>
            <span class="n">ival</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">w</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">ival</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">basename</span><span class="p">[(</span><span class="o">-</span> <span class="n">w</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):])</span>
                    <span class="n">w</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">w</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">basename</span><span class="p">):</span>
                        <span class="n">ival</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">ival</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">ffid</span> <span class="o">=</span> <span class="n">basename</span><span class="p">[</span><span class="o">-</span><span class="n">w</span><span class="p">:]</span>
            <span class="n">fid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ffid</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">fid</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">fid</span>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">_reloadfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">showmessage</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nexus</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; reloads the image file</span>

<span class="sd">        :param fid: frame id</span>
<span class="sd">        :type fid: :obj:`int`</span>
<span class="sd">        :param showmessage: no image message</span>
<span class="sd">        :type showmessage: :obj:`bool`</span>
<span class="sd">        :param nexus: nexus image name</span>
<span class="sd">        :type nexus: :obj:`str`</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="n">newimage</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">fid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">imagename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">imagename</span>
            <span class="k">if</span> <span class="n">nexus</span> \
               <span class="ow">or</span> <span class="n">imagename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.nxs&quot;</span><span class="p">)</span> \
               <span class="ow">or</span> <span class="n">imagename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.h5&quot;</span><span class="p">)</span> \
               <span class="ow">or</span> <span class="n">imagename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.nx&quot;</span><span class="p">)</span> \
               <span class="ow">or</span> <span class="n">imagename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.ndf&quot;</span><span class="p">)</span> \
               <span class="ow">or</span> <span class="n">imagename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.hdf&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__frame</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fid</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">fid</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">ipath</span><span class="p">,</span> <span class="n">iname</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">imagename</span><span class="p">)</span>
                    <span class="n">basename</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">iname</span><span class="p">)</span>
                    <span class="n">ival</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">w</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">while</span> <span class="n">ival</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="nb">int</span><span class="p">(</span><span class="n">basename</span><span class="p">[(</span><span class="o">-</span> <span class="n">w</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):])</span>
                            <span class="n">w</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="k">if</span> <span class="n">w</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">basename</span><span class="p">):</span>
                                <span class="n">ival</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                            <span class="n">ival</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">fprefix</span><span class="p">,</span> <span class="n">ffid</span> <span class="o">=</span> <span class="n">basename</span><span class="p">[:</span><span class="o">-</span><span class="n">w</span><span class="p">],</span> <span class="n">basename</span><span class="p">[</span><span class="o">-</span><span class="n">w</span><span class="p">:]</span>
                    <span class="k">if</span> <span class="n">w</span><span class="p">:</span>
                        <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">d&quot;</span> <span class="o">%</span> <span class="n">w</span>
                        <span class="n">fmtfid</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;%0&quot;</span> <span class="o">+</span> <span class="n">fmt</span><span class="p">)</span> <span class="o">%</span> <span class="n">fid</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">fmtfid</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                        <span class="n">fprefix</span> <span class="o">=</span> <span class="n">ffid</span>
                        <span class="n">ffid</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__frame</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fid</span><span class="p">)</span>

                    <span class="n">iname</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fprefix</span><span class="p">,</span> <span class="n">fmtfid</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>

                    <span class="n">imgname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ipath</span><span class="p">,</span> <span class="n">iname</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">imgname</span><span class="p">):</span>
                        <span class="n">imagename</span> <span class="o">=</span> <span class="n">imgname</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">imagename</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">fid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">fid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nexus</span><span class="p">:</span>
                <span class="n">imagename</span> <span class="o">=</span> <span class="n">nexus</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fileDialog</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFileDialog</span><span class="p">()</span>
                <span class="n">fileout</span> <span class="o">=</span> <span class="n">fileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Load file&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">imagename</span> <span class="ow">or</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fileout</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="n">imagename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fileout</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">imagename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fileout</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">imagename</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nexus</span> \
               <span class="ow">or</span> <span class="n">imagename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.nxs&quot;</span><span class="p">)</span> \
               <span class="ow">or</span> <span class="n">imagename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.h5&quot;</span><span class="p">)</span> \
               <span class="ow">or</span> <span class="n">imagename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.nx&quot;</span><span class="p">)</span> \
               <span class="ow">or</span> <span class="n">imagename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.ndf&quot;</span><span class="p">)</span> \
               <span class="ow">or</span> <span class="n">imagename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.hdf&quot;</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">handler</span> <span class="o">=</span> <span class="n">imageFileHandler</span><span class="o">.</span><span class="n">NexusFieldHandler</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">imagename</span><span class="p">))</span>
                    <span class="n">fields</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">findImageFields</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">imagename</span> <span class="o">=</span> <span class="n">imagename</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                    <span class="c1"># print(str(e))</span>
                    <span class="n">fields</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setLavueState</span><span class="p">(</span>
                    <span class="p">{</span><span class="s2">&quot;imagefile&quot;</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">imagename</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)})</span>
                <span class="n">currentfield</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">fields</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">fid</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__fieldpath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">imgfield</span> <span class="o">=</span> <span class="n">imageField</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                        <span class="n">imgfield</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="n">fields</span>
                        <span class="n">imgfield</span><span class="o">.</span><span class="n">createGUI</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">imgfield</span><span class="o">.</span><span class="n">exec_</span><span class="p">():</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__fieldpath</span> <span class="o">=</span> <span class="n">imgfield</span><span class="o">.</span><span class="n">field</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__growing</span> <span class="o">=</span> <span class="n">imgfield</span><span class="o">.</span><span class="n">growing</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__frame</span> <span class="o">=</span> <span class="n">imgfield</span><span class="o">.</span><span class="n">frame</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">return</span>
                    <span class="n">currentfield</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__fieldpath</span><span class="p">]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">newimage</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">getImage</span><span class="p">(</span>
                            <span class="n">currentfield</span><span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">],</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__growing</span><span class="p">,</span> <span class="n">refresh</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                        <span class="c1"># print(str(e))</span>

                    <span class="n">metadata</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">getMetaData</span><span class="p">(</span><span class="n">currentfield</span><span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">])</span>
                    <span class="c1"># if metadata:</span>
                    <span class="c1">#     print(&quot;Metadata = %s&quot; % str(metadata))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameLineEdit</span><span class="o">.</span><span class="n">textChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_spinreloadfile</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__disconnectslider</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameHorizontalSlider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_sliderreloadfilelazy</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">currentfield</span><span class="p">[</span><span class="s2">&quot;shape&quot;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                            <span class="n">gsize</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">gsize</span> <span class="o">=</span> <span class="n">currentfield</span><span class="p">[</span><span class="s2">&quot;shape&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">__growing</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="n">gsize</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameLineEdit</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
                                <span class="s2">&quot;current frame (max: </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">gsize</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameHorizontalSlider</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="n">gsize</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameHorizontalSlider</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
                                <span class="s2">&quot;current frame (max: </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">gsize</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameLineEdit</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;current frame&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameHorizontalSlider</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameHorizontalSlider</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
                                <span class="s2">&quot;current frame&quot;</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameLineEdit</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;current frame&quot;</span><span class="p">)</span>
                    <span class="k">while</span> <span class="n">newimage</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__frame</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__frame</span> <span class="o">-=</span> <span class="mi">1</span>
                        <span class="n">newimage</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">getImage</span><span class="p">(</span>
                            <span class="n">currentfield</span><span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">],</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__frame</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__growing</span><span class="p">,</span> <span class="n">refresh</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">currentfield</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">currentfield</span><span class="p">[</span><span class="s2">&quot;shape&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__updateframeview</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__updateframeview</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameLineEdit</span><span class="o">.</span><span class="n">textChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_spinreloadfile</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameHorizontalSlider</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_sliderreloadfilelazy</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__connectslider</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">showmessage</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">=</span> <span class="n">messageBox</span><span class="o">.</span><span class="n">MessageBox</span><span class="o">.</span><span class="n">getText</span><span class="p">(</span>
                            <span class="s2">&quot;lavue: Image </span><span class="si">%s</span><span class="s2"> cannot be loaded&quot;</span>
                            <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">imagename</span><span class="p">)</span>
                        <span class="n">messageBox</span><span class="o">.</span><span class="n">MessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                            <span class="bp">self</span><span class="p">,</span>
                            <span class="s2">&quot;lavue: File </span><span class="si">%s</span><span class="s2"> cannot be loaded&quot;</span>
                            <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">imagename</span><span class="p">,</span>
                            <span class="s2">&quot;File </span><span class="si">%s</span><span class="s2"> without images&quot;</span>
                            <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">imagename</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="k">if</span> <span class="n">imagename</span><span class="p">:</span>
                    <span class="n">imagename</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">imagename</span><span class="p">,</span>
                        <span class="n">currentfield</span><span class="p">[</span><span class="s2">&quot;nexus_path&quot;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">currentfield</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">currentfield</span><span class="p">[</span><span class="s2">&quot;shape&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__updateframeview</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__updateframeview</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">fh</span> <span class="o">=</span> <span class="n">imageFileHandler</span><span class="o">.</span><span class="n">ImageFileHandler</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">imagename</span><span class="p">))</span>
                    <span class="n">newimage</span> <span class="o">=</span> <span class="n">fh</span><span class="o">.</span><span class="n">getImage</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">newimage</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span> \
                       <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">newimage</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_reloadfile</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span> <span class="n">showmessage</span><span class="p">,</span> <span class="n">nexus</span><span class="o">=</span><span class="n">imagename</span><span class="p">)</span>
                        <span class="k">return</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">newimage</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="n">newimage</span> <span class="o">==</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">:</span>
                        <span class="n">newimage</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">newimage</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                            <span class="s2">&quot;Cannot read the image </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">imagename</span><span class="p">))</span>
                    <span class="n">metadata</span> <span class="o">=</span> <span class="n">fh</span><span class="o">.</span><span class="n">getMetaData</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">imagename</span> <span class="o">=</span> <span class="n">imagename</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setLavueState</span><span class="p">(</span>
                        <span class="p">{</span><span class="s2">&quot;imagefile&quot;</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">imagename</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)})</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">ipath</span><span class="p">,</span> <span class="n">iname</span> <span class="o">=</span> <span class="n">ntpath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">imagename</span><span class="p">)</span>
                        <span class="n">basename</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">iname</span><span class="p">)</span>
                        <span class="n">ival</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">w</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">while</span> <span class="n">ival</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="nb">int</span><span class="p">(</span><span class="n">basename</span><span class="p">[(</span><span class="o">-</span> <span class="n">w</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):])</span>
                                <span class="n">w</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="k">if</span> <span class="n">w</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">basename</span><span class="p">):</span>
                                    <span class="n">ival</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                                <span class="n">ival</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="n">fprefix</span><span class="p">,</span> <span class="n">ffid</span> <span class="o">=</span> <span class="n">basename</span><span class="p">[:</span><span class="o">-</span><span class="n">w</span><span class="p">],</span> <span class="n">basename</span><span class="p">[</span><span class="o">-</span><span class="n">w</span><span class="p">:]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__frame</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ffid</span><span class="p">)</span>
                        <span class="n">iname</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fprefix</span><span class="p">,</span> <span class="n">ffid</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>
                        <span class="n">imagename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ipath</span><span class="p">,</span> <span class="n">iname</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__frame</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__updateframeview</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__frame</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__fieldpath</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                    <span class="c1"># print(str(e))</span>
            <span class="k">if</span> <span class="n">newimage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__metadata</span> <span class="o">=</span> <span class="n">metadata</span>
                <span class="k">if</span> <span class="n">metadata</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__mdata</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">metadata</span><span class="p">))</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">geometryfromsource</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">updateMetaData</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">__mdata</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">updateCenter</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">mouseImagePositionChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">geometryChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__mdata</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__imagename</span> <span class="o">=</span> <span class="n">imagename</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__rawimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">newimage</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__intmaxvalue</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">pd</span> <span class="o">=</span> <span class="n">PartialData</span><span class="p">(</span><span class="n">imagename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rawimage</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
                                 <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">imv</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">intmaxvalue</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">imv</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__intmaxvalue</span> <span class="o">=</span> <span class="n">imv</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">fid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">autoRange</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">messageBox</span><span class="o">.</span><span class="n">MessageBox</span><span class="o">.</span><span class="n">getText</span><span class="p">(</span>
                    <span class="s2">&quot;lavue: File </span><span class="si">%s</span><span class="s2"> cannot be loaded&quot;</span>
                    <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">imagename</span><span class="p">)</span>
                <span class="n">messageBox</span><span class="o">.</span><span class="n">MessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span>
                    <span class="s2">&quot;lavue: File </span><span class="si">%s</span><span class="s2"> cannot be loaded&quot;</span>
                    <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">imagename</span><span class="p">,</span>
                    <span class="n">text</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;lavue: File </span><span class="si">%s</span><span class="s2"> cannot be loaded&quot;</span>
                        <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">imagename</span><span class="p">))</span>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; launches the configuration dialog</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cnfdlg</span> <span class="o">=</span> <span class="n">configDialog</span><span class="o">.</span><span class="n">ConfigDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">doorname</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sardana</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">doorname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sardana</span><span class="o">.</span><span class="n">getDeviceName</span><span class="p">(</span><span class="s2">&quot;Door&quot;</span><span class="p">)</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">sardana</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sardana</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">door</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">doorname</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">crosshairlocker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">crosshairlocker</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">addrois</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">addrois</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">orderrois</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">orderrois</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">imagechannels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">imagechannels</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">showsub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showsub</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">showsubsf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showsubsf</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">shownorm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">shownorm</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">shownormsf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">shownormsf</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">showtrans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showtrans</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">showscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showscale</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">showlevels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showlevels</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">showframerate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showframerate</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">showhisto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showhisto</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">showaddhisto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showaddhisto</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">showmask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showmask</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">showhighvaluemask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showhighvaluemask</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">showmbuffer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showmbuffer</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">showrange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showrange</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">showfilters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showfilters</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">showstats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showstats</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">showsteps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showsteps</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">calcvariance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">calcvariance</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">filters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">filters</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">secautoport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">secautoport</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">secport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">secport</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">hidraport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">hidraport</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">maxmbuffersize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">maxmbuffersize</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">gradientcolors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">gradientcolors</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">floattype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">floattype</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">secstream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">secstream</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">zeromask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">zeromask</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">nanmask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">nanmask</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">negmask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">negmask</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">refreshrate</span> <span class="o">=</span> <span class="n">dataFetchThread</span><span class="o">.</span><span class="n">GLOBALREFRESHRATE</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">toolrefreshtime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">toolrefreshtime</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">toolpollinginterval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">toolpollinginterval</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">timeout</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">nrsources</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">nrsources</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">aspectlocked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">aspectlocked</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">autodownsample</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">autodownsample</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">keepcoords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">keepcoords</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">accelbuffersum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">accelbuffersum</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">lazyimageslider</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">lazyimageslider</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">statswoscaling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">statswoscaling</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">zmqtopics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">zmqtopics</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">autozmqtopics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">autozmqtopics</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">interruptonerror</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">interruptonerror</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">dirtrans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">dirtrans</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">tangoattrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">tangoattrs</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">tineprops</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">tineprops</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">epicspvnames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">epicspvnames</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">epicspvshapes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">epicspvshapes</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">doocsprops</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">doocsprops</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">tangoevattrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">tangoevattrs</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">tangofileattrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">tangofileattrs</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">tangodirattrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">tangodirattrs</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">httpurls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">httpurls</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">zmqservers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">zmqservers</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">nxslast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">nxslast</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">nxsopen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">nxsopen</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">sendrois</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sendrois</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">sendresults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sendresults</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">singlerois</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">singlerois</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">showallrois</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showallrois</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">storegeometry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">storegeometry</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">geometryfromsource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">geometryfromsource</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">roiscolors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">roiscolors</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">sourcedisplay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sourcedisplay</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">imagesources</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">imagesources</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">imagesourcenames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__srcaliasnames</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">toolwidgets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">toolwidgets</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">toolwidgetnames</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">diffnpt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">diffnpt</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">correctsolidangle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">correctsolidangle</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">availimagesources</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__allsourcealiases</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">availtoolwidgets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__alltoolaliases</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">defdetservers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">defdetservers</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">asaposerver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">asaposerver</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">asapotoken</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">asapotoken</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">asapobeamtime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">asapobeamtime</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">asaposourcepath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">asaposourcepath</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">asapodatasources</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">asapodatasources</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">detservers</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__mergeDetServers</span><span class="p">(</span>
            <span class="n">HIDRASERVERLIST</span> <span class="k">if</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">defdetservers</span> <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;pool&quot;</span><span class="p">:</span> <span class="p">[]},</span>
            <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detservers</span><span class="p">)))</span>
        <span class="n">cnfdlg</span><span class="o">.</span><span class="n">createGUI</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cnfdlg</span><span class="o">.</span><span class="n">exec_</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__updateConfig</span><span class="p">(</span><span class="n">cnfdlg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_storeSettings</span><span class="p">()</span>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">__updateConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dialog</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; updates the configuration</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">replot</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">doorname</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">door</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLavueState</span><span class="p">({</span><span class="s2">&quot;doordevice&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">doorname</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">dialog</span><span class="o">.</span><span class="n">sardana</span> <span class="o">!=</span> <span class="p">(</span><span class="kc">True</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sardana</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">False</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__setSardana</span><span class="p">(</span><span class="n">dialog</span><span class="o">.</span><span class="n">sardana</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sardana</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">sardana</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">addrois</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">addrois</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">orderrois</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">orderrois</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">imagechannels</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">imagechannels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">floattype</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">floattype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">crosshairlocker</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">crosshairlocker</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showsub</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">showsub</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__prepwg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="n">showsub</span><span class="o">=</span><span class="n">dialog</span><span class="o">.</span><span class="n">showsub</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showsub</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">showsub</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">shownorm</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">shownorm</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__prepwg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="n">shownorm</span><span class="o">=</span><span class="n">dialog</span><span class="o">.</span><span class="n">shownorm</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">shownorm</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">shownorm</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showsubsf</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">showsubsf</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dialog</span><span class="o">.</span><span class="n">showsubsf</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showsub</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__prepwg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="n">showsub</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                         <span class="n">showsubsf</span><span class="o">=</span><span class="n">dialog</span><span class="o">.</span><span class="n">showsubsf</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__prepwg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="n">showsubsf</span><span class="o">=</span><span class="n">dialog</span><span class="o">.</span><span class="n">showsubsf</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showsubsf</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">showsubsf</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_updateBkgScale</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">shownormsf</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">shownormsf</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dialog</span><span class="o">.</span><span class="n">shownormsf</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">shownorm</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__prepwg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="n">shownorm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                         <span class="n">shownormsf</span><span class="o">=</span><span class="n">dialog</span><span class="o">.</span><span class="n">shownormsf</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__prepwg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="n">shownormsf</span><span class="o">=</span><span class="n">dialog</span><span class="o">.</span><span class="n">shownormsf</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">shownormsf</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">shownormsf</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_updateBFScale</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showtrans</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">showtrans</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__prepwg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="n">showtrans</span><span class="o">=</span><span class="n">dialog</span><span class="o">.</span><span class="n">showtrans</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showtrans</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">showtrans</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showmask</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">showmask</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showmask</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">showmask</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__prepwg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="n">dialog</span><span class="o">.</span><span class="n">showmask</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showhighvaluemask</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">showhighvaluemask</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showhighvaluemask</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">showhighvaluemask</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__prepwg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span>
                <span class="n">showhighvaluemask</span><span class="o">=</span><span class="n">dialog</span><span class="o">.</span><span class="n">showhighvaluemask</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_checkHighMasking</span><span class="p">()</span>
            <span class="n">replot</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showrange</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">showrange</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showrange</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">showrange</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__rangewg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="n">dialog</span><span class="o">.</span><span class="n">showrange</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_resizePlot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showrange</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showfilters</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">showfilters</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showfilters</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">showfilters</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__filterswg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span>
                <span class="n">showfilters</span><span class="o">=</span><span class="n">dialog</span><span class="o">.</span><span class="n">showfilters</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showmbuffer</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">showmbuffer</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showmbuffer</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">showmbuffer</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__mbufferwg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="n">dialog</span><span class="o">.</span><span class="n">showmbuffer</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showscale</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">showscale</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__scalingwg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="n">dialog</span><span class="o">.</span><span class="n">showscale</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showscale</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">showscale</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showlevels</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">showlevels</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="n">showlevels</span><span class="o">=</span><span class="n">dialog</span><span class="o">.</span><span class="n">showlevels</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__channelwg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="n">showlevels</span><span class="o">=</span><span class="n">dialog</span><span class="o">.</span><span class="n">showlevels</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showlevels</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">showlevels</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showframerate</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">showframerate</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showframerate</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">showframerate</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__viewFrameRate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showframerate</span>
                                 <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">isConnected</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showhisto</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">showhisto</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="n">dialog</span><span class="o">.</span><span class="n">showhisto</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showhisto</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">showhisto</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showaddhisto</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">showaddhisto</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span><span class="n">showadd</span><span class="o">=</span><span class="n">dialog</span><span class="o">.</span><span class="n">showaddhisto</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showaddhisto</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">showaddhisto</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showsteps</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">showsteps</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showsteps</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">showsteps</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__updateframeview</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__frame</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">statschanged</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showstats</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">showstats</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showstats</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">showstats</span>
            <span class="n">statschanged</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">calcvariance</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">calcvariance</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">calcvariance</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">calcvariance</span>
            <span class="n">statschanged</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">statschanged</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__statswg</span><span class="o">.</span><span class="n">changeView</span><span class="p">(</span>
                <span class="n">dialog</span><span class="o">.</span><span class="n">showstats</span><span class="p">,</span> <span class="n">dialog</span><span class="o">.</span><span class="n">calcvariance</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">imagesources</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">imagesources</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">imagesources</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">imagesources</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">updateSourceComboBox</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__srcaliasnames</span><span class="p">[</span><span class="n">twn</span><span class="p">]</span>
                 <span class="k">for</span> <span class="n">twn</span> <span class="ow">in</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">imagesources</span><span class="p">))],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">currentDataSourceNames</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">toolwidgets</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">toolwidgets</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">toolwidgets</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">toolwidgets</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">updateToolComboBox</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__tlaliasnames</span><span class="p">[</span><span class="n">twn</span><span class="p">]</span>
                 <span class="k">for</span> <span class="n">twn</span> <span class="ow">in</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">toolwidgets</span><span class="p">)],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">currentTool</span><span class="p">())</span>
        <span class="n">dataFetchThread</span><span class="o">.</span><span class="n">GLOBALREFRESHRATE</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">refreshrate</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">refreshrate</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">refreshrate</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">refreshrate</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">refreshrate</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__updateframeratetip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">refreshrate</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">toolrefreshtime</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">toolrefreshtime</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">toolrefreshtime</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">toolrefreshtime</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setExtensionsRefreshTime</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">toolrefreshtime</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">toolpollinginterval</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">toolpollinginterval</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">toolpollinginterval</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">toolpollinginterval</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setExtensionsRefreshTime</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">toolrefreshtime</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">filters</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">filters</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__resetFilters</span><span class="p">(</span><span class="n">dialog</span><span class="o">.</span><span class="n">filters</span><span class="p">)</span>
            <span class="n">replot</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">secstream</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">secstream</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">secautoport</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">secautoport</span>
                <span class="ow">and</span> <span class="n">dialog</span><span class="o">.</span><span class="n">secautoport</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">secstream</span><span class="p">:</span>
                <span class="c1"># workaround for a bug in libzmq</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">secsocket</span><span class="o">.</span><span class="n">unbind</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">secsockopt</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">isConnected</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">connectSuccess</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dialog</span><span class="o">.</span><span class="n">secstream</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dialog</span><span class="o">.</span><span class="n">secautoport</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">secsockopt</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;tcp://*:*&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">secsocket</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">secsockopt</span><span class="p">)</span>
                    <span class="n">dialog</span><span class="o">.</span><span class="n">secport</span> <span class="o">=</span> <span class="n">unicode</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">secsocket</span><span class="o">.</span><span class="n">getsockopt</span><span class="p">(</span>
                            <span class="n">zmq</span><span class="o">.</span><span class="n">LAST_ENDPOINT</span><span class="p">))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">secsockopt</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;tcp://*:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">dialog</span><span class="o">.</span><span class="n">secport</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">secsocket</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">secsockopt</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">isConnected</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">connectSuccess</span><span class="p">(</span><span class="n">dialog</span><span class="o">.</span><span class="n">secport</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">secautoport</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">secautoport</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">secport</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">secport</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">timeout</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ds</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__datasources</span><span class="p">):</span>
            <span class="n">ds</span><span class="o">.</span><span class="n">setTimeOut</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">timeout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">aspectlocked</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">aspectlocked</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setAspectLocked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">aspectlocked</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">autodownsample</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">autodownsample</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setAutoDownSample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">autodownsample</span><span class="p">)</span>
        <span class="n">remasking</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">accelbuffersum</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">accelbuffersum</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">accelbuffersum</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">accelbuffersum</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__mbufferwg</span><span class="o">.</span><span class="n">setComputeSum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">accelbuffersum</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">gradientcolors</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">gradientcolors</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">gradientcolors</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">gradientcolors</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setGradientColors</span><span class="p">(</span><span class="n">dialog</span><span class="o">.</span><span class="n">gradientcolors</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">setGradientColors</span><span class="p">(</span><span class="n">dialog</span><span class="o">.</span><span class="n">gradientcolors</span><span class="p">)</span>
            <span class="n">replot</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">keepcoords</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">keepcoords</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">keepcoords</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">keepcoords</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_assessTransformation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__trafoname</span><span class="p">)</span>
            <span class="n">replot</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">lazyimageslider</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">lazyimageslider</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">lazyimageslider</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">lazyimageslider</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__switchlazysignals</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">lazyimageslider</span><span class="p">)</span>

        <span class="n">setsrc</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">nrsources</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">nrsources</span><span class="p">:</span>
            <span class="n">setsrc</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">oldsize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">nrsources</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">isConnected</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">toggleServerConnection</span><span class="p">()</span>
                <span class="n">QtCore</span><span class="o">.</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__setNumberOfSources</span><span class="p">(</span><span class="n">dialog</span><span class="o">.</span><span class="n">nrsources</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">nrsources</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">nrsources</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">updateSourceComboBox</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__srcaliasnames</span><span class="p">[</span><span class="n">twn</span><span class="p">]</span>
                 <span class="k">for</span> <span class="n">twn</span> <span class="ow">in</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">imagesources</span><span class="p">))],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">currentDataSourceNames</span><span class="p">()[:</span><span class="n">oldsize</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">secstream</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">secstream</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">storegeometry</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">storegeometry</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">geometryfromsource</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">geometryfromsource</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">interruptonerror</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">interruptonerror</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sourcedisplay</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">sourcedisplay</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">hidraport</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">hidraport</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">hidraport</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">hidraport</span>
            <span class="n">setsrc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">dirtrans</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">dirtrans</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">dirtrans</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">dirtrans</span>
            <span class="n">setsrc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">tangoattrs</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">tangoattrs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">tangoattrs</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">tangoattrs</span>
            <span class="n">setsrc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">tineprops</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">tineprops</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">tineprops</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">tineprops</span>
            <span class="n">setsrc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">epicspvnames</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">epicspvnames</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">epicspvnames</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">epicspvnames</span>
            <span class="n">setsrc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">epicspvshapes</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">epicspvshapes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">epicspvshapes</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">epicspvshapes</span>
            <span class="n">setsrc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">doocsprops</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">doocsprops</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">doocsprops</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">doocsprops</span>
            <span class="n">setsrc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">tangoevattrs</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">tangoevattrs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">tangoevattrs</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">tangoevattrs</span>
            <span class="n">setsrc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">tangofileattrs</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">tangofileattrs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">tangofileattrs</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">tangofileattrs</span>
            <span class="n">setsrc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">tangodirattrs</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">tangodirattrs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">tangodirattrs</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">tangodirattrs</span>
            <span class="n">setsrc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">httpurls</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">httpurls</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">httpurls</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">httpurls</span>
            <span class="n">setsrc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">zmqservers</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">zmqservers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">zmqservers</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">zmqservers</span>
            <span class="n">setsrc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">zmqtopics</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">zmqtopics</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">zmqtopics</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">zmqtopics</span>
            <span class="n">setsrc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">asapodatasources</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">asapodatasources</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">asapodatasources</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">asapodatasources</span>
            <span class="n">setsrc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">defdetservers</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">defdetservers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">defdetservers</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">defdetservers</span>
            <span class="n">setsrc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">detservers</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__retrieveUserDetServers</span><span class="p">(</span>
            <span class="n">HIDRASERVERLIST</span> <span class="k">if</span> <span class="n">dialog</span><span class="o">.</span><span class="n">defdetservers</span> <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;pool&quot;</span><span class="p">:</span> <span class="p">[]},</span>
            <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">dialog</span><span class="o">.</span><span class="n">detservers</span><span class="p">)))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detservers</span> <span class="o">!=</span> <span class="n">detservers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">detservers</span> <span class="o">=</span> <span class="n">detservers</span>
            <span class="n">setsrc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">asaposerver</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">asaposerver</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">asaposerver</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">asaposerver</span>
            <span class="n">setsrc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">asapotoken</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">asapotoken</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">asapotoken</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">asapotoken</span>
            <span class="n">setsrc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">asapobeamtime</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">asapobeamtime</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">asapobeamtime</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">asapobeamtime</span>
            <span class="n">setsrc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">asaposourcepath</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">asaposourcepath</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">asaposourcepath</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">asaposourcepath</span>
            <span class="n">setsrc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">autozmqtopics</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">autozmqtopics</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">autozmqtopics</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">autozmqtopics</span>
            <span class="n">setsrc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">nxsopen</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">nxsopen</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">nxsopen</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">nxsopen</span>
            <span class="n">setsrc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">nxslast</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">nxslast</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">nxslast</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">nxslast</span>
            <span class="n">setsrc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sendrois</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">sendrois</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sendrois</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">sendrois</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sendresults</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">sendresults</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sendresults</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">sendresults</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">singlerois</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">singlerois</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">singlerois</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">singlerois</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showallrois</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">showallrois</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showallrois</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">showallrois</span>
        <span class="k">if</span> <span class="n">setsrc</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__updateSource</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">maxmbuffersize</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">maxmbuffersize</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">maxmbuffersize</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">maxmbuffersize</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__mbufferwg</span><span class="o">.</span><span class="n">setMaxBufferSize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">maxmbuffersize</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">statswoscaling</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">statswoscaling</span>
        <span class="n">replot</span> <span class="o">=</span> <span class="n">replot</span> <span class="ow">or</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setStatsWOScaling</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">statswoscaling</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">zeromask</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">zeromask</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">zeromask</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">zeromask</span>
            <span class="n">remasking</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">replot</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">diffnpt</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">diffnpt</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">diffnpt</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">diffnpt</span>
            <span class="n">replot</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">correctsolidangle</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">correctsolidangle</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">correctsolidangle</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">correctsolidangle</span>
            <span class="n">replot</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">nanmask</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">nanmask</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">nanmask</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">nanmask</span>
            <span class="n">remasking</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">replot</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">negmask</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">negmask</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">negmask</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">negmask</span>
            <span class="n">remasking</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">replot</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">roiscolors</span> <span class="o">!=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">roiscolors</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">roiscolors</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">roiscolors</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setColors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">roiscolors</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">remasking</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__remasking</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">replot</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span><span class="p">()</span>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">__setNumberOfSources</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nrsources</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set a number of image sources</span>

<span class="sd">        :param nrsources: a number of image sources</span>
<span class="sd">        :type nrsources: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nrsources</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nrsources</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dataFetchers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">nrsources</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">nrsources</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dataFetchers</span><span class="p">))):</span>
                <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dataFetchers</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">df</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
                <span class="n">df</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
                <span class="n">df</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__datasources</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__exchangelists</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dataFetchers</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">nrsources</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dataFetchers</span><span class="p">),</span> <span class="n">nrsources</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__datasources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">isr</span><span class="o">.</span><span class="n">BaseSource</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__exchangelists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataFetchThread</span><span class="o">.</span><span class="n">ExchangeList</span><span class="p">())</span>
                <span class="n">dft</span> <span class="o">=</span> <span class="n">dataFetchThread</span><span class="o">.</span><span class="n">DataFetchThread</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__datasources</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">__exchangelists</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                    <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__exchangelists</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__dataFetchers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dft</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_stateUpdated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">dft</span><span class="o">.</span><span class="n">changeStatus</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">setNumberOfSources</span><span class="p">(</span><span class="n">nrsources</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setSourceConfiguration</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">nrsources</span> <span class="o">=</span> <span class="n">nrsources</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">updateLayout</span><span class="p">()</span>
        <span class="n">QtCore</span><span class="o">.</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">__mergeDetServers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detserverdict</span><span class="p">,</span> <span class="n">detserverlist</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; merges detector servers from</span>
<span class="sd">        a dictionary and a list</span>

<span class="sd">        :param detserverdict: detector server dictionary</span>
<span class="sd">        :type detserverdict: :obj:`dict` &lt;:obj:`str`, :obj:`list`&lt;:obj:`str`&gt;&gt;</span>
<span class="sd">        :param detserverklist: detector server list</span>
<span class="sd">        :type detserverlist: :obj:`list` &lt; :obj:`str`&gt;</span>
<span class="sd">        :returns: merged detector server list</span>
<span class="sd">        :rtype: :obj:`list` &lt; :obj:`str`&gt;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">servers</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">detserverdict</span><span class="p">[</span><span class="s2">&quot;pool&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__targetname</span> <span class="ow">in</span> <span class="n">detserverdict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">servers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">detserverdict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__targetname</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">detserverlist</span><span class="p">:</span>
            <span class="n">servers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">detserverlist</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">servers</span><span class="p">)</span>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">__retrieveUserDetServers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detserverdict</span><span class="p">,</span> <span class="n">detserverlist</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; retrives user detector servers from a list</span>
<span class="sd">             which are not in a dictionary</span>

<span class="sd">        :param detserverdict: detector server dictionary</span>
<span class="sd">        :type detserverdict: :obj:`dict` &lt;:obj:`str`, :obj:`list`&lt;:obj:`str`&gt;&gt;</span>
<span class="sd">        :param detserverklist: detector server list</span>
<span class="sd">        :type detserverlist: :obj:`list` &lt; :obj:`str`&gt;</span>
<span class="sd">        :returns: user detector server list</span>
<span class="sd">        :rtype: :obj:`list` &lt; :obj:`str`&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">servers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">detserverlist</span><span class="p">:</span>
            <span class="n">defservers</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">detserverdict</span><span class="p">[</span><span class="s2">&quot;pool&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__targetname</span> <span class="ow">in</span> <span class="n">detserverdict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">defservers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">detserverdict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__targetname</span><span class="p">])</span>
            <span class="n">servers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">detserverlist</span><span class="p">)</span> <span class="o">-</span> <span class="n">defservers</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">servers</span><span class="p">)</span>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">_setSourceConfiguration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourceConfiguration</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sets the source configuration</span>

<span class="sd">        :param sourceConfiguration: source configuration string</span>
<span class="sd">        :type sourceConfiguration: :obj:`str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">sourceConfiguration</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sourceConfiguration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sourceconfiguration</span> <span class="o">=</span> <span class="n">sourceConfiguration</span>
        <span class="n">cdss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">currentDataSources</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ds</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cdss</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">ds</span> <span class="o">==</span> \
               <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__datasources</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="vm">__name__</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__datasources</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setConfiguration</span><span class="p">(</span><span class="n">sourceConfiguration</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLavueState</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;configuration&quot;</span><span class="p">:</span> <span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__sourceconfiguration</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)})</span>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">_switchSourceDisplay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;switches source display parameters</span>

<span class="sd">        :param sourceConfiguration: source configuration string</span>
<span class="sd">        :type sourceConfiguration: :obj:`str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sourcelabel</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="ow">and</span> <span class="n">label</span> <span class="ow">and</span> \
           <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sourcedisplay</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__sourcelabel</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sourceDisplay</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__sourcelabel</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__applyoptionsfromdict</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">__setSourceLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;sets source display parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sourcelabel</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">sourcedisplay</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sourcelabel</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;transformation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__trafowg</span><span class="o">.</span><span class="n">transformation</span><span class="p">()</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;tool&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;toolconfig&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">toolConfiguration</span><span class="p">()</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;scaling&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scalingwg</span><span class="o">.</span><span class="n">currentScaling</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">isAutoLevel</span><span class="p">():</span>
                <span class="n">values</span><span class="p">[</span><span class="s2">&quot;levels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">levels</span><span class="p">()</span>
                <span class="n">values</span><span class="p">[</span><span class="s2">&quot;autofactor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">values</span><span class="p">[</span><span class="s2">&quot;autofactor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">autoFactor</span><span class="p">()</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;gradient&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">gradient</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bkgsubwg</span><span class="o">.</span><span class="n">isBkgSubApplied</span><span class="p">()</span> \
               <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">bkgimagename</span><span class="p">:</span>
                <span class="n">values</span><span class="p">[</span><span class="s2">&quot;bkgfile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">bkgimagename</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">values</span><span class="p">[</span><span class="s2">&quot;bkgfile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__normwg</span><span class="o">.</span><span class="n">isBFSubApplied</span><span class="p">()</span> \
               <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">bfimagename</span><span class="p">:</span>
                <span class="n">values</span><span class="p">[</span><span class="s2">&quot;brightfieldfile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">bfimagename</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">values</span><span class="p">[</span><span class="s2">&quot;brightfieldfile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">bkgscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__backgroundscale</span> \
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showsubsf</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">bfscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__brightfieldscale</span> \
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">shownormsf</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;bfscale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bfscale</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;bkgscale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bkgscale</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__maskwg</span><span class="o">.</span><span class="n">isMaskApplied</span><span class="p">()</span> <span class="ow">and</span> \
               <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">maskimagename</span><span class="p">:</span>
                <span class="n">values</span><span class="p">[</span><span class="s2">&quot;maskfile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">maskimagename</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">values</span><span class="p">[</span><span class="s2">&quot;maskfile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">mvalue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__highvaluemaskwg</span><span class="o">.</span><span class="n">mask</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">mvalue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">values</span><span class="p">[</span><span class="s2">&quot;maskhighvalue&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">mvalue</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">values</span><span class="p">[</span><span class="s2">&quot;maskhighvalue&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;viewrange&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">viewRange</span><span class="p">()</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;offset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translations</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">setSourceDisplay</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">__setSardana</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sets the sardana utils</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__sardana</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__sardana</span> <span class="o">=</span> <span class="n">sardanaUtils</span><span class="o">.</span><span class="n">SardanaUtils</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setSardanaUtils</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__sardana</span><span class="p">)</span>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_onSourceChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; update a list of sources according to the status</span>

<span class="sd">        :param status: json list on status, i.e source type ids</span>
<span class="sd">        :type status: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lstatus</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
        <span class="n">dss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">currentDataSources</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ds</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dss</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">lstatus</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">ds</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__datasources</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="vm">__name__</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__datasources</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span>
                        <span class="n">isr</span><span class="p">,</span> <span class="n">ds</span><span class="p">)(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">timeout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setSourceConfiguration</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ds</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dss</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">updateSourceMetaData</span><span class="p">(</span>
                <span class="n">i</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">__datasources</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">getMetaData</span><span class="p">())</span>
        <span class="n">dssa</span> <span class="o">=</span> <span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">currentDataSourceAlias</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLavueState</span><span class="p">({</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">dssa</span><span class="p">})</span>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_onToolConfigurationChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; update tool configuration in lavue state</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLavueState</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;tool&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">tool</span><span class="p">(),</span>
             <span class="s2">&quot;toolconfig&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">toolConfiguration</span><span class="p">()})</span>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_updateSource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">sid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; update the current source</span>

<span class="sd">        :param status: current source combobox status id from starting from 1,</span>
<span class="sd">                       0 is disconnected, -1 current source</span>
<span class="sd">        :type status: :obj:`int`</span>
<span class="sd">        :param sid: source tab id starting from 0 and -1 for all</span>
<span class="sd">        :type sid: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
            <span class="n">dss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">currentDataSources</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">sid</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ds</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__datasources</span><span class="p">):</span>
                    <span class="n">ds</span><span class="o">.</span><span class="n">setTimeOut</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">timeout</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__dataFetchers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">setDataSource</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sourceconfiguration</span> <span class="ow">and</span> \
                       <span class="bp">self</span><span class="o">.</span><span class="n">__sourceconfiguration</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> \
                       <span class="n">dss</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">):</span>
                        <span class="n">ds</span><span class="o">.</span><span class="n">setConfiguration</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__sourceconfiguration</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">updateSourceMetaData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">**</span><span class="n">ds</span><span class="o">.</span><span class="n">getMetaData</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__datasources</span><span class="p">[</span><span class="n">sid</span><span class="p">]</span>
                <span class="n">ds</span><span class="o">.</span><span class="n">setTimeOut</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">timeout</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__dataFetchers</span><span class="p">[</span><span class="n">sid</span><span class="p">]</span><span class="o">.</span><span class="n">setDataSource</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sourceconfiguration</span> <span class="ow">and</span> \
                   <span class="bp">self</span><span class="o">.</span><span class="n">__sourceconfiguration</span><span class="p">[</span><span class="n">sid</span><span class="p">]</span> <span class="ow">and</span> \
                   <span class="n">dss</span><span class="p">[</span><span class="n">sid</span><span class="p">]</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">):</span>
                    <span class="n">ds</span><span class="o">.</span><span class="n">setConfiguration</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__sourceconfiguration</span><span class="p">[</span><span class="n">sid</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">updateSourceMetaData</span><span class="p">(</span>
                        <span class="n">sid</span><span class="p">,</span> <span class="o">**</span><span class="n">ds</span><span class="o">.</span><span class="n">getMetaData</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stateUpdated</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_replot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">autorange</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The main command of the live viewer class:</span>
<span class="sd">        draw a numpy array with the given name and autoRange.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">autorange</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">autoRange</span><span class="p">()</span>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The main command of the live viewer class:</span>
<span class="sd">        draw a numpy array with the given name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ploting</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ploting</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rawimage</span>
            <span class="c1"># apply user range</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__applyRange</span><span class="p">()</span>
            <span class="c1"># apply user filters</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__applyFilters</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showmbuffer</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__mbufferwg</span><span class="o">.</span><span class="n">isOn</span><span class="p">():</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__mbufferwg</span><span class="o">.</span><span class="n">process</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__imagename</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span><span class="p">,</span> <span class="n">mdata</span> <span class="o">=</span> <span class="n">result</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__mdata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">mdata</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;channellabels&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__mdata</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__channelwg</span><span class="o">.</span><span class="n">updateChannelLabels</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__mdata</span><span class="p">[</span><span class="s2">&quot;channellabels&quot;</span><span class="p">])</span>

            <span class="c1"># prepare or preprocess the raw image if present:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__prepareImage</span><span class="p">()</span>

            <span class="c1"># perform transformation</span>
            <span class="c1"># (crdtranspose, crdleftrightflip, crdupdownflip,</span>
            <span class="c1"># orgtranspose, orgleftrightflip, orgupdownflip)</span>
            <span class="n">allcrds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__transform</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setTransformations</span><span class="p">(</span><span class="o">*</span><span class="n">allcrds</span><span class="p">)</span>
            <span class="c1"># use the internal raw image to create a display image with chosen</span>
            <span class="c1"># scaling</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__scale</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__scalingwg</span><span class="o">.</span><span class="n">currentScaling</span><span class="p">())</span>
            <span class="c1"># calculate and update the stats for this</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__calcUpdateStats</span><span class="p">()</span>
            <span class="c1"># calls internally the plot function of the plot widget</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__imagename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scaledimage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">fileNameLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__imagename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">fileNameLineEdit</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__imagename</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__scaledimage</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">statswoscaling</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scaledimage</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__imagename</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showhisto</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__updatehisto</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">updateHistoImage</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__updatehisto</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ploting</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_calcUpdateStatsSec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calcuates statistics without  sending security stream</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__calcUpdateStats</span><span class="p">(</span><span class="n">secstream</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">__calcUpdateStats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">secstream</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calcuates statistics</span>

<span class="sd">        :param secstream: send security stream flag</span>
<span class="sd">        :type secstream: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># calculate the stats for this</span>

        <span class="n">auto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">isAutoLevel</span><span class="p">()</span>
        <span class="n">stream</span> <span class="o">=</span> <span class="n">secstream</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">secstream</span> <span class="ow">and</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">__scaledimage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showstats</span>
        <span class="n">calcvariance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">calcvariance</span>
        <span class="n">maxval</span><span class="p">,</span> <span class="n">meanval</span><span class="p">,</span> <span class="n">varval</span><span class="p">,</span> <span class="n">minval</span><span class="p">,</span> <span class="n">maxrawval</span><span class="p">,</span> <span class="n">maxsval</span><span class="p">,</span> <span class="n">channels</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">__calcStats</span><span class="p">(</span>
                <span class="p">(</span><span class="n">stream</span> <span class="ow">or</span> <span class="n">display</span><span class="p">,</span>
                 <span class="n">stream</span> <span class="ow">or</span> <span class="n">display</span><span class="p">,</span>
                 <span class="n">display</span> <span class="ow">and</span> <span class="n">calcvariance</span><span class="p">,</span>
                 <span class="n">stream</span> <span class="ow">or</span> <span class="n">auto</span><span class="p">,</span>
                 <span class="n">stream</span><span class="p">,</span>
                 <span class="n">auto</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">smaxval</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.4f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">maxval</span>
        <span class="n">smeanval</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.4f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">meanval</span>
        <span class="n">svarval</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.4f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">varval</span>
        <span class="n">sminval</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">minval</span>
        <span class="n">smaxrawval</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.4f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">maxrawval</span>
        <span class="n">calctime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">currentscaling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scalingwg</span><span class="o">.</span><span class="n">currentScaling</span><span class="p">()</span>
        <span class="c1"># update the statistics display</span>
        <span class="k">if</span> <span class="n">stream</span><span class="p">:</span>
            <span class="n">messagedata</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;command&#39;</span><span class="p">:</span> <span class="s1">&#39;alive&#39;</span><span class="p">,</span> <span class="s1">&#39;calctime&#39;</span><span class="p">:</span> <span class="n">calctime</span><span class="p">,</span> <span class="s1">&#39;maxval&#39;</span><span class="p">:</span> <span class="n">smaxval</span><span class="p">,</span>
                <span class="s1">&#39;maxrawval&#39;</span><span class="p">:</span> <span class="n">smaxrawval</span><span class="p">,</span>
                <span class="s1">&#39;minval&#39;</span><span class="p">:</span> <span class="n">sminval</span><span class="p">,</span> <span class="s1">&#39;meanval&#39;</span><span class="p">:</span> <span class="n">smeanval</span><span class="p">,</span> <span class="s1">&#39;pid&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__apppid</span><span class="p">,</span>
                <span class="s1">&#39;scaling&#39;</span><span class="p">:</span> <span class="p">(</span>
                    <span class="s1">&#39;linear&#39;</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">statswoscaling</span>
                    <span class="k">else</span> <span class="n">currentscaling</span><span class="p">)}</span>
            <span class="n">topic</span> <span class="o">=</span> <span class="mi">10001</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">topic</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">messagedata</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">secsocket</span><span class="o">.</span><span class="n">send_string</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__statswg</span><span class="o">.</span><span class="n">updateStatistics</span><span class="p">(</span>
            <span class="n">smeanval</span><span class="p">,</span> <span class="n">smaxval</span><span class="p">,</span> <span class="n">svarval</span><span class="p">,</span>
            <span class="s1">&#39;linear&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">statswoscaling</span> <span class="k">else</span> <span class="n">currentscaling</span><span class="p">)</span>

        <span class="c1"># if needed, update the level display</span>
        <span class="k">if</span> <span class="n">auto</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">updateAutoLevels</span><span class="p">(</span><span class="n">minval</span><span class="p">,</span> <span class="n">maxsval</span><span class="p">,</span> <span class="n">channels</span><span class="p">)</span>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">_startPlotting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; mode changer: start plotting mode.</span>
<span class="sd">        It starts plotting if the connection is really established.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">isConnected</span><span class="p">():</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">dft</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dataFetchers</span><span class="p">:</span>
            <span class="n">dft</span><span class="o">.</span><span class="n">changeStatus</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">dft</span><span class="o">.</span><span class="n">isFetching</span><span class="p">():</span>
                <span class="n">dft</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">_stopPlotting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; mode changer: stop plotting mode</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">dft</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dataFetchers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dft</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dft</span><span class="o">.</span><span class="n">changeStatus</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_connectSource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  calls the connect function of the source interface</span>

<span class="sd">        :param status: current source status id</span>
<span class="sd">        :type status: :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># print(&quot;Connect Source %s&quot; % status)</span>
        <span class="n">lstatus</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">lstatus</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__viewFrameRate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showframerate</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">status</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lstatus</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_updateSource</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__datasources</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">messageBox</span><span class="o">.</span><span class="n">MessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;lavue: No data source is defined&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;No data source is defined&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Please select the image source&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setSourceConfiguration</span><span class="p">()</span>
        <span class="n">consuccess</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__datasources</span><span class="p">))</span>
        <span class="n">states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">tabCheckBoxStates</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ids</span><span class="p">,</span> <span class="n">ds</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__datasources</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ds</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="ow">and</span> <span class="n">states</span><span class="p">[</span><span class="n">ids</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">connectFailure</span><span class="p">()</span>
                <span class="n">messageBox</span><span class="o">.</span><span class="n">MessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;lavue: The </span><span class="si">%s</span><span class="s2"> connection could not be established&quot;</span>
                    <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="s2">&quot;The </span><span class="si">%s</span><span class="s2"> connection could not be established&quot;</span>
                    <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">errormessage</span><span class="p">))</span>
                <span class="n">consuccess</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">consuccess</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">connectSuccess</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">secport</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">secstream</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">secstream</span><span class="p">:</span>
            <span class="n">calctime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">messagedata</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;command&#39;</span><span class="p">:</span> <span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="s1">&#39;calctime&#39;</span><span class="p">:</span> <span class="n">calctime</span><span class="p">,</span> <span class="s1">&#39;pid&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__apppid</span><span class="p">}</span>
            <span class="n">topic</span> <span class="o">=</span> <span class="mi">10001</span>
            <span class="c1"># print(str(messagedata))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">secsocket</span><span class="o">.</span><span class="n">send_string</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">topic</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">messagedata</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__updatehisto</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__setSourceLabel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLavueState</span><span class="p">({</span><span class="s2">&quot;connected&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">isConnected</span><span class="p">()})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_startPlotting</span><span class="p">()</span>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_disconnectSource</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calls the disconnect function of the source interface</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__disconnectSource</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_updateSource</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__setSourceLabel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLavueState</span><span class="p">({</span><span class="s2">&quot;connected&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">isConnected</span><span class="p">()})</span>
        <span class="c1"># self.__datasources[0] = None</span>

    <span class="k">def</span> <span class="nf">__disconnectSource</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calls the disconnect function of the source interface</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stopPlotting</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__datasources</span><span class="p">:</span>
            <span class="n">ds</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__viewFrameRate</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">secstream</span><span class="p">:</span>
            <span class="n">calctime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">messagedata</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;command&#39;</span><span class="p">:</span> <span class="s1">&#39;stop&#39;</span><span class="p">,</span>
                <span class="s1">&#39;calctime&#39;</span><span class="p">:</span> <span class="n">calctime</span><span class="p">,</span>
                <span class="s1">&#39;pid&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__apppid</span><span class="p">}</span>
            <span class="c1"># print(str(messagedata))</span>
            <span class="n">topic</span> <span class="o">=</span> <span class="mi">10001</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">secsocket</span><span class="o">.</span><span class="n">send_string</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">topic</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">messagedata</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">)))</span>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">__mergeData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fulldata</span><span class="p">,</span> <span class="n">oldname</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; merge data parts to (name, rawdata, metadata)</span>

<span class="sd">        :param fulldata: a list of PartialData objects</span>
<span class="sd">        :type fulldata: :obj:`list` &lt;:class:`PartialData`&gt;</span>
<span class="sd">        :param oldname: old name</span>
<span class="sd">        :type oldname: :obj:`str`</span>
<span class="sd">        :param channels: map image sources into different color channels</span>
<span class="sd">        :type channels: :obj:`bool`</span>
<span class="sd">        :returns: tuple of exchange object (name, data, metadata)</span>
<span class="sd">        :rtype: :obj:`list` &lt;:obj:`str`, :class:`numpy.ndarray`, :obj:`str` &gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">pdata</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">pdata</span> <span class="ow">in</span> <span class="n">fulldata</span> <span class="k">if</span> <span class="n">pdata</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="n">rawimage</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s2">&quot;__ERROR__&quot;</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;__ERROR__&quot;</span>
            <span class="n">rawimage</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">pdata</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
                 <span class="k">for</span> <span class="n">pdata</span> <span class="ow">in</span> <span class="n">fulldata</span>
                 <span class="k">if</span> <span class="n">pdata</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;__ERROR__&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">name</span><span class="p">,</span> <span class="n">rawimage</span><span class="p">,</span> <span class="n">metadata</span>

        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">names</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="kc">None</span>

        <span class="n">mdata</span> <span class="o">=</span> <span class="p">[</span><span class="n">pdata</span><span class="o">.</span><span class="n">metadata</span> <span class="k">for</span> <span class="n">pdata</span> <span class="ow">in</span> <span class="n">fulldata</span> <span class="k">if</span> <span class="n">pdata</span><span class="o">.</span><span class="n">metadata</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">oldname</span> <span class="o">==</span> <span class="n">name</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">mdata</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">mdata</span><span class="p">:</span>
            <span class="n">dmdata</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">md</span> <span class="ow">in</span> <span class="n">mdata</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">md</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">dmdata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">md</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                            <span class="s2">&quot;lavuelib.liveViewer.LiveViewer.__getNewData &quot;</span>
                            <span class="s2">&quot;update metadata </span><span class="si">%s</span><span class="s2">: (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">md</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">md</span><span class="p">)))</span>

            <span class="n">metadata</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">dmdata</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">ldata</span> <span class="o">=</span> <span class="p">[</span><span class="n">pdata</span> <span class="k">for</span> <span class="n">pdata</span> <span class="ow">in</span> <span class="n">fulldata</span> <span class="k">if</span> <span class="n">pdata</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ldata</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">name</span><span class="p">,</span> <span class="n">rawimage</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">ldata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[:</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">ldata</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">pd</span> <span class="o">=</span> <span class="n">ldata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">sx</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">sy</span><span class="p">]</span>
                <span class="n">dtype</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">dtype</span><span class="p">()</span>
                <span class="n">scc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">scc</span>
                <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">shape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">pd</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">x</span> <span class="ow">or</span> <span class="mi">0</span>
                <span class="n">pd</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">y</span> <span class="ow">or</span> <span class="mi">0</span>
                <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">pd</span><span class="o">.</span><span class="n">x</span>
                <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">pd</span><span class="o">.</span><span class="n">y</span>
                <span class="n">nx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
                <span class="n">ny</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">pd</span> <span class="ow">in</span> <span class="n">ldata</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="n">scc</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">scc</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">scc</span><span class="p">)</span>
                    <span class="n">pd</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">x</span> <span class="ow">or</span> <span class="mi">0</span>
                    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">pd</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">psh</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">sx</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">sy</span><span class="p">]</span>
                    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">psh</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">psh</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">psh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">pd</span><span class="o">.</span><span class="n">x</span>
                    <span class="n">psh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">pd</span><span class="o">.</span><span class="n">y</span>
                    <span class="k">if</span> <span class="n">dtype</span> <span class="o">!=</span> <span class="n">pd</span><span class="o">.</span><span class="n">dtype</span><span class="p">():</span>
                        <span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">floattype</span>
                    <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">psh</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">psh</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">nx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
                    <span class="n">ny</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ny</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">channels</span><span class="p">:</span>
                    <span class="n">scc</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ldata</span><span class="p">),</span> <span class="n">scc</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">scc</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">nshape</span> <span class="o">=</span> <span class="p">(</span><span class="n">scc</span><span class="p">,</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">nx</span><span class="p">,</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ny</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">nshape</span> <span class="o">=</span> <span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">nx</span><span class="p">,</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ny</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">nanmask</span><span class="p">:</span>
                    <span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">floattype</span>
                <span class="n">rawimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">nshape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">nanmask</span><span class="p">:</span>
                    <span class="n">rawimage</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pd</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ldata</span><span class="p">):</span>
                    <span class="n">lsh</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">data</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">lsh</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">scc</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">rawimage</span><span class="p">[</span>
                                <span class="n">pd</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">nx</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">sx</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">nx</span><span class="p">,</span>
                                <span class="n">pd</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">ny</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">sy</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">ny</span><span class="p">]</span> <span class="o">=</span> \
                                    <span class="n">pd</span><span class="o">.</span><span class="n">data</span><span class="p">()</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">rawimage</span><span class="p">[</span>
                                <span class="n">i</span><span class="p">,</span>
                                <span class="n">pd</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">nx</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">sx</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">nx</span><span class="p">,</span>
                                <span class="n">pd</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">ny</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">sy</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">ny</span><span class="p">]</span> <span class="o">=</span> \
                                    <span class="n">pd</span><span class="o">.</span><span class="n">data</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">scc</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">rawimage</span><span class="p">[</span>
                                <span class="n">i</span><span class="p">:</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                <span class="n">pd</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">nx</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">sx</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">nx</span><span class="p">,</span>
                                <span class="n">pd</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">ny</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">sy</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">ny</span>
                                <span class="p">]</span> <span class="o">=</span> \
                                    <span class="n">pd</span><span class="o">.</span><span class="n">data</span><span class="p">()</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">rawimage</span><span class="p">[</span>
                                <span class="mi">0</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">scc</span><span class="p">,</span>
                                <span class="n">pd</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">nx</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">sx</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">nx</span><span class="p">,</span>
                                <span class="n">pd</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">ny</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">sy</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">ny</span><span class="p">]</span> <span class="o">=</span> \
                                    <span class="n">pd</span><span class="o">.</span><span class="n">data</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">name</span><span class="p">,</span> <span class="n">rawimage</span><span class="p">,</span> <span class="n">metadata</span>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_getNewData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; checks if data is there at all</span>

<span class="sd">        :param name: image name</span>
<span class="sd">        :type name: :obj:`str`</span>
<span class="sd">        :param metadata: JSON dictionary with metadata</span>
<span class="sd">        :type metadata: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fulldata</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">tabCheckBoxStates</span><span class="p">()</span>
        <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dataFetchers</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">while</span> <span class="p">(</span><span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">fetching</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">isConnected</span><span class="p">()</span>
                       <span class="ow">and</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="mi">100</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">name</span><span class="p">):</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">refreshrate</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span>
                    <span class="n">cnt</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
                    <span class="c1"># print(&quot;READ&quot;, i, time.time())</span>
                    <span class="n">name</span><span class="p">,</span> <span class="n">rawimage</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">__exchangelists</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">readData</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">name</span><span class="p">,</span> <span class="n">rawimage</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__translations</span><span class="p">):</span>
                    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__translations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__transformations</span><span class="p">):</span>
                    <span class="n">tr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__transformations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;lavuelib.liveViewer.LiveViewer.__getNewData &quot;</span>
                    <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">, [</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span>
                    <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
                     <span class="n">rawimage</span><span class="o">.</span><span class="n">shape</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">rawimage</span><span class="p">,</span> <span class="s2">&quot;shape&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                     <span class="n">x</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">fulldata</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">PartialData</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">rawimage</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">tr</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__intmaxvalue</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">negmask</span><span class="p">:</span>
            <span class="n">imvtb</span> <span class="o">=</span> <span class="p">[</span><span class="n">fd</span><span class="o">.</span><span class="n">intmaxvalue</span><span class="p">()</span> <span class="k">for</span> <span class="n">fd</span> <span class="ow">in</span> <span class="n">fulldata</span><span class="p">]</span>
            <span class="n">imvtb</span> <span class="o">=</span> <span class="p">[</span><span class="n">vl</span> <span class="k">for</span> <span class="n">vl</span> <span class="ow">in</span> <span class="n">imvtb</span> <span class="k">if</span> <span class="n">vl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">imvtb</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__intmaxvalue</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">imvtb</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">isConnected</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fulldata</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">rawimage</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">fulldata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[:</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">rawimage</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__mergeData</span><span class="p">(</span>
                <span class="n">fulldata</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__imagename</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">imagechannels</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">rawimage</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">rawimage</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span> \
           <span class="ow">and</span> <span class="n">rawimage</span><span class="p">:</span>
            <span class="n">rawimage</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> string (</span><span class="si">%s</span><span class="s2">) cannot be read&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">rawimage</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;__ERROR__&quot;</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__imagename</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">metadata</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dft</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dataFetchers</span><span class="p">:</span>
                <span class="n">dft</span><span class="o">.</span><span class="n">ready</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;__ERROR__&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">interruptonerror</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">isConnected</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">toggleServerConnection</span><span class="p">()</span>
                <span class="n">errortext</span> <span class="o">=</span> <span class="n">rawimage</span>
                <span class="n">messageBox</span><span class="o">.</span><span class="n">MessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;lavue: Error in reading data&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Viewing will be interrupted&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">errortext</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">setErrorStatus</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">dft</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dataFetchers</span><span class="p">:</span>
                <span class="n">dft</span><span class="o">.</span><span class="n">ready</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">setErrorStatus</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dft</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dataFetchers</span><span class="p">:</span>
                <span class="n">dft</span><span class="o">.</span><span class="n">ready</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="c1"># first time:</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__metadata</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="n">imagename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__metadata</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">metadata</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">imagename</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> \
               <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rawimage</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">rawimage</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">rawimage</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__imagename</span> <span class="o">=</span> <span class="n">imagename</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__rawimage</span> <span class="o">=</span> <span class="n">rawimage</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">metadata</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__mdata</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">metadata</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__mdata</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__mdata</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__mdata</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">resdata</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__mdata</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                                   <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__allowedmdata</span><span class="p">)</span>
                    <span class="n">wgdata</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__mdata</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                                  <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__allowedwgdata</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">wgdata</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">updateMetaData</span><span class="p">(</span><span class="o">**</span><span class="n">wgdata</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">resdata</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__sourcewg</span><span class="o">.</span><span class="n">updateMetaData</span><span class="p">(</span><span class="o">**</span><span class="n">resdata</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">geometryfromsource</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">updateMetaData</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">__mdata</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">updateCenter</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centerx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">centery</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">mouseImagePositionChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">geometryChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="c1"># print(str(e))</span>
        <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__imagename</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__imagename</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__imagename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__metadata</span> \
                    <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">metadata</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rawimage</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">rawimage</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">rawimage</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__rawimage</span> <span class="o">=</span> <span class="n">rawimage</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__mdata</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__updateframeview</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__currenttime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showframerate</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lasttime</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__updateframerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__currenttime</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lasttime</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lasttime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__currenttime</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span><span class="p">()</span>
        <span class="n">QtCore</span><span class="o">.</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dataFetchers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">tm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dataFetchers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getTimeStamp</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">idf</span><span class="p">,</span> <span class="n">dft</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dataFetchers</span><span class="p">):</span>
            <span class="n">dft</span><span class="o">.</span><span class="n">ready</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">idf</span><span class="p">:</span>
                <span class="n">dft</span><span class="o">.</span><span class="n">setTimeStamp</span><span class="p">(</span><span class="n">tm</span><span class="p">)</span>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">__updateframeview</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">slider</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">status</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showsteps</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__frame</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__frame</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">slider</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__frame</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameHorizontalSlider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__frame</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameHorizontalSlider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameHorizontalSlider</span><span class="o">.</span><span class="n">maximum</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">framestepSpinBox</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">framestepLabel</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">lowerframePushButton</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">higherframePushButton</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameLineEdit</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># self.__fieldpath = None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">lowerframePushButton</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">higherframePushButton</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">framestepSpinBox</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameLineEdit</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">framestepLabel</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">slider</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameHorizontalSlider</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">frameHorizontalSlider</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">__updateframerate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ratetime</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ratetime</span><span class="p">:</span>
            <span class="n">fr</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">ratetime</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fr</span> <span class="o">&gt;=</span> <span class="mf">9.9</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">framerateLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.0f</span><span class="s2"> Hz&quot;</span> <span class="o">%</span> <span class="n">fr</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">framerateLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.1f</span><span class="s2"> Hz&quot;</span> <span class="o">%</span> <span class="n">fr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">framerateLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">__updateframeratetip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ratetime</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ratetime</span><span class="p">:</span>
            <span class="n">fr</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">ratetime</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fr</span> <span class="o">&gt;=</span> <span class="mf">9.9</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">framerateLineEdit</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
                    <span class="s2">&quot;Set frame rate: </span><span class="si">%.0f</span><span class="s2"> Hz&quot;</span> <span class="o">%</span> <span class="n">fr</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">framerateLineEdit</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
                    <span class="s2">&quot;Set frame rate: </span><span class="si">%.1f</span><span class="s2"> Hz&quot;</span> <span class="o">%</span> <span class="n">fr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ui</span><span class="o">.</span><span class="n">framerateLineEdit</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Frame rate in Hz&quot;</span><span class="p">)</span>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">__prepareImage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;applies: make image gray, substracke the background image and</span>
<span class="sd">           apply the mask</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">ics</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="s2">&quot;suminthelast&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__mdata</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">ics</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__mdata</span><span class="p">[</span><span class="s2">&quot;suminthelast&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__channelwg</span><span class="o">.</span><span class="n">setNumberOfChannels</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ics</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__channelwg</span><span class="o">.</span><span class="n">colorChannel</span><span class="p">():</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rgb</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setrgb</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">showGradient</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ics</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
                <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;skipfirst&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__mdata</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">__mdata</span><span class="p">[</span><span class="s2">&quot;skipfirst&quot;</span><span class="p">]):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span> <span class="o">=</span> <span class="n">_nansum</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span> <span class="o">=</span> <span class="n">_nansum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span><span class="p">)</span> <span class="o">-</span> <span class="n">ics</span> <span class="o">&gt;=</span> \
                       <span class="bp">self</span><span class="o">.</span><span class="n">__channelwg</span><span class="o">.</span><span class="n">colorChannel</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span><span class="p">[</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__channelwg</span><span class="o">.</span><span class="n">colorChannel</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rgb</span><span class="p">():</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">setrgb</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">showGradient</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">ics</span> <span class="o">==</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">__channelwg</span><span class="o">.</span><span class="n">colorChannel</span><span class="p">()):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rgb</span><span class="p">():</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">setrgb</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">showGradient</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span>
                                <span class="s1">&#39;ignore&#39;</span><span class="p">,</span>
                                <span class="sa">r</span><span class="s1">&#39;Mean of empty slice&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="s2">&quot;skipfirst&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__mdata</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> \
                               <span class="bp">self</span><span class="o">.</span><span class="n">__mdata</span><span class="p">[</span><span class="s2">&quot;skipfirst&quot;</span><span class="p">]:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="mi">0</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ics</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rgb</span><span class="p">():</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">setrgb</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">showGradient</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">rgbs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__channelwg</span><span class="o">.</span><span class="n">rgbchannels</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">rgbs</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span> <span class="o">=</span> \
                                    <span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
                            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                                <span class="n">nshape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                                <span class="n">nshape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span><span class="p">,</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                                         <span class="n">shape</span><span class="o">=</span><span class="n">nshape</span><span class="o">.</span>
                                         <span class="n">shape</span><span class="p">[:,</span> <span class="p">:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                         <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span><span class="o">.</span><span class="n">dtype</span><span class="p">)),</span>
                                    <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">zeros</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="n">nshape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                            <span class="n">nshape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                            <span class="k">if</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">in</span> <span class="n">rgbs</span><span class="p">:</span>
                                <span class="n">zeros</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                                    <span class="n">shape</span><span class="o">=</span><span class="n">nshape</span><span class="p">,</span>
                                    <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">nanmask</span> <span class="ow">and</span> \
                                   <span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span>
                                    <span class="n">zeros</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">rgbs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span>
                                 <span class="n">reshape</span><span class="p">(</span><span class="n">nshape</span><span class="p">)</span>
                                 <span class="k">if</span> <span class="n">rgbs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="n">zeros</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">rgbs</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span>
                                 <span class="n">reshape</span><span class="p">(</span><span class="n">nshape</span><span class="p">)</span>
                                 <span class="k">if</span> <span class="n">rgbs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="n">zeros</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">rgbs</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span>
                                 <span class="n">reshape</span><span class="p">(</span><span class="n">nshape</span><span class="p">)</span>
                                 <span class="k">if</span> <span class="n">rgbs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="n">zeros</span><span class="p">),</span>
                                <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ics</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rgb</span><span class="p">():</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">setrgb</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__channelwg</span><span class="o">.</span><span class="n">showGradient</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">showGradient</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>

                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="kn">import</span> <span class="nn">traceback</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="n">messageBox</span><span class="o">.</span><span class="n">MessageBox</span><span class="o">.</span><span class="n">getText</span><span class="p">(</span>
                        <span class="s2">&quot;lavue: color channel </span><span class="si">%s</span><span class="s2"> does not exist.&quot;</span>
                        <span class="s2">&quot; Reset to grey scale&quot;</span>
                        <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__channelwg</span><span class="o">.</span><span class="n">colorChannel</span><span class="p">())</span>
                    <span class="n">messageBox</span><span class="o">.</span><span class="n">MessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="bp">self</span><span class="p">,</span>
                        <span class="s2">&quot;lavue: color channel </span><span class="si">%s</span><span class="s2"> does not exist. &quot;</span>
                        <span class="s2">&quot; Reset to grey scale&quot;</span>
                        <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__channelwg</span><span class="o">.</span><span class="n">colorChannel</span><span class="p">(),</span>
                        <span class="n">text</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__channelwg</span><span class="o">.</span><span class="n">setChannel</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rgb</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setrgb</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__channelwg</span><span class="o">.</span><span class="n">showGradient</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">showGradient</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">applyMask</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__channelwg</span><span class="o">.</span><span class="n">setNumberOfChannels</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rgb</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setrgb</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__channelwg</span><span class="o">.</span><span class="n">showGradient</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">showGradient</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__channelwg</span><span class="o">.</span><span class="n">setNumberOfChannels</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dobkgsubtraction</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scbackgroundimage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span> <span class="ow">and</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__unsignedmap</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> \
                   <span class="ow">and</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__scbackgroundimage</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span> <span class="ow">and</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">__scbackgroundimage</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__unsignedmap</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scbackgroundimage</span><span class="p">,</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__unsignedmap</span><span class="p">[</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span> <span class="o">=</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scbackgroundimage</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_checkBkgSubtraction</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__backgroundimage</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__scbackgroundimage</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__dobkgsubtraction</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="kn">import</span> <span class="nn">traceback</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">messageBox</span><span class="o">.</span><span class="n">MessageBox</span><span class="o">.</span><span class="n">getText</span><span class="p">(</span>
                    <span class="s2">&quot;lavue: Background image does not match &quot;</span>
                    <span class="s2">&quot;to the current image&quot;</span><span class="p">)</span>
                <span class="n">messageBox</span><span class="o">.</span><span class="n">MessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;lavue: Background image does not match &quot;</span>
                    <span class="s2">&quot;to the current image&quot;</span><span class="p">,</span>
                    <span class="n">text</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dobfsubtraction</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bfmdfimage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bfmdfimage</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_checkBFSubtraction</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__bfmdfimage</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__brightfieldimage</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__scbrightfieldimage</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__dobfsubtraction</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="kn">import</span> <span class="nn">traceback</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">messageBox</span><span class="o">.</span><span class="n">MessageBox</span><span class="o">.</span><span class="n">getText</span><span class="p">(</span>
                    <span class="s2">&quot;lavue: Bright field image does not match &quot;</span>
                    <span class="s2">&quot;to the current image&quot;</span><span class="p">)</span>
                <span class="n">messageBox</span><span class="o">.</span><span class="n">MessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;lavue: Bright field image does not match &quot;</span>
                    <span class="s2">&quot;to the current image&quot;</span><span class="p">,</span>
                    <span class="n">text</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showmask</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">applyMask</span><span class="p">()</span> <span class="ow">and</span> \
           <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">maskIndices</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># set all masked (non-zero values) to zero by index</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">nanmask</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">maskIndices</span><span class="p">()]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span><span class="p">,</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">floattype</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">maskIndices</span><span class="p">()]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__maskwg</span><span class="o">.</span><span class="n">noImage</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setApplyMask</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="kn">import</span> <span class="nn">traceback</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">messageBox</span><span class="o">.</span><span class="n">MessageBox</span><span class="o">.</span><span class="n">getText</span><span class="p">(</span>
                    <span class="s2">&quot;lavue: Mask image does not match &quot;</span>
                    <span class="s2">&quot;to the current image&quot;</span><span class="p">)</span>
                <span class="n">messageBox</span><span class="o">.</span><span class="n">MessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;lavue: Mask image does not match &quot;</span>
                    <span class="s2">&quot;to the current image&quot;</span><span class="p">,</span>
                    <span class="n">text</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showhighvaluemask</span> <span class="ow">and</span> \
           <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">maskValue</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">maskvalue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">maskValue</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">negmask</span> <span class="ow">and</span> \
               <span class="n">maskvalue</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intmaxvalue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">maskvalue</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__intmaxvalue</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">nanmask</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span><span class="p">,</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">floattype</span><span class="p">)</span>
                    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span>
                            <span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;invalid value encountered in greater&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setMaskValueIndices</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span> <span class="o">&gt;</span> <span class="n">maskvalue</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span><span class="p">[</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">maskValueIndices</span><span class="p">()]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setMaskValueIndices</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span> <span class="o">&gt;</span> <span class="n">maskvalue</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span><span class="p">[</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">maskValueIndices</span><span class="p">()]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="c1"># self.__highvaluemaskwg.noValue()</span>
                <span class="kn">import</span> <span class="nn">traceback</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">messageBox</span><span class="o">.</span><span class="n">MessageBox</span><span class="o">.</span><span class="n">getText</span><span class="p">(</span>
                    <span class="s2">&quot;lavue: Cannot apply high value mask to the current image&quot;</span><span class="p">)</span>
                <span class="n">messageBox</span><span class="o">.</span><span class="n">MessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;lavue: Cannot apply high value mask&quot;</span>
                    <span class="s2">&quot; to the current image&quot;</span><span class="p">,</span>
                    <span class="n">text</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">__transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; does the image transformation on the given numpy array.</span>

<span class="sd">        :returns: crdtranspose, crdleftrightflip, crdupdownflip,</span>
<span class="sd">         orgtranspose, orgleftrightflip, orgupdownflip flags</span>
<span class="sd">        :rtype: (:obj:`bool`, :obj:`bool`, :obj:`bool`,:obj:`bool`,</span>
<span class="sd">                 :obj:`bool`, :obj:`bool`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">crdupdownflip</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">crdleftrightflip</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">crdtranspose</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">orgupdownflip</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">orgleftrightflip</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">orgtranspose</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__trafoname</span> <span class="o">==</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__trafoname</span> <span class="o">==</span> <span class="s2">&quot;flip (up-down)&quot;</span><span class="p">:</span>
            <span class="n">orgupdownflip</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">keepcoords</span><span class="p">:</span>
                <span class="n">crdupdownflip</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__trafoname</span> <span class="o">==</span> <span class="s2">&quot;flip (left-right)&quot;</span><span class="p">:</span>
            <span class="n">orgleftrightflip</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">keepcoords</span><span class="p">:</span>
                <span class="n">crdleftrightflip</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__trafoname</span> <span class="o">==</span> <span class="s2">&quot;transpose&quot;</span><span class="p">:</span>
            <span class="n">orgtranspose</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="c1"># self.__displayimage = np.transpose(self.__displayimage)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">keepcoords</span><span class="p">:</span>
                <span class="n">crdtranspose</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__trafoname</span> <span class="o">==</span> <span class="s2">&quot;rot90 (clockwise)&quot;</span><span class="p">:</span>
            <span class="n">orgtranspose</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">orgupdownflip</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">keepcoords</span><span class="p">:</span>
                <span class="n">crdtranspose</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">crdupdownflip</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="c1"># self.__displayimage = np.transpose(self.__displayimage)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># self.__displayimage = np.transpose(</span>
                <span class="c1">#     np.flipud(self.__displayimage))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__trafoname</span> <span class="o">==</span> <span class="s2">&quot;rot180&quot;</span><span class="p">:</span>
            <span class="n">orgupdownflip</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">orgleftrightflip</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">keepcoords</span><span class="p">:</span>
                <span class="n">crdupdownflip</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">crdleftrightflip</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span><span class="p">))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__trafoname</span> <span class="o">==</span> <span class="s2">&quot;rot270 (clockwise)&quot;</span><span class="p">:</span>
            <span class="n">orgtranspose</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">orgleftrightflip</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">keepcoords</span><span class="p">:</span>
                <span class="n">crdtranspose</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">crdleftrightflip</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="c1"># self.__displayimage = np.transpose(self.__displayimage)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="c1"># self.__displayimage = np.transpose(</span>
                <span class="c1">#     np.fliplr(self.__displayimage))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__trafoname</span> <span class="o">==</span> <span class="s2">&quot;rot180 + transpose&quot;</span><span class="p">:</span>
            <span class="n">orgtranspose</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">orgupdownflip</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">orgleftrightflip</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">keepcoords</span><span class="p">:</span>
                <span class="n">crdtranspose</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">crdupdownflip</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">crdleftrightflip</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># self.__displayimage = np.transpose(self.__displayimage)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span><span class="p">)),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="c1"># self.__displayimage = np.transpose(</span>
                <span class="c1">#     np.fliplr(np.flipud(self.__displayimage)))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">crdtranspose</span><span class="p">,</span> <span class="n">crdleftrightflip</span><span class="p">,</span> <span class="n">crdupdownflip</span><span class="p">,</span>
                <span class="n">orgtranspose</span><span class="p">,</span> <span class="n">orgleftrightflip</span><span class="p">,</span> <span class="n">orgupdownflip</span><span class="p">)</span>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">__applyRange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; applies user range</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showrange</span> <span class="ow">and</span> \
           <span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rangewg</span><span class="o">.</span><span class="n">rangeWindow</span><span class="p">()</span>
            <span class="n">position</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">x1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">y1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> \
               <span class="n">x2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">y2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__setrange</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rangewg</span><span class="o">.</span><span class="n">factor</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">factor</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rangewg</span><span class="o">.</span><span class="n">function</span><span class="p">()</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__npresize</span><span class="p">(</span><span class="n">factor</span><span class="p">,</span> <span class="n">function</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__trafoname</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;transpose&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;rot90 (clockwise)&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;rot270 (clockwise)&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;rot180 + transpose&quot;</span><span class="p">]:</span>
                <span class="n">position</span> <span class="o">=</span> <span class="p">[</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="p">[</span><span class="n">scale</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">scale</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">__setrange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sets window range</span>

<span class="sd">        :param x1: x1 position</span>
<span class="sd">        :type x1: :obj:`int`</span>
<span class="sd">        :param y1: y1 position</span>
<span class="sd">        :type y1: :obj:`int`</span>
<span class="sd">        :param x2: x2 position</span>
<span class="sd">        :type x2: :obj:`int`</span>
<span class="sd">        :param y2: y2 position</span>
<span class="sd">        :type y2: :obj:`int`</span>
<span class="sd">        :returns: x,y - start x,y-position</span>
<span class="sd">        :rtype: (:obj:`int`, :obj:`int`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">image</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">position</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span><span class="p">[</span><span class="n">x1</span><span class="p">:</span><span class="n">x2</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span><span class="p">[</span><span class="n">x1</span><span class="p">:</span><span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">:</span><span class="n">y2</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span><span class="p">[:,</span> <span class="n">x1</span><span class="p">:</span><span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">:</span><span class="n">y2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span> <span class="o">=</span> <span class="n">image</span>
            <span class="n">position</span> <span class="o">=</span> <span class="p">[</span><span class="n">x1</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y1</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">position</span>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">__npresize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; resizes image</span>

<span class="sd">        :param factor: down-sampling factor</span>
<span class="sd">        :type factor: :obj:`int`</span>
<span class="sd">        :param function: reduction function</span>
<span class="sd">        :type function: :obj:`str`</span>
<span class="sd">        :returns: x,y - invert scale</span>
<span class="sd">        :rtype: (:obj:`int`, :obj:`int`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">factor</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="n">factor</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="n">factor</span>
            <span class="n">ww</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">factor</span>
            <span class="n">hh</span> <span class="o">=</span> <span class="n">h</span> <span class="o">*</span> <span class="n">factor</span>
            <span class="k">if</span> <span class="n">ww</span> <span class="o">&lt;</span> <span class="n">factor</span> <span class="ow">or</span> <span class="n">hh</span> <span class="o">&lt;</span> <span class="n">factor</span><span class="p">:</span>
                <span class="n">nfactor</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])),</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__rangewg</span><span class="o">.</span><span class="n">setFactor</span><span class="p">(</span><span class="n">nfactor</span><span class="p">)</span>
                <span class="n">factor</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="n">factor</span>
                <span class="n">h</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="n">factor</span>
                <span class="n">ww</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">factor</span>
                <span class="n">hh</span> <span class="o">=</span> <span class="n">h</span> <span class="o">*</span> <span class="n">factor</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">factor</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span> <span class="o">=</span> \
                    <span class="nb">getattr</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span><span class="p">[:</span><span class="n">ww</span><span class="p">,</span> <span class="p">:</span><span class="n">hh</span><span class="p">]</span><span class="o">.</span>
                        <span class="n">reshape</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">factor</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">factor</span><span class="p">),</span>
                        <span class="n">function</span><span class="p">)((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span> <span class="o">=</span> \
                    <span class="nb">getattr</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span><span class="p">[:,</span> <span class="p">:</span><span class="n">ww</span><span class="p">,</span> <span class="p">:</span><span class="n">hh</span><span class="p">]</span><span class="o">.</span>
                        <span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">w</span><span class="p">,</span> <span class="n">factor</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">factor</span><span class="p">),</span>
                        <span class="n">function</span><span class="p">)((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">))</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="p">[</span><span class="n">factor</span><span class="p">,</span> <span class="n">factor</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">scale</span>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_resizePlot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; resize window and plot</span>
<span class="sd">        :param show: enable/disable resizing</span>
<span class="sd">        :type show: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rangewg</span><span class="o">.</span><span class="n">rangeWindow</span><span class="p">()</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rangewg</span><span class="o">.</span><span class="n">factor</span><span class="p">()</span>
        <span class="n">positionscale</span> <span class="o">=</span> <span class="p">[</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">factor</span><span class="p">,</span> <span class="n">factor</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">show</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x1</span> <span class="ow">or</span> <span class="n">y1</span> <span class="ow">or</span> <span class="n">factor</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">updateMetaData</span><span class="p">(</span>
                <span class="n">positionscale</span><span class="p">,</span>
                <span class="n">rescale</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">updateMetaData</span><span class="p">(</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="n">rescale</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLavueState</span><span class="p">({</span>
            <span class="s2">&quot;rangewindow&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rangewg</span><span class="o">.</span><span class="n">rangeWindow</span><span class="p">(),</span>
            <span class="s2">&quot;dsfactor&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rangewg</span><span class="o">.</span><span class="n">factor</span><span class="p">(),</span>
            <span class="s2">&quot;dsreduction&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__rangewg</span><span class="o">.</span><span class="n">function</span><span class="p">())})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span><span class="p">()</span>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">__applyFilters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; applies user filters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># self.__filteredimage = self.__rawimage</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__filterstate</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">flt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__filters</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">image</span> <span class="o">=</span> <span class="n">flt</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__imagename</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__metadata</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span>
                        <span class="p">)</span>
                        <span class="n">fltmdata</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                                <span class="n">image</span><span class="p">,</span> <span class="n">fltmdata</span> <span class="o">=</span> <span class="n">image</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">image</span> <span class="o">=</span> <span class="n">image</span>
                        <span class="k">if</span> <span class="n">image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span>
                                <span class="nb">hasattr</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__filteredimage</span> <span class="o">=</span> <span class="n">image</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fltmdata</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__mdata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fltmdata</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__filterswg</span><span class="o">.</span><span class="n">setState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="kn">import</span> <span class="nn">traceback</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>
                    <span class="n">messageBox</span><span class="o">.</span><span class="n">MessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;lavue: problems in applying filters&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span>
                    <span class="c1"># print(str(e))</span>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">__scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scalingtype</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sets scaletype on the image</span>

<span class="sd">        :param scalingtype: scaling type</span>
<span class="sd">        :type scalingtype: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setScalingType</span><span class="p">(</span><span class="n">scalingtype</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__scaledimage</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">scalingtype</span> <span class="o">==</span> <span class="s2">&quot;sqrt&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__scaledimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__scaledimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__scaledimage</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">scalingtype</span> <span class="o">==</span> <span class="s2">&quot;log&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__scaledimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span><span class="p">,</span> <span class="mf">10e-3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__scaledimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__scaledimage</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">_VMAJOR</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span> <span class="ow">and</span> <span class="n">_VMINOR</span> <span class="o">==</span> <span class="s1">&#39;9&#39;</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">_VPATCH</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">:</span>
            <span class="c1"># (for 0.9.8 &lt;= version &lt; 0.10.0 i.e. ubuntu 16.04)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__scaledimage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">floattype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__scaledimage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">__calcStats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calcualtes scaled limits for intesity levels</span>

<span class="sd">        :param flag: (max value, mean value, variance value,</span>
<span class="sd">                  min scaled value, max raw value, max scaled value)</span>
<span class="sd">                  to calculate</span>
<span class="sd">        :type flag: [:obj:`bool`, :obj:`bool`, :obj:`bool`,</span>
<span class="sd">                       :obj:`bool`, :obj:`bool`, :obj:`bool`]</span>
<span class="sd">        :returns: max value, mean value, variance value,</span>
<span class="sd">                  min scaled value, max raw value, max scaled value</span>
<span class="sd">        :rtype: [:obj:`str`, :obj:`str`, :obj:`str`, :obj:`str`,</span>
<span class="sd">                    :obj:`str`, :obj:`str`]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">statswoscaling</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> \
           <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span>
                    <span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;All-NaN slice encountered&#39;</span><span class="p">)</span>
                <span class="n">maxval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span><span class="p">)</span> <span class="k">if</span> <span class="n">flag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="mf">0.0</span>
                <span class="n">meanval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span><span class="p">)</span> <span class="k">if</span> <span class="n">flag</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="mf">0.0</span>
                <span class="n">varval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanvar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span><span class="p">)</span> <span class="k">if</span> <span class="n">flag</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">else</span> <span class="mf">0.0</span>
                <span class="n">maxsval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__scaledimage</span><span class="p">)</span> <span class="k">if</span> <span class="n">flag</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="k">else</span> <span class="mf">0.0</span>
        <span class="k">elif</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">statswoscaling</span>
              <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scaledimage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
              <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">maxval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__scaledimage</span><span class="p">)</span> \
                     <span class="k">if</span> <span class="n">flag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">flag</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="k">else</span> <span class="mf">0.0</span>
            <span class="n">meanval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__scaledimage</span><span class="p">)</span> <span class="k">if</span> <span class="n">flag</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="mf">0.0</span>
            <span class="n">varval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanvar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__scaledimage</span><span class="p">)</span> <span class="k">if</span> <span class="n">flag</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">else</span> <span class="mf">0.0</span>
            <span class="n">maxsval</span> <span class="o">=</span> <span class="n">maxval</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span>
                <span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;All-NaN slice encountered&#39;</span><span class="p">)</span>
            <span class="n">maxrawval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span><span class="p">)</span> <span class="k">if</span> <span class="n">flag</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="k">else</span> <span class="mf">0.0</span>
            <span class="n">minval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__scaledimage</span><span class="p">)</span> <span class="k">if</span> <span class="n">flag</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">else</span> <span class="mf">0.0</span>
        <span class="n">channels</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__scaledimage</span><span class="p">,</span> <span class="s2">&quot;shape&quot;</span><span class="p">)</span> \
           <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__scaledimage</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span>
                    <span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;All-NaN (slice|axis) encountered&#39;</span><span class="p">)</span>
                <span class="n">nch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scaledimage</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">channels</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__scaledimage</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">])</span>
                     <span class="k">if</span> <span class="n">flag</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">else</span> <span class="mf">0.0</span><span class="p">,</span>
                     <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__scaledimage</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">])</span>
                     <span class="k">if</span> <span class="n">flag</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="k">else</span> <span class="mf">0.0</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nch</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">channels</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">maxval</span><span class="p">,</span> <span class="n">meanval</span><span class="p">,</span> <span class="n">varval</span><span class="p">,</span> <span class="n">minval</span><span class="p">,</span> <span class="n">maxrawval</span><span class="p">,</span>  <span class="n">maxsval</span><span class="p">,</span> <span class="n">channels</span><span class="p">)</span>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_checkHighMasking</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; reads the mask image, select non-zero elements</span>
<span class="sd">            and store the indices</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__highvaluemaskwg</span><span class="o">.</span><span class="n">mask</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setMaskValue</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setMaskValue</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">maskhighvalue</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showhighvaluemask</span><span class="p">:</span>
            <span class="n">maskhighvalue</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLavueState</span><span class="p">({</span><span class="s2">&quot;maskhighvalue&quot;</span><span class="p">:</span> <span class="n">maskhighvalue</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span><span class="p">()</span>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_checkMasking</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; replots the image with mask if mask exists</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setApplyMask</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">applyMask</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__maskimage</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__maskwg</span><span class="o">.</span><span class="n">noImage</span><span class="p">()</span>
        <span class="n">maskfile</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__maskwg</span><span class="o">.</span><span class="n">isMaskApplied</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">maskimagename</span><span class="p">:</span>
            <span class="n">maskfile</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">maskimagename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLavueState</span><span class="p">({</span><span class="s2">&quot;maskfile&quot;</span><span class="p">:</span> <span class="n">maskfile</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span><span class="p">()</span>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_prepareMasking</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imagename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; reads the mask image, select non-zero elements</span>
<span class="sd">            and store the indices</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">imagename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">imagename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">imagename</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">imagename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.nxs&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">imagename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.h5&quot;</span><span class="p">)</span> \
               <span class="ow">or</span> <span class="n">imagename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.nx&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">imagename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.ndf&quot;</span><span class="p">):</span>
                <span class="n">fieldpath</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">growing</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">frame</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">handler</span> <span class="o">=</span> <span class="n">imageFileHandler</span><span class="o">.</span><span class="n">NexusFieldHandler</span><span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">imagename</span><span class="p">))</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">findImageFields</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">fields</span><span class="p">:</span>
                    <span class="n">imgfield</span> <span class="o">=</span> <span class="n">imageField</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="n">imgfield</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="n">fields</span>
                    <span class="n">imgfield</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">imgfield</span><span class="o">.</span><span class="n">createGUI</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">imgfield</span><span class="o">.</span><span class="n">exec_</span><span class="p">():</span>
                        <span class="n">fieldpath</span> <span class="o">=</span> <span class="n">imgfield</span><span class="o">.</span><span class="n">field</span>
                        <span class="n">growing</span> <span class="o">=</span> <span class="n">imgfield</span><span class="o">.</span><span class="n">growing</span>
                        <span class="n">frame</span> <span class="o">=</span> <span class="n">imgfield</span><span class="o">.</span><span class="n">frame</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span>
                    <span class="n">currentfield</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="n">fieldpath</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__maskimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">handler</span><span class="o">.</span><span class="n">getImage</span><span class="p">(</span>
                        <span class="n">currentfield</span><span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">],</span>
                        <span class="n">frame</span><span class="p">,</span> <span class="n">growing</span><span class="p">,</span> <span class="n">refresh</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__maskimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span>
                    <span class="n">imageFileHandler</span><span class="o">.</span><span class="n">ImageFileHandler</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">imagename</span><span class="p">))</span><span class="o">.</span><span class="n">getImage</span><span class="p">())</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">zeromask</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setMaskIndices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__maskimage</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setMaskIndices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__maskimage</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__maskimage</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># @debugmethod</span>
    <span class="k">def</span> <span class="nf">__remasking</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; recalculates the mask</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__maskimage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">zeromask</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setMaskIndices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__maskimage</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setMaskIndices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__maskimage</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_checkBkgSubtraction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; replots the image with subtranction if background image exists</span>

<span class="sd">        :param state: checkbox state</span>
<span class="sd">        :type state:  :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dobkgsubtraction</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dobkgsubtraction</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scbackgroundimage</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__bkgsubwg</span><span class="o">.</span><span class="n">setDisplayedName</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__bkgsubwg</span><span class="o">.</span><span class="n">checkBkgSubtraction</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setDoBkgSubtraction</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="n">bkgfile</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bkgsubwg</span><span class="o">.</span><span class="n">isBkgSubApplied</span><span class="p">()</span> <span class="ow">and</span> \
           <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">bkgimagename</span><span class="p">:</span>
            <span class="n">bkgfile</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">bkgimagename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLavueState</span><span class="p">({</span><span class="s2">&quot;bkgfile&quot;</span><span class="p">:</span> <span class="n">bkgfile</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span><span class="p">()</span>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_checkBFSubtraction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; replots the image with subtranction if background image exists</span>

<span class="sd">        :param state: checkbox state</span>
<span class="sd">        :type state:  :obj:`int`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dobfsubtraction</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dobfsubtraction</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scbrightfieldimage</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__normwg</span><span class="o">.</span><span class="n">setDisplayedBFName</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__normwg</span><span class="o">.</span><span class="n">checkBFSubtraction</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setDoBFSubtraction</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="n">bffile</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__normwg</span><span class="o">.</span><span class="n">isBFSubApplied</span><span class="p">()</span> <span class="ow">and</span> \
           <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">bfimagename</span><span class="p">:</span>
            <span class="n">bffile</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">bfimagename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLavueState</span><span class="p">({</span><span class="s2">&quot;brightfieldfile&quot;</span><span class="p">:</span> <span class="n">bffile</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span><span class="p">()</span>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_prepareBkgSubtraction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imagename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; reads the background image</span>

<span class="sd">        :param imagename: image name</span>
<span class="sd">        :type imagename: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">imagename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">imagename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">imagename</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">imagename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.nxs&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">imagename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.h5&quot;</span><span class="p">)</span> \
               <span class="ow">or</span> <span class="n">imagename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.nx&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">imagename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.ndf&quot;</span><span class="p">):</span>
                <span class="n">fieldpath</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">growing</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">frame</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">handler</span> <span class="o">=</span> <span class="n">imageFileHandler</span><span class="o">.</span><span class="n">NexusFieldHandler</span><span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">imagename</span><span class="p">))</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">findImageFields</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">fields</span><span class="p">:</span>
                    <span class="n">imgfield</span> <span class="o">=</span> <span class="n">imageField</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="n">imgfield</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="n">fields</span>
                    <span class="n">imgfield</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">imgfield</span><span class="o">.</span><span class="n">createGUI</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">imgfield</span><span class="o">.</span><span class="n">exec_</span><span class="p">():</span>
                        <span class="n">fieldpath</span> <span class="o">=</span> <span class="n">imgfield</span><span class="o">.</span><span class="n">field</span>
                        <span class="n">growing</span> <span class="o">=</span> <span class="n">imgfield</span><span class="o">.</span><span class="n">growing</span>
                        <span class="n">frame</span> <span class="o">=</span> <span class="n">imgfield</span><span class="o">.</span><span class="n">frame</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span>
                    <span class="n">currentfield</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="n">fieldpath</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__backgroundimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span>
                        <span class="n">handler</span><span class="o">.</span><span class="n">getImage</span><span class="p">(</span>
                            <span class="n">currentfield</span><span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">],</span>
                            <span class="n">frame</span><span class="p">,</span> <span class="n">growing</span><span class="p">,</span> <span class="n">refresh</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_updateBkgScale</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__backgroundimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span>
                    <span class="n">imageFileHandler</span><span class="o">.</span><span class="n">ImageFileHandler</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">imagename</span><span class="p">))</span><span class="o">.</span><span class="n">getImage</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_updateBkgScale</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__backgroundimage</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__scbackgroundimage</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__updatebfmdf</span><span class="p">()</span>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_prepareBFSubtraction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imagename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; reads the brightfield image</span>

<span class="sd">        :param imagename: image name</span>
<span class="sd">        :type imagename: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">imagename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">imagename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">imagename</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">imagename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.nxs&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">imagename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.h5&quot;</span><span class="p">)</span> \
               <span class="ow">or</span> <span class="n">imagename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.nx&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">imagename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.ndf&quot;</span><span class="p">):</span>
                <span class="n">fieldpath</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">growing</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">frame</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">handler</span> <span class="o">=</span> <span class="n">imageFileHandler</span><span class="o">.</span><span class="n">NexusFieldHandler</span><span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">imagename</span><span class="p">))</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">findImageFields</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">fields</span><span class="p">:</span>
                    <span class="n">imgfield</span> <span class="o">=</span> <span class="n">imageField</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="n">imgfield</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="n">fields</span>
                    <span class="n">imgfield</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">imgfield</span><span class="o">.</span><span class="n">createGUI</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">imgfield</span><span class="o">.</span><span class="n">exec_</span><span class="p">():</span>
                        <span class="n">fieldpath</span> <span class="o">=</span> <span class="n">imgfield</span><span class="o">.</span><span class="n">field</span>
                        <span class="n">growing</span> <span class="o">=</span> <span class="n">imgfield</span><span class="o">.</span><span class="n">growing</span>
                        <span class="n">frame</span> <span class="o">=</span> <span class="n">imgfield</span><span class="o">.</span><span class="n">frame</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span>
                    <span class="n">currentfield</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="n">fieldpath</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__brightfieldimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span>
                        <span class="n">handler</span><span class="o">.</span><span class="n">getImage</span><span class="p">(</span>
                            <span class="n">currentfield</span><span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">],</span>
                            <span class="n">frame</span><span class="p">,</span> <span class="n">growing</span><span class="p">,</span> <span class="n">refresh</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__brightfieldimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span>
                    <span class="n">imageFileHandler</span><span class="o">.</span><span class="n">ImageFileHandler</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">imagename</span><span class="p">))</span><span class="o">.</span><span class="n">getImage</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_updateBFScale</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__brightfield</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__updatebfmdf</span><span class="p">()</span>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_setCurrentImageAsBkg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sets the chrrent image as the background image</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__backgroundimage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_updateBkgScale</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__bkgsubwg</span><span class="o">.</span><span class="n">setDisplayedName</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__imagename</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__bkgsubwg</span><span class="o">.</span><span class="n">setDisplayedName</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_updateBkgScale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fetchscale</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">fetchscale</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__backgroundscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bkgsubwg</span><span class="o">.</span><span class="n">bkgScalingFactor</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__backgroundimage</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__scbackgroundimage</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__backgroundscale</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> \
                <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">showsubsf</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__scbackgroundimage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__backgroundimage</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__scbackgroundimage</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">__backgroundimage</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__backgroundscale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__updatebfmdf</span><span class="p">()</span>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_updateBFScale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fetchscale</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">fetchscale</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__brightfieldscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__normwg</span><span class="o">.</span><span class="n">bfScalingFactor</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__brightfieldimage</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__scbrightfieldimage</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__brightfieldscale</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> \
                <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">shownormsf</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__scbrightfieldimage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__brightfieldimage</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__scbrightfieldimage</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">__brightfieldimage</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__brightfieldscale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__updatebfmdf</span><span class="p">()</span>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_setCurrentImageAsBF</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sets the chrrent image as the brightfield image</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__brightfieldimage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rawgreyimage</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_updateBFScale</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__normwg</span><span class="o">.</span><span class="n">setDisplayedBFName</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__imagename</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__normwg</span><span class="o">.</span><span class="n">setDisplayedBFName</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__updatebfmdf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sets brightfield - darkfield image</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scbrightfieldimage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> \
           <span class="bp">self</span><span class="o">.</span><span class="n">__scbackgroundimage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__bfmdfimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">true_divide</span><span class="p">(</span>
                        <span class="mi">1</span><span class="p">,</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__scbrightfieldimage</span>
                         <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scbackgroundimage</span><span class="p">),</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">floattype</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__bfmdfimage</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__bfmdfimage</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_checkBFSubtraction</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__brightfieldimage</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__scbrightfieldimage</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__dobfsubtraction</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="kn">import</span> <span class="nn">traceback</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">messageBox</span><span class="o">.</span><span class="n">MessageBox</span><span class="o">.</span><span class="n">getText</span><span class="p">(</span>
                    <span class="s2">&quot;lavue: Bright field image does not match &quot;</span>
                    <span class="s2">&quot;to the current image&quot;</span><span class="p">)</span>
                <span class="n">messageBox</span><span class="o">.</span><span class="n">MessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;lavue: Bright field image does not match &quot;</span>
                    <span class="s2">&quot;to the current image&quot;</span><span class="p">,</span>
                    <span class="n">text</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__bfmdfimage</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scbrightfieldimage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__bfmdfimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">true_divide</span><span class="p">(</span>
                    <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scbrightfieldimage</span><span class="p">,</span>
                    <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">floattype</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__bfmdfimage</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__bfmdfimage</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__bfmdfimage</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_assessFilters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; assesses the filter on/off state</span>

<span class="sd">        :param state: assess filter status</span>
<span class="sd">        :type state:  :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__filterstate</span> <span class="o">!=</span> <span class="n">state</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__filterstate</span> <span class="o">=</span> <span class="n">state</span>
            <span class="k">for</span> <span class="n">flt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__filters</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">state</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">flt</span><span class="p">,</span> <span class="s2">&quot;initialize&quot;</span><span class="p">):</span>
                            <span class="n">flt</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">flt</span><span class="p">,</span> <span class="s2">&quot;terminate&quot;</span><span class="p">):</span>
                            <span class="n">flt</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__filterswg</span><span class="o">.</span><span class="n">setState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="kn">import</span> <span class="nn">traceback</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>
                    <span class="n">messageBox</span><span class="o">.</span><span class="n">MessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;lavue: problems in starting or stoping filters&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span>
                    <span class="c1"># print(str(e))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">setLavueState</span><span class="p">({</span><span class="s2">&quot;filters&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__filterstate</span><span class="p">)})</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__displayimage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span><span class="p">()</span>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_assessTransformation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trafoname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; assesses the transformation and replot it</span>

<span class="sd">        :param imagename: transformation name</span>
<span class="sd">        :type imagename: :obj:`str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__trafoname</span> <span class="o">=</span> <span class="n">trafoname</span>
        <span class="k">if</span> <span class="n">trafoname</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="s2">&quot;transpose&quot;</span><span class="p">,</span> <span class="s2">&quot;rot90 (clockwise)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;rot270 (clockwise)&quot;</span><span class="p">,</span> <span class="s2">&quot;rot180 + transpose&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__trafowg</span><span class="o">.</span><span class="n">setKeepCoordsLabel</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">keepcoords</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__trafowg</span><span class="o">.</span><span class="n">setKeepCoordsLabel</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__settings</span><span class="o">.</span><span class="n">keepcoords</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLavueState</span><span class="p">({</span><span class="s2">&quot;transformation&quot;</span><span class="p">:</span> <span class="n">trafoname</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span><span class="p">()</span>

<div class="viewcode-block" id="LiveViewer.keyPressEvent"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.liveViewer.LiveViewer.keyPressEvent">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">keyPressEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; skips escape key action</span>

<span class="sd">        :param event: close event</span>
<span class="sd">        :type event:  :class:`pyqtgraph.QtCore.QEvent`:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">!=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Key_Escape</span><span class="p">:</span>
            <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QDialog</span><span class="o">.</span><span class="n">keyPressEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span></div>
        <span class="c1"># else:</span>
        <span class="c1">#     self.closeEvent(None)</span>

<div class="viewcode-block" id="LiveViewer.setrgb"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.liveViewer.LiveViewer.setrgb">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">setrgb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sets RGB on/off</span>

<span class="sd">        :param status: True for on and False for off</span>
<span class="sd">        :type status: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">setrgb</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setrgb</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span><span class="p">()</span></div>

    <span class="nd">@debugmethod</span>
    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_setRGBState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sets RGB on/off</span>

<span class="sd">        :param status: True for on and False for off</span>
<span class="sd">        :type status: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__levelswg</span><span class="o">.</span><span class="n">setrgb</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">setrgb</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLavueState</span><span class="p">({</span><span class="s2">&quot;channel&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__channelwg</span><span class="o">.</span><span class="n">channelLabel</span><span class="p">()})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span><span class="p">()</span>

<div class="viewcode-block" id="LiveViewer.rgb"><a class="viewcode-back" href="../../develop/lavuelib/lavuelib.html#lavuelib.liveViewer.LiveViewer.rgb">[docs]</a>    <span class="nd">@debugmethod</span>
    <span class="k">def</span> <span class="nf">rgb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; gets RGB on/off</span>

<span class="sd">        :returns: True for on and False for off</span>
<span class="sd">        :rtype: :obj:`bool`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__imagewg</span><span class="o">.</span><span class="n">rgb</span><span class="p">()</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">LaVue 2.78.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017 DESY, Jan Kotanski &lt;jkotan@mail.desy.de&gt;, Christoph Rosemann &lt;christoph.rosemann@desy.de&gt; 

GNU GENERAL PUBLIC LICENSE, version 2.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.4.
    </div>
  </body>
</html>